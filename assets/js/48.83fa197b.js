(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{410:function(s,a,e){"use strict";e.r(a);var t=e(11),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"user-ini-htaccess配置文件利用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-ini-htaccess配置文件利用"}},[s._v("#")]),s._v(" .user.ini .htaccess配置文件利用")]),s._v(" "),a("h2",{attrs:{id:"user-ini"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-ini"}},[s._v("#")]),s._v(" .user.ini")]),s._v(" "),a("p",[s._v("php.ini是php的配置文件，.user.ini是用户自定义的php配置文件，.user.ini文件仅作用于他"),a("strong",[s._v("所在的文件夹及所有子文件夹")])]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("警告")]),s._v(" "),a("p",[s._v("利用前提，当前目录存在一个php文件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("- index.php\n- other.php\n- upload\n    - .user.ini\n    - 1.php\n    - files\n        - 3.php\n    - evil.png\n- css\n- js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("在这个目录中，.user.ini会影响到1.php以及子目录files下的php文件3.php的行为")]),s._v(" "),a("p",[s._v("例如，在upload目录下存在图片马evil.png")]),s._v(" "),a("p",[s._v(".user.ini内容如下")]),s._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("auto_prepend_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("evil.png")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("访问1.php，会先包含evil.png并执行其中的php代码")]),s._v(" "),a("h3",{attrs:{id:"php中常被利用的配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php中常被利用的配置项"}},[s._v("#")]),s._v(" PHP中常被利用的配置项")]),s._v(" "),a("ul",[a("li",[s._v("allow_url_fopen：是否允许从远程服务器获取文件")]),s._v(" "),a("li",[s._v("allow_url_include：是否允许包含远程文件")]),s._v(" "),a("li",[s._v("auto_prepend_file：在执行目标文件之前，先包含指定的文件")]),s._v(" "),a("li",[s._v("auto_append_file：在执行目标文件之后，包含指定的文件")])]),s._v(" "),a("p",[s._v("前两个可以用于文件包含，php伪协议利用。后两个用于文件上传，文件包含。")]),s._v(" "),a("h2",{attrs:{id:"htaccess"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#htaccess"}},[s._v("#")]),s._v(" .htaccess")]),s._v(" "),a("p",[s._v(".htaccess文件是apache服务器中的一个配置文件，可以控制服务器的行为")]),s._v(" "),a("h3",{attrs:{id:"常利用的配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常利用的配置项"}},[s._v("#")]),s._v(" 常利用的配置项")]),s._v(" "),a("ul",[a("li",[s._v("AddType：添加文件类型")]),s._v(" "),a("li",[s._v("AddHandler：添加文件处理器")]),s._v(" "),a("li",[s._v("php_value: 设置php.ini中的值")])]),s._v(" "),a("p",[s._v("jpg文件做为php解析")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("AddType application/x-httpd-php .jpg\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("所有文件作为php解析")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("SetHandler application/x-http-php\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("通过php_value来配置PHP的配置选项。")]),s._v(" "),a("p",[s._v("利用文件包含，对于文件内容进行base64编码包含")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v('# 支持php伪协议\nphp_value auto_prepend_file "php://filter/convert.base64-decode/resource=./poc.jpg"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("在一些php web文件上传严格的waf下，刀法精准到文件内容的每一个字符如`=<?反引号、等号、尖括号、问号时，可以考虑目标只审计了文件内容的前面部分内容，尝试通过填充大量垃圾内容绕过")]),s._v(" "),a("p",[s._v("参考：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_65279640/article/details/137843949",target:"_blank",rel:"noopener noreferrer"}},[s._v("文件上传漏洞之.htaccess文件"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.anquanke.com/post/id/205098",target:"_blank",rel:"noopener noreferrer"}},[s._v(".htaccess利用与Bypass方式总结"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);